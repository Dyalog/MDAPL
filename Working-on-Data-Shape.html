
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>8. Working on Data Shape &#8212; Mastering Dyalog APL</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. Special Syntax" href="Special-Syntax.html" />
    <link rel="prev" title="7. Execute &amp; Format Control" href="Execute-and-Format-Control.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Mastering Dyalog APL</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction.html">
   1. Introduction - Will You Play APL With Me?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Getting-Started.html">
   2. Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Data-and-Variables.html">
   3. Data and Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Some-Primitive-Functions.html">
   4. Some Primitive Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="User-Defined-Functions.html">
   5. User-Defined Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="First-Aid-Kit.html">
   6. First-Aid Kit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Execute-and-Format-Control.html">
   7. Execute &amp; Format Control
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   8. Working on Data Shape
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Special-Syntax.html">
   9. Special Syntax
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Nested-Arrays-Continued.html">
   10. Nested Arrays (Continued)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Operators.html">
   11. Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Tacit-Programming.html">
   12. Tacit Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendices.html">
   13. Appendices
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Dyalog/MDAPL"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Dyalog/MDAPL/edit/master/docs/Working-on-Data-Shape.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/Working-on-Data-Shape.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#take-and-drop">
   8.1. Take and Drop
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-and-drop-applied-to-vectors">
     8.1.1. Take and Drop Applied to Vectors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#starter">
       8.1.1.1. Starter
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#be-careful">
       8.1.1.2. Be Careful
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#produce-empty-vectors">
       8.1.1.3. Produce Empty Vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#take-more-cash-than-you-have">
       8.1.1.4. Take More Cash Than You Have
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#three-basic-applications">
     8.1.2. Three Basic Applications
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#determine-the-type-of-a-variable">
       8.1.2.1. Determine the Type of a Variable
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#change-a-vector-into-a-matrix">
       8.1.2.2. Change a Vector into a Matrix
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculate-growth-rates">
       8.1.2.3. Calculate Growth Rates
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-and-drop-applied-to-arrays">
     8.1.3. Take and Drop Applied to Arrays
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#maximal-length-left-argument">
       8.1.3.1. Maximal-Length Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#short-left-argument">
       8.1.3.2. Short Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#short-left-argument-with-axis-specification">
       8.1.3.3. Short Left Argument with Axis Specification
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#laminate">
   8.2. Laminate
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications-to-vectors-and-scalars">
     8.2.1. Applications to Vectors and Scalars
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#laminate-applied-to-vectors">
       8.2.1.1. Laminate Applied to Vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#laminate-scalars-with-vectors">
       8.2.1.2. Laminate Scalars with Vectors
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications">
     8.2.2. Applications
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interlace-matrices">
       8.2.2.1. Interlace Matrices
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#show-vectors">
       8.2.2.2. Show Vectors
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#expand">
   8.3. Expand
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-use">
     8.3.1. Basic Use
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extended-definition">
     8.3.2. Extended Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expand-along-first-axis">
     8.3.3. Expand Along First Axis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reverse-and-transpose">
   8.4. Reverse and Transpose
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caveats-to-be-aware-of">
     8.4.1. Caveats to be Aware Of
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rotate">
   8.5. Rotate
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rotate-vectors">
     8.5.1. Rotate Vectors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rotate-higher-rank-arrays">
     8.5.2. Rotate Higher-Rank Arrays
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#uniform-rotation">
       8.5.2.1. Uniform Rotation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-rotations">
       8.5.2.2. Multiple Rotations
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#application">
       8.5.2.3. Application
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dyadic-transpose">
   8.6. Dyadic Transpose
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   8.7. Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   8.8. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-about-laminate">
     8.8.1. More About Laminate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-on-dyadic-transpose">
     8.8.2. More on Dyadic Transpose
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conditions">
       8.8.2.1. Conditions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#diagonal-sections-of-an-array">
       8.8.2.2. Diagonal Sections of an Array
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#diagonal-section-of-a-matrix">
       8.8.2.3. Diagonal Section of a Matrix
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   8.9. Solutions
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Working on Data Shape</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#take-and-drop">
   8.1. Take and Drop
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-and-drop-applied-to-vectors">
     8.1.1. Take and Drop Applied to Vectors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#starter">
       8.1.1.1. Starter
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#be-careful">
       8.1.1.2. Be Careful
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#produce-empty-vectors">
       8.1.1.3. Produce Empty Vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#take-more-cash-than-you-have">
       8.1.1.4. Take More Cash Than You Have
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#three-basic-applications">
     8.1.2. Three Basic Applications
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#determine-the-type-of-a-variable">
       8.1.2.1. Determine the Type of a Variable
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#change-a-vector-into-a-matrix">
       8.1.2.2. Change a Vector into a Matrix
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculate-growth-rates">
       8.1.2.3. Calculate Growth Rates
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-and-drop-applied-to-arrays">
     8.1.3. Take and Drop Applied to Arrays
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#maximal-length-left-argument">
       8.1.3.1. Maximal-Length Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#short-left-argument">
       8.1.3.2. Short Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#short-left-argument-with-axis-specification">
       8.1.3.3. Short Left Argument with Axis Specification
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#laminate">
   8.2. Laminate
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications-to-vectors-and-scalars">
     8.2.1. Applications to Vectors and Scalars
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#laminate-applied-to-vectors">
       8.2.1.1. Laminate Applied to Vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#laminate-scalars-with-vectors">
       8.2.1.2. Laminate Scalars with Vectors
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications">
     8.2.2. Applications
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interlace-matrices">
       8.2.2.1. Interlace Matrices
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#show-vectors">
       8.2.2.2. Show Vectors
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#expand">
   8.3. Expand
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-use">
     8.3.1. Basic Use
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extended-definition">
     8.3.2. Extended Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expand-along-first-axis">
     8.3.3. Expand Along First Axis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reverse-and-transpose">
   8.4. Reverse and Transpose
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caveats-to-be-aware-of">
     8.4.1. Caveats to be Aware Of
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rotate">
   8.5. Rotate
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rotate-vectors">
     8.5.1. Rotate Vectors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rotate-higher-rank-arrays">
     8.5.2. Rotate Higher-Rank Arrays
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#uniform-rotation">
       8.5.2.1. Uniform Rotation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-rotations">
       8.5.2.2. Multiple Rotations
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#application">
       8.5.2.3. Application
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dyadic-transpose">
   8.6. Dyadic Transpose
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   8.7. Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   8.8. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-about-laminate">
     8.8.1. More About Laminate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-on-dyadic-transpose">
     8.8.2. More on Dyadic Transpose
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conditions">
       8.8.2.1. Conditions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#diagonal-sections-of-an-array">
       8.8.2.2. Diagonal Sections of an Array
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#diagonal-section-of-a-matrix">
       8.8.2.3. Diagonal Section of a Matrix
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   8.9. Solutions
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="working-on-data-shape">
<span id="working-on-data-shape-working-on-data-shape"></span><h1><span class="section-number">8. </span>Working on Data Shape<a class="headerlink" href="#working-on-data-shape" title="Permalink to this headline">#</a></h1>
<p>In many programming languages, the programmer has to declare the dimensions of an array statically, and it is often possible to operate on the individual items using programmer-written loops.</p>
<p>In contrast to this, because APL processes arrays in their entirety, it is important to be able to manage the dimensions of an array dynamically.
This is why this chapter presents a number of new tools that will help you perform these tasks.</p>
<p>We have already studied functions which create arrays with specific shapes:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Name</p></th>
<th class="text-align:center head"><p>Syntax</p></th>
<th class="text-align:left head"><p>Explanation</p></th>
<th class="text-align:left head"><p>Section</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Reshape</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">x⍴y</span></code></p></td>
<td class="text-align:left"><p>Creates a new array with dimensions <code class="docutils literal notranslate"><span class="pre">x</span></code> and the data from <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></td>
<td class="text-align:left"><p><a class="reference internal" href="Data-and-Variables.html#data-and-variables-create-a-list-or-a-matrix"><span class="std std-numref">Section 3.2.1</span></a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Catenate</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">x,y</span></code></p></td>
<td class="text-align:left"><p>Creates a new array by gluing <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> together.</p></td>
<td class="text-align:left"><p><a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-catenate"><span class="std std-numref">Section 4.11</span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Ravel</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">,y</span></code></p></td>
<td class="text-align:left"><p>Creates a vector from any array.</p></td>
<td class="text-align:left"><p><a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-ravel"><span class="std std-numref">Section 4.16</span></a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Compress</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">x/y</span></code></p></td>
<td class="text-align:left"><p>Selects parts of an array.</p></td>
<td class="text-align:left"><p><a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-basic-approach-compress"><span class="std std-numref">Section 4.12.1</span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Replicate</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">x/y</span></code></p></td>
<td class="text-align:left"><p>Generally replicates the items of an array.</p></td>
<td class="text-align:left"><p><a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-general-case-replicate"><span class="std std-numref">Section 4.12.2</span></a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Indexing</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">x[y]</span></code></p></td>
<td class="text-align:left"><p>Creates a new array, often with modified dimensions.</p></td>
<td class="text-align:left"><p><a class="reference internal" href="Data-and-Variables.html#data-and-variables-indexing"><span class="std std-numref">Section 3.5</span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Index function</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">x⌷y</span></code></p></td>
<td class="text-align:left"><p>Creates a new array, often with modified dimensions.</p></td>
<td class="text-align:left"><p><a class="reference internal" href="Data-and-Variables.html#data-and-variables-the-index-function"><span class="std std-numref">Section 3.5.6</span></a></p></td>
</tr>
</tbody>
</table>
<div class="section" id="take-and-drop">
<span id="working-on-data-shape-take-and-drop"></span><h2><span class="section-number">8.1. </span>Take and Drop<a class="headerlink" href="#take-and-drop" title="Permalink to this headline">#</a></h2>
<div class="section" id="take-and-drop-applied-to-vectors">
<span id="working-on-data-shape-take-and-drop-applied-to-vectors"></span><h3><span class="section-number">8.1.1. </span>Take and Drop Applied to Vectors<a class="headerlink" href="#take-and-drop-applied-to-vectors" title="Permalink to this headline">#</a></h3>
<div class="section" id="starter">
<span id="working-on-data-shape-starter"></span><h4><span class="section-number">8.1.1.1. </span>Starter<a class="headerlink" href="#starter" title="Permalink to this headline">#</a></h4>
<p>There are two functions, <em>take</em> (<code class="docutils literal notranslate"><span class="pre">↑</span></code>) and <em>drop</em> (<code class="docutils literal notranslate"><span class="pre">↓</span></code>), that can be used to extract or remove a number of elements from the beginning or end of a vector.
The number is the left argument and its sign controls if the extraction/removal is done from the beginning or end of the vector.</p>
<ul class="simple">
<li><p><em>Take</em> extracts the vector’s head or tail; and</p></li>
<li><p><em>Drop</em> removes the vector’s head or tail, and hence selects the remaining part.</p></li>
</ul>
<p>Let us test these functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nums</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">56</span><span class="w"> </span><span class="m">66</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">68</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">82</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>With a positive left argument <code class="docutils literal notranslate"><span class="pre">n</span></code>, <em>take</em> extracts the first <code class="docutils literal notranslate"><span class="pre">n</span></code> items:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="o">↑</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">56 66 19 37
</span></div></div>
</div>
<p>It works on any kind of data (numbers, text),</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="o">↑</span><span class="s1">&#39;My name is Bond&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">My na
</span></div></div>
</div>
<p>including nested arrays:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↑</span><span class="p">(</span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">35</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">21</span><span class="p">)(</span><span class="m">42</span><span class="w"> </span><span class="m">73</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───────────┐
│6 2│35 33 26 21│
└───┴───────────┘
</span></div></div>
</div>
<p>With a negative left argument <code class="docutils literal notranslate"><span class="pre">n</span></code>, it extracts the last <code class="docutils literal notranslate"><span class="pre">|n</span></code> items of the vector, in their normal order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯3</span><span class="o">↑</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">68 70 82
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯6</span><span class="o">↑</span><span class="s1">&#39;Mississippi&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ssippi
</span></div></div>
</div>
<p>Sometimes, these two operations are referred to as taking the “head” of the vector (with a positive left argument) and taking the “tail” of the vector (with a negative left argument).</p>
<p>With a positive left argument <code class="docutils literal notranslate"><span class="pre">n</span></code>, <em>drop</em> removes the first <code class="docutils literal notranslate"><span class="pre">n</span></code> items and returns the tail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="o">↓</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">44 20 18 23 68 70 82
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="o">↓</span><span class="s1">&#39;My name is Bond&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">me is Bond
</span></div></div>
</div>
<p>With a negative left argument <code class="docutils literal notranslate"><span class="pre">n</span></code>, it removes the last <code class="docutils literal notranslate"><span class="pre">|n</span></code> items and returns the head:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯6</span><span class="o">↓</span><span class="s1">&#39;Mississippi&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Missi
</span></div></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>You will have noticed that <code class="docutils literal notranslate"><span class="pre">4↑nums</span></code> and <code class="docutils literal notranslate"><span class="pre">¯7↓nums</span></code> both gave the same result <code class="docutils literal notranslate"><span class="pre">56</span> <span class="pre">66</span> <span class="pre">19</span> <span class="pre">37</span></code>.</p>
<p>At first sight it would appear that there is no need for both of these functions, and that one or other of <em>take</em> and <em>drop</em> is redundant.
There are, however, some differences that make it necessary to have both functions, as we will soon see.</p>
</div>
</div>
<div class="section" id="be-careful">
<span id="working-on-data-shape-be-careful"></span><h4><span class="section-number">8.1.1.2. </span>Be Careful<a class="headerlink" href="#be-careful" title="Permalink to this headline">#</a></h4>
<p>Do not confuse the two following expressions.</p>
<p>We can take the <strong>last</strong> three items of a vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯3</span><span class="o">↑</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">68 70 82
</span></div></div>
</div>
<p>Or we can take the first three items, and then change their sign:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="m">3</span><span class="o">↑</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯56 ¯66 ¯19
</span></div></div>
</div>
<p>On another note, the result of <em>take</em> and <em>drop</em> applied to a vector remains a vector, even if it has only one item:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="m">1</span><span class="o">↑</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="m">10</span><span class="o">↓</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Although the results of the two expressions above would contain only one item, they are 1-item vectors, and not scalars.</p>
</div>
<div class="section" id="produce-empty-vectors">
<span id="working-on-data-shape-produce-empty-vectors"></span><h4><span class="section-number">8.1.1.3. </span>Produce Empty Vectors<a class="headerlink" href="#produce-empty-vectors" title="Permalink to this headline">#</a></h4>
<p>Of course, if you take no items, or if you drop all the items, the result is an empty vector of the same type (numeric or character) as the original vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="o">↑</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">22</span><span class="o">↓</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">14</span><span class="o">↓</span><span class="s1">&#39;Empty&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<p>Although all of the results above are empty vectors, we know that they are different if the original vectors have different types of data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">22</span><span class="o">↓</span><span class="nv">nums</span><span class="p">)</span><span class="o">≡</span><span class="p">(</span><span class="m">14</span><span class="o">↓</span><span class="s1">&#39;Empty&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Take a look at <a class="reference internal" href="Data-and-Variables.html#data-and-variables-empty-arrays"><span class="std std-numref">Section 3.7</span></a> for a reminder of how empty arrays work.</p>
</div>
<div class="section" id="take-more-cash-than-you-have">
<span id="working-on-data-shape-take-more-cash-than-you-have"></span><h4><span class="section-number">8.1.1.4. </span>Take More Cash Than You Have<a class="headerlink" href="#take-more-cash-than-you-have" title="Permalink to this headline">#</a></h4>
<p>The <em>take</em> function has a very special property: it allows you to take more items than there really are.
If so, it pads the result with <em>fill items</em>; zeroes for a numeric vector, and blanks for a text vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cash</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">92</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If we take too many items, zeroes are appended to the vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="o">↑</span><span class="nv">cash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">45 23 18 92 0 0 0
</span></div></div>
</div>
<p>With negative left arguments, starting from the tail, the zeroes are placed before the existing items:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯9</span><span class="o">↑</span><span class="nv">cash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 45 23 18 92
</span></div></div>
</div>
<p>For character vectors, spaces are appended:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">12</span><span class="o">↑</span><span class="s1">&#39;Invisible&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Invisible   
</span></div></div>
</div>
<p>However, you have to be careful because those do not show:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">12</span><span class="o">↑</span><span class="s1">&#39;Invisible&#39;</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;.&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Invisible   .
</span></div></div>
</div>
<p>Starting from the right, with a negative left argument, the blanks are appended to the left and are a bit easier to see:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯12</span><span class="o">↑</span><span class="s1">&#39;Visible&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     Visible
</span></div></div>
</div>
<p>In fact, the concept of <em>fill item</em> is a bit more complex than this; it will be studied in detail in <a class="reference internal" href="Nested-Arrays-Continued.html#nested-arrays-continued-type-prototype-fill-item"><span class="std std-numref">Section 10.9</span></a>.</p>
<p>The concept of “taking more than you have” is sometimes referred to as <em>overtaking</em>.
This is an application of <em>take</em> that cannot be performed using <em>drop</em> alone.</p>
<p>This property applies equally to empty vectors; they are filled with as many zeroes or blanks as specified.
This means that the result will be different for empty numeric and empty character vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">4</span><span class="o">↑</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────┐
│0 0 0 0│
└~──────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">4</span><span class="o">↑</span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───┐
│    │
└────┘
</span></div></div>
</div>
</div>
</div>
<div class="section" id="three-basic-applications">
<span id="working-on-data-shape-three-basic-applications"></span><h3><span class="section-number">8.1.2. </span>Three Basic Applications<a class="headerlink" href="#three-basic-applications" title="Permalink to this headline">#</a></h3>
<div class="section" id="determine-the-type-of-a-variable">
<span id="working-on-data-shape-determine-the-type-of-a-variable"></span><h4><span class="section-number">8.1.2.1. </span>Determine the Type of a Variable<a class="headerlink" href="#determine-the-type-of-a-variable" title="Permalink to this headline">#</a></h4>
<p>The property we have just seen can be used to determine whether an array is numeric or character, provided that it is simple and homogeneous (neither <em>mixed</em> nor <em>nested</em>).
The method is simple: create an empty vector “filled” with the array (<code class="docutils literal notranslate"><span class="pre">0⍴⍵</span></code>), then take one item of it (<code class="docutils literal notranslate"><span class="pre">1↑</span></code>), and compare with <code class="docutils literal notranslate"><span class="pre">0</span></code>.
This will return <code class="docutils literal notranslate"><span class="pre">1</span></code> (true) for a numeric array, and <code class="docutils literal notranslate"><span class="pre">0</span></code> (false) for a character array.
A little dfn will do that for us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TypeOf</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">0</span><span class="o">=</span><span class="m">1</span><span class="o">↑</span><span class="m">0</span><span class="o">⍴</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TypeOf</span><span class="w"> </span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TypeOf</span><span class="w"> </span><span class="s1">&#39;Character vector&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>This function wouldn’t work on a mixed or nested variable.
Again, you will understand why when we talk about <em>fill items</em> in <a class="reference internal" href="Nested-Arrays-Continued.html#nested-arrays-continued-type-prototype-fill-item"><span class="std std-numref">Section 10.9</span></a>.
We shall see in <span class="xref myst">a later chapter</span> that APL has a <em>system function</em> that does the job much better.</p>
</div>
<div class="section" id="change-a-vector-into-a-matrix">
<span id="working-on-data-shape-change-a-vector-into-a-matrix"></span><h4><span class="section-number">8.1.2.2. </span>Change a Vector into a Matrix<a class="headerlink" href="#change-a-vector-into-a-matrix" title="Permalink to this headline">#</a></h4>
<p>Sometimes you want a variable <code class="docutils literal notranslate"><span class="pre">var</span></code> to be a matrix, although you are not sure of its current rank.</p>
<p>If it is already a matrix, you want to leave it unchanged, and if it is a vector, you want to change it into a one-row matrix.
The following function should help:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HorMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="m">¯2</span><span class="o">↑</span><span class="m">1</span><span class="o">,⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍴</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Notice that the shape of the following matrix remains unchanged:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">HorMat</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5
</span></div></div>
</div>
<p>But the vector is “promoted” into a matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">HorMat</span><span class="w"> </span><span class="s1">&#39;This is a vector&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 16
</span></div></div>
</div>
<p>Let’s break down how <code class="docutils literal notranslate"><span class="pre">HorMat</span></code> works:</p>
<ol class="simple">
<li><p>we first append <code class="docutils literal notranslate"><span class="pre">1</span></code> to the shape of the argument, which gives <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">3</span> <span class="pre">5</span></code> for the matrix and <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">16</span></code> for the vector;</p></li>
<li><p>next, we keep only the last two items, which gives <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">5</span></code> for the matrix and <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">16</span></code> for the vector;</p></li>
<li><p>the final <em>reshape</em> returns an unchanged matrix, or transforms a vector intro a matrix.</p></li>
</ol>
<p>We can change vectors into 1-column matrices with a very similar function, which also leaves matrices unchanged:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">VerMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="m">2</span><span class="o">↑</span><span class="p">(</span><span class="o">⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="m">1</span><span class="p">)</span><span class="o">⍴</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">VerMat</span><span class="w"> </span><span class="s1">&#39;Vertically?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">V
e
r
t
i
c
a
l
l
y
?
</span></div></div>
</div>
</div>
<div class="section" id="calculate-growth-rates">
<span id="working-on-data-shape-calculate-growth-rates"></span><h4><span class="section-number">8.1.2.3. </span>Calculate Growth Rates<a class="headerlink" href="#calculate-growth-rates" title="Permalink to this headline">#</a></h4>
<p>Let us imagine a business with a turnover which has grown over 12 years.
The variable <code class="docutils literal notranslate"><span class="pre">tome</span></code> is TurnOver in Millions of Euros:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tome</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">56</span><span class="w"> </span><span class="m">59</span><span class="w"> </span><span class="m">67</span><span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="m">68</span><span class="w"> </span><span class="m">73</span><span class="w"> </span><span class="m">78</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">81</span><span class="w"> </span><span class="m">84</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We want to calculate the difference between each year and the next; how do we achieve this?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">↓</span><span class="nv">tome</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">59 67 64 60 61 68 73 78 75 81 84
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">↓</span><span class="nv">tome</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">56 59 67 64 60 61 68 73 78 75 81
</span></div></div>
</div>
<p>All that remains is to subtract the results of these expressions one from the other, item by item:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">tome</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">tome</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 8 ¯3 ¯4 1 7 5 5 ¯3 6 3
</span></div></div>
</div>
<p>If instead of subtraction we used division, we would calculate (with some adjustments) the rates of growth instead of the differences.
Let us upt that in a small dfn, and apply it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Growth</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">100</span><span class="o">×</span><span class="p">((</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷</span><span class="p">(</span><span class="m">¯1</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">))</span><span class="o">-</span><span class="m">1</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⍕</span><span class="nv">Growth</span><span class="w"> </span><span class="nv">tome</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 5.36 13.56 ¯4.48 ¯6.25 1.67 11.48 7.35 6.85 ¯3.85 8.00 3.70
</span></div></div>
</div>
</div>
</div>
<div class="section" id="take-and-drop-applied-to-arrays">
<span id="working-on-data-shape-take-and-drop-applied-to-arrays"></span><h3><span class="section-number">8.1.3. </span>Take and Drop Applied to Arrays<a class="headerlink" href="#take-and-drop-applied-to-arrays" title="Permalink to this headline">#</a></h3>
<p>The functions <em>take</em> and <em>drop</em> can be applied to any array so long as the left argument contains a number of items that is equal to or smaller than the number of dimensions (the <em>rank</em>) of the array.</p>
<p>In the expressions <code class="docutils literal notranslate"><span class="pre">ns↑array</span></code> and <code class="docutils literal notranslate"><span class="pre">ns↓array</span></code>, <code class="docutils literal notranslate"><span class="pre">≢ns</span></code> must be less than or equal to <code class="docutils literal notranslate"><span class="pre">≢⍴array</span></code>.</p>
<p>For the examples that follow, we shall work on the following matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">13</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">81</span><span class="w"> </span><span class="m">42</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">47</span><span class="w"> </span><span class="m">51</span><span class="w"> </span><span class="m">73</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">19</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mat</span></code> is an integer matrix but <em>take</em> and <em>drop</em> work the same for character arrays, and even for <em>nested</em> and/or <em>mixed</em> arrays.</p>
<div class="section" id="maximal-length-left-argument">
<span id="working-on-data-shape-maximal-length-left-argument"></span><h4><span class="section-number">8.1.3.1. </span>Maximal-Length Left Argument<a class="headerlink" href="#maximal-length-left-argument" title="Permalink to this headline">#</a></h4>
<p>We start by exploring what happens when the left argument has the maximal length it can have, that is, when <code class="docutils literal notranslate"><span class="pre">(≢ns)=≢⍴array</span></code> in the expression <code class="docutils literal notranslate"><span class="pre">ns↑array</span></code> or <code class="docutils literal notranslate"><span class="pre">ns↓array</span></code>.</p>
<p>If we want to take the 2 top rows and the 3 left columns of <code class="docutils literal notranslate"><span class="pre">mat</span></code>, we write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">↑</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 52 33
42 62 70
</span></div></div>
</div>
<p>The elements of the left argument are paired up with the axes of the right argument array, and that is why <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3↑mat</span></code> takes 2 <em>rows</em> and then 3 <em>columns</em>, because the first axis specifies the number of rows and the second one the number of columns.</p>
<p>In order to drop the top row and 2 columns <em>from the right</em>, we write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">¯2</span><span class="o">↓</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">42 62
51 73
</span></div></div>
</div>
<p>If we take 5 rows starting from the bottom and 3 columns starting from the left, we get</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯5</span><span class="w"> </span><span class="m">3</span><span class="o">↑</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 0  0  0
 0  0  0
13 52 33
42 62 70
51 73 28
</span></div></div>
</div>
<p>The two extra rows are added on the top of <code class="docutils literal notranslate"><span class="pre">mat</span></code> because we asked for 5 rows <em>starting from the bottom</em>.</p>
<p>Dropping 1 row starting from the bottom and 3 columns starting from the left, we get</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="w"> </span><span class="m">3</span><span class="o">↓</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">81
47
</span></div></div>
</div>
<p>In the example above, we have dropped 3 out of the 4 columns available, so there is only one left, but it is still a 1-column matrix; it has not been changed into a vector.
This is similar to how <code class="docutils literal notranslate"><span class="pre">1↑vector</span></code> in a vector returns a 1-element vector, not a scalar.
In short, the functions <em>take</em> and <em>drop</em> return a result with the same rank as the right argument, regardless of the number of elements in the result.</p>
<p>As for vectors, it is often possible to use <em>take</em> or <em>drop</em> interchangeably to obtain the same result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">¯3</span><span class="o">↑</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">52 33 81
62 70 47
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="w"> </span><span class="m">1</span><span class="o">↓</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">52 33 81
62 70 47
</span></div></div>
</div>
</div>
<div class="section" id="short-left-argument">
<span id="working-on-data-shape-short-left-argument"></span><h4><span class="section-number">8.1.3.2. </span>Short Left Argument<a class="headerlink" href="#short-left-argument" title="Permalink to this headline">#</a></h4>
<!-- (TODO) Write about Leading Axis Theory somewhere and talk about this example -->
<p>If one or more of the trailing dimensions of the array are to remain unchanged, then one need only specify the parameters for the leading dimensions.</p>
<p>For example, suppose that we want to extract the first 2 rows of <code class="docutils literal notranslate"><span class="pre">mat</span></code>.
We know its shape is <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">4</span></code>, so we can easily write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">↑</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 52 33 81
42 62 70 47
</span></div></div>
</div>
<p>But if we didn’t know its shape in advance, we would have to resort to something like</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="o">,</span><span class="m">¯1</span><span class="o">↑⍴</span><span class="nv">mat</span><span class="p">)</span><span class="o">↑</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 52 33 81
42 62 70 47
</span></div></div>
</div>
<p>which is a bit cumbersome and, as it turns out, far from optimal.</p>
<p>In a matrix, the first axis denotes the rows, so we can pick the first 2 rows by just specifying the <code class="docutils literal notranslate"><span class="pre">2</span></code> in the left argument to <em>take</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↑</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 52 33 81
42 62 70 47
</span></div></div>
</div>
<p>This works for arrays of arbitrarily high rank.
For example, recall the 3D array <code class="docutils literal notranslate"><span class="pre">prod</span></code>, that contained monthly (12) production values of 2 assembly lines, throughout the course of 5 years:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">prod</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">12</span><span class="o">⍴</span><span class="m">50</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36
34 19 32 12 37 15 46 24 49 28 36  9

29  5 45 23 27  4 23 16 39 22 22  2
46 20 47 17 18 25 13 38 42 38 45 28

37 19  5 10 30 49 16 18 46 47 47  3
39 23 41 20  6 40 21 22 40 49 20  1

13 36 12 40 12 15 24 20 21 12 19 25
 8 48 22 37 33  1 39 30 50 50  8 35

38 31 24 40 23  7 20 34 35  6 19 27
41  1 14 50 17 42  6 35 12 48 30 29
</span></div></div>
</div>
<p>We can get the production values for the first 2 years with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↑</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36
34 19 32 12 37 15 46 24 49 28 36  9

29  5 45 23 27  4 23 16 39 22 22  2
46 20 47 17 18 25 13 38 42 38 45 28
</span></div></div>
</div>
<p>But we can also get the production values for the first 4 years and only for the first assembly line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="o">↑</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36

29  5 45 23 27  4 23 16 39 22 22  2

37 19  5 10 30 49 16 18 46 47 47  3

13 36 12 40 12 15 24 20 21 12 19 25
</span></div></div>
</div>
<p>Naturally, <em>drop</em> can also be used with a left argument whose length is smaller than the rank of the argument.
For example, we can drop the first row of a matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">↓</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">42 62 70 47
51 73 28 19
</span></div></div>
</div>
<p>Or we can drop the production values of the <em>last</em> year and of the first assembly line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="w"> </span><span class="m">1</span><span class="o">↓</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">34 19 32 12 37 15 46 24 49 28 36  9

46 20 47 17 18 25 13 38 42 38 45 28

39 23 41 20  6 40 21 22 40 49 20  1

 8 48 22 37 33  1 39 30 50 50  8 35
</span></div></div>
</div>
<p>In <a class="reference internal" href="#working-on-data-shape-exercises"><span class="std std-numref">Section 8.7</span></a> you can find a rule to compute the shape of the final result of a <em>take</em> (or <em>drop</em>) operation in terms of the left argument and the shape of the right argument.</p>
</div>
<div class="section" id="short-left-argument-with-axis-specification">
<span id="working-on-data-shape-short-left-argument-with-axis-specification"></span><h4><span class="section-number">8.1.3.3. </span>Short Left Argument with Axis Specification<a class="headerlink" href="#short-left-argument-with-axis-specification" title="Permalink to this headline">#</a></h4>
<p>When you provide a left argument that has less elements than the number of axes on the right argument, the left argument defaults to referring to the leading axes of the right argument.
However, we can use <em>take</em> and <em>drop</em> with <em>axis</em> <code class="docutils literal notranslate"><span class="pre">[]</span></code> to specify other axes.</p>
<p>For example, the first 2 rows of <code class="docutils literal notranslate"><span class="pre">mat</span></code> were obtained with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↑</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 52 33 81
42 62 70 47
</span></div></div>
</div>
<p>Using <em>axis</em>, we can just as easily get the first 2 columns of <code class="docutils literal notranslate"><span class="pre">mat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↑</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 52
42 62
51 73
</span></div></div>
</div>
<p>This also extends to higher rank.
If we want the information regarding the first 3 years, and only the final 6 months of the year (but for all assembly lines), we can write:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">¯6</span><span class="o">↑</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="sr">]</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">11 45 17 37 29 36
46 24 49 28 36  9

23 16 39 22 22  2
13 38 42 38 45 28

16 18 46 47 47  3
21 22 40 49 20  1
</span></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="laminate">
<span id="working-on-data-shape-laminate"></span><h2><span class="section-number">8.2. </span>Laminate<a class="headerlink" href="#laminate" title="Permalink to this headline">#</a></h2>
<p>We have previously used <em>catenate</em> to glue one array to another; let us now look at a new method.</p>
<p>We shall work with the following two character matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">names</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="s1">&#39;AlexAnnaMark&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Alex
Anna
Mark
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">surnames</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="s1">&#39;GainNairTyte&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Gain
Nair
Tyte
</span></div></div>
</div>
<p>The <em>catenation</em> of those two matrices will not change the <em>rank</em> of the arrays, and thus give another matrix, as we saw in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-catenate"><span class="std std-numref">Section 4.11</span></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">names</span><span class="o">,</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">AlexGain
AnnaNair
MarkTyte
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">names</span><span class="o">⍪</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Alex
Anna
Mark
Gain
Nair
Tyte
</span></div></div>
</div>
<p>If both matrices have exactly the same shape, it is possible to join them together along a new dimension to make a 3D array.
Because this operation produces a result of higher rank than its arguments, it is called <em>laminate</em> rather than <em>catenate</em>.</p>
<p>The symbol representing <em>catenate</em> and <em>laminate</em> is the same (<code class="docutils literal notranslate"><span class="pre">,</span></code>), but when the comma is used as <em>laminate</em> it is always used with a fractional <em>axis</em>.</p>
<p>The two arrays we intend to <em>laminate</em> have the same shape: <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">4</span></code>.
Because we are going to laminate 2 arrays, the new dimension will have a length of 2, and the shape of the result will be some combination of <code class="docutils literal notranslate"><span class="pre">3</span></code>, <code class="docutils literal notranslate"><span class="pre">4</span></code>, and <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Let us examine all the possibilities:</p>
<ul class="simple">
<li><p><code>2 3   4  </code> – the new dimension is inserted before the first dimension;</p></li>
<li><p><code>  3 2 4  </code> – the new dimension is inserted between the first and second dimensions;</p></li>
<li><p><code>  3   4 2</code> – the new dimension is inserted after the second dimension.</p></li>
</ul>
<p>To obtain these three different results, we shall use <em>laminate</em> with a fractional axis to specify where the new dimension is to be inserted:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">names,[0.5]surnames</span></code> will produce a result of shape <code>2 3   4  </code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">names,[1.5]surnames</span></code> will produce a result of shape <code>  3 2 4  </code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">names,[2.5]surnames</span></code> will produce a result of shape <code>  3   4 2</code>.</p></li>
</ul>
<p>Beware that we could have equally used <code class="docutils literal notranslate"><span class="pre">⍪</span></code>.</p>
<p>Here are the three cases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Alex
Anna
Mark

Gain
Nair
Tyte
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Alex
Gain

Anna
Nair

Mark
Tyte
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">2.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">AG
la
ei
xn

AN
na
ni
ar

MT
ay
rt
ke
</span></div></div>
</div>
<p>In fact, the value of the axis specifier just identifies the <em>position</em> of the new dimension relative to the values 1 and 2, so it could be any other fractional value between 0 and 1, or 1 and 2, or 2 and 3, respectively.</p>
<p>Hence, the three matches that we see below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">0.295</span><span class="sr">]</span><span class="nv">surnames</span><span class="p">)</span><span class="o">≡</span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">1.643</span><span class="sr">]</span><span class="nv">surnames</span><span class="p">)</span><span class="o">≡</span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">2.107</span><span class="sr">]</span><span class="nv">surnames</span><span class="p">)</span><span class="o">≡</span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">2.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Of course, it would be somewhat obtuse to use such axis specifications, and programmers conventionally use “<code class="docutils literal notranslate"><span class="pre">n.5</span></code>” values, like the ones in our examples.</p>
<div class="section" id="applications-to-vectors-and-scalars">
<span id="working-on-data-shape-applications-to-vectors-and-scalars"></span><h3><span class="section-number">8.2.1. </span>Applications to Vectors and Scalars<a class="headerlink" href="#applications-to-vectors-and-scalars" title="Permalink to this headline">#</a></h3>
<p>Now that we understand the reason for the fractional axis, which is perhaps initially somewhat surprising, we can apply <em>laminate</em> to all kind of arrays.</p>
<div class="section" id="laminate-applied-to-vectors">
<span id="working-on-data-shape-laminate-applied-to-vectors"></span><h4><span class="section-number">8.2.1.1. </span>Laminate Applied to Vectors<a class="headerlink" href="#laminate-applied-to-vectors" title="Permalink to this headline">#</a></h4>
<p>Let us use both character and numeric vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t1</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;tomatoes&#39;</span><span class="w"></span>
<span class="nv">t2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;potatoes&#39;</span><span class="w"></span>
<span class="nv">n1</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">88</span><span class="w"></span>
<span class="nv">n2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">×⍳</span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If we catenate them, we still obtain vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t1</span><span class="o">,</span><span class="nv">t2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">tomatoespotatoes
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">n1</span><span class="o">,</span><span class="nv">n2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14 62 32 88 10 20 30 40
</span></div></div>
</div>
<p>But if we instead laminate them, we obtain matrices with either 2 rows or 2 columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t1</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">t2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">tomatoes
potatoes
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t1</span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">t2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">tp
oo
mt
aa
tt
oo
ee
ss
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">n1</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">n2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14 62 32 88
10 20 30 40
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">n1</span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">n2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14 10
62 20
32 30
88 40
</span></div></div>
</div>
<p>Of course, since we are working with 1-dimensional arrays, we cannot specify an axis equal to or greater than 2.</p>
<p>There is also no reason for why you wouldn’t be able to laminate a character vector with a numeric vector, for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t1</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">n1</span><span class="o">,</span><span class="nv">n2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> t  o  m  a  t  o  e  s
14 62 32 88 10 20 30 40
</span></div></div>
</div>
</div>
<div class="section" id="laminate-scalars-with-vectors">
<span id="working-on-data-shape-laminate-scalars-with-vectors"></span><h4><span class="section-number">8.2.1.2. </span>Laminate Scalars with Vectors<a class="headerlink" href="#laminate-scalars-with-vectors" title="Permalink to this headline">#</a></h4>
<p>Scalars can be laminated with any array: they are repeated as many times as necessary to match the length of the new dimension:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">n1</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14 62 32 88
 0  0  0  0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">n1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 14
1 62
1 32
1 88
</span></div></div>
</div>
<p>This can be used, for example, to underline a title:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">title</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Laminate is good for you&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Without <em>laminate</em>, we must create a matrix with 2 rows, and as many columns as the length of <code class="docutils literal notranslate"><span class="pre">title</span></code>, filled with <code class="docutils literal notranslate"><span class="pre">title</span></code> itself, followed by as many dashes as the length of <code class="docutils literal notranslate"><span class="pre">title</span></code>: boring!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="o">,≢</span><span class="nv">title</span><span class="p">)</span><span class="o">⍴</span><span class="nv">title</span><span class="o">,</span><span class="p">(</span><span class="o">≢</span><span class="nv">title</span><span class="p">)</span><span class="o">⍴</span><span class="s1">&#39;-&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Laminate is good for you
------------------------
</span></div></div>
</div>
<p>Now, with <em>laminate</em>, we just have to laminate a single dash; it will be repeated as many times as necessary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">title</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="s1">&#39;-&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Laminate is good for you
------------------------
</span></div></div>
</div>
</div>
</div>
<div class="section" id="applications">
<span id="working-on-data-shape-applications"></span><h3><span class="section-number">8.2.2. </span>Applications<a class="headerlink" href="#applications" title="Permalink to this headline">#</a></h3>
<div class="section" id="interlace-matrices">
<span id="working-on-data-shape-interlace-matrices"></span><h4><span class="section-number">8.2.2.1. </span>Interlace Matrices<a class="headerlink" href="#interlace-matrices" title="Permalink to this headline">#</a></h4>
<p>Do you remember that, in <a class="reference internal" href="User-Defined-Functions.html"><span class="doc std std-doc">the chapter about user-defined functions</span></a>, we wrote a function to interlace two matrices?
It is no longer relevant; we can solve the problem more simply using <em>laminate</em>.</p>
<p>Can you see how? Give it some thought, if you will.</p>
<p>Take a look at the result of <code class="docutils literal notranslate"><span class="pre">names,[2.5]surnames</span></code> above.
You will see that the names are on the left and the surnames are on the right.
If we reshape that result with appropriate dimensions, we shall obtain <code class="docutils literal notranslate"><span class="pre">names</span></code> and <code class="docutils literal notranslate"><span class="pre">surnames</span></code> interlaced 😊 :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">×⍴</span><span class="nv">names</span><span class="p">)</span><span class="o">⍴</span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">2.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">AGlaeixn
ANnaniar
MTayrtke
</span></div></div>
</div>
<p>The result isn’t easy to read, but the expression works!</p>
<p>Hence, our new implementation of <code class="docutils literal notranslate"><span class="pre">Interlace</span></code> could be</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Interlace</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">×⍴</span><span class="bp">⍺</span><span class="p">)</span><span class="o">⍴</span><span class="bp">⍺</span><span class="o">,</span><span class="sr">[</span><span class="m">2.5</span><span class="sr">]</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We can apply the same technique to matrices of forecasts and actuals, provided we define them first:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">forecast</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">×?</span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="m">55</span><span class="w"></span>
<span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">actual</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">forecast</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">¯10</span><span class="o">+?</span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">forecast</span><span class="w"> </span><span class="nv">Interlace</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90  89 160 166 420 420 500 508  20  12  30  23
110 111 450 453 170 177 370 365 290 284 360 352
340 349 190 192 320 329 120 115 510 515 370 374
150 160 460 467 240 234 520 519 490 485 280 283
</span></div></div>
</div>
</div>
<div class="section" id="show-vectors">
<span id="working-on-data-shape-show-vectors"></span><h4><span class="section-number">8.2.2.2. </span>Show Vectors<a class="headerlink" href="#show-vectors" title="Permalink to this headline">#</a></h4>
<p>Sometimes you will have two vectors that are related, and you would like to display them side by side.
You might have a character vector and you would like to display it side by side with a Boolean vector indicating the positions of vowels in the character vector, so that you can verify visually if the result is correct:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;National Aeronautics and Space Administration&#39;</span><span class="w"></span>
<span class="nv">vowels</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">vowels</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">N a t i o n a l   A e r o n a u t i c s   a n d   S p a c e   A d m i n i s t r a t i o n
0 1 0 1 1 0 1 0 0 0 1 0 1 0 1 1 0 1 0 0 0 1 0 0 0 0 0 1 0 1 0 0 0 0 1 0 1 0 0 0 1 0 1 1 0
</span></div></div>
</div>
<p>By looking at the above, you would be able to see more easily that your result missed the capital vowels, and you would then proceed to fixing your function.</p>
<p>This was a simple example of where laminating two vectors might prove useful, but this ad-hoc technique might also be useful in slightly more complex scenarios.
Suppose that we have four vectors containing information about certain products: their price, their current discount, their quantity in stock, and their availability (physical store, online, or both):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">23</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">discount</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">35</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">stock</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">103</span><span class="w"> </span><span class="m">98</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">64</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">availability</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;SSBOB&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 4 15 8 23
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 25 25 35
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">103 98 50 23 64
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">SSBOB
</span></div></div>
</div>
<p>The output shown above is not ideal, because each individual vector is displayed using its own natural format, and it is extremely difficult to connect the four related pieces of information to a specific product.
We can have these values displayed much better if we create a matrix.</p>
<p>To produce a matrix we will need to laminate two of the vectors and catenate the others (in rows or in columns).
The results are much easier to read:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">price</span><span class="o">⍪</span><span class="nv">discount</span><span class="o">⍪</span><span class="nv">stock</span><span class="o">⍪</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">availability</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  2  4 15  8 23
  0  0 25 25 35
103 98 50 23 64
  S  S  B  O  B
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">price</span><span class="o">,</span><span class="nv">discount</span><span class="o">,</span><span class="nv">stock</span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">availability</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 2  0 103 S
 4  0  98 S
15 25  50 B
 8 25  23 O
23 35  64 B
</span></div></div>
</div>
<p>In these examples, there is only one <em>laminate</em>, followed by as many <em>catenates</em> as needed.</p>
</div>
</div>
</div>
<div class="section" id="expand">
<span id="working-on-data-shape-expand"></span><h2><span class="section-number">8.3. </span>Expand<a class="headerlink" href="#expand" title="Permalink to this headline">#</a></h2>
<div class="section" id="basic-use">
<span id="working-on-data-shape-basic-use"></span><h3><span class="section-number">8.3.1. </span>Basic Use<a class="headerlink" href="#basic-use" title="Permalink to this headline">#</a></h3>
<p>You remember that simple <em>compress</em> uses a Boolean vector of 1s and 0s as a mask to include or exclude specific items of an array.</p>
<p>Simple <em>expand</em> (specified by the <code class="docutils literal notranslate"><span class="pre">\</span></code> symbol) also uses a Boolean vector of 1s and 0s, but the 0s <em>insert</em> new items into the array.
It is used as follows: <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">pattern\argument</span></code>.</p>
<p>In this form, the Boolean vector left argument contains a 1 for each item of the right argument, and a 0 for each item to insert.
For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="m">11</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">57</span><span class="w"> </span><span class="m">69</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">11 28 0 32 0 0 40 57 69
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="s1">&#39;Africa&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Af r  ica
</span></div></div>
</div>
<p>If the right argument is numeric, <em>expand</em> inserts zeroes, and if it is a character vector, <em>expand</em> inserts blanks as <em>fill items</em>.
For mixed or nested arrays, the concept of <em>fill item</em> is more complex and, as mentioned before, will be explained in <a class="reference internal" href="Nested-Arrays-Continued.html#nested-arrays-continued-type-prototype-fill-item"><span class="std std-numref">Section 10.9</span></a>.</p>
</div>
<div class="section" id="extended-definition">
<span id="working-on-data-shape-extended-definition"></span><h3><span class="section-number">8.3.2. </span>Extended Definition<a class="headerlink" href="#extended-definition" title="Permalink to this headline">#</a></h3>
<p>We can extend the behaviour of <em>extend</em> to handle cases where the left argument is not a simple Boolean vector, but contains integers other than just 0s and 1s:</p>
<ul class="simple">
<li><p>the amount of positive numbers in the left argument should match the length of the right argument;</p></li>
<li><p>for each positive item in the left argument, the corresponding item in the right argument is replicated as many times as is specified by that value;</p></li>
<li><p>each negative item in the left argument inserts an equivalent number of <em>fill items</em> in the same position; and</p></li>
<li><p>zeroes in the left argument mean the same as <code class="docutils literal notranslate"><span class="pre">¯1</span></code>, and they each insert one fill item.</p></li>
</ul>
<p>In the description above, we assumed that the right argument is a vector.
We will cover the fully generic case in a bit.</p>
<p>Because it is an extension of it, this new definition is fully compatible with the Boolean case we described before.</p>
<p>Here is an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="m">11</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">57</span><span class="w"> </span><span class="m">69</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">11 28 0 32 32 32 0 0 40 57 69
</span></div></div>
</div>
<p>The first two items remain unchanged.
Then a zero inserts a zero in the result.
The next value is repeated 3 times, and the value <code class="docutils literal notranslate"><span class="pre">¯2</span></code> inserts 2 zeroes.
The last 3 items are unchanged.</p>
<p>The same thing can be done using a character vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="s1">&#39;expand&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ex ppp  and
</span></div></div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">¯1</span></code> have the same effect when used in the left argument of <em>expand</em>, we can obtain the same result with a different pattern:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="s1">&#39;expand&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ex ppp  and
</span></div></div>
</div>
<p>Naturally, the function can work on any shape of array, in which case <code class="docutils literal notranslate"><span class="pre">\</span></code> acts on the last axis of the right argument, by default.</p>
<p>For example, if we take our <code class="docutils literal notranslate"><span class="pre">chemistry</span></code> matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="s1">&#39;H2SO4CaCO3Fe2O3&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2SO4
CaCO3
Fe2O3
</span></div></div>
</div>
<p>We can insert one extra column by using <em>expand</em> with a Boolean left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2 SO4
Ca CO3
Fe 2O3
</span></div></div>
</div>
<p>We can further specify the axis along which we want to act, to change the default:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2SO4

CaCO3

Fe2O3
</span></div></div>
</div>
<p>The axis specified can be the same as the default, making it redundant, but otherwise completely correct:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">¯3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="na">\</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H   2SO 444
C   aCO 333
F   e2O 333
</span></div></div>
</div>
<p>With arrays of rank higher than 1, the description provided above remains the same, except that <em>extend</em> no longer operates on single items of the right argument, but on its sub-arrays along the given axis (the last one, if left unspecified) instead.</p>
<p><em>Expand</em> can also be used on scalars; they are repeated as many times as necessary to fit the number of positive values in the left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="s1">&#39;A&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  AA  AA
</span></div></div>
</div>
<p>The above is equivalent to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="s1">&#39;AAAA&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  AA  AA
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="m">71</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 71 71 71 71 0 0 71 71
</span></div></div>
</div>
</div>
<div class="section" id="expand-along-first-axis">
<span id="working-on-data-shape-expand-along-first-axis"></span><h3><span class="section-number">8.3.3. </span>Expand Along First Axis<a class="headerlink" href="#expand-along-first-axis" title="Permalink to this headline">#</a></h3>
<p>Like it was mentioned before, <em>expand</em> works on the last dimension of an array.
To work on the first dimension, one can use the function <code class="docutils literal notranslate"><span class="pre">⍀</span></code> (<kbd>APL</kbd>+<kbd>.</kbd>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">1</span><span class="na">⍀</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2SO4
CaCO3


Fe2O3
</span></div></div>
</div>
<p>If one places an axis indication after the symbol <code class="docutils literal notranslate"><span class="pre">\</span></code> or <code class="docutils literal notranslate"><span class="pre">⍀</span></code>, the operation is processed according to the <em>axis</em> operator, whichever of the two symbols is used.
For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vec⍀[3]prod</span></code> and <code class="docutils literal notranslate"><span class="pre">vec\[3]prod</span></code> would be equivalent to <code class="docutils literal notranslate"><span class="pre">vec\prod</span></code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec\[1]forecast</span></code> and <code class="docutils literal notranslate"><span class="pre">vec⍀[1]forecast</span></code> would be equivalent to <code class="docutils literal notranslate"><span class="pre">vec⍀forecast</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="reverse-and-transpose">
<span id="working-on-data-shape-reverse-and-transpose"></span><h2><span class="section-number">8.4. </span>Reverse and Transpose<a class="headerlink" href="#reverse-and-transpose" title="Permalink to this headline">#</a></h2>
<p>APL is also well endowed with functions which pivot data about an axis, and the axis is suggested by the shape of the symbol used.
The functions apply to both numeric and character data.
In the examples we are going to use a character matrix called <code class="docutils literal notranslate"><span class="pre">towns</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">towns</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">10</span><span class="o">⍴</span><span class="s1">&#39;Canberra  Paris     WashingtonMoscow    Martigues Mexico    &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  
Paris     
Washington
Moscow    
Martigues 
Mexico    
</span></div></div>
</div>
<p>The symbols <code class="docutils literal notranslate"><span class="pre">⌽</span></code> (<kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>5</kbd>) and <code class="docutils literal notranslate"><span class="pre">⊖</span></code> (<kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>7</kbd>) are used for two variants of the same function, which is called <em>reverse</em>.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">⍉</span></code> is called <em>transpose</em> and its symbol is typed with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>6</kbd>.</p>
<p>Here are their effects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊢</span><span class="nv">towns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">⌽</span><span class="nv">towns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">⊖</span><span class="nv">towns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">⍉</span><span class="nv">towns</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┬──────────┬──────────┬──────┐
│Canberra  │  arrebnaC│Mexico    │CPWMMM│
│Paris     │     siraP│Martigues │aaaoae│
│Washington│notgnihsaW│Moscow    │nrssrx│
│Moscow    │    wocsoM│Washington│bihcti│
│Martigues │ seugitraM│Paris     │esioic│
│Mexico    │    ocixeM│Canberra  │r nwgo│
│          │          │          │r g u │
│          │          │          │a t e │
│          │          │          │  o s │
│          │          │          │  n   │
└──────────┴──────────┴──────────┴──────┘
</span></div></div>
</div>
<p>The symbols used (<code class="docutils literal notranslate"><span class="pre">⌽</span> <span class="pre">⊖</span> <span class="pre">⍉</span></code>) are self-describing, no effort is required to remember any of them because the position of the bar visually indicates which kind of transformation they stand for.</p>
<p>If you insert an axis specification after the symbols <code class="docutils literal notranslate"><span class="pre">⌽</span></code> or <code class="docutils literal notranslate"><span class="pre">⊖</span></code>, the operation is processed according to the <em>axis</em> operator, whichever of the two symbols is used.
So, for example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⌽[1]matrix</span></code> and <code class="docutils literal notranslate"><span class="pre">⊖[1]matrix</span></code> are both equivalent to <code class="docutils literal notranslate"><span class="pre">⊖matrix</span></code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⌽[2]matrix</span></code> and <code class="docutils literal notranslate"><span class="pre">⊖[2]matrix</span></code> are both equivalent to <code class="docutils literal notranslate"><span class="pre">⌽matrix</span></code>.</p></li>
</ul>
<div class="section" id="caveats-to-be-aware-of">
<span id="working-on-data-shape-caveats-to-be-aware-of"></span><h3><span class="section-number">8.4.1. </span>Caveats to be Aware Of<a class="headerlink" href="#caveats-to-be-aware-of" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><em>Transpose</em> has no effect on a vector, because it has only one axis:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍉</span><span class="s1">&#39;I shall not move&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">I shall not move
</span></div></div>
</div>
<p>On a similar note,</p>
<ul class="simple">
<li><p>The distracted APLer might expect <code class="docutils literal notranslate"><span class="pre">⊖</span></code> to do nothing on vectors, but that is <em>not</em> what happens.</p></li>
</ul>
<p>Visually, <code class="docutils literal notranslate"><span class="pre">⊖</span></code> hints at the fact that it “flips” its argument upside down, and a vector can’t be flipped upside down because it is one-dimensional.
However, <code class="docutils literal notranslate"><span class="pre">⊖</span></code> is called <em>reverse <strong>first</strong></em>, which means it always reverses the argument along its <strong>first</strong> dimension, even if that dimension is the <em>only</em> dimension of the argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊖</span><span class="s1">&#39;I shall not move...!?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">?!...evom ton llahs I
</span></div></div>
</div>
<p>This confusion might arise from the visual similarity of the character vector above and</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">21</span><span class="o">⍴</span><span class="s1">&#39;I shall not move...!?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">I shall not move...!?
</span></div></div>
</div>
<p>The latter is a 1-row matrix, which is why it <em>is</em> left unchanged by <code class="docutils literal notranslate"><span class="pre">⊖</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊖</span><span class="m">1</span><span class="w"> </span><span class="m">21</span><span class="o">⍴</span><span class="s1">&#39;I shall not move...!?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">I shall not move...!?
</span></div></div>
</div>
<ul class="simple">
<li><p><em>Transpose</em> cannot be modified by an axis specifier, because it always operates on all of the dimensions of its argument.</p></li>
<li><p><em>Transpose</em> can be applied to arrays of any rank; let us try it with a 3D character array:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">big</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">names</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">surnames</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Alex
Anna
Mark

Gain
Nair
Tyte
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍉</span><span class="nv">big</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">AG
AN
MT

la
na
ay

ei
ni
rt

xn
ar
ke
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">big</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 3 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⍉</span><span class="nv">big</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 3 2
</span></div></div>
</div>
<p>You can see that <code class="docutils literal notranslate"><span class="pre">⍴⍉big</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">⌽⍴big</span></code>, and the explanation of why this is the case will follow shortly.</p>
<p>All three primitives we just discussed also have (related) dyadic meanings, and those are introduced in two following sections.</p>
</div>
</div>
<div class="section" id="rotate">
<span id="working-on-data-shape-rotate"></span><h2><span class="section-number">8.5. </span>Rotate<a class="headerlink" href="#rotate" title="Permalink to this headline">#</a></h2>
<p>The symbols <code class="docutils literal notranslate"><span class="pre">⌽</span></code> and <code class="docutils literal notranslate"><span class="pre">⊖</span></code>, when used dyadically, shift the items of the right argument in a circular manner.</p>
<p>The dyadic functions are called <em>rotate</em>.</p>
<div class="section" id="rotate-vectors">
<span id="working-on-data-shape-rotate-vectors"></span><h3><span class="section-number">8.5.1. </span>Rotate Vectors<a class="headerlink" href="#rotate-vectors" title="Permalink to this headline">#</a></h3>
<p>Much like in the monadic case, the dyadic usage of <code class="docutils literal notranslate"><span class="pre">⌽</span></code> and <code class="docutils literal notranslate"><span class="pre">⊖</span></code> is identical when applied to vectors (we shall use <code class="docutils literal notranslate"><span class="pre">⌽</span></code> in our examples because of the visual clue that the symbol <code class="docutils literal notranslate"><span class="pre">⌽</span></code> gives with respect to the operation it performs).</p>
<p>Dyadic <code class="docutils literal notranslate"><span class="pre">⌽</span></code> (and <code class="docutils literal notranslate"><span class="pre">⊖</span></code>) expects an integer as the left argument, when the right argument is a vector, like so: <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">n⌽vector</span></code>.</p>
<ul class="simple">
<li><p>when <code class="docutils literal notranslate"><span class="pre">n</span></code> is positive, the first <code class="docutils literal notranslate"><span class="pre">n</span></code> items of <code class="docutils literal notranslate"><span class="pre">vector</span></code> are moved to the end. In other words, the vector is rotated to the left; and</p></li>
<li><p>when <code class="docutils literal notranslate"><span class="pre">n</span></code> is negative, the last <code class="docutils literal notranslate"><span class="pre">n</span></code> items of <code class="docutils literal notranslate"><span class="pre">vector</span></code> are moved to the beginning. In other words, the vector is rotated to the right:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="o">⌽</span><span class="s1">&#39;What did they do to my song?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">d they do to my song?What di
</span></div></div>
</div>
<p>In the example above, the first 7 items of the vector (<code class="docutils literal notranslate"><span class="pre">'What</span> <span class="pre">di'</span></code>) have been moved to the back, whereas if we use a negative argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯7</span><span class="o">⌽</span><span class="s1">&#39;What did they do to my song?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">y song?What did they do to m
</span></div></div>
</div>
<p>the last 7 items of the vector (<code class="docutils literal notranslate"><span class="pre">'y</span> <span class="pre">song?'</span></code>) are moved to the front of the vector.</p>
<p><em>Rotate</em> can of course be applied to numeric vectors as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">56 66 19 37 44 20 18 23 68 70 82
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="o">⌽</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37 44 20 18 23 68 70 82 56 66 19
</span></div></div>
</div>
<p>Do not confuse the following two expressions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯3</span><span class="o">⌽</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">68 70 82 56 66 19 37 44 20 18 23
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="m">3</span><span class="o">⌽</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯37 ¯44 ¯20 ¯18 ¯23 ¯68 ¯70 ¯82 ¯56 ¯66 ¯19
</span></div></div>
</div>
<p>The first one moves 3 items to the beginning, whilst the second expression moves the first 3 items to the end, and then changes the sign of the result (we saw something very similar when we talked about <em>take</em>).
It is all about being careful with the normal and high minus symbols!</p>
</div>
<div class="section" id="rotate-higher-rank-arrays">
<span id="working-on-data-shape-rotate-higher-rank-arrays"></span><h3><span class="section-number">8.5.2. </span>Rotate Higher-Rank Arrays<a class="headerlink" href="#rotate-higher-rank-arrays" title="Permalink to this headline">#</a></h3>
<p>When applied to a matrix or higher-order array, <code class="docutils literal notranslate"><span class="pre">⌽</span></code> works on the last dimension, while <code class="docutils literal notranslate"><span class="pre">⊖</span></code> works on the first dimension.
This default behaviour can be overriden by an <em>axis</em> specification.
To obtain a rotation along any other dimension, the <em>axis</em> specification is mandatory.</p>
<p><em>Rotate</em> can be applied to any array, but we shall only demonstrate its application to matrices.</p>
<div class="section" id="uniform-rotation">
<span id="working-on-data-shape-uniform-rotation"></span><h4><span class="section-number">8.5.2.1. </span>Uniform Rotation<a class="headerlink" href="#uniform-rotation" title="Permalink to this headline">#</a></h4>
<p>In its simplest form, <em>rotate</em> applies the same rotation to all the rows or columns of a matrix; let us see the result produced on a character matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">monMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;January FebruaryMarch   April   May     June    &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">January 
February
March   
April   
May     
June    
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⌽</span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">nuary Ja
bruaryFe
rch   Ma
ril   Ap
y     Ma
ne    Ju
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊖</span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">March   
April   
May     
June    
January 
February
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯2</span><span class="o">⊖</span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">May     
June    
January 
February
March   
April   
</span></div></div>
</div>
</div>
<div class="section" id="multiple-rotations">
<span id="working-on-data-shape-multiple-rotations"></span><h4><span class="section-number">8.5.2.2. </span>Multiple Rotations<a class="headerlink" href="#multiple-rotations" title="Permalink to this headline">#</a></h4>
<p>It is possible to apply a different rotation to each of the rows or to each of the columns.</p>
<p>In this case, the rotation is no longer indicated by a single value, but by a vector which specifies the amount by which each row or column will be moved.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2SO4
CaCO3
Fe2O3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="o">⌽</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4H2SO
CaCO3
2O3Fe
</span></div></div>
</div>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">¯1</span></code> was used to rotate the first row, <code class="docutils literal notranslate"><span class="pre">0</span></code> was used to rotate the second row, and <code class="docutils literal notranslate"><span class="pre">2</span></code> was used to rotate the third row.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">⊖</span></code>, we can rotate columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">January 
February
March   
April   
May     
June    
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⊖</span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Far ar  
Mereua  
Aayuh   
Mpnrl   
Janc  y 
Jubi  ry
</span></div></div>
</div>
</div>
<div class="section" id="application">
<span id="working-on-data-shape-application"></span><h4><span class="section-number">8.5.2.3. </span>Application<a class="headerlink" href="#application" title="Permalink to this headline">#</a></h4>
<p><em>Rotate</em> can provide very simple solutions to many tasks.
For example, let us count how many blanks appear at the end of each row of <code class="docutils literal notranslate"><span class="pre">monMat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 3 3 5 4
</span></div></div>
</div>
<p>We can then use these values to move the blanks to the beginning of each row, thereby right-aligning the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-+</span><span class="na">/</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="nv">monMat</span><span class="p">)</span><span class="o">⌽</span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> January
February
   March
   April
     May
    June
</span></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="dyadic-transpose">
<span id="working-on-data-shape-dyadic-transpose"></span><h2><span class="section-number">8.6. </span>Dyadic Transpose<a class="headerlink" href="#dyadic-transpose" title="Permalink to this headline">#</a></h2>
<p><em>Dyadic transpose</em> is interesting only for arrays of rank higher than 2.
It rotates an array as if to show it from different angles.</p>
<p>Remember our variable called <code class="docutils literal notranslate"><span class="pre">prod</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36
34 19 32 12 37 15 46 24 49 28 36  9

29  5 45 23 27  4 23 16 39 22 22  2
46 20 47 17 18 25 13 38 42 38 45 28

37 19  5 10 30 49 16 18 46 47 47  3
39 23 41 20  6 40 21 22 40 49 20  1

13 36 12 40 12 15 24 20 21 12 19 25
 8 48 22 37 33  1 39 30 50 50  8 35

38 31 24 40 23  7 20 34 35  6 19 27
41  1 14 50 17 42  6 35 12 48 30 29
</span></div></div>
</div>
<p>It is an array with 3 dimensions, which are respectively 5 years, 2 assembly lines, and 12 months.</p>
<p>Suppose we now want to reorganise it into an array of 2 assembly lines, 5 years, and 12 months: a dyadic transposition can do that for us.</p>
<p>The left argument of <em>dyadic transpose</em> specifies the position that you want each dimension to appear in the result.</p>
<p>The shape of <code class="docutils literal notranslate"><span class="pre">prod</span></code> was</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 2 12
</span></div></div>
</div>
<p>but now we want it to become <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">5</span> <span class="pre">12</span></code>.
The years should become the 2nd dimension, the assembly lines should become the 1st dimension, and the months should remain the 3rd dimension, hence the transposition vector will be <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">1</span> <span class="pre">3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="o">⍉</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36
29  5 45 23 27  4 23 16 39 22 22  2
37 19  5 10 30 49 16 18 46 47 47  3
13 36 12 40 12 15 24 20 21 12 19 25
38 31 24 40 23  7 20 34 35  6 19 27

34 19 32 12 37 15 46 24 49 28 36  9
46 20 47 17 18 25 13 38 42 38 45 28
39 23 41 20  6 40 21 22 40 49 20  1
 8 48 22 37 33  1 39 30 50 50  8 35
41  1 14 50 17 42  6 35 12 48 30 29
</span></div></div>
</div>
<p>Alternatively, if we want to reorganise it into an array of 2 assembly lines, 12 months, and 5 years, the method will be the same:</p>
<p>The required new shape is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">12</span> <span class="pre">5</span></code>.</p>
<p>When all dimensions are different from each other, the transposition vector can be generated using dyadic <em>iota</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">tv</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">⍳</span><span class="w"> </span><span class="o">⍴</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 1 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tv</span><span class="o">⍉</span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 29 37 13 38
16  5 19 36 31
42 45  5 12 24
50 23 10 40 40
 2 27 30 12 23
 3  4 49 15  7
11 23 16 24 20
45 16 18 20 34
17 39 46 21 35
37 22 47 12  6
29 22 47 19 19
36  2  3 25 27

34 46 39  8 41
19 20 23 48  1
32 47 41 22 14
12 17 20 37 50
37 18  6 33 17
15 25 40  1 42
46 13 21 39  6
24 38 22 30 35
49 42 40 50 12
28 38 49 50 48
36 45 20  8 30
 9 28  1 35 29
</span></div></div>
</div>
<div class="figure align-default" id="apler-skilled-orange">
<span id="fig-apler-skilled-orange"></span><img alt="_images/APLer-Skilled_Orange.png" src="_images/APLer-Skilled_Orange.png" />
<p class="caption"><span class="caption-number">Fig. 8.1 </span><span class="caption-text">Skilled APLer that is confident with their tools.</span><a class="headerlink" href="#apler-skilled-orange" title="Permalink to this image">#</a></p>
</div>
</div>
<div class="section" id="exercises">
<span id="working-on-data-shape-exercises"></span><h2><span class="section-number">8.7. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<div class="exercise admonition" id="ex-take-drop">

<p class="admonition-title"><span class="caption-number">Exercise 8.1 </span></p>
<div class="section" id="exercise-content">
<p>Given the matrix <code class="docutils literal notranslate"><span class="pre">xg1</span></code> below, try to produce each of the three following matrices; first using only <em>take</em>, and then only <em>drop</em>.</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
<span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">9</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg1</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">1</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 9 5 3 6
5 4 8 2 3
7 7 6 2 6
</span></div></div>
</div>
<div class="exercise admonition" id="ex-overtake">

<p class="admonition-title"><span class="caption-number">Exercise 8.2 </span></p>
<div class="section" id="exercise-content">
<p>With <code class="docutils literal notranslate"><span class="pre">xg1</span></code> again, how could you produce this:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="ex-takedropshape">

<p class="admonition-title"><span class="caption-number">Exercise 8.3 </span></p>
<div class="section" id="exercise-content">
<p>Write two dyadic functions <code class="docutils literal notranslate"><span class="pre">TakeShape</span></code> and <code class="docutils literal notranslate"><span class="pre">DropShape</span></code>.
<code class="docutils literal notranslate"><span class="pre">TakeShape</span></code> computes <code class="docutils literal notranslate"><span class="pre">⍴ns↑array</span></code> and <code class="docutils literal notranslate"><span class="pre">DropShape</span></code> computes <code class="docutils literal notranslate"><span class="pre">⍴ns↓array</span></code>.
The left argument to both functions will be <code class="docutils literal notranslate"><span class="pre">ns</span></code> and the right argument will be <code class="docutils literal notranslate"><span class="pre">⍴array</span></code>.
You can assume that the left argument and right arguments are valid and make sense together.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">¯3</span><span class="w"> </span><span class="nv">TakeShape</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 3 10
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">15</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">¯3</span><span class="w"> </span><span class="nv">DropShape</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 6 7
</span></div></div>
</div>
<div class="exercise admonition" id="ex-takeasdrop">

<p class="admonition-title"><span class="caption-number">Exercise 8.4 </span></p>
<div class="section" id="exercise-content">
<p>Write two dyadic functions, <code class="docutils literal notranslate"><span class="pre">TakeAsDrop</span></code> and <code class="docutils literal notranslate"><span class="pre">DropAsTake</span></code>, that take an array on the right and a vector on the left.
<code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">v</span> <span class="pre">TakeAsDrop</span> <span class="pre">a</span></code> is such that <code class="docutils literal notranslate"><span class="pre">(r↓a)≡v↑a</span></code> whenever possible, and conversely for <code class="docutils literal notranslate"><span class="pre">DropAsTake</span></code>: <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">v</span> <span class="pre">DropAsTake</span></code> is such that <code class="docutils literal notranslate"><span class="pre">(r↑a)≡v↓a</span></code> whenever possible.</p>
</div>
</div>
<p>Test your functions with your solutions to the first exercise.</p>
<div class="exercise admonition" id="ex-showvowels">

<p class="admonition-title"><span class="caption-number">Exercise 8.5 </span></p>
<div class="section" id="exercise-content">
<p>Write a function which “highlights” all the vowels of a given character vector by placing an arrow under them.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ShowVowels</span><span class="w"> </span><span class="s1">&#39;This function works properly&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">This function works properly
  ↑   ↑   ↑↑   ↑      ↑ ↑  ↑
</span></div></div>
</div>
<div class="exercise admonition" id="ex-sparse-matrices">

<p class="admonition-title"><span class="caption-number">Exercise 8.6 </span></p>
<div class="section" id="exercise-content">
<p>Write two monadic functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Contract</span></code> takes a sparse matrix and returns a more compact representation of the same matrix; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Restore</span></code> takes a compact representation of a sparse matrix and builds the full matrix.</p></li>
</ul>
</div>
</div>
<p>For reference, a sparse matrix is a matrix that contains mostly zeroes, like the matrix <code class="docutils literal notranslate"><span class="pre">xg6</span></code> shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg6</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">7</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="nv">xg6</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 8 0 0 3 0
0 7 0 0 0 0 0
6 0 2 0 0 0 1
0 0 0 0 4 0 0
</span></div></div>
</div>
<p>A large sparse matrix may occupy a lot of memory.
To reduce the memory consumption, we can consider an alternative, more compact representation.
For example, we can start by ravelling the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 8 0 0 3 0 0 7 0 0 0 0 0 6 0 2 0 0 0 1 0 0 0 0 4 0 0
</span></div></div>
</div>
<p>Then, we retain only the non-zero values together with their position in the ravel:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">values</span><span class="w">    </span><span class="kd">←</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">2</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">4</span><span class="w"></span>
<span class="nv">positions</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">26</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, if we add the shape of the matrix on the left, we have all the necessary information to restore the original matrix when required:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">2</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="c1">⍝ values</span><span class="w"></span>
<span class="w">  </span><span class="m">7</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">26</span><span class="w">  </span><span class="c1">⍝ positions</span><span class="w"></span>
<span class="c1">⍝ ^ shape of the original matrix</span><span class="w"></span>
</pre></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Contract</span><span class="w"> </span><span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 8 3 7  6  2  1  4
7 3 6 9 15 17 21 26
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg6</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">Restore</span><span class="w"> </span><span class="nv">Contract</span><span class="w"> </span><span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-whiten">

<p class="admonition-title"><span class="caption-number">Exercise 8.7 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">Whiten</span></code> that replaces all occurrences of the character scalar left argument in the character vector right argument with blanks.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;a&#39;</span><span class="w"> </span><span class="nv">Whiten</span><span class="w"> </span><span class="s1">&#39;Panama is a canal between Atlantic and Pacific&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">P n m  is   c n l between Atl ntic  nd P cific
</span></div></div>
</div>
<p>Can you find a solution that uses the function <em>expand</em>?</p>
<div class="exercise admonition" id="ex-ontop">

<p class="admonition-title"><span class="caption-number">Exercise 8.8 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">OnTop</span></code> to centre a title above a character matrix.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">monMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;January FebruaryMarch   April   May     June    &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;2022&#39;</span><span class="w"> </span><span class="nv">OnTop</span><span class="w"> </span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  2022  
--------
January 
February
March   
April   
May     
June    
</span></div></div>
</div>
<div class="exercise admonition" id="ex-rotations">

<p class="admonition-title"><span class="caption-number">Exercise 8.9 </span></p>
<div class="section" id="exercise-content">
<p>Determine the result of the expression <code class="docutils literal notranslate"><span class="pre">¯3</span> <span class="pre">¯1</span> <span class="pre">3⌽(-2</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">2</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">0)⊖xg9</span></code> for the matrix <code class="docutils literal notranslate"><span class="pre">xg9</span></code> given below.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg9</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">9</span><span class="o">⍴</span><span class="s1">&#39;oeornlhtu n siduothf uogYti&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">oeornlhtu
 n siduot
hf uogYti
</span></div></div>
</div>
<div class="exercise admonition" id="ex-free">

<p class="admonition-title"><span class="caption-number">Exercise 8.10 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">Free</span></code> which looks for a sequence of contiguous zeroes in a Boolean vector.
The right argument is the Boolean vector in which to look for the sequence of zeroes and the left argument is the integer that specifies the sequence length to look for.
The function should return the position of the first zero of the first such sequence and, if no such sequence exists, it should return <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg10</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 1 1 1 0 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="nv">Free</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">Free</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">Free</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="nv">Free</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">15
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Free</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="exercise admonition" id="ex-tocolumns">

<p class="admonition-title"><span class="caption-number">Exercise 8.11 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">ToColumns</span></code> that takes an integer scalar left argument and a character matrix right argument.
The function should split the matrix into as many columns as the left argument specifies. Columns should be separated by, at least, a blank.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg11</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;Emily   Luciano Paul    Oxana   Thor    Carmen  VeronicaWilliam VladimirMonica  Colette &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily   
Luciano 
Paul    
Oxana   
Thor    
Carmen  
Veronica
William 
Vladimir
Monica  
Colette 
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">ToColumns</span><span class="w"> </span><span class="nv">xg11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily    Thor     Vladimir
Luciano  Carmen   Monica  
Paul     Veronica Colette 
Oxana    William          
</span></div></div>
</div>
<div class="exercise admonition" id="ex-showcodes">

<p class="admonition-title"><span class="caption-number">Exercise 8.12 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">ShowCodes</span></code> that takes a numeric vector left argument and a character matrix right argument.
The function should display the numerical codes on the left of the rows of the argument matrix, but with a blank row every time the code changes.</p>
</div>
</div>
<p>Notice that, in the example below, the vector <code class="docutils literal notranslate"><span class="pre">xg12</span></code> with the codes has length equal to the number of rows in <code class="docutils literal notranslate"><span class="pre">xg11</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg12</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">19</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg12</span><span class="w"> </span><span class="nv">ShowCodes</span><span class="w"> </span><span class="nv">xg11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">22  Emily   
22  Luciano 

74  Paul    
74  Oxana   
74  Thor    
74  Carmen  

30  Veronica

65  William 
65  Vladimir
65  Monica  

19  Colette 
</span></div></div>
</div>
</div>
<div class="section" id="the-specialist-s-section">
<span id="working-on-data-shape-the-specialists-section"></span><h2><span class="section-number">8.8. </span>The Specialist’s Section<a class="headerlink" href="#the-specialist-s-section" title="Permalink to this headline">#</a></h2>
<br />
<center>
<i>Each chapter is followed by a "Specialist's Section" like this one. This section is dedicated to skilled APLers who wish to improve their knowledge.</i>
You will find here rare or complex usages of the concepts presented in this chapter, or discover extended explanations which need the knowledge of some symbols that will be seen much further in the book.
<p><b>If you are exploring APL for the first time, skip this section and go to the next chapter.</b></p>
</center><div class="section" id="more-about-laminate">
<span id="working-on-data-shape-more-about-laminate"></span><h3><span class="section-number">8.8.1. </span>More About Laminate<a class="headerlink" href="#more-about-laminate" title="Permalink to this headline">#</a></h3>
<p>Here is a formal definition of the conditions required to laminate two variables <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>In the expression <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">a,[axis]b</span></code>,</p>
<ul class="simple">
<li><p>it is mandatory that (⍴a)≡(⍴b), unless one of them is a scalar;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">axis</span></code> must be a value between <code class="docutils literal notranslate"><span class="pre">⎕IO-1</span></code> and <code class="docutils literal notranslate"><span class="pre">⎕IO+≢⍴a</span></code>; and</p></li>
<li><p>the shape of <code class="docutils literal notranslate"><span class="pre">r</span></code> is given by the expression <code class="docutils literal notranslate"><span class="pre">((⌊axis↑⍴a),2,((⌈axis)↓⍴a)</span></code>.</p></li>
</ul>
<p>Examine the second rule: it is obvious that <code class="docutils literal notranslate"><span class="pre">axis</span></code> can be negative if the <em>index origin</em> is set to 0.
The axis can also be negative for <em>mix</em> and <em>ravel</em> with axis.</p>
<p>Let us use the following two vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">88</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">39</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">69</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>In order to produce the matrix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="nv">a</span><span class="o">,</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">41 27 88 11
39 63 12 69
</span></div></div>
</div>
<p>we write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">41 27 88 11
39 63 12 69
</span></div></div>
</div>
<p>when <code class="docutils literal notranslate"><span class="pre">⎕IO</span> <span class="pre">←</span> <span class="pre">1</span></code>, but if we set</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>then the expression becomes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="o">,</span><span class="sr">[</span><span class="m">¯0.5</span><span class="sr">]</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">41 27 88 11
39 63 12 69
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="more-on-dyadic-transpose">
<span id="working-on-data-shape-more-on-dyadic-transpose"></span><h3><span class="section-number">8.8.2. </span>More on Dyadic Transpose<a class="headerlink" href="#more-on-dyadic-transpose" title="Permalink to this headline">#</a></h3>
<div class="section" id="conditions">
<span id="working-on-data-shape-conditions"></span><h4><span class="section-number">8.8.2.1. </span>Conditions<a class="headerlink" href="#conditions" title="Permalink to this headline">#</a></h4>
<p>We said that <em>dyadic transpose</em> can be thought of as a way to observe an array from different positions.
For this usage there is a certain rule to follow.</p>
<p>To transpose an array with <code class="docutils literal notranslate"><span class="pre">a⍉b</span></code>, we must have <code class="docutils literal notranslate"><span class="pre">a[⍋a]≡⍳≢⍴b</span></code>.</p>
<p>In other words, <code class="docutils literal notranslate"><span class="pre">a</span></code> must be composed of all the values of <code class="docutils literal notranslate"><span class="pre">⍳≢⍴b</span></code> taken in any order, or, mathematically speaking, <code class="docutils literal notranslate"><span class="pre">a</span></code> must be a permutation of the axes of <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
</div>
<div class="section" id="diagonal-sections-of-an-array">
<span id="working-on-data-shape-diagonal-sections-of-an-array"></span><h4><span class="section-number">8.8.2.2. </span>Diagonal Sections of an Array<a class="headerlink" href="#diagonal-sections-of-an-array" title="Permalink to this headline">#</a></h4>
<p><em>Dyadic transpose</em> can also be used to select the items from an array which have two or more identical coordinates.
Such selections are called “diagonal sections” of the array.</p>
<p>For example, let us use the following array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">36</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  6  7  8
 9 10 11 12

13 14 15 16
17 18 19 20
21 22 23 24

25 26 27 28
29 30 31 32
33 34 35 36
</span></div></div>
</div>
<p>Look at the result of the following expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">⍉</span><span class="nv">y</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
17 18 19 20
33 34 35 36
</span></div></div>
</div>
<p>We have specified that both the first and second dimensions are to become the first dimension of the result.
This conflict is resolved by extracting the items on the diagonal between the dimensions which are merged.</p>
<p>The items on this diagonal have identical first and second coordinates, much like the identical nature of the first and second values in the left argument <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">1</span> <span class="pre">2⍉y</span></code>.
The result is a section of the “cube”.</p>
<p>The expression <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">2</span> <span class="pre">1⍉y</span></code> would give the same result, but transposed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="o">⍉</span><span class="nv">y</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 17 33
2 18 34
3 19 35
4 20 36
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">⍉</span><span class="nv">y</span><span class="p">)</span><span class="o">≡⍉</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="o">⍉</span><span class="nv">y</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="remark admonition">
<p class="admonition-title">Rules</p>
<p>This special use of <code class="docutils literal notranslate"><span class="pre">a⍉b</span></code> must also follow some rules:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(≢a)≡(≢⍴b)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∧/a∊⍳≢⍴b</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∧/(⍳⌈/a)∊a</span></code></p></li>
</ul>
</div>
<p>The first two rules are not unique to this special usage of <em>dyadic transpose</em>, and the third rule means that the items of <code class="docutils literal notranslate"><span class="pre">a</span></code> must be consecutive integers, starting from <code class="docutils literal notranslate"><span class="pre">⎕IO</span></code>.</p>
<p>So, for the array <code class="docutils literal notranslate"><span class="pre">y</span></code> shown above, the only possible sections are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="o">⊣,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="o">⍉</span><span class="na">¨</span><span class="p">)</span><span class="o">⊂</span><span class="nv">y</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬───────────┬────────┬────────┬────────┬───────┬───────┐
│1 1 1  │1 1 2      │1 2 1   │1 2 2   │2 1 1   │2 1 2  │2 2 1  │
├───────┼───────────┼────────┼────────┼────────┼───────┼───────┤
│1 18 35│ 1  2  3  4│ 1  5  9│ 1  6 11│ 1 13 25│1 14 27│1 17 33│
│       │17 18 19 20│14 18 22│13 18 23│ 6 18 30│5 18 31│2 18 34│
│       │33 34 35 36│27 31 35│25 30 35│11 23 35│9 22 35│3 19 35│
│       │           │        │        │        │       │4 20 36│
└───────┴───────────┴────────┴────────┴────────┴───────┴───────┘
</span></div></div>
</div>
<p>If the required conditions are satisfied, the selection can be thought of as having two steps:</p>
<ol class="simple">
<li><p>the left argument <code class="docutils literal notranslate"><span class="pre">a</span></code> is examined to see which of the coordinates are identical.</p></li>
</ol>
<p>For example, a left argument equal to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">1</span> <span class="pre">2</span></code> will select items which have their first and their coordinates identical.
A left argument equal to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">1</span> <span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">2</span> <span class="pre">1</span></code> will select items which have their first two coordinates identical.</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">2⍉y</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">1</span> <span class="pre">1⍉y</span></code> would select the items which have their last two coordinates equal, that is,</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
<span class="m">13</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">23</span><span class="w"></span>
<span class="m">25</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">35</span><span class="w"></span>
</pre></div>
</div>
<p>So, now we know which items from <code class="docutils literal notranslate"><span class="pre">y</span></code> we must work with in the next step.</p>
<ol class="simple">
<li><p>the selected values are repositioned using a normal dyadic transposition, the left argument of which is composed of the unique values of <code class="docutils literal notranslate"><span class="pre">a</span></code> obtained by <code class="docutils literal notranslate"><span class="pre">∪a</span></code>.</p></li>
</ol>
<p>For example, we said that both <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">2⍉y</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">1</span> <span class="pre">1⍉y</span></code> would select the same set of values, shown above.
This little matrix will then be transposed using a left argument equal to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span></code> (the matrix remains unchanged) or <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">1</span></code> (the matrix is transposed):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍉</span><span class="nv">y</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  6 11
13 18 23
25 30 35
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="o">⍉</span><span class="nv">y</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1 13 25
 6 18 30
11 23 35
</span></div></div>
</div>
<p>We recommend that you try to work through the other possibilities to make sure you understand them.</p>
</div>
<div class="section" id="diagonal-section-of-a-matrix">
<span id="working-on-data-shape-diagonal-section-of-a-matrix"></span><h4><span class="section-number">8.8.2.3. </span>Diagonal Section of a Matrix<a class="headerlink" href="#diagonal-section-of-a-matrix" title="Permalink to this headline">#</a></h4>
<p>In the case of a matrix, the only possible diagonal section is specified by <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">1</span></code>.
It selects what is called the main diagonal of the matrix.</p>
<p>For example, here is how you would select the values along the main diagonal of <code class="docutils literal notranslate"><span class="pre">forecast</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="o">⍉</span><span class="nv">forecast</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">90 450 320 520
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">forecast</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90 160 420 500  20  30
110 450 170 370 290 360
340 190 320 120 510 370
150 460 240 520 490 280
</span></div></div>
</div>
<p>Notice that for a matrix <code class="docutils literal notranslate"><span class="pre">m</span></code>, we have <code class="docutils literal notranslate"><span class="pre">(≢1</span> <span class="pre">1⍉m)=⌊/⍴m</span></code>.
This means that the diagonal section of a rectangular matrix has as many elements as the shorter side of the matrix, like in the <code class="docutils literal notranslate"><span class="pre">forecast</span></code> example above.</p>
</div>
</div>
</div>
<div class="section" id="solutions">
<span id="working-on-data-shape-solutions"></span><h2><span class="section-number">8.9. </span>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline">#</a></h2>
<p>The following solutions we propose are not necessarily the “best” ones; perhaps you will find other solutions that we have never considered.
APL is a very rich language, and due to the general nature of its primitive functions and operators there are always plenty of different ways to express different solutions to a given problem.
Which one is “the best” depends on many things, for example the level of experience of the programmer, the importance of system performance, the required behaviour in border cases, the requirement to meet certain programming standards and also personal preferences.
This is one of the reasons why APL is so pleasant to teach and to learn!</p>
<p>We advise you to try and solve the exercises before reading the solutions!</p>
<div class="solution admonition" id="Working-on-Data-Shape-solution-12">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-take-drop"> Exercise 8.1</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Starting from <code class="docutils literal notranslate"><span class="pre">xg1</span></code>,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg1</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">1</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 9 5 3 6
5 4 8 2 3
7 7 6 2 6
</span></div></div>
</div>
<p>we want to extract sub-matrices using <em>take</em> and <em>drop</em>.
Because we are dealing with a matrix – a rank 2 array – the left argument must be a 2-element vector.
The first element determines how many rows we take (or drop) and from where (top or bottom), while the second element determines how many columns we take (or drop) and from where (left or right).</p>
<p>Let us go through the three matrices, one by one:</p>
<p><strong>1</strong>.</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
<span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
<p>This matrix has elements from the <em>first</em> two rows and from the <em>last</em> three columns of <code class="docutils literal notranslate"><span class="pre">xg1</span></code>, so we can build it with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">¯3</span><span class="o">↑</span><span class="nv">xg1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 3 6
8 2 3
</span></div></div>
</div>
<p>Conversely, we can build that matrix by ignoring the <em>last</em> row and the <em>first</em> two columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="w"> </span><span class="m">2</span><span class="o">↓</span><span class="nv">xg1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 3 6
8 2 3
</span></div></div>
</div>
<p><strong>2</strong>.</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
<p>This matrix has elements from the <em>last</em> two rows and from the <em>first</em> four columns, so we build it with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯2</span><span class="w"> </span><span class="m">4</span><span class="o">↑</span><span class="nv">xg1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 4 8 2
7 7 6 2
</span></div></div>
</div>
<p>Conversely, we can build it by ignoring the <em>first</em> row and the <em>last</em> column of <code class="docutils literal notranslate"><span class="pre">xg1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">¯1</span><span class="o">↓</span><span class="nv">xg1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 4 8 2
7 7 6 2
</span></div></div>
</div>
<p><strong>3</strong>.</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">9</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
<p>Finally, this matrix contains all three rows but the 3 columns that make it up are from the <em>middle</em> of <code class="docutils literal notranslate"><span class="pre">xg1</span></code>, so there is no single number that we can use to build this matrix in a single <em>take</em>.
Instead, what we can do is two successive <em>takes</em>: first we take the <em>first</em> 4 columns and then the <em>last</em> 3 columns of that, or first we take the <em>last</em> 4 columns and then the <em>first</em> 3 of that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">↑</span><span class="m">3</span><span class="w"> </span><span class="m">¯4</span><span class="o">↑</span><span class="nv">xg1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9 5 3
4 8 2
7 6 2
</span></div></div>
</div>
<p>We do a similar thing with <em>drop</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="o">↓</span><span class="m">0</span><span class="w"> </span><span class="m">¯1</span><span class="o">↓</span><span class="nv">xg1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9 5 3
4 8 2
7 6 2
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-13">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-overtake"> Exercise 8.2</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We want to produce the matrix</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
<p>from <code class="docutils literal notranslate"><span class="pre">xg1</span></code>.
We immediately notice that <code class="docutils literal notranslate"><span class="pre">xg1</span></code> is in the upper-left corner of this larger matrix, and we see there are an extra row and column of zeroes, which are certainly the result of overtaking:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="o">↑</span><span class="nv">xg1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 9 5 3 6 0
5 4 8 2 3 0
7 7 6 2 6 0
0 0 0 0 0 0
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-14">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-takedropshape"> Exercise 8.3</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Let us start with <code class="docutils literal notranslate"><span class="pre">TakeShape</span></code>, that is supposed to compute the <em>shape</em> of the result of doing <code class="docutils literal notranslate"><span class="pre">ns↑array</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">ns</span> <span class="pre">TakeShape</span> <span class="pre">⍴array</span></code> should be such that <code class="docutils literal notranslate"><span class="pre">r≡⍴ns↑array</span></code>, and notice that the right argument to <code class="docutils literal notranslate"><span class="pre">TakeShape</span></code> is <code class="docutils literal notranslate"><span class="pre">⍴array</span></code>, not the array itself.</p>
<p>From reading the specification of <em>take</em> and from the previous exercises, we can start to see that the absolute value of the left argument indicates the length of each dimension.
However, the solution isn’t just</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TakeShape</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">|</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Why not?
Because the left argument to <em>take</em> may be shorter than the number of dimensions of the array we are working with, in which case the trailing dimensions are left untouched.
To fix our function, we just need to check if there are trailing dimensions that are left untouched and, in case there are any, we should tack them to the right of <code class="docutils literal notranslate"><span class="pre">|ns</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TakeShape</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">|</span><span class="bp">⍺</span><span class="p">)</span><span class="o">,</span><span class="p">((</span><span class="o">≢</span><span class="bp">⍺</span><span class="p">)</span><span class="o">-≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">¯3</span><span class="w"> </span><span class="nv">TakeShape</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
<span class="c1">⍝ 2 3 10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 3 10
</span></div></div>
</div>
<p>How does it work?</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">≢⍵</span></code> is the number of dimensions of the array and <code class="docutils literal notranslate"><span class="pre">≢⍺</span></code> is the number of dimensions of the left argument to <em>take</em>, so <code class="docutils literal notranslate"><span class="pre">(≢⍵)-≢⍺</span></code> is the number of trailing dimensions that are left untouched;</p></li>
<li><p>we then use <em>take</em> to reach the lengths of those dimensions, so they show up in the final result. However, we want to <em>take</em> from the end, so we would need <code class="docutils literal notranslate"><span class="pre">-(≢⍵)-≢⍺</span></code>; instead, we flip the subtraction in the first place to get <code class="docutils literal notranslate"><span class="pre">(≢⍺)-≢⍵</span></code>; and</p></li>
<li><p>we tack those trailing dimensions to the absolute value of the left argument.</p></li>
</ul>
<p>The problem statement specifies that the arguments to <code class="docutils literal notranslate"><span class="pre">TakeShape</span></code> will always be relative to a usage of <em>take</em> that makes sense, so we also know that <code class="docutils literal notranslate"><span class="pre">(≢⍺)-≢⍵</span></code> is always 0 or negative.</p>
<p>We can follow a similar train of thought with <code class="docutils literal notranslate"><span class="pre">DropShape</span></code>, except that now <code class="docutils literal notranslate"><span class="pre">⍺</span></code> doesn’t tell us the length of each dimension, but rather the number of elements that are dropped along that dimension.
For <code class="docutils literal notranslate"><span class="pre">DropShape</span></code>, we can take advantage of overtaking to make sure that the left argument has the same length as the right argument.
Finally, we just need to make sure we don’t try to drop too many elements along any dimension, because the final result cannot have dimensions with negative length:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DropShape</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">0</span><span class="o">⌈</span><span class="bp">⍵</span><span class="o">-|</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">↑</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">15</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">¯3</span><span class="w"> </span><span class="nv">DropShape</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
<span class="c1">⍝ 0 6 7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 6 7
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-15">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-takeasdrop"> Exercise 8.4</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>This exercise wants us to convert left arguments of <em>take</em> into left arguments of <em>drop</em> and vice-versa, and doing so means we need to understand the lengths of the resulting dimensions, but that is what we have been doing in the previous exercises.</p>
<p>Start by imagining how it works for a vector <code class="docutils literal notranslate"><span class="pre">v</span></code> of length <code class="docutils literal notranslate"><span class="pre">l</span></code>.</p>
<ul class="simple">
<li><p>if we write <code class="docutils literal notranslate"><span class="pre">t↑v</span></code>, for positive <code class="docutils literal notranslate"><span class="pre">t</span></code>, the corresponding left argument for <em>drop</em> would be <code class="docutils literal notranslate"><span class="pre">-l-t</span></code>; but</p></li>
<li><p>if we write <code class="docutils literal notranslate"><span class="pre">(-t)↑v</span></code>, then the corresponding left argument for <em>drop</em> would be <code class="docutils literal notranslate"><span class="pre">l-t</span></code>.</p></li>
</ul>
<p>Now we just need to find a way of unifying the two cases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">-×</span><span class="bp">⍺</span><span class="p">)</span><span class="o">×</span><span class="bp">⍵</span><span class="o">-|</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">⍵-|⍺</span></code> determines the magnitude of the corresponding <em>drop</em> left argument and the expression <code class="docutils literal notranslate"><span class="pre">(-×⍺)</span></code> corrects the sign.</p>
<p>This is a great starting point, but our implementation has three issues that we need to solve.
One of them should become apparent here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="w"> </span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<p>If we try to <em>take</em> 10 elements from a vector of length 5, we end up with a (larger) vector of length 10, so there is no left argument to <em>drop</em> that would have the same effect.
Arguably, the most sensible thing to do here would be to return <code class="docutils literal notranslate"><span class="pre">0</span></code>, because that is the left argument for a <em>drop</em> that would have the closest result possible to the original <em>take</em>.
To make this change, what we need to do is make sure that the magnitude of the argument to <em>drop</em> is never below zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">-×</span><span class="bp">⍺</span><span class="p">)</span><span class="o">×</span><span class="m">0</span><span class="o">⌈</span><span class="bp">⍵</span><span class="o">-|</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
<span class="m">10</span><span class="w"> </span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>The second issue, that really is a bug, has to do with what happens if we <em>take</em> 0 elements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>If we take 0 elements from a vector of length 5, that would be the same as dropping 5 elements from that vector.
However, we say it is the same as dropping 0 elements from that vector, which is wrong.
The problem is that <code class="docutils literal notranslate"><span class="pre">(-×⍺)</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">0</span></code> in this case, whipping out the correct magnitude computed by <code class="docutils literal notranslate"><span class="pre">0⌈⍵-|⍺</span></code>.
One way to fix that is by nudging the values of <code class="docutils literal notranslate"><span class="pre">⍺</span></code> slightly, so that their signs remain the same for all integers, except for 0:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">-×</span><span class="bp">⍺</span><span class="o">-</span><span class="m">0.5</span><span class="p">)</span><span class="o">×</span><span class="m">0</span><span class="o">⌈</span><span class="bp">⍵</span><span class="o">-|</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<p>The third and final issue, is that <code class="docutils literal notranslate"><span class="pre">TakeAsDrop</span></code> doesn’t handle cases where the left argument is shorter than the right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR: Mismatched left and right argument shapes
TakeAsDrop[0] TakeAsDrop←{(-×⍺-0.5)×0⌈⍵-|⍺}
                                       ∧
</pre></div>
</div>
</div>
</div>
<p>The simplest way to fix this is by shortening <code class="docutils literal notranslate"><span class="pre">⍵</span></code> to match the length of <code class="docutils literal notranslate"><span class="pre">⍺</span></code>.
This works because the trailing dimensions that are not covered by the left argument to <em>take</em> can also be omitted in the left argument to <em>drop</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">-×</span><span class="bp">⍺</span><span class="o">-</span><span class="m">0.5</span><span class="p">)</span><span class="o">×</span><span class="m">0</span><span class="o">⌈</span><span class="p">((</span><span class="o">≢</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="o">-|</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
<span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="nv">TakeAsDrop</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯7 ¯4
</span></div></div>
</div>
<p>As for the <code class="docutils literal notranslate"><span class="pre">DropAsTake</span></code> function… It is exactly the same as the <code class="docutils literal notranslate"><span class="pre">TakeAsDrop</span></code> one!</p>
<div class="solution admonition" id="Working-on-Data-Shape-solution-16">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-showvowels"> Exercise 8.5</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>It is clear that an integral part of this exercise will be finding the vowels in the given character vector, and we can use the <em>membership</em> primitive for that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;This function works properly&#39;</span><span class="o">∊</span><span class="s1">&#39;aeiouyAEIOUY&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 1 0 0 0 1 0 0 0 1 1 0 0 0 1 0 0 0 0 0 0 1 0 1 0 0 1
</span></div></div>
</div>
<p>Next, we want to turn that Boolean mask into a character vector with arrows <code class="docutils literal notranslate"><span class="pre">↑</span></code> where the ones are.
If we take advantage of the fact that the blank space <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> is the fill element for character vectors, we can use the <em>expand</em> primitive that we just learned about:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;This function works properly&#39;</span><span class="o">∊</span><span class="s1">&#39;aeiouyAEIOUY&#39;</span><span class="p">)</span><span class="na">\</span><span class="s1">&#39;↑&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  ↑   ↑   ↑↑   ↑      ↑ ↑  ↑
</span></div></div>
</div>
<p>To wrap it up, all we need to do is laminate this character vector with the original vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ShowVowels</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="p">(</span><span class="bp">⍵</span><span class="o">∊</span><span class="s1">&#39;aeiouyAEIOUY&#39;</span><span class="p">)</span><span class="na">\</span><span class="s1">&#39;↑&#39;</span><span class="kt">}</span><span class="w"></span>
<span class="nv">ShowVowels</span><span class="w"> </span><span class="s1">&#39;This function works properly&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">This function works properly
  ↑   ↑   ↑↑   ↑      ↑ ↑  ↑
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-17">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-sparse-matrices"> Exercise 8.6</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Let’s work with the following matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg6</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">7</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="nv">xg6</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 8 0 0 3 0
0 7 0 0 0 0 0
6 0 2 0 0 0 1
0 0 0 0 4 0 0
</span></div></div>
</div>
<p>In order to contract the matrix, we start by raveling it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 8 0 0 3 0 0 7 0 0 0 0 0 6 0 2 0 0 0 1 0 0 0 0 4 0 0
</span></div></div>
</div>
<p>And we also list all the indices of all the positions in the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍳≢,</span><span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28
</span></div></div>
</div>
<p>What we now want is to keep only the indices of non-zero values.
If we start by laminating the numbers and the positions together, we can then use a Boolean mask to figure out what things to keep:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg6r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">,</span><span class="nv">xg6</span><span class="w"></span>
<span class="p">(</span><span class="nv">xg6r</span><span class="o">≠</span><span class="m">0</span><span class="p">)</span><span class="na">/</span><span class="nv">xg6r</span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="o">⍳≢</span><span class="nv">xg6r</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8 3 7  6  2  1  4
3 6 9 15 17 21 26
</span></div></div>
</div>
<p>The final step is catenating the original shape of the matrix on the left:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Contract</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="o">⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="nv">r</span><span class="o">≠</span><span class="m">0</span><span class="p">)</span><span class="na">/</span><span class="nv">r</span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="o">⍳≢</span><span class="nv">r</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Contract</span><span class="w"> </span><span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 8 3 7  6  2  1  4
7 3 6 9 15 17 21 26
</span></div></div>
</div>
<p>In order to implement the function <code class="docutils literal notranslate"><span class="pre">Restore</span></code>, we can create an empty ravel of the matrix which we then populate with the correct values.
After populating, we just need to reshape the ravel into the original matrix by making use of the shape information that is on the first column of the input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Restore</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">shape</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">ravel</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="nv">shape</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="nv">ravel</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">shape</span><span class="o">⍴</span><span class="nv">ravel</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Restore</span><span class="w"> </span><span class="nv">Contract</span><span class="w"> </span><span class="nv">xg6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 8 0 0 3 0
0 7 0 0 0 0 0
6 0 2 0 0 0 1
0 0 0 0 4 0 0
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-18">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-whiten"> Exercise 8.7</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>When the problem statement mentions blanks and <em>expand</em>, it hints at the fact that the blank space is the fill element for character vectors, and we know that <em>expand</em> inserts fill elements when it finds zeroes.</p>
<p>A first hunch might be that we just need to create a Boolean mask that has a 1 for each character we want to keep, and then we use <em>expand</em> with that, but unfortunately that does not work:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">sentence</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Panama is a canal between Atlantic and Pacific&#39;</span><span class="w"></span>
<span class="p">(</span><span class="nv">sentence</span><span class="o">≠</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="na">\</span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      (sentence≠&#39;a&#39;)\sentence
                    ∧
</pre></div>
</div>
</div>
</div>
<p>The problem is that the left argument to <em>expand</em> needs to have as many positive elements as there are elements in the right argument.
In order to fix this, what we can do is remove the letter we want to replace with blanks and only <em>then</em> use <em>expand</em>.
We can remove the occurrences of the letter with a <em>compress</em> or with the <em>without</em> primitive:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Whiten</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="bp">⍵</span><span class="o">≠</span><span class="bp">⍺</span><span class="p">)</span><span class="na">\</span><span class="bp">⍵</span><span class="o">~</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
<span class="s1">&#39;a&#39;</span><span class="w"> </span><span class="nv">Whiten</span><span class="w"> </span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">P n m  is   c n l between Atl ntic  nd P cific
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Whiten</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">m</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="o">≠</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="nv">m</span><span class="na">\</span><span class="nv">m</span><span class="na">/</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;a&#39;</span><span class="w"> </span><span class="nv">Whiten</span><span class="w"> </span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">P n m  is   c n l between Atl ntic  nd P cific
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-19">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-ontop"> Exercise 8.8</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>If we want to centre something, that means we will need to rotate it to the correct place.
When we receive the title, we first pad it with enough blank spaces so that it can be catenated on top of the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">padded</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">↓⍴</span><span class="nv">monMat</span><span class="p">)</span><span class="o">↑</span><span class="s1">&#39;2007&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≢</span><span class="nv">padded</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8
</span></div></div>
</div>
<p>We overtake to achieve this effect.
The next thing is rotating some of the trailing spaces to the front, so that the title becomes centred.
To do that, we need to figure out how much larger the matrix is in relation to the title, and then we divide that by 2 and round, in case there are an odd number of spaces:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">rot</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="p">((</span><span class="m">1</span><span class="o">↓⍴</span><span class="nv">monMat</span><span class="p">)</span><span class="o">-≢</span><span class="s1">&#39;2007&#39;</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now we can rotate the padded title by <em>minus</em> that amount (otherwise we would be rotating in the wrong direction):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="nv">rot</span><span class="p">)</span><span class="o">⌽</span><span class="nv">padded</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  2007  
</span></div></div>
</div>
<p>Now it is just a matter of catenating this to the top of the matrix, together with the <code class="docutils literal notranslate"><span class="pre">-</span></code> underline.
Let us put everything together in a dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">OnTop</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">↓⍴</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">rot</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="p">(</span><span class="nv">c</span><span class="o">-≢</span><span class="bp">⍺</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="nv">padded</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">c</span><span class="o">↑</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="p">((</span><span class="o">-</span><span class="nv">rot</span><span class="p">)</span><span class="o">⌽</span><span class="nv">padded</span><span class="p">)</span><span class="o">⍪</span><span class="s1">&#39;-&#39;</span><span class="o">⍪</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;2022&#39;</span><span class="w"> </span><span class="nv">OnTop</span><span class="w"> </span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  2022  
--------
January 
February
March   
April   
May     
June    
</span></div></div>
</div>
<p>Notice that rounding up or down changes the position of the extra space when there are an odd number of spaces around the title:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;107&#39;</span><span class="w"> </span><span class="nv">OnTop</span><span class="w"> </span><span class="nv">monMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   107  
--------
January 
February
March   
April   
May     
June    
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-20">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-rotations"> Exercise 8.9</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Best way to check if your solution is correct is by actually running the code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg9</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">9</span><span class="o">⍴</span><span class="s1">&#39;oeornlhtu n siduothf uogYti&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">oeornlhtu
 n siduot
hf uogYti
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯3</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="m">3</span><span class="o">⌽</span><span class="p">(</span><span class="o">-</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="o">⊖</span><span class="nv">xg9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You found
the right
solution 
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-21">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-free"> Exercise 8.10</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Let us prototype our solution with the vector that follows, and let us assume we want to find a run of 4 zeroes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg10</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0
</span></div></div>
</div>
<p>We can start by asking <em>where</em> in our vector the 1s are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 4 5 6 8 12 13 18 19 24
</span></div></div>
</div>
<p>This is useful because we know that the 0s are <em>between</em> the 1s.</p>
<p>However, if our vector starts and/or ends with 0s, those will not be enclosed by 1s and so we need to prepend and append a 1 to be sure all runs of 0s are surrounded by 1s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">ones</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="m">1</span><span class="o">,</span><span class="nv">xg10</span><span class="o">,</span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 5 6 7 9 13 14 19 20 25 28
</span></div></div>
</div>
<p>The next thing we do is figure out the distances between the consecutive 1s, so that we know the lengths of the runs of 0s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">runLengths</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="o">+</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">ones</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">ones</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 2 0 0 1 3 0 4 0 4 2
</span></div></div>
</div>
<p>Now we just use the lengths of the runs to compress the initial <code class="docutils literal notranslate"><span class="pre">ones</span></code> vector.
However, we can’t do it directly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="o">=</span><span class="nv">runLengths</span><span class="p">)</span><span class="na">/</span><span class="nv">ones</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      (4=runLengths)/ones
                    ∧
</pre></div>
</div>
</div>
</div>
<p>The problem is that the vector <code class="docutils literal notranslate"><span class="pre">ones</span></code> contains the beginning and end of each run of zeroes, whereas the vector <code class="docutils literal notranslate"><span class="pre">runLengths</span></code> only has the corresponding length.
In short, <code class="docutils literal notranslate"><span class="pre">ones</span></code> contains one element too many, that corresponds to the 1 that was catenated to the end of the argument vector.
So, we need to drop the last element of <code class="docutils literal notranslate"><span class="pre">ones</span></code> before compressing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="o">=</span><span class="nv">runLengths</span><span class="p">)</span><span class="na">/</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">ones</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14 20
</span></div></div>
</div>
<p>Finally, we take the first element of that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">↑</span><span class="p">(</span><span class="m">4</span><span class="o">=</span><span class="nv">runLengths</span><span class="p">)</span><span class="na">/</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">ones</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14
</span></div></div>
</div>
<p>At this point, we can figure out the approximate location of our runs of zeroes, we just need to make sure that we return the exact index required by the problem statement.
The problem statement wanted us to return the index of the first 0 of such a run.
We worked with indices of 1s, and not 0s, but we also catenated a 1 at the beginning of the vector, thus shifting all the indices of the 1s.
This means that, even though we are working with indices of 1s, the final result matches the corresponding index of the first 0.</p>
<p>Let’s wrap our code in a dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Free</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">ones</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="m">1</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="nv">runLengths</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="o">+</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">ones</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">ones</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="m">1</span><span class="o">↑</span><span class="p">(</span><span class="bp">⍺</span><span class="o">=</span><span class="nv">runLengths</span><span class="p">)</span><span class="na">/</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">ones</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>What if the right argument does not have a run with the required length?
Does our function return 0 like the problem statement requires?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Free</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>It does…
But how?</p>
<p>When we filter for runs of the required length, we get nothing, because there are no such runs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">6</span><span class="o">=</span><span class="nv">runLengths</span><span class="p">)</span><span class="na">/</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">ones</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<p>In other words, we get an empty numeric vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="no">⍬</span><span class="o">≡</span><span class="p">(</span><span class="m">6</span><span class="o">=</span><span class="nv">runLengths</span><span class="p">)</span><span class="na">/</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">ones</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>If our vector is <em>empty</em>, then trying to use <em>take</em> to get its first element corresponds to over taking, because we are trying to retrieve too many elements.
When that is the case, we know that the function <em>take</em> will put as many <em>fill elements</em> as needed, and so it returns a single 0 as a result of doing “one take” on an empty vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">↑</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Here is an alternative solution.
First, we stack the vector on top of itself as many times as required by the desired run length (let us say it is <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">←</span> <span class="pre">4</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="p">(</span><span class="o">≢</span><span class="nv">xg10</span><span class="p">)</span><span class="o">⍴</span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0
1 0 0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0
1 0 0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0
1 0 0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0
</span></div></div>
</div>
<p>Next, we use <em>rotate</em> <code class="docutils literal notranslate"><span class="pre">⌽</span></code> to rotate each row one more element than the previous one, so that each column represents <code class="docutils literal notranslate"><span class="pre">n</span></code> consecutive elements of the vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">rot</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">¯1</span><span class="o">+⍳</span><span class="nv">n</span><span class="p">)</span><span class="o">⌽</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0
0 0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0 1
0 1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0 1 0
1 1 1 0 1 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0 1 0 0
</span></div></div>
</div>
<p>In other words, if you look at the top row, you will notice that the 3 elements below a number match the 3 elements to its right.
For example, the 4th element in the 1st row is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">rot</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The 3 elements to its right are</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">rot</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0
</span></div></div>
</div>
<p>and the three elements below it are</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">rot</span><span class="sr">[</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="sr">;</span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0
</span></div></div>
</div>
<p>Now, the runs that we care about correspond to columns that are completely 0.
Using a reduction, we can figure out which columns have 1s and which do not:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">⌿</span><span class="nv">rot</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 0 1 1 1 1 1 1
</span></div></div>
</div>
<p>To finish up, we can do something similar to what we did before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">↑⍸~∨</span><span class="na">⌿</span><span class="nv">rot</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14
</span></div></div>
</div>
<p>This is what this solution would look like in a dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Free2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="w"> </span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍴</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">rot</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">¯1</span><span class="o">+⍳</span><span class="bp">⍺</span><span class="p">)</span><span class="o">⌽</span><span class="nv">mat</span><span class="w"></span>
<span class="w">    </span><span class="m">1</span><span class="o">↑⍸~∨</span><span class="na">⌿</span><span class="nv">rot</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">Free2</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Free2</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="nv">Free2</span><span class="w"> </span><span class="nv">xg10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-22">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-tocolumns"> Exercise 8.11</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We start with our matrix of names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">xg11</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;Emily   Luciano Paul    Oxana   Thor    Carmen  VeronicaWilliam VladimirMonica  Colette &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily   
Luciano 
Paul    
Oxana   
Thor    
Carmen  
Veronica
William 
Vladimir
Monica  
Colette 
</span></div></div>
</div>
<p>Let us also assume we want to make <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">←</span> <span class="pre">3</span></code> columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If we look at the problem statement, we see that the names must be laid out top to bottom, and only then left to right.
However, in APL, the <em>ravel order</em> of arrays is first left to right, and <em>then</em> top to bottom.
So it seems like we have to fight APL’s natural order in some way…
The key to doing that is understanding that we actually have 3 dimensions along which we want to navigate:</p>
<ol class="simple">
<li><p>we want to walk along one dimension that holds a single name,</p></li>
<li><p>then we want to go down along the column of names,</p></li>
<li><p>and then we want to go right along the columns of names.</p></li>
</ol>
<p>This hints at the fact that we should reshape our data to have 3 dimensions, where one dimension holds the columns, another holds all the names, and the last one holds the characters that compose a name.</p>
<p>The first thing that we need to do, in order to break up the matrix with the names, into an array with 3 dimensions, is figure out the length of each dimension.
<code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">←</span> <span class="pre">3</span></code> indicates that we want 3 columns, but how many names are there in each slice?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">height</span><span class="w"> </span><span class="nv">width</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="nv">xg11</span><span class="w"></span>
<span class="nv">height</span><span class="o">÷</span><span class="nv">n</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3.66667
</span></div></div>
</div>
<p>This doesn’t divide evenly, so we use the <em>ceiling</em> primitive to round up, and then we use <em>take</em> to create empty names to pad the column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">colSize</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="nv">height</span><span class="o">÷</span><span class="nv">n</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">names</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">colSize</span><span class="o">×</span><span class="nv">n</span><span class="p">)</span><span class="o">↑</span><span class="nv">xg11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily   
Luciano 
Paul    
Oxana   
Thor    
Carmen  
Veronica
William 
Vladimir
Monica  
Colette 

</span></div></div>
</div>
<p>Maybe you didn’t notice, but now there is an empty row added to the matrix.
So, the next step is reshaping the matrix <code class="docutils literal notranslate"><span class="pre">names</span></code> into a 3D array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">columns</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">colSize</span><span class="w"> </span><span class="nv">width</span><span class="w"> </span><span class="o">⍴</span><span class="w"> </span><span class="nv">names</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily   
Luciano 
Paul    
Oxana   

Thor    
Carmen  
Veronica
William 

Vladimir
Monica  
Colette 

</span></div></div>
</div>
<p>Now we have an array where the dimensions match the dimensions we want, but now we need to reorder the dimensions so that they do what we want when we reshape the 3D array back into a matrix.
We see that the 3rd dimension is already correct, because the names are laid out along the 3rd (last) dimension.
This means the only thing we can try to do is reorder the first and second dimensions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="o">⍉</span><span class="nv">columns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily   
Thor    
Vladimir

Luciano 
Carmen  
Monica  

Paul    
Veronica
Colette 

Oxana   
William 

</span></div></div>
</div>
<p>After the reordering of the two leading dimensions, we can now reshape the 3D array into a matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">colSize</span><span class="w"> </span><span class="p">(</span><span class="nv">n</span><span class="o">×</span><span class="nv">width</span><span class="p">)</span><span class="o">⍴</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="o">⍉</span><span class="nv">columns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily   Thor    Vladimir
Luciano Carmen  Monica  
Paul    VeronicaColette 
Oxana   William         
</span></div></div>
</div>
<p>This is almost perfect, we just need to add blanks between all the columns.
In order to do so, we can catenate a blank space at the end of the array (making it one character wider) and then dropping the last column of superfluous blanks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">¯1</span><span class="o">↓</span><span class="nv">colSize</span><span class="w"> </span><span class="p">(</span><span class="nv">n</span><span class="o">×</span><span class="nv">width</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">⍴</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="o">⍉</span><span class="nv">columns</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily    Thor     Vladimir
Luciano  Carmen   Monica  
Paul     Veronica Colette 
Oxana    William          
</span></div></div>
</div>
<p>This can be written as a dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">ToColumns</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">h</span><span class="w"> </span><span class="nv">w</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">nh</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="nv">h</span><span class="o">÷</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="nv">names</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">nh</span><span class="o">×</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↑</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">columns</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="w"> </span><span class="nv">nh</span><span class="w"> </span><span class="nv">w</span><span class="o">⍴</span><span class="nv">names</span><span class="w"></span>
<span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">¯1</span><span class="o">↓</span><span class="nv">nh</span><span class="w"> </span><span class="p">(</span><span class="bp">⍺</span><span class="o">×</span><span class="nv">w</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">⍴</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="o">⍉</span><span class="nv">columns</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">ToColumns</span><span class="w"> </span><span class="nv">xg11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily    Thor     Vladimir
Luciano  Carmen   Monica  
Paul     Veronica Colette 
Oxana    William          
</span></div></div>
</div>
<p>For reference, we provide another implementation that is <em>not</em> correct, where we just do some reshaping.
In this alternative solution, the names get listed from left to right, and then from top to bottom.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">ToColumnsWrong</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">h</span><span class="w"> </span><span class="nv">w</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">nh</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="nv">h</span><span class="o">÷</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">¯1</span><span class="o">↓</span><span class="nv">nh</span><span class="p">(</span><span class="bp">⍺</span><span class="o">×</span><span class="nv">w</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">⍴</span><span class="p">(</span><span class="bp">⍺</span><span class="o">×</span><span class="nv">nh</span><span class="o">×</span><span class="nv">w</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">↑,</span><span class="nv">xg11</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">ToColumnsWrong</span><span class="w"> </span><span class="nv">xg11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Emily    Luciano  Paul    
Oxana    Thor     Carmen  
Veronica William  Vladimir
Monica   Colette          
</span></div></div>
</div>
<div class="solution admonition" id="Working-on-Data-Shape-solution-23">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-showcodes"> Exercise 8.12</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>For this exercise, we are given an extra vector <code class="docutils literal notranslate"><span class="pre">xg12</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg12</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">19</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>It is fairly straightforward to put the labels next to the names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">labeled</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍕</span><span class="nv">xg12</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">xg11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">22  Emily   
22  Luciano 
74  Paul    
74  Oxana   
74  Thor    
74  Carmen  
30  Veronica
65  William 
65  Vladimir
65  Monica  
19  Colette 
</span></div></div>
</div>
<p>The final step is creating the blank lines that separate the different labels.</p>
<p>For that, we need to create a Boolean vector that we can give to <em>expand</em>.
This is what we need to create:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">⍀</span><span class="nv">labeled</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">22  Emily   
22  Luciano 

74  Paul    
74  Oxana   
74  Thor    
74  Carmen  

30  Veronica

65  William 
65  Vladimir
65  Monica  

19  Colette 
</span></div></div>
</div>
<p>In order to create that vector, we will want to figure out the indices of the above vector that are 0.
To do so, we start by finding where the labels change:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">indices</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="p">(</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">xg12</span><span class="p">)</span><span class="o">≠</span><span class="m">1</span><span class="o">↓</span><span class="nv">xg12</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 6 7 10
</span></div></div>
</div>
<p>However, if we look at the Boolean vector above, these are the indices of the 0s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸~</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 8 10 14
</span></div></div>
</div>
<p>Can you see the pattern?</p>
<p>Here is the mapping that we need to do:</p>
<ul class="simple">
<li><p>2 goes to 3</p></li>
<li><p>6 goes to 8</p></li>
<li><p>7 goes to 10</p></li>
<li><p>10 goes to 14</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">indices</span><span class="o">+⍳≢</span><span class="nv">indices</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 8 10 14
</span></div></div>
</div>
<p>Every index that we found in <code class="docutils literal notranslate"><span class="pre">indices</span></code> points to the last position of a run of labels, and we wanted to insert a new 0 in the position after the run ends and before the next run begins.
However, if we imagine we are working from the left, every time we insert a new position between different labels, we shift part of the vector to the right.
That is why we need to add the <em>iota</em> of the <em>tally</em> of <code class="docutils literal notranslate"><span class="pre">indices</span></code>, to correct for those shifts.</p>
<p>Now we use these indices to create the Boolean vector we need:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">exp</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="o">⍳</span><span class="p">(</span><span class="o">≢</span><span class="nv">indices</span><span class="p">)</span><span class="o">+≢</span><span class="nv">xg12</span><span class="p">)</span><span class="o">∊</span><span class="nv">indices</span><span class="o">+⍳≢</span><span class="nv">indices</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0 1 1 1 1 0 1 0 1 1 1 0 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">exp</span><span class="na">⍀</span><span class="nv">labeled</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">22  Emily   
22  Luciano 

74  Paul    
74  Oxana   
74  Thor    
74  Carmen  

30  Veronica

65  William 
65  Vladimir
65  Monica  

19  Colette 
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">ShowCodes</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">labeled</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍕</span><span class="bp">⍺</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">indices</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="p">(</span><span class="m">¯1</span><span class="o">↓</span><span class="bp">⍺</span><span class="p">)</span><span class="o">≠</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="nv">exp</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="o">⍳</span><span class="p">(</span><span class="o">≢</span><span class="nv">indices</span><span class="p">)</span><span class="o">+≢</span><span class="nv">xg12</span><span class="p">)</span><span class="o">∊</span><span class="nv">indices</span><span class="o">+⍳≢</span><span class="nv">indices</span><span class="w"></span>
<span class="w">    </span><span class="nv">exp</span><span class="na">⍀</span><span class="nv">labeled</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">xg12</span><span class="w"> </span><span class="nv">ShowCodes</span><span class="w"> </span><span class="nv">xg11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">22  Emily   
22  Luciano 

74  Paul    
74  Oxana   
74  Thor    
74  Carmen  

30  Veronica

65  William 
65  Vladimir
65  Monica  

19  Colette 
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Execute-and-Format-Control.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Execute &amp; Format Control</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Special-Syntax.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Special Syntax</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Bernard Legrand, reworked by Rodrigo Girão Serrão.<br/>
  
    <div class="extra_footer">
      <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
</a></p>
<p>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>