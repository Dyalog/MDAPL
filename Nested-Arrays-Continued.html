
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>10. Nested Arrays (Continued) &#8212; Mastering Dyalog APL</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="11. Operators" href="Operators.html" />
    <link rel="prev" title="9. Special Syntax" href="Special-Syntax.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Mastering Dyalog APL</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction.html">
   1. Introduction - Will You Play APL With Me?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Getting-Started.html">
   2. Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Data-and-Variables.html">
   3. Data and Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Some-Primitive-Functions.html">
   4. Some Primitive Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="User-Defined-Functions.html">
   5. User-Defined Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="First-Aid-Kit.html">
   6. First-Aid Kit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Execute-and-Format-Control.html">
   7. Execute &amp; Format Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Working-on-Data-Shape.html">
   8. Working on Data Shape
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Special-Syntax.html">
   9. Special Syntax
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   10. Nested Arrays (Continued)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Operators.html">
   11. Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Tacit-Programming.html">
   12. Tacit Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendices.html">
   13. Appendices
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Dyalog/MDAPL"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Dyalog/MDAPL/edit/master/docs/Nested-Arrays-Continued.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/Nested-Arrays-Continued.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-contact">
   10.1. First Contact
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definitions">
     10.1.1. Definitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enclose-disclose">
     10.1.2. Enclose &amp; Disclose
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#enclose">
       10.1.2.1. Enclose
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#disclose">
       10.1.2.2. Disclose
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mnemonics">
       10.1.2.3. Mnemonics
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-and-other-scalars">
       10.1.2.4. Simple and Other Scalars
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-about-display">
     10.1.3. More about DISPLAY
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conventions">
       10.1.3.1. Conventions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#change-the-default-presentation">
       10.1.3.2. Change the Default Presentation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#distinguish-between-items">
       10.1.3.3. Distinguish Between Items
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#empty-arrays">
       10.1.3.4. Empty Arrays
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choose-indexing">
   10.2. Choose Indexing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#depth">
   10.3. Depth
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enclosing-scalars">
     10.3.1. Enclosing Scalars
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-depth-of-an-array">
     10.3.2. The Depth of an Array
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-depth-of-an-array-take-2">
     10.3.3. The Depth of an Array, Take 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nest">
   10.4. Nest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#argument-homogenisation">
     10.4.1. Argument Homogenisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nesting-a-scalar">
     10.4.2. Nesting a Scalar
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#each">
   10.5. Each
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition-and-examples">
     10.5.1. Definition and Examples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-use-of-each">
     10.5.2. The Use of Each
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#three-compressions">
     10.5.3. Three Compressions!
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#processing-nested-arrays">
   10.6. Processing Nested Arrays
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-dyadic-functions">
     10.6.1. Scalar Dyadic Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#juxtaposition-vs-catenation">
     10.6.2. Juxtaposition vs Catenation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characters-and-numbers">
     10.6.3. Characters and Numbers
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-1">
       10.6.3.1. Solution 1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-2">
       10.6.3.2. Solution 2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-3">
       10.6.3.3. Solution 3
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-more-operations">
     10.6.4. Some More Operations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reduction">
       10.6.4.1. Reduction
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#index-of-and-membership">
       10.6.4.2. Index Of and Membership
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexing">
       10.6.4.3. Indexing
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intermission-exercises">
   10.7. Intermission Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-and-mix">
   10.8. Split and Mix
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-use">
     10.8.1. Basic Use
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mix-applied-to-heterogeneous-data">
       10.8.1.1. Mix Applied to Heterogeneous Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#axis-specification">
     10.8.2. Axis Specification
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#split">
       10.8.2.1. Split
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mix">
       10.8.2.2. Mix
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#type-prototype-fill-item">
   10.9. Type, Prototype, Fill Item
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pick">
   10.10. Pick
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition">
     10.10.1. Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#left-argument-length">
     10.10.2. Left Argument Length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disclosed-result">
     10.10.3. Disclosed Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pick-first">
     10.10.4. Pick First
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selective-assignment">
     10.10.5. Selective Assignment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-idiom">
     10.10.6. An Idiom
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reach-indexing">
   10.11. Reach Indexing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relationship-to-pick">
     10.11.1. Relationship to Pick
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reach-versus-choose-indexing">
     10.11.2. Reach Versus Choose Indexing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#partitioned-enclose-partition">
   10.12. Partitioned Enclose &amp; Partition
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partitioned-enclose">
     10.12.1. Partitioned Enclose
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-boolean-vector-left-argument">
       10.12.1.1. Simple Boolean Vector Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-enclosures">
       10.12.1.2. Multiple Enclosures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trailing-empty-enclosures">
       10.12.1.3. Trailing Empty Enclosures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#scalar-left-argument">
       10.12.1.4. Scalar Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#partitioned-enclose-with-axis">
       10.12.1.5. Partitioned Enclose with Axis
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wrap-up">
       10.12.1.6. Wrap-up
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partition">
     10.12.2. Partition
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#working-on-vectors">
       10.12.2.1. Working on Vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#working-on-higher-rank-arrays">
       10.12.2.2. Working on Higher-Rank Arrays
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#union-intersection">
   10.13. Union &amp; Intersection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enlist">
   10.14. Enlist
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   10.15. Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   10.16. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compatibility-and-migration-level">
     10.16.1. Compatibility and Migration Level
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#migration-level">
       10.16.1.1. Migration Level
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-list-of-differences">
       10.16.1.2. A List of Differences
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-the-type-and-prototype">
     10.16.2. Computing the Type and Prototype
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#migration-level-zero">
       10.16.2.1. Migration Level Zero
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#migration-level-non-zero">
       10.16.2.2. Migration Level Non-zero
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#high-rank-partition">
     10.16.3. High-rank Partition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ambiguous-representation">
     10.16.4. Ambiguous Representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pick-inside-a-scalar">
     10.16.5. Pick Inside a Scalar
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   10.17. Solutions
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Nested Arrays (Continued)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-contact">
   10.1. First Contact
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definitions">
     10.1.1. Definitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enclose-disclose">
     10.1.2. Enclose &amp; Disclose
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#enclose">
       10.1.2.1. Enclose
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#disclose">
       10.1.2.2. Disclose
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mnemonics">
       10.1.2.3. Mnemonics
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-and-other-scalars">
       10.1.2.4. Simple and Other Scalars
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-about-display">
     10.1.3. More about DISPLAY
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conventions">
       10.1.3.1. Conventions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#change-the-default-presentation">
       10.1.3.2. Change the Default Presentation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#distinguish-between-items">
       10.1.3.3. Distinguish Between Items
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#empty-arrays">
       10.1.3.4. Empty Arrays
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choose-indexing">
   10.2. Choose Indexing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#depth">
   10.3. Depth
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enclosing-scalars">
     10.3.1. Enclosing Scalars
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-depth-of-an-array">
     10.3.2. The Depth of an Array
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-depth-of-an-array-take-2">
     10.3.3. The Depth of an Array, Take 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nest">
   10.4. Nest
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#argument-homogenisation">
     10.4.1. Argument Homogenisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nesting-a-scalar">
     10.4.2. Nesting a Scalar
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#each">
   10.5. Each
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition-and-examples">
     10.5.1. Definition and Examples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-use-of-each">
     10.5.2. The Use of Each
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#three-compressions">
     10.5.3. Three Compressions!
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#processing-nested-arrays">
   10.6. Processing Nested Arrays
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-dyadic-functions">
     10.6.1. Scalar Dyadic Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#juxtaposition-vs-catenation">
     10.6.2. Juxtaposition vs Catenation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characters-and-numbers">
     10.6.3. Characters and Numbers
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-1">
       10.6.3.1. Solution 1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-2">
       10.6.3.2. Solution 2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#solution-3">
       10.6.3.3. Solution 3
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-more-operations">
     10.6.4. Some More Operations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reduction">
       10.6.4.1. Reduction
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#index-of-and-membership">
       10.6.4.2. Index Of and Membership
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexing">
       10.6.4.3. Indexing
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intermission-exercises">
   10.7. Intermission Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-and-mix">
   10.8. Split and Mix
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-use">
     10.8.1. Basic Use
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mix-applied-to-heterogeneous-data">
       10.8.1.1. Mix Applied to Heterogeneous Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#axis-specification">
     10.8.2. Axis Specification
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#split">
       10.8.2.1. Split
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mix">
       10.8.2.2. Mix
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#type-prototype-fill-item">
   10.9. Type, Prototype, Fill Item
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pick">
   10.10. Pick
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition">
     10.10.1. Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#left-argument-length">
     10.10.2. Left Argument Length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disclosed-result">
     10.10.3. Disclosed Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pick-first">
     10.10.4. Pick First
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selective-assignment">
     10.10.5. Selective Assignment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-idiom">
     10.10.6. An Idiom
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reach-indexing">
   10.11. Reach Indexing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relationship-to-pick">
     10.11.1. Relationship to Pick
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reach-versus-choose-indexing">
     10.11.2. Reach Versus Choose Indexing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#partitioned-enclose-partition">
   10.12. Partitioned Enclose &amp; Partition
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partitioned-enclose">
     10.12.1. Partitioned Enclose
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-boolean-vector-left-argument">
       10.12.1.1. Simple Boolean Vector Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-enclosures">
       10.12.1.2. Multiple Enclosures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trailing-empty-enclosures">
       10.12.1.3. Trailing Empty Enclosures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#scalar-left-argument">
       10.12.1.4. Scalar Left Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#partitioned-enclose-with-axis">
       10.12.1.5. Partitioned Enclose with Axis
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wrap-up">
       10.12.1.6. Wrap-up
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partition">
     10.12.2. Partition
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#working-on-vectors">
       10.12.2.1. Working on Vectors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#working-on-higher-rank-arrays">
       10.12.2.2. Working on Higher-Rank Arrays
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#union-intersection">
   10.13. Union &amp; Intersection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enlist">
   10.14. Enlist
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   10.15. Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   10.16. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compatibility-and-migration-level">
     10.16.1. Compatibility and Migration Level
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#migration-level">
       10.16.1.1. Migration Level
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-list-of-differences">
       10.16.1.2. A List of Differences
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-the-type-and-prototype">
     10.16.2. Computing the Type and Prototype
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#migration-level-zero">
       10.16.2.1. Migration Level Zero
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#migration-level-non-zero">
       10.16.2.2. Migration Level Non-zero
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#high-rank-partition">
     10.16.3. High-rank Partition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ambiguous-representation">
     10.16.4. Ambiguous Representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pick-inside-a-scalar">
     10.16.5. Pick Inside a Scalar
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   10.17. Solutions
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="nested-arrays-continued">
<span id="nested-arrays-continued-nested-arrays-continued"></span><h1><span class="section-number">10. </span>Nested Arrays (Continued)<a class="headerlink" href="#nested-arrays-continued" title="Permalink to this headline">#</a></h1>
<div class="section" id="first-contact">
<span id="nested-arrays-continued-first-contact"></span><h2><span class="section-number">10.1. </span>First Contact<a class="headerlink" href="#first-contact" title="Permalink to this headline">#</a></h2>
<div class="section" id="definitions">
<span id="nested-arrays-continued-definitions"></span><h3><span class="section-number">10.1.1. </span>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">#</a></h3>
<p>We have already met <em>nested</em> arrays in <a class="reference internal" href="Data-and-Variables.html"><span class="doc std std-doc">the chapter about Data and Variables</span></a>; let us just remind ourselves of some definitions:</p>
<p>An array is said to be <em>generalised</em> or <em>nested</em> when one or more of its items are not <em>simple</em> scalars, but scalars containing “enclosed” arrays (this term will be explained soon).</p>
<p>Such an array can be created in many ways, although until now we have only covered the simplest one, called <em>vector notation</em>, or <em>strand notation</em>.
Using this notation, the items of an array are just juxtaposed, and each item can be identified as a separate item because:</p>
<ul class="simple">
<li><p>it is separated from its neighbours by <strong>blanks</strong>, or</p></li>
<li><p>it is embedded within <strong>quotes</strong>, or</p></li>
<li><p>it is an expression embedded within <strong>parentheses</strong>, or</p></li>
<li><p>it is a <strong>variable name</strong>, or the name of a niladic function which returns a result.</p></li>
</ul>
<p>Just to demonstrate how it works, we will create a nested vector and a nested matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">one</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">8</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="nv">two</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nesVec</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">87</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="s1">&#39;John&#39;</span><span class="w"> </span><span class="m">51</span><span class="w"> </span><span class="p">(</span><span class="m">78</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">23</span><span class="p">)</span><span class="w"> </span><span class="m">85</span><span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="m">69</span><span class="w"></span>
<span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">nesVec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────────────┐
│       ┌→───┐    ┌→───────┐    ┌→──┐    │
│ 87 24 │John│ 51 │78 45 23│ 85 ↓8 6│ 69 │
│       └────┘    └~───────┘    │2 4│    │
│                               └~──┘    │
└∊───────────────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nesMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;Dyalog&#39;</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="nv">two</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"></span>
<span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">nesMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────┐
↓ ┌→─────┐       ┌→────┐ │
│ │Dyalog│ 44    │Hello│ │
│ └──────┘       └─────┘ │
│          ┌→──┐ ┌→────┐ │
│ 27       ↓8 6│ ↓1 2 0│ │
│          │2 4│ │0 0 5│ │
│          └~──┘ └~────┘ │
└∊───────────────────────┘
</span></div></div>
</div>
<p>Later, we will provide a more formal description of this notation.</p>
</div>
<div class="section" id="enclose-disclose">
<span id="nested-arrays-continued-enclose-disclose"></span><h3><span class="section-number">10.1.2. </span>Enclose &amp; Disclose<a class="headerlink" href="#enclose-disclose" title="Permalink to this headline">#</a></h3>
<p>It seems so easy to create and work with nested arrays;
couldn’t we turn a <em>simple</em> array into a nested array by, for example, replacing one item of a simple matrix with a vector?</p>
<p>For example, we create a <em>simple</em> matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">87</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">62</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">87 63 52
74 11 62
</span></div></div>
</div>
<p>Then, we try to change it into a nested array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      mat[1;2]←10 20 30
              ∧
</pre></div>
</div>
</div>
</div>
<p>It doesn’t work!</p>
<p>We cannot replace <strong>one</strong> item with an array of <strong>three</strong> items.</p>
<p><code class="docutils literal notranslate"><span class="pre">mat[1;2]</span></code> is a scalar.
We can only replace it with a scalar.</p>
<div class="section" id="enclose">
<span id="nested-arrays-continued-enclose"></span><h4><span class="section-number">10.1.2.1. </span>Enclose<a class="headerlink" href="#enclose" title="Permalink to this headline">#</a></h4>
<p>Let us now use a little trick to make the assignment above work.
We just have to zip up the three values into a single “bag”, using a function called <em>enclose</em>, represented by the symbol <code class="docutils literal notranslate"><span class="pre">⊂</span></code>, typed with <kbd>APL</kbd>+<kbd>z</kbd>.</p>
<p>Then we will be able to replace one item by one bag!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊂</span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬────────┬──┐
│87│10 20 30│52│
├──┼────────┼──┤
│74│11      │62│
└──┴────────┴──┘
</span></div></div>
</div>
<p>Now it works!</p>
<p>We can, of course, do the same with character data, but we now know that an expression like</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="s1">&#39;JohnPete&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      mat[2;3]←2 4⍴&#39;JohnPete&#39;
              ∧
</pre></div>
</div>
</div>
</div>
<p>is incorrect.
We must enclose the array like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="s1">&#39;JohnPete&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The result is what we expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────┐
↓    ┌→───────┐        │
│ 87 │10 20 30│ 52     │
│    └~───────┘        │
│               ┌→───┐ │
│ 74 11         ↓John│ │
│               │Pete│ │
│               └────┘ │
└∊─────────────────────┘
</span></div></div>
</div>
<p>The result of <em>enclose</em> is always a scalar: cf. <a class="reference internal" href="#nested-arrays-continued-simple-and-other-scalars"><span class="std std-numref">Section 10.1.2.4</span></a>.</p>
</div>
<div class="section" id="disclose">
<span id="nested-arrays-continued-disclose"></span><h4><span class="section-number">10.1.2.2. </span>Disclose<a class="headerlink" href="#disclose" title="Permalink to this headline">#</a></h4>
<p>If we look at the contents of <code class="docutils literal notranslate"><span class="pre">mat[2;3]</span></code>, we see a little 2 by 4 matrix, but if we look at its shape, we see that surprisingly it has no shape.
Its rank is zero, so it must be a scalar!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┐
│John│
│Pete│
└────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<p>As we can see, its shape is empty.
And its rank is zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⍴</span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>The explanation is obvious:
we have put this little matrix into a bag (a scalar), so we now see the bag, and not its contents.
If we want to see its contents, we must extract them from the bag, using a function called <em>disclose</em>, which is represented by the symbol <code class="docutils literal notranslate"><span class="pre">⊃</span></code> and typed with <kbd>APL</kbd>+<kbd>x</kbd>.</p>
<p>With it, we now have access to the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⊃</span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 4
</span></div></div>
</div>
<p>And its rank is two, as expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⍴⊃</span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<p>We experience the same behaviour if we try to extract one item from a nested vector.</p>
<p>Let us recall the nested vector <code class="docutils literal notranslate"><span class="pre">nesVec</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nesVec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬──┬────┬──┬────────┬──┬───┬──┐
│87│24│John│51│78 45 23│85│8 6│69│
│  │  │    │  │        │  │2 4│  │
└──┴──┴────┴──┴────────┴──┴───┴──┘
</span></div></div>
</div>
<p>We can use similar expressions to the ones we used on <code class="docutils literal notranslate"><span class="pre">mat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<p>The above looks like a scalar; it is a scalar, containing an enclosed vector.</p>
<p>Once we disclose it, we gain access to its contents (three elements, in this case):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⊃</span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3
</span></div></div>
</div>
<p>In fact, this should not have come as a complete surprise to us.
Earlier, we learned that the shape of the result of an indexing operation is identical to the shape of the indices.
In this case (as well as in the matrix case above), the index specifies a scalar.
Hence, it would be incorrect to expect anything other than a scalar as the result of the indexing operation!</p>
</div>
<div class="section" id="mnemonics">
<span id="nested-arrays-continued-mnemonics"></span><h4><span class="section-number">10.1.2.3. </span>Mnemonics<a class="headerlink" href="#mnemonics" title="Permalink to this headline">#</a></h4>
<p>It is easy to remember how to generate the two symbols for <em>enclose</em> and <em>disclose</em> on a US or UK keyboard:</p>
<ul class="simple">
<li><p><em>Disclose</em> <code class="docutils literal notranslate"><span class="pre">⊃</span></code> is generated by <kbd>APL</kbd>+<kbd>X</kbd>, as in e<strong>X</strong>tract; and</p></li>
<li><p><em>Enclose</em> <code class="docutils literal notranslate"><span class="pre">⊂</span></code> is generated by <kbd>APL</kbd>+<kbd>Z</kbd>, as in <strong>Z</strong>ip-up.</p></li>
</ul>
<p>For reference, the actual symbols are called <em>left shoe</em> and <em>right shoe</em>, respectively for <code class="docutils literal notranslate"><span class="pre">⊂</span></code> and <code class="docutils literal notranslate"><span class="pre">⊃</span></code>; “enclose” and “disclose” are the names of the functions.</p>
</div>
<div class="section" id="simple-and-other-scalars">
<span id="nested-arrays-continued-simple-and-other-scalars"></span><h4><span class="section-number">10.1.2.4. </span>Simple and Other Scalars<a class="headerlink" href="#simple-and-other-scalars" title="Permalink to this headline">#</a></h4>
<p>We know that the result of <em>enclose</em> is <strong>always</strong> a scalar, but there is a difference between enclosing a scalar number or character, and enclosing any other array.</p>
<p>When appropriate, we shall use four different terms:</p>
<ul class="simple">
<li><p><em>simple scalar</em> refers to a single number or letter (rank zero);</p></li>
<li><p><em>enclosed array</em> refers to a scalar that is the result of enclosing anything other than a simple scalar;</p></li>
<li><p><em>item</em> refers to a scalar that is a constituent of an array, whether it is a simple scalar or an enclosed array; and</p></li>
<li><p><em>nested array</em> is an array in which at least one of the items is an enclosed array.</p></li>
</ul>
<p>Always remember these important points:</p>
<ul class="simple">
<li><p><em>enclose</em> does nothing to a simple scalar - it returns the scalar unchanged. The same for <em>disclose</em>;</p></li>
<li><p>all items of an array are effectively scalars, whether they are simple scalars or enclosed arrays: their rank is 0, and their shape is empty;</p></li>
<li><p>a single item can be replaced only by another single item: a simple scalar, or an array of values zipped up using <em>enclose</em> (to form an enclosed array); and</p></li>
<li><p><em>strand notation</em> avoids the use of <em>enclose</em>, because of the conventions used to separate individual items from one another.</p></li>
</ul>
<p>Let us create four vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;coffee&#39;</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;tea&#39;</span><span class="w"></span>
<span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;chocolate&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The last statement is just a simpler way to write:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="nv">a</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">b</span><span class="p">)</span><span class="o">,⊂</span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>So, we can see that each of the items of <code class="docutils literal notranslate"><span class="pre">v</span></code> is an enclosed character vector.
Thus,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">v</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<p>is <code class="docutils literal notranslate"><span class="pre">⍬</span></code>, not <code class="docutils literal notranslate"><span class="pre">6</span></code>.</p>
<p>Here is another example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="m">987</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"></span>
<span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">nesVec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────┐
│ ┌→──┐    ┌→───┐        ┌→────┐ ┌→──┐    │
│ │Yes│ 24 │John│ 51 987 │Hello│ ↓8 6│ 69 │
│ └───┘    └────┘        └─────┘ │2 4│    │
│                                └~──┘    │
└∊────────────────────────────────────────┘
</span></div></div>
</div>
<p>If we use any additional <em>enclose</em> primitives, the results are very different.
And the results also vary depending on where the <em>enclose</em> primitives are used.</p>
<p>Here are two examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="m">987</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span><span class="w"></span>
<span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">nesVec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────────┐
│ ┌→──┐    ┌→───┐        ┌─────────┐ ┌→──┐    │
│ │Yes│ 24 │John│ 51 987 │ ┌→────┐ │ ↓8 6│ 69 │
│ └───┘    └────┘        │ │Hello│ │ │2 4│    │
│                        │ └─────┘ │ └~──┘    │
│                        └∊────────┘          │
└∊────────────────────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊂</span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="m">987</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"></span>
<span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">nesVec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────────────────────────────────────────────────────┐
│ ┌→──────────────────┐    ┌→───┐    ┌→──────────────────┐ ┌→──────────────────┐ ┌→──┐    │
│ │ ┌→──┐     ┌→────┐ │ 24 │John│ 51 │ ┌→──┐     ┌→────┐ │ │ ┌→──┐     ┌→────┐ │ ↓8 6│ 69 │
│ │ │Yes│ 987 │Hello│ │    └────┘    │ │Yes│ 987 │Hello│ │ │ │Yes│ 987 │Hello│ │ │2 4│    │
│ │ └───┘     └─────┘ │              │ └───┘     └─────┘ │ │ └───┘     └─────┘ │ └~──┘    │
│ └∊──────────────────┘              └∊──────────────────┘ └∊──────────────────┘          │
└∊────────────────────────────────────────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>Now, we revert back to the original values because we will need <code class="docutils literal notranslate"><span class="pre">nesVec</span></code> below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="m">987</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="more-about-display">
<span id="nested-arrays-continued-more-about-display"></span><h3><span class="section-number">10.1.3. </span>More about DISPLAY<a class="headerlink" href="#more-about-display" title="Permalink to this headline">#</a></h3>
<p>Most of the time, the user command <code class="docutils literal notranslate"><span class="pre">]box</span></code> displays enough information when working with nested arrays in the session.
However, in some situations, you might want or need more granular display information, which you can obtain by using the function <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code>.
We have already seen the function <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code> and its main characteristics in <a class="reference internal" href="Data-and-Variables.html#data-and-variables-display"><span class="std std-numref">Section 3.6.4</span></a>.
We now need to explore some additional characteristics of it.</p>
<div class="section" id="conventions">
<span id="nested-arrays-continued-conventions"></span><h4><span class="section-number">10.1.3.1. </span>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">#</a></h4>
<p>The following conventions are used in the character matrix that <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code> returns:</p>
<ul class="simple">
<li><p>A simple scalar has no box around it.</p></li>
<li><p>All other arrays are shown with a surrounding box.
The upper-left hand corner of the box describes the <em>shape</em> of the array.
It can be:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">─</span></code>, a simple line for a scalar that is an enclosed array;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">→</span></code>, a single arrow, for a vector;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">↓</span></code> or <code class="docutils literal notranslate"><span class="pre">↓↓</span></code>, one or more vertical arrows for matrices and higher-rank arrays;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⊖</span></code>, a horizontal circled minus for an array with empty last axis; or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⌽</span></code>, a vertical circled bar for an array with another empty axis.</p></li>
</ul>
</li>
<li><p>The bottom-left hand corner of the box describes the nature of the array:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">─</span></code>, a simple line for character contents;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~</span></code>, a tilde for numeric contents;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code>, a <em>plus</em> symbol for mixed contents;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∊</span></code>, a <em>membership</em> symbol for nested arrays;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∇</span></code>, a <em>del</em> for <code class="docutils literal notranslate"><span class="pre">⎕OR</span></code> arrays; or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span></code>, a hash for <em>namespace</em> references.</p></li>
</ul>
</li>
</ul>
<p>We have not yet studied the last two concepts (<code class="docutils literal notranslate"><span class="pre">⎕OR</span></code> and namespaces); you can ignore them for now.</p>
</div>
<div class="section" id="change-the-default-presentation">
<span id="nested-arrays-continued-change-the-default-presentation"></span><h4><span class="section-number">10.1.3.2. </span>Change the Default Presentation<a class="headerlink" href="#change-the-default-presentation" title="Permalink to this headline">#</a></h4>
<p>By default, the boxes are drawn with special line-drawing characters, but you can provide a zero left argument to force the function to use alternative (standard APL) characters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">copy</span><span class="w"> </span><span class="nv">DISPLAY</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">C:\Program Files\Dyalog\Dyalog APL-64 18.2 Unicode\ws\DISPLAY.dws saved Thu Apr  7 00:29:10 2022
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│Hello│
└─────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="nv">DISPLAY</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">.→----.
|Hello|
'-----'
</span></div></div>
</div>
<p>As mentioned previously, the default presentation looks a lot better on the screen, but there may be situations where using standard APL characters may be preferred.</p>
</div>
<div class="section" id="distinguish-between-items">
<span id="nested-arrays-continued-distinguish-between-items"></span><h4><span class="section-number">10.1.3.3. </span>Distinguish Between Items<a class="headerlink" href="#distinguish-between-items" title="Permalink to this headline">#</a></h4>
<p>Now that we have discovered the existence of scalars which are enclosed arrays, we can use <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code> to distinguish between the two kinds of scalars.</p>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code> does not draw a box around the 34 below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="m">34</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  
34

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">6</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│ ┌→────┐ │
│ │Hello│ │
│ └─────┘ │
└∊────────┘
</span></div></div>
</div>
<p>The sixth item of <code class="docutils literal notranslate"><span class="pre">nesVec</span></code> is an enclosed vector, so its corners are marked with a simple line and an <code class="docutils literal notranslate"><span class="pre">∊</span></code>.
It contains a second box whose corners tell us that <code class="docutils literal notranslate"><span class="pre">'Hello'</span></code> is a character vector.
<code class="docutils literal notranslate"><span class="pre">nesVec[6]</span></code> is a scalar containing a vector.
If we <em>disclose</em> the item, we obtain a simple vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="o">⊃</span><span class="nv">nesVec</span><span class="sr">[</span><span class="m">6</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│Hello│
└─────┘
</span></div></div>
</div>
</div>
<div class="section" id="empty-arrays">
<span id="nested-arrays-continued-empty-arrays"></span><h4><span class="section-number">10.1.3.4. </span>Empty Arrays<a class="headerlink" href="#empty-arrays" title="Permalink to this headline">#</a></h4>
<p>Here is how <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code> identifies some empty arrays:</p>
<ul class="simple">
<li><p>Empty numeric vector:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌⊖┐
│0│
└~┘
</span></div></div>
</div>
<ul class="simple">
<li><p>Empty text vector:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌⊖┐
│ │
└─┘
</span></div></div>
</div>
<p>These are vectors, because there is not vertical arrow, and the <code class="docutils literal notranslate"><span class="pre">⊖</span></code> sign indicates that they are empty.
At the bottom of the boxes, the symbols <code class="docutils literal notranslate"><span class="pre">~</span></code> and <code class="docutils literal notranslate"><span class="pre">─</span></code> show that an empty numeric vector and an empty character vector are different.
One contains a zero, the other contains a blank.
This indicates the type of the array, which is a property of an array even when the array is empty (in <a class="reference internal" href="#nested-arrays-continued-type-prototype-fill-item"><span class="std std-numref">Section 10.9</span></a> we talk more about <em>fill</em> items).</p>
<p>We can see the same kind of output for empty matrices:</p>
<ul class="simple">
<li><p>Empty numeric matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
⌽0 0 0 0 0│
└~────────┘
</span></div></div>
</div>
<ul class="simple">
<li><p>Empty character matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">10</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────┐
⌽          │
└──────────┘
</span></div></div>
</div>
<ul class="simple">
<li><p>Another empty character matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌⊖┐
↓ │
│ │
│ │
│ │
│ │
└─┘
</span></div></div>
</div>
<ul class="simple">
<li><p>Empty numeric 3D array:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DISPLAY</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┌⊖┐
↓↓0│
││0│
││0│
││ │
││0│
││0│
││0│
└└~┘
</span></div></div>
</div>
<p>The output for the empty numeric 3D array contains 2 sets of 3 zeroes to show that its shape is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">0</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="choose-indexing">
<span id="nested-arrays-continued-choose-indexing"></span><h2><span class="section-number">10.2. </span>Choose Indexing<a class="headerlink" href="#choose-indexing" title="Permalink to this headline">#</a></h2>
<p><em>Choose indexing</em> is a different way of indexing arrays and is one example application of nested arrays.</p>
<p>In <em>simple indexing</em>, that you learned in <a class="reference internal" href="Data-and-Variables.html#data-and-variables-indexing"><span class="std std-numref">Section 3.5</span></a>, you can index into an array to select multiple items at the same time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">12</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1  2  3  4
5  6  7  8
9 10 11 12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="sr">;</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 4
7 8
</span></div></div>
</div>
<p>However, <em>simple indexing</em> always extracts items in a grid-like fashion.
For example, the indexing above specified that the result would come from rows <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code> and from columns <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">4</span></code>.
But what if you wanted only the items <code class="docutils literal notranslate"><span class="pre">mat[1;3]</span></code>, <code class="docutils literal notranslate"><span class="pre">mat[2;3]</span></code>, and <code class="docutils literal notranslate"><span class="pre">mat[2;4]</span></code>?</p>
<p>In that case, you can use <em>choose indexing</em>.
In <em>choose indexing</em>, the index is a <em>nested array</em> and each scalar of that array identifies a single element of the array being indexed.
Each scalar is a vector of indices, with one element per axis of the array being indexed.</p>
<p>So, if we want to index into a matrix, which has two axes, we need each scalar to be a vector of length two, enclosed.
If we want three values, our index vector will have length three:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 7 8
</span></div></div>
</div>
<p>In <em>choose indexing</em>, the index does not have to be a vector.
Much like with <em>simple indexing</em>, the shape of the index will determine the shape of the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 6 11 12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  6
11 12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1
 6

11
12
</span></div></div>
</div>
<p>If you want to use <em>choose indexing</em> to index a single item, you need to <em>enclose</em> it to turn it into a scalar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="sr">[</span><span class="o">⊂</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
</div>
<div class="section" id="depth">
<span id="nested-arrays-continued-depth"></span><h2><span class="section-number">10.3. </span>Depth<a class="headerlink" href="#depth" title="Permalink to this headline">#</a></h2>
<div class="section" id="enclosing-scalars">
<span id="nested-arrays-continued-enclosing-scalars"></span><h3><span class="section-number">10.3.1. </span>Enclosing Scalars<a class="headerlink" href="#enclosing-scalars" title="Permalink to this headline">#</a></h3>
<p>Applied to a <em>simple</em> scalar, <em>enclose</em> does nothing: the enclose of a <em>simple</em> scalar is the same <em>simple</em> scalar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">35</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  
35

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="o">⊂</span><span class="m">35</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  
35

</span></div></div>
</div>
<p>However, when applied to any other array, <em>enclose</em> puts a “bag” around it.</p>
<p>First, we start with a <em>simple</em> vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│2 4 8│
└~────┘
</span></div></div>
</div>
<p>If we use <em>enclose</em> once, we get a scalar containing a numeric vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│ ┌→────┐ │
│ │2 4 8│ │
│ └~────┘ │
└∊────────┘
</span></div></div>
</div>
<p>With one more <em>enclose</em>, we get a scalar containing another scalar, itself containing a numeric vector.</p>
</div>
<div class="section" id="the-depth-of-an-array">
<span id="nested-arrays-continued-the-depth-of-an-array"></span><h3><span class="section-number">10.3.2. </span>The Depth of an Array<a class="headerlink" href="#the-depth-of-an-array" title="Permalink to this headline">#</a></h3>
<p>Suppose that we write a function <code class="docutils literal notranslate"><span class="pre">Process</span></code>, which takes as its argument a vector consisting of: the name of a town, the number of inhabitants, a country code, and the turnover of our company in that town.</p>
<p>For example, we could call the function as <code class="docutils literal notranslate"><span class="pre">Process</span> <span class="pre">'Lyon'</span> <span class="pre">466400</span> <span class="pre">'FR'</span> <span class="pre">894600</span></code>.</p>
<p>For the purpose of this example, the function will just display the items it receives in its argument.
We choose to write it with the following syntax:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Process</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">pop</span><span class="w"> </span><span class="nv">coun</span><span class="w"> </span><span class="nv">tov</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Town = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">town</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Population = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">pop</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Country = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">coun</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Turnover = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">tov</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Perhaps this is not the smartest thing we could do, but we did it!</p>
<p>Now, let us execute the function and verify that it works properly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"> </span><span class="m">540678</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         York
Population =   186800
Country =      GB
Turnover =     540678
</span></div></div>
</div>
<p>This looks promising, but what will happen if the user forgets one of the items that the function expects?
Let us test it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
Process[1] (town pop coun tov)←⍵
                              ∧
</pre></div>
</div>
</div>
</div>
<p>As we might expect, an error message is issued: we cannot put 3 values into 4 variables!</p>
<p>Let us add a little test to our function to check whether or not the right argument has 4 items.</p>
<p>Here is the new version; notice the new line of code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Process</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="m">4</span><span class="o">≠≢</span><span class="bp">⍵:</span><span class="w"> </span><span class="s1">&#39;Hey, weren&#39;&#39;t you supposed to provide 4 values?&#39;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">pop</span><span class="w"> </span><span class="nv">coun</span><span class="w"> </span><span class="nv">tov</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Town = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">town</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Population = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">pop</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Country = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">coun</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Turnover = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">tov</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>It seems to work well now:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Hey, weren't you supposed to provide 4 values?
</span></div></div>
</div>
<p>But one day the user forgets all but one of the items, and just types the name of the town.
If the user is (un)lucky enough to type a town name with four letters, here is what happens:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         Y
Population =   o
Country =      r
Turnover =     k
</span></div></div>
</div>
<p>This trivial example shows that when nested arrays are involved, it is not sufficient to rely on the shape of an array;
we need additional information: specifically, is it a simple or a nested array?
To help distinguish between simple and nested arrays, APL provides a function named <em>depth</em>.
It is represented by the monadic use of the symbol <code class="docutils literal notranslate"><span class="pre">≡</span></code>.</p>
<p>Here is a set of rules that define how to determine the depth of an array:</p>
<ul class="simple">
<li><p>the depth of a simple scalar is 0;</p></li>
<li><p>the depth of any other array of any shape is 1, if all of its items are simple scalars.</p></li>
</ul>
<p>We call such an array a <em>simple array</em>, so we can instead say:</p>
<ul class="simple">
<li><p>the depth of a non-scalar, simple array is 1;</p></li>
<li><p>the depth of any other array is equal to the depth of its deepest item plus 1; and</p></li>
<li><p>the depth is positive if the array is uniform (all of its items have the same depth), and negative if it is not.</p></li>
</ul>
<p>Therefore, our <code class="docutils literal notranslate"><span class="pre">Process</span></code> function can only work when the argument <code class="docutils literal notranslate"><span class="pre">⍵</span></code> has depth <code class="docutils literal notranslate"><span class="pre">¯2</span></code>!
Why <code class="docutils literal notranslate"><span class="pre">¯2</span></code>?
Because the town name and the country name are character <em>vectors</em>, but the population and the turnover are numeric scalars, meaning that <code class="docutils literal notranslate"><span class="pre">⍵</span></code> has heterogeneous depth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Process</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="m">¯2</span><span class="o">≠≡</span><span class="bp">⍵:</span><span class="w"> </span><span class="s1">&#39;The argument has the wrong depth!&#39;</span><span class="w"></span>
<span class="w">    </span><span class="m">4</span><span class="o">≠≢</span><span class="bp">⍵:</span><span class="w"> </span><span class="s1">&#39;Hey, weren&#39;&#39;t you supposed to provide 4 values?&#39;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">pop</span><span class="w"> </span><span class="nv">coun</span><span class="w"> </span><span class="nv">tov</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Town = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">town</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Population = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">pop</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Country = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">coun</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Turnover = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">tov</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"> </span><span class="m">540678</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         York
Population =   186800
Country =      GB
Turnover =     540678
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">The argument has the wrong depth!
</span></div></div>
</div>
<p>Another intuitive definition of <em>depth</em> is this: <code class="docutils literal notranslate"><span class="pre">]display</span></code> the array and count the number of boxes you must pass to reach its deepest item.</p>
<p>Here are some examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≡</span><span class="w"> </span><span class="m">540678</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>As seen above, a scalar has depth 0.</p>
<p>The following vector contains only simple scalars. Its depth is 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≡</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">84</span><span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The rank of an array doesn’t influence directly its depth.
If we reshape the vector above into a matrix, its depth is still 1 because it contains only simple scalars:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≡</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">15</span><span class="w"> </span><span class="m">84</span><span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Now, let us consider this nested vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≡</span><span class="w"> </span><span class="nv">vec1</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="p">(</span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<p>It is composed of four enclosed vectors, each of depth 1 - so <code class="docutils literal notranslate"><span class="pre">vec1</span></code> has depth 2.
Now let us change the expression slightly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≡</span><span class="w"> </span><span class="nv">vec2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="p">(</span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯2
</span></div></div>
</div>
<p>This vector is no longer uniform: it contains four enclosed vectors and one simple scalar, so its depth is negative.
The <em>magnitude</em> of the depth has not changed, since it reports the highest level of nesting.</p>
<p>In this context, the word “uniform” only means that the array contains items of the same <em>depth</em>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vec2</span></code> is not uniform: it contains vectors (of depth 1) mixed with a scalar (of depth 0); and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec1</span></code> is uniform: all its items are vectors (of depth 1), even though they do not have the same shape, the same type, and certainly not the same content.</p></li>
</ul>
</div>
<div class="section" id="the-depth-of-an-array-take-2">
<span id="nested-arrays-continued-the-depth-of-an-array-take-2"></span><h3><span class="section-number">10.3.3. </span>The Depth of an Array, Take 2<a class="headerlink" href="#the-depth-of-an-array-take-2" title="Permalink to this headline">#</a></h3>
<p>We used the example of the function <code class="docutils literal notranslate"><span class="pre">Process</span></code> to motivate the definition of the <em>depth</em> of an array, but perhaps we could have fixed our function in a different way.</p>
<p>This was the original definition of <code class="docutils literal notranslate"><span class="pre">Process</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Process</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">pop</span><span class="w"> </span><span class="nv">coun</span><span class="w"> </span><span class="nv">tov</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Town = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">town</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Population = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">pop</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Country = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">coun</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Turnover = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">tov</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Instead of checking the length of <code class="docutils literal notranslate"><span class="pre">⍵</span></code> to see if there are enough items, perhaps we could write a more lenient version of <code class="docutils literal notranslate"><span class="pre">Process</span></code> that uses default values for the population, the country, and the turnover.</p>
<p>That way, if the user does not input enough arguments, the function still works, and displays that some information is missing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Process</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">defaults</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="w"> </span><span class="m">¯1</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">pop</span><span class="w"> </span><span class="nv">coun</span><span class="w"> </span><span class="nv">tov</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="o">,</span><span class="p">(</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">↓</span><span class="nv">defaults</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Town = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">town</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Population = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">pop</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Country = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">coun</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Turnover = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">tov</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"> </span><span class="m">540678</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         York
Population =   186800
Country =      GB
Turnover =     540678
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         York
Population =   186800
Country =      GB
Turnover =     ¯1
</span></div></div>
</div>
<p>It seems like we have a more robust function, but let us see what happens if we keep removing items from the arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         York
Population =   186800
Country =      ?
Turnover =     ¯1
</span></div></div>
</div>
<p>If we only pass in the town and the population, the function still works.</p>
<p>Now, let us try to pass in only the town:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         Y
Population =   o
Country =      r
Turnover =     k
</span></div></div>
</div>
<p>Once again, the user runs into trouble because our function <code class="docutils literal notranslate"><span class="pre">Process</span></code> takes a look at the character vector <code class="docutils literal notranslate"><span class="pre">'York'</span></code>, sees it has four items, and thus adds no default values.</p>
<p>The issue can be resolved if the user remembers to <em>enclose</em> the town name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="o">⊂</span><span class="s1">&#39;York&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         York
Population =   ¯1
Country =      ?
Turnover =     ¯1
</span></div></div>
</div>
<p>However, as you will come to understand, it is rarely a good idea to rely on the user to pass the arguments in the correct format.</p>
<p>Wouldn’t it be nice if we, the developers, could take care of that for ourselves?
As it turns out, we can.</p>
</div>
</div>
<div class="section" id="nest">
<span id="nested-arrays-continued-nest"></span><h2><span class="section-number">10.4. </span>Nest<a class="headerlink" href="#nest" title="Permalink to this headline">#</a></h2>
<p>The function <em>nest</em> is a monadic function represented by the <em>left shoe underbar</em> character, <code class="docutils literal notranslate"><span class="pre">⊆</span></code>, which you can type with <kbd>APL</kbd> + <kbd>Shift</kbd> + <kbd>Z</kbd>.
(Remembering how to type <code class="docutils literal notranslate"><span class="pre">⊆</span></code> should not be too hard, because it lives in the same key as <code class="docutils literal notranslate"><span class="pre">⊂</span></code>.)</p>
<p>The function <em>nest</em> is sometimes called <em>enclose if simple</em>, because that is exactly what it does:
you give it an array, and <code class="docutils literal notranslate"><span class="pre">⊆</span></code> will enclose it if and only if the argument array is simple.</p>
<p>In an intuitive sense, but using less rigorous words, <code class="docutils literal notranslate"><span class="pre">⊆</span></code> will put a box around arrays that don’t have any boxes yet.</p>
<p>Let us take a look at a couple of examples.
Here is a <em>nested</em> array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"> </span><span class="m">540678</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──────┬──┬──────┐
│York│186800│GB│540678│
└────┴──────┴──┴──────┘
</span></div></div>
</div>
<p>Because the array above is <em>nested</em>, it is not <em>simple</em>.
Therefore, <code class="docutils literal notranslate"><span class="pre">⊆</span></code> applied to that array will do nothing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊆</span><span class="s1">&#39;York&#39;</span><span class="w"> </span><span class="m">186800</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="w"> </span><span class="m">540678</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──────┬──┬──────┐
│York│186800│GB│540678│
└────┴──────┴──┴──────┘
</span></div></div>
</div>
<p>On the other hand, we can compare the <em>simple</em> character vector</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;York&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">York
</span></div></div>
</div>
<p>with what we get if we <em>nest</em> it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊆</span><span class="s1">&#39;York&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┐
│York│
└────┘
</span></div></div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">'York'</span></code> was not <em>nested</em>, <code class="docutils literal notranslate"><span class="pre">⊆</span></code> did it for us.</p>
<div class="section" id="argument-homogenisation">
<span id="nested-arrays-continued-argument-homogenisation"></span><h3><span class="section-number">10.4.1. </span>Argument Homogenisation<a class="headerlink" href="#argument-homogenisation" title="Permalink to this headline">#</a></h3>
<p>In the context of the function <code class="docutils literal notranslate"><span class="pre">Process</span></code> from before, the function <em>nest</em> becomes quite useful.
With it, we can handle the case when the user forgets to <em>enclose</em> the town name when no other information is given:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Process</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">defaults</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="w"> </span><span class="m">¯1</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">pop</span><span class="w"> </span><span class="nv">coun</span><span class="w"> </span><span class="nv">tov</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">⊆</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="m">¯1</span><span class="o">+≢⊆</span><span class="bp">⍵</span><span class="p">)</span><span class="o">↓</span><span class="nv">defaults</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Town = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">town</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Population = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">pop</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Country = &#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">coun</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="s1">&#39;Turnover = &#39;</span><span class="p">)</span><span class="o">,⍕</span><span class="nv">tov</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;York&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         York
Population =   ¯1
Country =      ?
Turnover =     ¯1
</span></div></div>
</div>
<p>In the <a class="reference internal" href="#nested-arrays-continued-exercises"><span class="std std-numref">Section 10.15</span></a> you will be asked to use <em>nest</em> for the purpose of argument homogenisation again.</p>
</div>
<div class="section" id="nesting-a-scalar">
<span id="nested-arrays-continued-nesting-a-scalar"></span><h3><span class="section-number">10.4.2. </span>Nesting a Scalar<a class="headerlink" href="#nesting-a-scalar" title="Permalink to this headline">#</a></h3>
<p>A word of caution is in order, pertaining to what happens if we <em>nest</em> a simple scalar.
The function <em>nest</em> is supposed to enclose its argument array when it is a simple array.
So, let us try to <em>nest</em> the scalar 42:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊆</span><span class="m">42</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">42
</span></div></div>
</div>
<p>At a first glance, it looks like the function <strong>failed</strong>!
After all, there is no box around the 42…
But the function did not fail.
The “issue” here is that simple scalars match their own enclosures.
So, when <code class="docutils literal notranslate"><span class="pre">⊆</span></code> tried enclosing 42, nothing happened.</p>
<p>Bear this in mind when using <em>nest</em>, but do not worry about this giving you unpleasant surprises.
For example, pretend there is a town called <code class="docutils literal notranslate"><span class="pre">'A'</span></code> and let us call <code class="docutils literal notranslate"><span class="pre">Process</span></code> with that town name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Town =         A
Population =   ¯1
Country =      ?
Turnover =     ¯1
</span></div></div>
</div>
<p>See?
<code class="docutils literal notranslate"><span class="pre">⊆'A'</span></code> gives <code class="docutils literal notranslate"><span class="pre">'A'</span></code>, but that didn’t prevent the function from correctly handling the default values for the missing pieces of information.</p>
</div>
</div>
<div class="section" id="each">
<span id="nested-arrays-continued-each"></span><h2><span class="section-number">10.5. </span>Each<a class="headerlink" href="#each" title="Permalink to this headline">#</a></h2>
<div class="section" id="definition-and-examples">
<span id="nested-arrays-continued-definition-and-examples"></span><h3><span class="section-number">10.5.1. </span>Definition and Examples<a class="headerlink" href="#definition-and-examples" title="Permalink to this headline">#</a></h3>
<p>To avoid the necessity of processing the items of an array one after the other in an explicitly programmed loop, one can use a monadic operator called <em>each</em>, which is represented by a diaeresis symbol, which looks like <code class="docutils literal notranslate"><span class="pre">¨</span></code> and is typed with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>1</kbd>.</p>
<p>As its name implies, <em>each</em> applies the function on its left (its <em>operand</em>) to each of the items of the array on its right (if the function is monadic), or to each pair of corresponding items of the arrays on its left and right (if the function is dyadic).</p>
<p>Let us try it with some small nested vectors and a monadic function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec3</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">23</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">52</span><span class="w"> </span><span class="m">41</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">38</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">22</span><span class="p">)</span><span class="w"></span>
<span class="nv">vec4</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">15</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="m">71023</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">74</span><span class="w"> </span><span class="m">85</span><span class="w"> </span><span class="m">96</span><span class="p">)</span><span class="w"></span>
<span class="nv">vec5</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">19</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">33</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">55</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can ask for the shape of <code class="docutils literal notranslate"><span class="pre">vec3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">vec3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4
</span></div></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">¨</span></code>, we can ask for the shape of <em>each of the items</em> of <code class="docutils literal notranslate"><span class="pre">vec3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">¨</span><span class="nv">vec3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┬─┐
│2│3│2│4│
└─┴─┴─┴─┘
</span></div></div>
</div>
<p>We can do the same with the second vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">¨</span><span class="nv">vec4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬┬───┬─┐
│2││2 2│3│
└─┴┴───┴─┘
</span></div></div>
</div>
<p>Beware! One item of <code class="docutils literal notranslate"><span class="pre">vec4</span></code> is a scalar, so its shape is empty, as shown above.
If <code class="docutils literal notranslate"><span class="pre">]box</span></code> were off, this could look odd at first sight:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">box</span><span class="w"> </span><span class="nv">off</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Was ON
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">¨</span><span class="nv">vec4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 2    2 2  3 
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">box</span><span class="w"> </span><span class="nv">on</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Was OFF
</span></div></div>
</div>
<p>If the function specified as the operand to <em>each</em> is dyadic, the derived function is also dyadic.
As usual, if one of the arguments is a scalar, the scalar is automatically repeated to match the shape of the other argument.
For example, take the following vector with the names of some months:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">monVec</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;January&#39;</span><span class="w"> </span><span class="s1">&#39;February&#39;</span><span class="w"> </span><span class="s1">&#39;March&#39;</span><span class="w"> </span><span class="s1">&#39;April&#39;</span><span class="w"> </span><span class="s1">&#39;May&#39;</span><span class="w"> </span><span class="s1">&#39;June&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>To take the first 3 letters of <em>each</em> vector in that vector of vectors, we would do</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="o">↑</span><span class="na">¨</span><span class="nv">monVec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┬───┐
│Jan│Feb│Mar│Apr│May│Jun│
└───┴───┴───┴───┴───┴───┘
</span></div></div>
</div>
<p>As we have just shown, there is no need to repeat the <code class="docutils literal notranslate"><span class="pre">3</span></code> to have the same shape as <code class="docutils literal notranslate"><span class="pre">monVec</span></code>.</p>
<p>Naturally, the operand to <em>each</em> can also be a <em>user-defined function</em>, provided that it can be applied to all of the items of the argument array(s):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Average</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">Average</span><span class="na">¨</span><span class="nv">vec3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3.5 13.3333 46.5 20.5
</span></div></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>In fact, <em>each</em> is a bit more than a “hidden” loop.</p>
<p>Please, remember that all items of an array are scalars - either simple scalars or enclosed arrays.
So, in an expression like <code class="docutils literal notranslate"><span class="pre">⍴¨vec5</span></code>, shouldn’t we expect the result to be just a list of three empty vectors, since the shape of a scalar is an empty vector?</p>
<p>No, the <em>each</em> operator is smarter than that.
For each item of the argument array, the item is first <em>disclosed</em> (the “bag” is opened), the function is applied to the disclosed item, and the result is <em>enclosed</em> again to form a scalar (i.e., put into a new “bag”).
Finally, all the new bags (scalars) are arranged in exactly the same structure (rank and shape) as the original argument array to for the final result.</p>
</div>
<p>So,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">¨</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│3│3│3│
└─┴─┴─┘
</span></div></div>
</div>
<p>is in fact equivalent to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂⍴⊃</span><span class="nv">vec5</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="o">⊂⍴⊃</span><span class="nv">vec5</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">)</span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="o">⊂⍴⊃</span><span class="nv">vec5</span><span class="sr">[</span><span class="m">3</span><span class="sr">]</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│3│3│3│
└─┴─┴─┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍴</span><span class="na">¨</span><span class="nv">vec5</span><span class="p">)</span><span class="o">≡</span><span class="p">(</span><span class="o">⊂⍴⊃</span><span class="nv">vec5</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="o">⊂⍴⊃</span><span class="nv">vec5</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">)</span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="o">⊂⍴⊃</span><span class="nv">vec5</span><span class="sr">[</span><span class="m">3</span><span class="sr">]</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>If the operand to <em>each</em> is a dyadic function, the corresponding items of the left and right arguments are both disclosed before applying the function.</p>
<p>We have seen that the operand to <em>each</em> may be a primitive function or a user-defined function.
It may also be a <em>derived function</em> returned by another operator.
For example, in the following expressions, the operand to <em>each</em> is not <code class="docutils literal notranslate"><span class="pre">/</span></code>, but the derived function <code class="docutils literal notranslate"><span class="pre">+/</span></code>.</p>
<p>In this example, we sum the numbers inside each item of the vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/¨</span><span class="nv">vec3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 40 93 82
</span></div></div>
</div>
<p>In this next one, it still works, even though one item is a matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/¨</span><span class="nv">vec4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬─────┬───┬───┐
│27│71023│3 7│255│
└──┴─────┴───┴───┘
</span></div></div>
</div>
<p>Beware: in some cases, the same derived function can be applied with or without the help of <em>each</em>, but the result will not be the same at all:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────┐
│ ┌→────┐ ┌→───────┐ ┌→───────┐ │
│ │7 5 1│ │19 14 13│ │33 44 55│ │
│ └~────┘ └~───────┘ └~───────┘ │
└∊──────────────────────────────┘
</span></div></div>
</div>
<p>Without <code class="docutils literal notranslate"><span class="pre">¨</span></code>, <code class="docutils literal notranslate"><span class="pre">+/</span></code> sums the three sub-vectors together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┐
│59 63 69│
└────────┘
</span></div></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">¨</span></code>, <code class="docutils literal notranslate"><span class="pre">+/¨</span></code> will compute the sum of <em>each</em> of the sub-vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/¨</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 46 132
</span></div></div>
</div>
</div>
<div class="section" id="the-use-of-each">
<span id="nested-arrays-continued-the-use-of-each"></span><h3><span class="section-number">10.5.2. </span>The Use of Each<a class="headerlink" href="#the-use-of-each" title="Permalink to this headline">#</a></h3>
<p><em>Each</em> is a “loop cruncher”.
Instead of programming loops, in APL you can apply any function to each of the items of an array, each of which may contain a complex set of data.</p>
<p>This operator is also useful combined with <em>match</em> when a simple equal sign would have caused an error.
For example, to compare two lists of names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;John&#39;</span><span class="w"> </span><span class="s1">&#39;Julius&#39;</span><span class="w"> </span><span class="s1">&#39;Jim&#39;</span><span class="w"> </span><span class="s1">&#39;Jean&#39;</span><span class="w"> </span><span class="o">≡</span><span class="na">¨</span><span class="w"> </span><span class="s1">&#39;John&#39;</span><span class="w"> </span><span class="s1">&#39;Oops&#39;</span><span class="w"> </span><span class="s1">&#39;Jim&#39;</span><span class="w"> </span><span class="s1">&#39;Jeff&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 0
</span></div></div>
</div>
<p>When used inappropriately, the <em>each</em> operator can sometimes use a large amount of memory for its intermediate results, so you may need to use it with some care.</p>
<p>Suppose that we have a huge list <code class="docutils literal notranslate"><span class="pre">customerTover</span></code>, of turnover amounts, one item per customer (we have more than 5,000 of them!).
Each item contains a matrix having a varying number of rows (products) and 52 columns (weeks).
Our task is to calculate the total average turnover per week per customer.
No problem, that’s just <code class="docutils literal notranslate"><span class="pre">(+/¨+⌿¨customerTover)÷52</span></code>.</p>
<p>However, if <code class="docutils literal notranslate"><span class="pre">customerTover</span></code> is very large, and we do not have much workspace left, the above expression may easily cause a <code class="docutils literal notranslate"><span class="pre">WS</span> <span class="pre">FULL</span></code> error.</p>
<p>The reason is that the intermediate expression <code class="docutils literal notranslate"><span class="pre">+⌿¨customerTover</span></code> produces a list of 52 amounts per customer, and that may require more workspace than we have room for.</p>
<p>Instead, we can put the entire expression into a function.
As is often the case in APL (and in programming, in general), the hardest part of writing a function is finding a good name for it.
Fortunately, we can get by without a name if we use an anonymous dfn, with <code class="docutils literal notranslate"><span class="pre">{(+/+⌿⍵)÷52}¨customerTover</span></code>.</p>
<p>Because we have “isolated” the entire logical process in the function and used <em>each</em> to loop through the items one by one, we will at most have only one customer’s data “active” at any time, and each intermediate result (a 52-item vector) will be thrown away before recalculating that for the next customer.
The result of each function call is just one number, so it is much less likely that we will run into <code class="docutils literal notranslate"><span class="pre">WS</span> <span class="pre">FULL</span></code> problems.</p>
</div>
<div class="section" id="three-compressions">
<span id="nested-arrays-continued-three-compressions"></span><h3><span class="section-number">10.5.3. </span>Three Compressions!<a class="headerlink" href="#three-compressions" title="Permalink to this headline">#</a></h3>
<p>In the following we will show three expressions which look similar, but their results are very different.
Let us first recall that <code class="docutils literal notranslate"><span class="pre">vec5</span></code> consists of three vectors, each containing three items:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬────────┬────────┐
│7 5 1│19 14 13│33 44 55│
└─────┴────────┴────────┘
</span></div></div>
</div>
<p>What is the result of a <em>compression</em>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">/</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬────────┐
│7 5 1│33 44 55│
└─────┴────────┘
</span></div></div>
</div>
<p>Above, the vector <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span></code> applies to the three items of <code class="docutils literal notranslate"><span class="pre">vec5</span></code>, compressing out the middle one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">/</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────┐
│ ┌→────┐ ┌→───────┐ │
│ │7 5 1│ │33 44 55│ │
│ └~────┘ └~───────┘ │
└∊───────────────────┘
</span></div></div>
</div>
<p>As mentioned, the compression applies to the items of <code class="docutils literal notranslate"><span class="pre">vec5</span></code>, as it would to any vector.
So, the second item has been removed.</p>
<p>If we use <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1/¨vec5</span></code>, do you think the result is the same?
Are you sure?
It is not displayed the same way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">/¨</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬┬────────┐
│7 5 1││33 44 55│
└─────┴┴────────┘
</span></div></div>
</div>
<p>Things are different here: each item of <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span></code> is paired with each sub-vector, like this:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1/7</span> <span class="pre">5</span> <span class="pre">1</span></code> gives <code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">5</span> <span class="pre">1</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0/19</span> <span class="pre">14</span> <span class="pre">13</span></code> gives <code class="docutils literal notranslate"><span class="pre">⍬</span></code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1/33</span> <span class="pre">44</span> <span class="pre">55</span></code> gives <code class="docutils literal notranslate"><span class="pre">33</span> <span class="pre">44</span> <span class="pre">55</span></code>.</p></li>
</ul>
<p>Thanks to <code class="docutils literal notranslate"><span class="pre">]display</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">/¨</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────┐
│ ┌→────┐ ┌⊖┐ ┌→───────┐ │
│ │7 5 1│ │0│ │33 44 55│ │
│ └~────┘ └~┘ └~───────┘ │
└∊───────────────────────┘
</span></div></div>
</div>
<p>There is a third way of using <em>compress</em>.
If we <em>enclose</em> the left argument, the entire mask <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span></code> is applied to each sub-vector.
The second item of each sub-vector has been removed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="na">/¨</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────┐
│ ┌→──┐ ┌→────┐ ┌→────┐ │
│ │7 1│ │19 13│ │33 55│ │
│ └~──┘ └~────┘ └~────┘ │
└∊──────────────────────┘
</span></div></div>
</div>
</div>
</div>
<div class="section" id="processing-nested-arrays">
<span id="nested-arrays-continued-processing-nested-arrays"></span><h2><span class="section-number">10.6. </span>Processing Nested Arrays<a class="headerlink" href="#processing-nested-arrays" title="Permalink to this headline">#</a></h2>
<p>We have already seen a number of operations involving nested arrays; we shall explore some more in this section.
Because nested arrays generally tend to have a rather simple - or at least uniform - structure, we can illustrate the operations using our little vectors.</p>
<div class="section" id="scalar-dyadic-functions">
<span id="nested-arrays-continued-scalar-dyadic-functions"></span><h3><span class="section-number">10.6.1. </span>Scalar Dyadic Functions<a class="headerlink" href="#scalar-dyadic-functions" title="Permalink to this headline">#</a></h3>
<p>You can refer to <a class="reference external" href="Some-Primitive-Functions.ipynb#Scalar-vs-Non-scalar-Functions">this section</a> concerning the application of scalar dyadic functions to nested arrays.</p>
<p>However, let us here explore again how <em>each</em> applies to scalar dyadic functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬────────┬────────┐
│7 5 1│19 14 13│33 44 55│
└─────┴────────┴────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────┬────────┬────────┐
│107 105 101│39 34 33│34 45 56│
└───────────┴────────┴────────┘
</span></div></div>
</div>
<p>100, 20, and 1 are added to the three sub-vectors, respectively.</p>
<p>Using <em>each</em>, the result is still the same:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"> </span><span class="o">+</span><span class="na">¨</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────┬────────┬────────┐
│107 105 101│39 34 33│34 45 56│
└───────────┴────────┴────────┘
</span></div></div>
</div>
<p>If we <em>enclose</em> the right argument, then <code class="docutils literal notranslate"><span class="pre">100</span> <span class="pre">20</span> <span class="pre">1</span></code> becomes a scalar, and gets added to each of the three sub-vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"> </span><span class="o">+</span><span class="na">¨</span><span class="w"> </span><span class="o">⊂</span><span class="m">100</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬─────────┬─────────┐
│107 25 2│119 34 14│133 64 56│
└────────┴─────────┴─────────┘
</span></div></div>
</div>
<p>If we drop the <em>each</em> operator, the result is the same because the scalar on the right is extended to match the shape of the left vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">⊂</span><span class="m">100</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬─────────┬─────────┐
│107 25 2│119 34 14│133 64 56│
└────────┴─────────┴─────────┘
</span></div></div>
</div>
<p>In fact, <em>each</em> is a superfluous operator when used with scalar dyadic functions, because scalar dyadic functions are <em>pervasive</em>, as seen in <a class="reference external" href="Some-Primitive-Functions.ipynb#Scalar-vs-Non-scalar-Functions">a previous section</a>.</p>
</div>
<div class="section" id="juxtaposition-vs-catenation">
<span id="nested-arrays-continued-juxtaposition-vs-catenation"></span><h3><span class="section-number">10.6.2. </span>Juxtaposition vs Catenation<a class="headerlink" href="#juxtaposition-vs-catenation" title="Permalink to this headline">#</a></h3>
<p>When you <em>catenate</em> a number of arrays, for example <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">←</span> <span class="pre">a,b,c</span></code>, you create a new array with the <strong>contents</strong> of <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">c</span></code> catenated together to make a single new array, as we have seen many times before.</p>
<p>Let us use a small vector and see how it works:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">small</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">,</span><span class="nv">small</span><span class="o">,</span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3 4 5 6 7
</span></div></div>
</div>
<p>As we can see, the result is a <em>simple</em> vector.</p>
<p>What happens here is, of course, that the first 3-item vector <code class="docutils literal notranslate"><span class="pre">small</span></code> and the 2-item vector <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">7</span></code> are combined into one 5-item vector.
Then, this 5-item vector is combined with the 2-item vector <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span></code> to form the resulting 7-item vector.
Both the final and the interim results are <em>simple</em> vectors.</p>
<p>We can now explain what happens when you <em>juxtapose</em> two or more arrays (<em>strand notation</em>), for example <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span> <span class="pre">d</span> <span class="pre">e</span></code>: each array is enclosed, and the resulting scalars are catenated together.</p>
<p>Such an expression produces a vector made of as many items as we have arrays on the right.
In the example that follows, the result is a <em>nested</em> vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─────┬─┬─┐
│1│2│3 4 5│6│7│
└─┴─┴─────┴─┴─┘
</span></div></div>
</div>
<p>This is what we call <em>vector notation</em> or <em>strand notation</em>.
In this case, we juxtaposed five arrays, so we created a nested array of length five.</p>
<p>What happens here is that each of the five arrays is first enclosed, and then the resulting five scalars are catenated together to produce the 5-item vector.
Please remember that enclosing a simple scalar does not change it, so you can only see the difference for the array <code class="docutils literal notranslate"><span class="pre">small</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬─────┬─┬─┐
│1 2│3 4 5│6│7│
└───┴─────┴─┴─┘
</span></div></div>
</div>
<p>Here, we juxtaposed four arrays, two of which are vectors.
It is, again, an example of <em>strand notation</em>.</p>
<p>In other words, juxtaposition works on arrays seen as building blocks, while catenation works on the contents of the arrays.</p>
<p>It may help you to know that there is a strict relationship between catenation and <em>strand notation</em>:
<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">(⊂a),(⊂b),(⊂c)</span></code>.</p>
<p>Here is an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="no">⍬</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;apl&#39;</span><span class="w"></span>
<span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">42</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┬───┬──┐
││apl│42│
└┴───┴──┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="nv">a</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">b</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">c</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┬───┬──┐
││apl│42│
└┴───┴──┘
</span></div></div>
</div>
<p>The two results look the same; we can be sure they <em>are</em> the same by using <code class="docutils literal notranslate"><span class="pre">≡</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="o">≡</span><span class="p">(</span><span class="o">⊂</span><span class="nv">a</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">b</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">c</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Now, we will turn our attention to two other expressions that give the same result,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="nv">small</span><span class="o">,</span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬─────┬─┬─┐
│1 2│3 4 5│6│7│
└───┴─────┴─┴─┘
</span></div></div>
</div>
<p>and</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬─────┬─┬─┐
│1 2│3 4 5│6│7│
└───┴─────┴─┴─┘
</span></div></div>
</div>
<p>These two expressions give the same result, but for a different reason than the one explained above.
In fact, <code class="docutils literal notranslate"><span class="pre">small</span></code> is <strong>not</strong> catenated to the vector <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">7</span></code> as in the first example above.
To read this expression correctly, we must recall comma <em>is</em> an APL function:</p>
<ul class="simple">
<li><p>its right argument is the vector <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">7</span></code>, of course; and</p></li>
<li><p>its left argument is whatever is on its left, up to the next function.
As there is no such function (parenthesis are not functions), the left argument is the result of the entire expression to the left of the comma, i.e., the 2-item vector <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span> <span class="pre">small</span></code>.</p></li>
</ul>
<p>So, the result is that the 2-item vector <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span> <span class="pre">small</span></code> is combined with the 2-item vector <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">7</span></code> to form the resulting 4-item vector.</p>
<p><strong>Remember this</strong>: when interpreting an expression, you must never “break” a sequence of juxtaposed arrays (a <em>strand</em>), even if it is a nested vector.</p>
<p>So, in the previous example, the left argument to <em>catenate</em> is this whole array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="nv">small</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬─────┐
│1 2│3 4 5│
└───┴─────┘
</span></div></div>
</div>
<p>When <em>catenate</em> is executed, the two items of this argument are catenated to the two items <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">7</span></code> of the right argument, making the same 4-item nested vector as in the previous example.</p>
<p>Can you predict the result of <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2),small</span> <span class="pre">6</span> <span class="pre">7</span></code>?</p>
</div>
<div class="section" id="characters-and-numbers">
<span id="nested-arrays-continued-characters-and-numbers"></span><h3><span class="section-number">10.6.3. </span>Characters and Numbers<a class="headerlink" href="#characters-and-numbers" title="Permalink to this headline">#</a></h3>
<p>We have a character matrix <code class="docutils literal notranslate"><span class="pre">cm</span></code> and a numeric matrix <code class="docutils literal notranslate"><span class="pre">nm</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">cm</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="o">⍴</span><span class="s1">&#39;FrancisCarmen Luciano&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Francis
Carmen 
Luciano
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">nm</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">200000</span><span class="p">)</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  21.21 1534.88 375.46  704.5
1125.14 1963.52 464.45 1438.25
 796.53 1569    157.14  886.59
</span></div></div>
</div>
<p>We would like to have them displayed side by side.</p>
<div class="section" id="solution-1">
<span id="nested-arrays-continued-solution-1"></span><h4><span class="section-number">10.6.3.1. </span>Solution 1<a class="headerlink" href="#solution-1" title="Permalink to this headline">#</a></h4>
<p>The first idea is to just type <code class="docutils literal notranslate"><span class="pre">cm</span> <span class="pre">nm</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cm</span><span class="w"> </span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬──────────────────────────────┐
│Francis│  21.21 1534.88 375.46  704.5 │
│Carmen │1125.14 1963.52 464.45 1438.25│
│Luciano│ 796.53 1569    157.14  886.59│
└───────┴──────────────────────────────┘
</span></div></div>
</div>
<p>The format of the result is not ideal; some values have two decimal digits, and some have only one or none.
But there is a much more important problem.
Imagine that we would like to draw a line on the top of the report.
We can catenate a single dash along the first dimension:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;-&#39;</span><span class="o">⍪</span><span class="nv">cm</span><span class="w"> </span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───────┬──────────────────────────────┐
│-│Francis│  21.21 1534.88 375.46  704.5 │
│ │Carmen │1125.14 1963.52 464.45 1438.25│
│ │Luciano│ 796.53 1569    157.14  886.59│
└─┴───────┴──────────────────────────────┘
</span></div></div>
</div>
<p>This is not what we expected: the dash has been placed on the left, not on the top!
The reason is that the expression <code class="docutils literal notranslate"><span class="pre">cm</span> <span class="pre">nm</span></code> does not produce a matrix, but a 2-item nested vector.
And when one catenates a scalar to a vector, it is inserted before its first item or after the last one, to produce a longer vector.
This cannot produce a matrix, unless <em>laminate</em> is used, but we shall not try that now.</p>
</div>
<div class="section" id="solution-2">
<span id="nested-arrays-continued-solution-2"></span><h4><span class="section-number">10.6.3.2. </span>Solution 2<a class="headerlink" href="#solution-2" title="Permalink to this headline">#</a></h4>
<p>Well, if juxtaposition doesn’t achieve what we want, why shouldn’t we catenate our two matrices?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cm</span><span class="o">,</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Francis   21.21 1534.88 375.46  704.5
Carmen  1125.14 1963.52 464.45 1438.25
Luciano  796.53 1569    157.14  886.59
</span></div></div>
</div>
<p>This is almost the same presentation, but not exactly; this is a matrix!</p>
<p>Now, let us try to draw the line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;-&#39;</span><span class="o">⍪</span><span class="nv">cm</span><span class="o">,</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">-------       -       -      -       -
Francis   21.21 1534.88 375.46  704.5 
Carmen  1125.14 1963.52 464.45 1438.25
Luciano  796.53 1569    157.14  886.59
</span></div></div>
</div>
<p>Horrible!
What happened?</p>
<p>When we catenated <code class="docutils literal notranslate"><span class="pre">cm</span></code> (shape <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">7</span></code>) with <code class="docutils literal notranslate"><span class="pre">nm</span></code> (shape <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">4</span></code>), we produced a 3 by 11 matrix.
So, when we further catenated a dash on top of it, the dash was repeated 11 times to fit the last dimension of the matrix.
This is why we obtained 7 dashes on top of the 7 text columns, and 4 dashes, each on top of each of the 4 numeric columns.
This is still not what we want!</p>
</div>
<div class="section" id="solution-3">
<span id="nested-arrays-continued-solution-3"></span><h4><span class="section-number">10.6.3.3. </span>Solution 3<a class="headerlink" href="#solution-3" title="Permalink to this headline">#</a></h4>
<p>The final solution will be the following: convert the numbers into text, using the <em>format</em> function, and then catenate one character matrix to another character matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;-&#39;</span><span class="o">⍪</span><span class="nv">cm</span><span class="o">,</span><span class="m">9</span><span class="w"> </span><span class="m">2</span><span class="o">⍕</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">-------------------------------------------
Francis    21.21  1534.88   375.46   704.50
Carmen   1125.14  1963.52   464.45  1438.25
Luciano   796.53  1569.00   157.14   886.59
</span></div></div>
</div>
<p>Now, the line is exactly where we want it and the numbers are nicely formatted.</p>
<div class="exercise admonition" id="ex-depth-rank-shape">

<p class="admonition-title"><span class="caption-number">Exercise 10.1 </span></p>
<div class="section" id="exercise-content">
<p>Deduce the results of the following 3 expressions (depth, rank, shape), and then verify your solutions on the computer:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="nv">cm</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="nv">nm</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="o">⊂</span><span class="nv">cm</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">nm</span><span class="p">)</span><span class="w"></span>
<span class="nv">cm</span><span class="o">,⊂</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="some-more-operations">
<span id="nested-arrays-continued-some-more-operations"></span><h3><span class="section-number">10.6.4. </span>Some More Operations<a class="headerlink" href="#some-more-operations" title="Permalink to this headline">#</a></h3>
<p>Let us use <code class="docutils literal notranslate"><span class="pre">vec5</span></code> once more.</p>
<div class="section" id="reduction">
<span id="nested-arrays-continued-reduction"></span><h4><span class="section-number">10.6.4.1. </span>Reduction<a class="headerlink" href="#reduction" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┐
│59 63 69│
└────────┘
</span></div></div>
</div>
<p>Notice the box around the final result!</p>
<p>The three enclosed arrays (scalars) have been added together, and the result is therefore an enclosed array (a scalar).
You can tell this from the output, because there is a box around the result.</p>
<p>We know that the reduction of a vector (rank 1) produces a scalar (rank 0), and this rule still applies here.</p>
<p>To obtain the <em>contents</em> of the (enclosed) vector, we must disclose the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃+</span><span class="na">/</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">59 63 69
</span></div></div>
</div>
<p>The same thing can be observed if we try to collect all the values contained in <code class="docutils literal notranslate"><span class="pre">vec5</span></code> into a single vector, by catenating them together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="na">/</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────────────────┐
│7 5 1 19 14 13 33 44 55│
└───────────────────────┘
</span></div></div>
</div>
<p>It worked, but here again we might want to disclose the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃,</span><span class="na">/</span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 5 1 19 14 13 33 44 55
</span></div></div>
</div>
</div>
<div class="section" id="index-of-and-membership">
<span id="nested-arrays-continued-index-of-and-membership"></span><h4><span class="section-number">10.6.4.2. </span>Index Of and Membership<a class="headerlink" href="#index-of-and-membership" title="Permalink to this headline">#</a></h4>
<p>The function <em>index of</em> (dyadic <code class="docutils literal notranslate"><span class="pre">⍳</span></code>) may be used to search for (find the position of) items in a nested vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"> </span><span class="o">⍳</span><span class="w"> </span><span class="p">(</span><span class="m">19</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 4
</span></div></div>
</div>
<p>This is correct: the first vector appears in <code class="docutils literal notranslate"><span class="pre">vec5</span></code> as <code class="docutils literal notranslate"><span class="pre">vec5[2]</span></code>, and the second vector is not present.</p>
<p>But beware, there is a booby trap:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"> </span><span class="o">⍳</span><span class="w"> </span><span class="p">(</span><span class="m">19</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 4 4
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">(19</span> <span class="pre">14</span> <span class="pre">13)</span></code> is not a nested array.
<code class="docutils literal notranslate"><span class="pre">vec5</span></code> is searched for each of these three numbers individually, and they are not found.</p>
<p>To get the expected result, we need to enclose the right argument to <em>index of</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec5</span><span class="w"> </span><span class="o">⍳</span><span class="w"> </span><span class="o">⊂</span><span class="m">19</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<p>It is also important to be aware of this when using <em>membership</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="p">)(</span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">∊</span><span class="w"> </span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">∊</span><span class="w"> </span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">∊</span><span class="w"> </span><span class="nv">vec5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
</div>
<div class="section" id="indexing">
<span id="nested-arrays-continued-indexing"></span><h4><span class="section-number">10.6.4.3. </span>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">#</a></h4>
<p>The rules we saw about indexing remain true: when one indexes a vector by an array, the result has the same shape as the array.
If the vector is nested, the result is generally nested too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">vec4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────┐
│ ┌→────┐       ┌→──┐ ┌→───────┐ │
│ │15 12│ 71023 ↓1 2│ │74 85 96│ │
│ └~────┘       │3 4│ └~───────┘ │
│               └~──┘            │
└∊───────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">vec4</span><span class="sr">[</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────┐
↓ ┌→───────┐       │
│ │74 85 96│ 71023 │
│ └~───────┘       │
│ ┌→────┐    ┌→──┐ │
│ │15 12│    ↓1 2│ │
│ └~────┘    │3 4│ │
│            └~──┘ │
└∊─────────────────┘
</span></div></div>
</div>
<p>We have also seen, in <a class="reference internal" href="Data-and-Variables.html#data-and-variables-array-indexing"><span class="std std-numref">Section 3.5.3</span></a>, that a nested array can be used as an index.
For example, to index items scattered throughout a matrix, the array that specifies the indices is composed of 2-item vectors (row and column indices):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">tests</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">11</span><span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">87</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">65</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">55</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">44</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">11 26 22
14 87 52
30 28 19
65 40 55
19 31 64
33 70 44
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tests</span><span class="sr">[</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">52 19 26
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tests</span><span class="sr">[</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">52 19
26 52
</span></div></div>
</div>
<p>Let us try to obtain the same result with the <em>index</em> function, or <em>squad</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">⌷</span><span class="w"> </span><span class="nv">tests</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      (2 3)(5 1)(1 2)⌷tests
                     ∧
</pre></div>
</div>
</div>
</div>
<p>The above cannot work.
<em>Index</em> expects a 2-item vector: a list of rows and a list of columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">⌷</span><span class="na">¨</span><span class="w"> </span><span class="nv">tests</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR
      (2 3)(5 1)(1 2)⌷¨tests
                     ∧
</pre></div>
</div>
</div>
</div>
<p>This second attempt also won’t work: each item of the left argument cannot be associated with a corresponding item of <code class="docutils literal notranslate"><span class="pre">tests</span></code>, because they do not have the same shape.</p>
<p>In order to get this to work, we need to enclose <code class="docutils literal notranslate"><span class="pre">tests</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">⌷</span><span class="na">¨</span><span class="w"> </span><span class="o">⊂</span><span class="nv">tests</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">52 19 26
</span></div></div>
</div>
<p>This last expression worked correctly. <strong>Each</strong> couple of indices is paired with <code class="docutils literal notranslate"><span class="pre">tests</span></code> as a whole because it has been enclosed, and therefore the scalar on the right is extended to match the 3-item vector on the left.</p>
<p><strong>Always keep in mind the following rules</strong>:</p>
<ul class="simple">
<li><p>The items of a nested array are scalars and are therefore always processed as scalars.</p></li>
</ul>
<p>In the expression below,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">×</span><span class="m">10</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┐
│50 60│20 10│
└─────┴─────┘
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">(5</span> <span class="pre">6)</span></code> is multiplied by <code class="docutils literal notranslate"><span class="pre">10</span></code> and <code class="docutils literal notranslate"><span class="pre">(4</span> <span class="pre">2)</span></code> is multiplied by <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p>
<ul class="simple">
<li><p>A single list of values placed between parentheses is not a nested array:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">45</span><span class="w"> </span><span class="m">77</span><span class="w"> </span><span class="m">80</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">45 77 80
</span></div></div>
</div>
<p>The parentheses do nothing here.</p>
<ul class="simple">
<li><p>An expression is always evaluated from right to left, one function at a time. Note that strands can be easy to miss when determining what the left argument of a function is.</p></li>
</ul>
<p>In the expression <code class="docutils literal notranslate"><span class="pre">2×a</span> <span class="pre">3+b</span></code>, the left argument of the <em>plus</em> function is not <code class="docutils literal notranslate"><span class="pre">3</span></code> alone, but the vector <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">3</span></code>.</p>
<p>Before we go any further with nested arrays, we recommend that you try to solve some exercises.</p>
</div>
</div>
</div>
<div class="section" id="intermission-exercises">
<span id="nested-arrays-continued-intermission-exercises"></span><h2><span class="section-number">10.7. </span>Intermission Exercises<a class="headerlink" href="#intermission-exercises" title="Permalink to this headline">#</a></h2>
<p>You are given three numeric vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
<span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="ex-depth-rank-shape2">

<p class="admonition-title"><span class="caption-number">Exercise 10.2 </span></p>
<div class="section" id="exercise-content">
<p>Try to predict the results given by the following expressions in terms of depth, rank, and shape.
Then check your results using <code class="docutils literal notranslate"><span class="pre">]display</span></code>, or the appropriate primitives.</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span> <span class="pre">×</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(10</span> <span class="pre">20),a</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(10</span> <span class="pre">20),a</span> <span class="pre">b</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">2</span> <span class="pre">×</span> <span class="pre">c[2]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10×a</span> <span class="pre">20×b</span></code></p></li>
</ol>
</div>
</div>
<div class="exercise admonition" id="ex-depth-rank-shape3">

<p class="admonition-title"><span class="caption-number">Exercise 10.3 </span></p>
<div class="section" id="exercise-content">
<p>Same question for the following expressions:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">+/a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+/¨a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1/¨a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(a</span> <span class="pre">b</span> <span class="pre">c)⍳(4</span> <span class="pre">5</span> <span class="pre">6)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">10</span> <span class="pre">3</span> <span class="pre">∊</span> <span class="pre">a</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(⊂1</span> <span class="pre">0</span> <span class="pre">1)/¨a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">10</span> <span class="pre">3</span> <span class="pre">∊</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
</ol>
</div>
</div>
<div class="exercise admonition" id="ex-reductions">

<p class="admonition-title"><span class="caption-number">Exercise 10.4 </span></p>
<div class="section" id="exercise-content">
<p>What are the results of <code class="docutils literal notranslate"><span class="pre">+/na</span></code> and <code class="docutils literal notranslate"><span class="pre">,/na</span></code> for the vector <code class="docutils literal notranslate"><span class="pre">na</span></code> shown below?</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">na</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬───┬─┬─┐
│1│2│3 4│7│8│
│ │ │5 6│ │ │
└─┴─┴───┴─┴─┘
</span></div></div>
</div>
</div>
<div class="section" id="split-and-mix">
<span id="nested-arrays-continued-split-and-mix"></span><h2><span class="section-number">10.8. </span>Split and Mix<a class="headerlink" href="#split-and-mix" title="Permalink to this headline">#</a></h2>
<p>We saw that in some cases we can choose to represent data either as a matrix or as a nested vector; remember <code class="docutils literal notranslate"><span class="pre">monMat</span></code> and <code class="docutils literal notranslate"><span class="pre">monVec</span></code>.</p>
<p>Two primitive monadic functions are provided to switch from one form to the other:</p>
<ul class="simple">
<li><p><em>Mix</em> (<code class="docutils literal notranslate"><span class="pre">↑</span></code>) returns an array of <em>higher rank</em> and <em>lower depth</em> than that of its argument; and</p></li>
<li><p><em>Split</em> (<code class="docutils literal notranslate"><span class="pre">↓</span></code>) returns an array of <em>lower rank</em> and <em>higher depth</em> than that of its argument.</p></li>
</ul>
<div class="section" id="basic-use">
<span id="nested-arrays-continued-basic-use"></span><h3><span class="section-number">10.8.1. </span>Basic Use<a class="headerlink" href="#basic-use" title="Permalink to this headline">#</a></h3>
<p>Let us apply <em>mix</em> to two small vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vtex</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;One&#39;</span><span class="w"> </span><span class="s1">&#39;Two&#39;</span><span class="w"> </span><span class="s1">&#39;Three&#39;</span><span class="w"></span>
<span class="nv">vnum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="p">(</span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">rtex</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↑</span><span class="w"> </span><span class="nv">vtex</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">One  
Two  
Three
</span></div></div>
</div>
<p>Notice how we have converted a nested vector (of depth 2 and rank 1) into a simple matrix (of depth 1 and rank 2).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">rnum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↑</span><span class="w"> </span><span class="nv">vnum</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 6 2 0
14 0 0
 7 5 3
</span></div></div>
</div>
<p>In this example, we have converted a nested vector (of depth -2 and rank 1) into a simple matrix (of depth 1 and rank 2).</p>
<p>Of course the operation is possible only because the shorter items are padded with blanks (for text) or zeroes (for numbers), or more generally by the appropriate <em>fill item</em> (this notion will be explained soon).</p>
<p>The last example above shows that when we say that the depth is reduced, we actually mean that the <em>magnitude</em> of the depth is reduced.</p>
<p>And now, let us apply <em>split</em> to the matrices we have just produced:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">newtex</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↓</span><span class="nv">rtex</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│One  │Two  │Three│
└─────┴─────┴─────┘
</span></div></div>
</div>
<p>We converted a simple matrix (of depth 1 and rank 2) into a nested vector (of depth 2 and rank 1).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">newnum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↓</span><span class="nv">rnum</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬──────┬─────┐
│6 2 0│14 0 0│7 5 3│
└─────┴──────┴─────┘
</span></div></div>
</div>
<p>Note that the two new vectors (<code class="docutils literal notranslate"><span class="pre">newtex</span></code> and <code class="docutils literal notranslate"><span class="pre">newnum</span></code>) are not identical to the original ones (<code class="docutils literal notranslate"><span class="pre">vtex</span></code> and <code class="docutils literal notranslate"><span class="pre">vnum</span></code>) because, when they were converted into the matrices <code class="docutils literal notranslate"><span class="pre">rtex</span></code> and <code class="docutils literal notranslate"><span class="pre">rnum</span></code>, the shorter items were padded.
When one splits a matrix, the items of the result all have the same size.</p>
<div class="section" id="mix-applied-to-heterogeneous-data">
<span id="nested-arrays-continued-mix-applied-to-heterogeneous-data"></span><h4><span class="section-number">10.8.1.1. </span>Mix Applied to Heterogeneous Data<a class="headerlink" href="#mix-applied-to-heterogeneous-data" title="Permalink to this headline">#</a></h4>
<p>The examples shown above represent very common uses of <em>mix</em> and <em>split</em>.
However, it is of course also possible to apply the functions to heterogeneous data.</p>
<p>For example, we can mix text and numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="s1">&#39;Mixed&#39;</span><span class="w"> </span><span class="p">(</span><span class="m">11</span><span class="w"> </span><span class="m">43</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> M  i x e d
11 43 0 0 0
</span></div></div>
</div>
<p>And we can also mix a simple vector with a nested one.
As expected, the result below is a 2 by 3 matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="w"> </span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Oui&#39;</span><span class="w"> </span><span class="s1">&#39;Da&#39;</span><span class="w"> </span><span class="s1">&#39;Si&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬──┬──┐
│Y  │e │s │
├───┼──┼──┤
│Oui│Da│Si│
└───┴──┴──┘
</span></div></div>
</div>
</div>
</div>
<div class="section" id="axis-specification">
<span id="nested-arrays-continued-axis-specification"></span><h3><span class="section-number">10.8.2. </span>Axis Specification<a class="headerlink" href="#axis-specification" title="Permalink to this headline">#</a></h3>
<div class="section" id="split">
<span id="nested-arrays-continued-split"></span><h4><span class="section-number">10.8.2.1. </span>Split<a class="headerlink" href="#split" title="Permalink to this headline">#</a></h4>
<p>When we apply the function <em>split</em> to an array, its rank will decrease, so we must specify which of its dimensions is to be suppressed.
If we don’t specify it explicitly, the default is to suppress the last dimension.</p>
<p>Let us work on <code class="docutils literal notranslate"><span class="pre">chemistry</span></code>, a matrix we used earlier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="s1">&#39;H2SO4CaCO3Fe2O3&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2SO4
CaCO3
Fe2O3
</span></div></div>
</div>
<p>In this case, there are two possible uses of <em>split</em>: we can apply it either to the first dimension or to the second dimension.</p>
<p>If we specify the first axis, the matrix is split column-wise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↓</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┐
│HCF│2ae│SC2│OOO│433│
└───┴───┴───┴───┴───┘
</span></div></div>
</div>
<p>If we specify the second axis, the matrix is split row-wise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↓</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│H2SO4│CaCO3│Fe2O3│
└─────┴─────┴─────┘
</span></div></div>
</div>
<p>If we omit the axis specification, <em>split</em> defaults to the last axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↓</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│H2SO4│CaCO3│Fe2O3│
└─────┴─────┴─────┘
</span></div></div>
</div>
</div>
<div class="section" id="mix">
<span id="nested-arrays-continued-mix"></span><h4><span class="section-number">10.8.2.2. </span>Mix<a class="headerlink" href="#mix" title="Permalink to this headline">#</a></h4>
<p>The use of <em>mix</em> is a bit more complex because it adds a new dimension to an existing array.
So does the function <em>laminate</em>, and the two functions use the same convention to specify where to insert the new dimension.</p>
<p>If we apply the function <em>mix</em> to a 3-item nested vector of vectors, in which the largest item is an enclosed 5-item vector, the result must be either a 5 by 3 matrix, or a 3 by 5 matrix (the default).</p>
<p>In the same way as for <em>laminate</em>, a new dimension is created.
This new dimension can be inserted before or after the existing dimension.
The programmer decides this by specifying an axis:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[0.5]</span></code> inserts the new dimension <strong>before</strong> the existing one, resulting in a 5 by 3 matrix; or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[1.5]</span></code> inserts the new dimension <strong>after</strong> the existing one, resulting in a 3 by 5 matrix.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="s1">&#39;One&#39;</span><span class="w"> </span><span class="s1">&#39;Two&#39;</span><span class="w"> </span><span class="s1">&#39;Three&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">OTT
nwh
eor
  e
  e
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="s1">&#39;One&#39;</span><span class="w"> </span><span class="s1">&#39;Two&#39;</span><span class="w"> </span><span class="s1">&#39;Three&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">One  
Two  
Three
</span></div></div>
</div>
<p>The last example is the default behaviour, where the new dimension is inserted after the existing one:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="s1">&#39;One&#39;</span><span class="w"> </span><span class="s1">&#39;Two&#39;</span><span class="w"> </span><span class="s1">&#39;Three&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">One  
Two  
Three
</span></div></div>
</div>
<p>Let us now work with a nested matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">friends</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;John&#39;</span><span class="w"> </span><span class="s1">&#39;Mike&#39;</span><span class="w"> </span><span class="s1">&#39;Anna&#39;</span><span class="w"> </span><span class="s1">&#39;Noah&#39;</span><span class="w"> </span><span class="s1">&#39;Suzy&#39;</span><span class="w"> </span><span class="s1">&#39;Paul&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬────┬────┐
│John│Mike│Anna│
├────┼────┼────┤
│Noah│Suzy│Paul│
└────┴────┴────┘
</span></div></div>
</div>
<p>The shape of this matrix is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code>, and its items are all of length <code class="docutils literal notranslate"><span class="pre">4</span></code>.
So, <em>mix</em> can produce three different results, according to axis specifications as follows:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>With the axis</p></th>
<th class="text-align:right head"><p>the new dimension is inserted</p></th>
<th class="text-align:right head"><p>and the resulting shape is</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">[2.5]</span></code></p></td>
<td class="text-align:right"><p>after <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code></p></td>
<td class="text-align:right"><p><code>  2   3 4</code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">[1.5]</span></code></p></td>
<td class="text-align:right"><p>between <code class="docutils literal notranslate"><span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td class="text-align:right"><p><code>  2 4 3  </code></p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">[0.5]</span></code></p></td>
<td class="text-align:right"><p>before <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code></p></td>
<td class="text-align:right"><p><code>4 2   3  </code></p></td>
</tr>
</tbody>
</table>
<p>Each of these three cases is illustrated below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="sr">[</span><span class="m">2.5</span><span class="sr">]</span><span class="nv">friends</span><span class="w">    </span><span class="c1">⍝ Default case, [2.5] was unnecessary.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">John
Mike
Anna

Noah
Suzy
Paul
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴↑</span><span class="sr">[</span><span class="m">2.5</span><span class="sr">]</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 3 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">JMA
oin
hkn
nea

NSP
oua
azu
hyl
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴↑</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 4 3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">JMA
NSP

oin
oua

hkn
azu

nea
hyl
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴↑</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 2 3
</span></div></div>
</div>
<p>In the first example, the names are placed “horizontally” as rows in two sub-matrices.</p>
<p>In the second case, they are placed “vertically” in columns.</p>
<p>The third case is more difficult to read; the names are positioned perpendicularly to the matrices, with one letter in each.
You might like to imagine that the letters are arranged in a cube, and that you are viewing it from three different positions.</p>
<p>Notice that, naturally, there is a connection between using <code class="docutils literal notranslate"><span class="pre">↑[k]</span></code> and using <em>mix</em> followed by <em>dyadic transpose</em>.</p>
<p>The tables above have shown that the main difference between using the default <em>mix</em>, or using <em>mix</em> with <em>axis</em>, pertains to the place where the new axis gets inserted into the shape of the result.
Therefore, one can always use <em>dyadic transpose</em> after <em>mix</em> to shuffle the axis of the result to the intended position.</p>
<p>Let us revisit the examples above using <code class="docutils literal notranslate"><span class="pre">friends</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">↑[0.5]friends</span></code> will have a resulting shape of <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">2</span> <span class="pre">3</span></code>, while <code class="docutils literal notranslate"><span class="pre">↑friends</span></code> has a shape of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span></code>.
Therefore, <em>dyadic transpose</em> needs to move the last axis of <code class="docutils literal notranslate"><span class="pre">↑friends</span></code> to the front:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="o">⍉↑</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">JMA
NSP

oin
oua

hkn
azu

nea
hyl
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">↑</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="nv">friends</span><span class="p">)</span><span class="o">≡</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="o">⍉↑</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Recall that the left argument of <em>dyadic transpose</em> tells you the position to which each axis goes.
If <code class="docutils literal notranslate"><span class="pre">la</span></code> is the left argument of dyadic transpose, <code class="docutils literal notranslate"><span class="pre">la</span> <span class="pre">←</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">1</span></code>, then <code class="docutils literal notranslate"><span class="pre">la[1]</span></code> tells us where the 1st axis goes, <code class="docutils literal notranslate"><span class="pre">la[2]</span></code> tells us where the 2nd axis goes, and <code class="docutils literal notranslate"><span class="pre">la[3]</span></code> tells us where the 3rd (and last) axis goes.</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">la[3]</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code>, we know that the last axis (which was created by <em>mix</em>) will now become the first axis, and the axes that were in positions <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code> will move one position down, to <code class="docutils literal notranslate"><span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p>
<p>Similarly, we can determine what should be the left argument to <em>dyadic transpose</em> if we were to use it instead of doing <code class="docutils literal notranslate"><span class="pre">↑[1.5]friends</span></code>.
With <code class="docutils literal notranslate"><span class="pre">↑[1.5]</span></code>, we want the new axis to go in the middle.
If we work from <code class="docutils literal notranslate"><span class="pre">↑friends</span></code>, the last axis in <code class="docutils literal notranslate"><span class="pre">↑friends</span></code> needs to go to position <code class="docutils literal notranslate"><span class="pre">2</span></code>, so we have <code class="docutils literal notranslate"><span class="pre">la</span> <span class="pre">←</span> <span class="pre">?</span> <span class="pre">?</span> <span class="pre">2</span></code>.
We just have to fill in the rest of the left argument, making sure that the original axes remain ordered:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">la</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="nv">la</span><span class="o">⍉↑</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">JMA
oin
hkn
nea

NSP
oua
azu
hyl
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">↑</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="nv">friends</span><span class="p">)</span><span class="o">≡</span><span class="nv">la</span><span class="o">⍉↑</span><span class="nv">friends</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="type-prototype-fill-item">
<span id="nested-arrays-continued-type-prototype-fill-item"></span><h2><span class="section-number">10.9. </span>Type, Prototype, Fill Item<a class="headerlink" href="#type-prototype-fill-item" title="Permalink to this headline">#</a></h2>
<p>Some operations like <em>expand</em> or <em>take</em> may insert new additional items into an array.
Up to now, things were <em>simple</em>; numeric arrays were expanded with zeroes and character arrays were expanded with blanks.
But what will happen if the array contains both numbers and characters (a <em>mixed</em> array), or if it is a nested array?</p>
<p>We need a variable to experiment a little:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">hogwash</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="s1">&#39;APL&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">5</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="s1">&#39;Nuts&#39;</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┬─┬────────┐
│19│1 2│A│┌────┬─┐│
│  │3 4│P││5   │8││
│  │   │L│├────┼─┤│
│  │   │ ││Nuts│9││
│  │   │ │└────┴─┘│
└──┴───┴─┴────────┘
</span></div></div>
</div>
<p>What would be the result of expressions like <code class="docutils literal notranslate"><span class="pre">6↑hogwash</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1\hogwash</span></code>?</p>
<p>In general, when expanding an array, APL inserts <em>fill items</em>, and it does so using the <em>prototype</em> of the array.
In order to understand what the <em>prototype</em> of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code> is, we first need to understand what the <em>type</em> of an array is.</p>
<div class="note admonition">
<p class="admonition-title">Definition</p>
<p>The <em>type</em> of an array is an array with the exact same structure (shape, rank, and depth, for all levels of nesting) in which all numbers are replaced by zeroes and all characters are replaced by blanks.</p>
</div>
<p>For example, here is the <em>type</em> of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">hogwashType</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="s1">&#39;    &#39;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─┬────────┐
│0│0 0│ │┌────┬─┐│
│ │0 0│ ││0   │0││
│ │   │ │├────┼─┤│
│ │   │ ││    │0││
│ │   │ │└────┴─┘│
└─┴───┴─┴────────┘
</span></div></div>
</div>
<p>As we can (not) see, the <em>type</em> of a nested array may be difficult to interpret because of the invisible blanks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">hogwashType</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────────┐
│   ┌→──┐ ┌→┐ ┌→─────────┐ │
│ 0 ↓0 0│ ↓ │ ↓          │ │
│   │0 0│ │ │ │ 0      0 │ │
│   └~──┘ │ │ │          │ │
│         └─┘ │ ┌→───┐   │ │
│             │ │    │ 0 │ │
│             │ └────┘   │ │
│             └∊─────────┘ │
└∊─────────────────────────┘
</span></div></div>
</div>
<p>Having defined what the <em>type</em> of an array is, we can define what the <em>prototype</em> of an array is:</p>
<div class="note admonition">
<p class="admonition-title">Definition</p>
<p>In other words, the <em>prototype</em> of an array is its first item, in which all numbers are replaced by zeroes and all characters are replaced by blanks.</p>
<p>The <em>prototype</em> of an array is used as a <em>fill item</em> whenever an operation needs to create additional items.</p>
</div>
<p>The first item of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code> is a number, so the <em>prototype</em> of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code> is a single zero.
If we lengthen the vector using <em>overtake</em>, it will be padded with zeroes (fill items):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="o">↑</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┬─┬────────┬─┬─┐
│19│1 2│A│┌────┬─┐│0│0│
│  │3 4│P││5   │8││ │ │
│  │   │L│├────┼─┤│ │ │
│  │   │ ││Nuts│9││ │ │
│  │   │ │└────┴─┘│ │ │
└──┴───┴─┴────────┴─┴─┘
</span></div></div>
</div>
<p>Similarly, if we <em>expand</em> the array, the new items will also be zeroes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┬─┬─┬─┬────────┐
│19│1 2│0│A│0│┌────┬─┐│
│  │3 4│ │P│ ││5   │8││
│  │   │ │L│ │├────┼─┤│
│  │   │ │ │ ││Nuts│9││
│  │   │ │ │ │└────┴─┘│
└──┴───┴─┴─┴─┴────────┘
</span></div></div>
</div>
<p>Let us rotate the vector by one position:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwash</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">⌽</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, the first item is a numeric matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2
3 4
</span></div></div>
</div>
<p>Therefore, the prototype of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code> is now</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0
0 0
</span></div></div>
</div>
<p>If we take six items from <code class="docutils literal notranslate"><span class="pre">hogwash</span></code>, two such matrices will be added:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="o">↑</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬─┬────────┬──┬───┬───┐
│1 2│A│┌────┬─┐│19│0 0│0 0│
│3 4│P││5   │8││  │0 0│0 0│
│   │L│├────┼─┤│  │   │   │
│   │ ││Nuts│9││  │   │   │
│   │ │└────┴─┘│  │   │   │
└───┴─┴────────┴──┴───┴───┘
</span></div></div>
</div>
<p>Let us rotate the variable once more:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwash</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">⌽</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, the first item is a little 3 by 1 character matrix containing the letters <code class="docutils literal notranslate"><span class="pre">'APL'</span></code>.
So, the <em>prototype</em> will be a 3 by 1 character matrix containing three blank spaces.
This is the array that will be used by <em>expand</em> as the fill item.
Let us verify it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">\</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────┐
│ ┌→┐ ┌→─────────┐ ┌→┐    ┌→┐ ┌→──┐ │
│ ↓A│ ↓          │ ↓ │ 19 ↓ │ ↓1 2│ │
│ │P│ │ 5      8 │ │ │    │ │ │3 4│ │
│ │L│ │          │ │ │    │ │ └~──┘ │
│ └─┘ │ ┌→───┐   │ └─┘    └─┘       │
│     │ │Nuts│ 9 │                  │
│     │ └────┘   │                  │
│     └∊─────────┘                  │
└∊──────────────────────────────────┘
</span></div></div>
</div>
<p>If we repeat the rotation, the first item will be a nested matrix.
So, the <em>prototype</em> (and hence, also the fill item) will be a 2 by 2 nested matrix.
Let us try to <em>overtake</em> again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwash</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">⌽</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="m">6</span><span class="o">↑</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────────────────┐
│ ┌→─────────┐    ┌→──┐ ┌→┐ ┌→─────────┐ ┌→─────────┐ │
│ ↓          │ 19 ↓1 2│ ↓A│ ↓          │ ↓          │ │
│ │ 5      8 │    │3 4│ │P│ │ 0      0 │ │ 0      0 │ │
│ │          │    └~──┘ │L│ │          │ │          │ │
│ │ ┌→───┐   │          └─┘ │ ┌→───┐   │ │ ┌→───┐   │ │
│ │ │Nuts│ 9 │              │ │    │ 0 │ │ │    │ 0 │ │
│ │ └────┘   │              │ └────┘   │ │ └────┘   │ │
│ └∊─────────┘              └∊─────────┘ └∊─────────┘ │
└∊────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>Obviously, fill items are generally only useful for arrays whose items have a uniform structure.</p>
<p>We will talk a bit about computing the type and prototype of arrays in <a class="reference internal" href="#nested-arrays-continued-computing-the-type-and-prototype"><span class="std std-numref">Section 10.16.2</span></a>.</p>
</div>
<div class="section" id="pick">
<span id="nested-arrays-continued-pick"></span><h2><span class="section-number">10.10. </span>Pick<a class="headerlink" href="#pick" title="Permalink to this headline">#</a></h2>
<div class="section" id="definition">
<span id="nested-arrays-continued-definition"></span><h3><span class="section-number">10.10.1. </span>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">#</a></h3>
<p>Whenever you need to select one (and only one) item from an array, you can use the dyadic function <em>pick</em>, represented by the symbol <code class="docutils literal notranslate"><span class="pre">⊃</span></code>.
What makes <em>pick</em> different from ordinary indexing is that it is possible to “dig into” a nested array and pick an item at any level of nesting, and that it discloses the result.
The latter is probably the reason why <em>pick</em> and the monadic function <em>disclose</em> use the same symbol.</p>
<p>The syntax of <em>pick</em> is as follows: <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">path</span> <span class="pre">⊃</span> <span class="pre">data</span></code>.</p>
<p>The left argument is a scalar or a vector which specifies the <em>path</em> that leads to the desired item.
Each item of <code class="docutils literal notranslate"><span class="pre">path</span></code> is the index or set of indices needed to reach the item at the corresponding level of depth of the array.</p>
<p>The operation starts at the outermost level and goes deeper and deeper into the levels of nesting.
At each level, the selected item is disclosed before applying the next level of selection.</p>
<p>We shall work with the nested matrix <code class="docutils literal notranslate"><span class="pre">weird</span></code> from a previous section:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">weird</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">456</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="w"> </span><span class="s1">&#39;Dyalog&#39;</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">8</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="m">17</span><span class="w"> </span><span class="m">51</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Twisted&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬────────────┐
│456  │┌──────┬───┐│
│     ││Dyalog│44 ││
│     │├──────┼───┤│
│     ││27    │8 6││
│     ││      │2 4││
│     │└──────┴───┘│
├─────┼────────────┤
│17 51│Twisted     │
└─────┴────────────┘
</span></div></div>
</div>
<p>Let us try to select the value <code class="docutils literal notranslate"><span class="pre">51</span></code>.</p>
<p>To select the <code class="docutils literal notranslate"><span class="pre">51</span></code> we must first select the vector located in row 2, column 1 of the matrix, and then select the second item of that vector.
This is how we express this selection using <em>pick</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">51
</span></div></div>
</div>
<p>The left argument <code class="docutils literal notranslate"><span class="pre">(2</span> <span class="pre">1)</span> <span class="pre">2</span></code> is a 2-item vector because we need to select at two levels of nesting.</p>
<p>Using simple indexing and explicit disclosing we need a much more complicated expression to obtain the same selection:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="p">(</span><span class="o">⊃</span><span class="nv">weird</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">51
</span></div></div>
</div>
<p>Although, to be fair, in this special case the leftmost <code class="docutils literal notranslate"><span class="pre">⊃</span></code> was not required.
(Can you figure out why?)</p>
<p>We can also select the letter “g” within “Dyalog”.
To do so, we must first select the matrix located in row 1, column 2.
Within this matrix, we must select the character vector located in row 1, column 1.
Finally, we must select the 6th item of that character vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">g
</span></div></div>
</div>
<p>This time, the left argument is a 3-item vector because we need to select at three levels of nesting:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span></code> is the set of indices for the selection at the outermost level of depth;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">1)</span></code> is the set of indices for the selection at the second level of depth; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">6</span></code> is the index for the selection at the third level of depth.</p></li>
</ul>
<p>Using simple indexing, this selection is almost obscure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="p">(</span><span class="o">⊃</span><span class="p">(</span><span class="o">⊃</span><span class="nv">weird</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">2</span><span class="sr">]</span><span class="p">)</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="sr">[</span><span class="m">6</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">g
</span></div></div>
</div>
</div>
<div class="section" id="left-argument-length">
<span id="nested-arrays-continued-left-argument-length"></span><h3><span class="section-number">10.10.2. </span>Left Argument Length<a class="headerlink" href="#left-argument-length" title="Permalink to this headline">#</a></h3>
<p>The left argument to <em>pick</em> is a vector with as many items as the depth at which we want to select an item.
Each item of the left argument has a number of items corresponding to the rank of the sub-item at the corresponding depth at which it operates.</p>
<p>If we remove the last item of <code class="docutils literal notranslate"><span class="pre">path</span></code> in the example above, the selection will stop one level above the level at which it stopped before.
This means that we would select the entire character vector <code class="docutils literal notranslate"><span class="pre">'Dyalog'</span></code> instead of just the letter <code class="docutils literal notranslate"><span class="pre">'g'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Dyalog
</span></div></div>
</div>
<p>Yes, we selected the entire character vector.
Please, note again that the result has been disclosed, so that a simple array is returned in this case, instead of a scalar which is an enclosed vector.</p>
<p>The difference becomes more clear if we compare this with the equivalent simple indexing without the final <em>disclose</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊃</span><span class="nv">weird</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">2</span><span class="sr">]</span><span class="p">)</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">1</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┐
│Dyalog│
└──────┘
</span></div></div>
</div>
<p>We tried removing the last item of <code class="docutils literal notranslate"><span class="pre">path</span></code>, but what happens if we instead remove the last two items of <code class="docutils literal notranslate"><span class="pre">path</span></code>?
If we remove the last two items of <code class="docutils literal notranslate"><span class="pre">path</span></code>, we might expect to select the entire 2 by 2 nested matrix that contains the character vector <code class="docutils literal notranslate"><span class="pre">'Dyalog'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR
      (1 2)⊃weird
           ∧
</pre></div>
</div>
</div>
</div>
<p>But it does not work!</p>
<p>The reason for this is a problem that we have seen before:</p>
<p>In the expression <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span> <span class="pre">(1</span> <span class="pre">1)</span> <span class="pre">⊃</span> <span class="pre">weird</span></code>, the item <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span></code> is a scalar (an enclosed vector) because of <em>strand notation</em>.
The left argument to <em>pick</em> has two items, because we want to select an item at the second level.</p>
<p>In the expression <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span> <span class="pre">⊃</span> <span class="pre">weird</span></code>, we do not have a <em>strand</em>, so the argument <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span></code> is not enclosed.
It is a (simple) 2-item vector and, therefore, only suitable for selection at the second level.
The <code class="docutils literal notranslate"><span class="pre">RANK</span> <span class="pre">ERROR</span></code> is reported because we try to use a scalar <code class="docutils literal notranslate"><span class="pre">1</span></code> as an index at the outermost level.
However, at this level the array is a matrix, so two items are needed to form a proper index.</p>
<p>We want to select at the outermost level, so the left argument to <em>pick</em> must have exactly one item.
Therefore, we must explicitly enclose the vector, leading to the correct expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬───┐
│Dyalog│44 │
├──────┼───┤
│27    │8 6│
│      │2 4│
└──────┴───┘
</span></div></div>
</div>
<p>We still need two indices inside the enclosure because, at the outermost level, the array is a matrix.</p>
<p>The expression we used before (without the explicit <em>enclose</em>) is inappropriate for the array <code class="docutils literal notranslate"><span class="pre">weird</span></code>, but it could work fine with a different array;
for example, to take the first item of a nested vector, and then select the second item of it, as shown here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">⊃</span><span class="s1">&#39;Madrid&#39;</span><span class="w"> </span><span class="s1">&#39;New York&#39;</span><span class="w"> </span><span class="s1">&#39;London&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">a
</span></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">1</span></code> selects <code class="docutils literal notranslate"><span class="pre">'Madrid'</span></code>, and the <code class="docutils literal notranslate"><span class="pre">2</span></code> then selects the <code class="docutils literal notranslate"><span class="pre">'a'</span></code>.</p>
<p>In this expression, an <em>enclose</em> would be wrong, as we need to select at two levels.
However, at each level we only need one index, as we select from vectors at both levels.</p>
</div>
<div class="section" id="disclosed-result">
<span id="nested-arrays-continued-disclosed-result"></span><h3><span class="section-number">10.10.3. </span>Disclosed Result<a class="headerlink" href="#disclosed-result" title="Permalink to this headline">#</a></h3>
<p>As mentioned previously, <em>pick</em> returns the <strong>contents</strong> of the specified item, not the scalar which contains it.</p>
<p>Let us refer to the original value of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code> (i.e., before we rotated it before):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwash</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="s1">&#39;APL&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">5</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="s1">&#39;Nuts&#39;</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Because boxing is ON, we can readily tell the difference between</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊃</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2
3 4
</span></div></div>
</div>
<p>and</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwash</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┐
│1 2│
│3 4│
└───┘
</span></div></div>
</div>
<p>However, if boxing is OFF, we might make the mistake of believing that the two results are equal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">box</span><span class="w"> </span><span class="nv">off</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Was ON
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊃</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2
3 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwash</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1 2 
 3 4 
</span></div></div>
</div>
<p>Because boxing is OFF, the two results look very similar.
(An attentive reader will notice that the result of <code class="docutils literal notranslate"><span class="pre">hogwash[2]</span></code> is indented one space to the right, which indicates one level of nesting.)
This is deceptive:</p>
<ul class="simple">
<li><p>the first expression (<code class="docutils literal notranslate"><span class="pre">2⊃hogwash</span></code>) returns the 2 by 2 matrix contained in <code class="docutils literal notranslate"><span class="pre">hogwash</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="m">2</span><span class="o">⊃</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 2
</span></div></div>
</div>
<ul class="simple">
<li><p>while the other expression merely returns the second item of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code>, which is an enclosed matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">hogwash</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<p>To prevent us from shooting ourselves in the foot, let us turn boxing back ON:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">box</span><span class="w"> </span><span class="nv">on</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Was OFF
</span></div></div>
</div>
</div>
<div class="section" id="pick-first">
<span id="nested-arrays-continued-pick-first"></span><h3><span class="section-number">10.10.4. </span>Pick First<a class="headerlink" href="#pick-first" title="Permalink to this headline">#</a></h3>
<p>We have not mentioned this before (because up to now we have only used it on 1-item arrays), but <em>disclose</em> <code class="docutils literal notranslate"><span class="pre">⊃</span></code> actually discloses just the <em>first</em> item of an array.
All other items are ignored.
In other words, <em>disclose</em> <code class="docutils literal notranslate"><span class="pre">⊃array</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">1⊃,array</span></code>.
For this reason, the function <code class="docutils literal notranslate"><span class="pre">⊃</span></code> is also called <em>first</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="m">26</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">30</span><span class="p">)</span><span class="w"> </span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="s1">&#39;January&#39;</span><span class="w"> </span><span class="s1">&#39;February&#39;</span><span class="w"> </span><span class="s1">&#39;March&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">January
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="s1">&#39;Dyalog&#39;</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;APL&#39;</span><span class="w"> </span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Dyalog
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="m">12</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
</span></div></div>
</div>
</div>
<div class="section" id="selective-assignment">
<span id="nested-arrays-continued-selective-assignment"></span><h3><span class="section-number">10.10.5. </span>Selective Assignment<a class="headerlink" href="#selective-assignment" title="Permalink to this headline">#</a></h3>
<p>When one wants to modify an item deep inside an array, it is important to remember that <em>pick</em> returns a disclosed result.</p>
<p>For example, let us try to replace the number <code class="docutils literal notranslate"><span class="pre">5</span></code> with the character vector <code class="docutils literal notranslate"><span class="pre">'five'</span></code> in the fourth item of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code>.</p>
<p>If we wanted to extract the value <code class="docutils literal notranslate"><span class="pre">5</span></code>, we would just write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">⊃</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<p>To replace it, we use the same expression in a normal selective assignment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">⊃</span><span class="nv">hogwash</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Five&#39;</span><span class="w"></span>
<span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┬─┬────────┐
│19│1 2│A│┌────┬─┐│
│  │3 4│P││Five│8││
│  │   │L│├────┼─┤│
│  │   │ ││Nuts│9││
│  │   │ │└────┴─┘│
└──┴───┴─┴────────┘
</span></div></div>
</div>
<p>And it works, though we haven’t enclosed the replacement value!
Going back is just as easy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">⊃</span><span class="nv">hogwash</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┬─┬────────┐
│19│1 2│A│┌────┬─┐│
│  │3 4│P││5   │8││
│  │   │L│├────┼─┤│
│  │   │ ││Nuts│9││
│  │   │ │└────┴─┘│
└──┴───┴─┴────────┘
</span></div></div>
</div>
</div>
<div class="section" id="an-idiom">
<span id="nested-arrays-continued-an-idiom"></span><h3><span class="section-number">10.10.6. </span>An Idiom<a class="headerlink" href="#an-idiom" title="Permalink to this headline">#</a></h3>
<p>Suppose you have a nested vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nv</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="p">)(</span><span class="m">9</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">8</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>You can select one of its items with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊃</span><span class="nv">nv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9 7 2 8
</span></div></div>
</div>
<p>But how can you select two (or more) items?
For example, the 2nd and the 4th items?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⊃</span><span class="nv">nv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8
</span></div></div>
</div>
<p>This does not work; it selects only one item: the 4th item of the 2nd item, which is the number <code class="docutils literal notranslate"><span class="pre">8</span></code> in this case.</p>
<p>Maybe we can use <em>each</em> <code class="docutils literal notranslate"><span class="pre">⊃¨</span></code> to <em>pick each</em> of the items we want?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⊃</span><span class="na">¨</span><span class="nv">nv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      2 4⊃¨nv
         ∧
</pre></div>
</div>
</div>
</div>
<p>This gives a <code class="docutils literal notranslate"><span class="pre">LENGTH</span> <span class="pre">ERROR</span></code> because <code class="docutils literal notranslate"><span class="pre">¨</span></code> is trying to pair each of the two numbers on the left with an item on the right, but <code class="docutils literal notranslate"><span class="pre">nv</span></code> has a total of four items.</p>
<p>In order to fix this, we need to <em>enclose</em> <code class="docutils literal notranslate"><span class="pre">nv</span></code> so that <code class="docutils literal notranslate"><span class="pre">¨</span></code> knows to pair each number on the left with the whole vector <code class="docutils literal notranslate"><span class="pre">nv</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⊃</span><span class="na">¨</span><span class="o">⊂</span><span class="nv">nv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬─────┐
│9 7 2 8│2 0 8│
└───────┴─────┘
</span></div></div>
</div>
<p>This expression is known as the “chipmunk idiom”, probably because of the eyes and moustaches of the combined symbol: <code class="docutils literal notranslate"><span class="pre">⊃¨⊂</span></code>.</p>
</div>
</div>
<div class="section" id="reach-indexing">
<span id="nested-arrays-continued-reach-indexing"></span><h2><span class="section-number">10.11. </span>Reach Indexing<a class="headerlink" href="#reach-indexing" title="Permalink to this headline">#</a></h2>
<div class="section" id="relationship-to-pick">
<span id="nested-arrays-continued-relationship-to-pick"></span><h3><span class="section-number">10.11.1. </span>Relationship to Pick<a class="headerlink" href="#relationship-to-pick" title="Permalink to this headline">#</a></h3>
<p>The way in which you can use <em>pick</em> to access elements from a nested array is very similar to another indexing notation that is called <em>reach indexing</em>.
Unlike <em>simple indexing</em> and <em>choose indexing</em>, which only let you access the scalars of an array, <em>reach indexing</em> can be used to index into arbitrary levels of depth of nested arrays.
Hence, its name.</p>
<p>In <em>reach indexing</em>, the index specification is given by a non-simple integer array, each of whose items reach down to a nested element of the array being indexed.
As we will see, each of those items works in the same way as the left argument of <em>pick</em>.</p>
<p>Recall the nested array <code class="docutils literal notranslate"><span class="pre">weird</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬────────────┐
│456  │┌──────┬───┐│
│     ││Dyalog│44 ││
│     │├──────┼───┤│
│     ││27    │8 6││
│     ││      │2 4││
│     │└──────┴───┘│
├─────┼────────────┤
│17 51│Twisted     │
└─────┴────────────┘
</span></div></div>
</div>
<p>We learned that, to access the nested character vector <code class="docutils literal notranslate"><span class="pre">'Twisted'</span></code>, we could <em>pick</em> it with the left argument <code class="docutils literal notranslate"><span class="pre">(⊂2</span> <span class="pre">2)</span></code>.
Similarly, we can access the integer <code class="docutils literal notranslate"><span class="pre">44</span></code> by <em>picking</em> it with the left argument <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)</span> <span class="pre">(1</span> <span class="pre">2)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">⊃</span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Twisted
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">⊃</span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">44
</span></div></div>
</div>
<p>To <em>pick</em> both in a single expression, we need to use the idiom we just learned:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)((</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">⊃</span><span class="na">¨</span><span class="o">⊂</span><span class="w"> </span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬──┐
│Twisted│44│
└───────┴──┘
</span></div></div>
</div>
<p>By using <em>reach indexing</em>, we just need to take the left argument of <code class="docutils literal notranslate"><span class="pre">⊃¨⊂</span></code> and put it inside square brackets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">weird</span><span class="sr">[</span><span class="p">(</span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)((</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬──┐
│Twisted│44│
└───────┴──┘
</span></div></div>
</div>
<p>One key difference between <em>reach indexing</em> and using <em>pick</em> (or the idiom) is that <em>pick</em> will disclose the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">⊃</span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Twisted
</span></div></div>
</div>
<p>Whereas <em>reach indexing</em> doesn’t:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">weird</span><span class="sr">[</span><span class="o">⊂</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┐
│Twisted│
└───────┘
</span></div></div>
</div>
</div>
<div class="section" id="reach-versus-choose-indexing">
<span id="nested-arrays-continued-reach-versus-choose-indexing"></span><h3><span class="section-number">10.11.2. </span>Reach Versus Choose Indexing<a class="headerlink" href="#reach-versus-choose-indexing" title="Permalink to this headline">#</a></h3>
<p>In some situations, indices for <em>reach indexing</em> can look like indices for <em>choose indexing</em>.
For example, to <em>pick</em> the character vector <code class="docutils literal notranslate"><span class="pre">'DYALOG'</span></code> from the array <code class="docutils literal notranslate"><span class="pre">weird</span></code>, we do</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">⊃</span><span class="nv">weird</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Dyalog
</span></div></div>
</div>
<p>Thus, one might think that <code class="docutils literal notranslate"><span class="pre">weird[(1</span> <span class="pre">2)(1</span> <span class="pre">1)]</span></code> uses <em>reach indexing</em> to fetch that same character vector (but enclosed).
Alas, this doesn’t work.
Or at least, not in the intended way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">weird</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────────┬───┐
│┌──────┬───┐│456│
││Dyalog│44 ││   │
│├──────┼───┤│   │
││27    │8 6││   │
││      │2 4││   │
│└──────┴───┘│   │
└────────────┴───┘
</span></div></div>
</div>
<p>The result we got not what we expected because <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)(1</span> <span class="pre">1)</span></code> was interpreted as an index vector with two scalars,
whereas we wanted it to refer to a single element of the array <code class="docutils literal notranslate"><span class="pre">weird</span></code>.
To fix this, we have to enclose that vector to make it a scalar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">weird</span><span class="sr">[</span><span class="o">⊂</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┐
│Dyalog│
└──────┘
</span></div></div>
</div>
<p>In <em>reach indexing</em>, each scalar of the index array reaches to a single item, so <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2)(1</span> <span class="pre">1)</span></code> can be seen as an index vector for <em>choose indexing</em> (for the scalars <code class="docutils literal notranslate"><span class="pre">weird[1;2]</span></code> and <code class="docutils literal notranslate"><span class="pre">weird[1;1]</span></code>) or an index vector for <em>reach indexing</em> that accesses the same values.</p>
<p>Thus, we can see that <em>reach indexing</em> and <em>choose indexing</em> overlap, but when they do, both schemes interpret the indices in the same way.</p>
</div>
</div>
<div class="section" id="partitioned-enclose-partition">
<span id="nested-arrays-continued-partitioned-enclose-partition"></span><h2><span class="section-number">10.12. </span>Partitioned Enclose &amp; Partition<a class="headerlink" href="#partitioned-enclose-partition" title="Permalink to this headline">#</a></h2>
<div class="section" id="partitioned-enclose">
<span id="nested-arrays-continued-partitioned-enclose"></span><h3><span class="section-number">10.12.1. </span>Partitioned Enclose<a class="headerlink" href="#partitioned-enclose" title="Permalink to this headline">#</a></h3>
<p>The primitive function <em>partitioned enclose</em> is the dyadic use of the <em>left shoe</em> <code class="docutils literal notranslate"><span class="pre">⊂</span></code>.
It is used to group the items of an array into a vector of nested items, or enclosures, according to a specified pattern.
It is used as <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">pattern</span> <span class="pre">⊂</span> <span class="pre">array</span></code>, or optionally with an <em>axis specification</em>: <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">pattern</span> <span class="pre">⊂[axis]</span> <span class="pre">array</span></code>.</p>
<p><em>Partitioned enclose</em> breaks up the right argument <code class="docutils literal notranslate"><span class="pre">array</span></code> into nested items, as determined by the left argument <code class="docutils literal notranslate"><span class="pre">pattern</span></code>.</p>
<div class="section" id="simple-boolean-vector-left-argument">
<span id="nested-arrays-continued-simple-boolean-vector-left-argument"></span><h4><span class="section-number">10.12.1.1. </span>Simple Boolean Vector Left Argument<a class="headerlink" href="#simple-boolean-vector-left-argument" title="Permalink to this headline">#</a></h4>
<p>Let us start by understanding how <em>partitioned enclose</em> works when the left argument <code class="docutils literal notranslate"><span class="pre">pattern</span></code> is a <em>simple</em> Boolean vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬──────┐
│Par│tition│
└───┴──────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┐
│Par│tit│ion│
└───┴───┴───┘
</span></div></div>
</div>
<p>The two examples seem to show that the <code class="docutils literal notranslate"><span class="pre">1</span></code>s in the left argument specify where new enclosures of the right argument start.
The <code class="docutils literal notranslate"><span class="pre">0</span></code>s just put the corresponding elements in the preceding enclosure.</p>
<p>Notice that, as soon as we start the last enclosure (with the last <code class="docutils literal notranslate"><span class="pre">1</span></code>), the trailing <code class="docutils literal notranslate"><span class="pre">0</span></code>s are irrelevant.
Thus, we can safely omit them from the left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┐
│Par│tit│ion│
└───┴───┴───┘
</span></div></div>
</div>
<p>Again, we <strong>can</strong> omit trailing zeroes, but we do not <strong>have</strong> to.
In fact, in older versions of Dyalog APL, <em>partitioned enclose</em> expects the trailing zeroes to be present.
In other words, the ability to not specify trailing zeroes was an extension to <em>partitioned enclose</em> that was introduced after <em>partitioned enclose</em> had been in the language.</p>
<!-- (TODO) find out in what exact Dyalog version this extension to ⊂ was introduced. -->
<p>We have seen what we can do about trailing zeroes.
It is also important to understand what happens when the left argument has leading zeroes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬─┐
│rti│tio│n│
└───┴───┴─┘
</span></div></div>
</div>
<p>Leading zeroes have not been preceded by any enclosures, so the corresponding items have nowhere to go.
Because of that, they are omitted from the final result.</p>
<p>We have already covered most of the behaviour of <em>partitioned</em> enclose, we are only missing some details.</p>
</div>
<div class="section" id="multiple-enclosures">
<span id="nested-arrays-continued-multiple-enclosures"></span><h4><span class="section-number">10.12.1.2. </span>Multiple Enclosures<a class="headerlink" href="#multiple-enclosures" title="Permalink to this headline">#</a></h4>
<p>The left argument <code class="docutils literal notranslate"><span class="pre">pattern</span></code> can be a simple integer vector with arbitrary non-negative integers, it doesn’t have to contain only zeroes and ones.
If we interpret the role of the zeroes and ones in a slightly different way, we can immediately understand how larger integers will work.</p>
<p>For that, we can use less rigorous language, and say that the enclosures of the result start in the places where we inserted dividers to split the right argument.
Having said that, we just have to understand how those dividers are placed:</p>
<ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">0</span></code> in the left argument means that we will insert <code class="docutils literal notranslate"><span class="pre">0</span></code> dividers before the corresponding item of the right argument; and</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">1</span></code> in the left argument means that we will insert <code class="docutils literal notranslate"><span class="pre">1</span></code> divider before the corresponding item of the right argument.</p></li>
</ul>
<p>Thus, an integer <code class="docutils literal notranslate"><span class="pre">n</span></code> in the left argument means that we will insert <code class="docutils literal notranslate"><span class="pre">n</span></code> dividers before the corresponding item of the right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┬┬───┬───┬┬───┐
│││Par│tit││ion│
└┴┴───┴───┴┴───┘
</span></div></div>
</div>
<p>Above, <code class="docutils literal notranslate"><span class="pre">pattern</span></code> started with a <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">array</span></code> started with <code class="docutils literal notranslate"><span class="pre">'P'</span></code>. Thus, <em>partitioned enclose</em> must insert <code class="docutils literal notranslate"><span class="pre">3</span></code> dividers before the <code class="docutils literal notranslate"><span class="pre">'P'</span></code>.
Because more than one divider was inserted, only the last one gets the corresponding item from the argument <code class="docutils literal notranslate"><span class="pre">array</span></code>.</p>
<p>Using <em>mix</em> as visual aid, we can see clearly where the dividers will be inserted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 0 0 1 0 0 2 0 0
P a r t i t i o n
</span></div></div>
</div>
<p>The usage of <em>mix</em> shows that we insert <code class="docutils literal notranslate"><span class="pre">3</span></code> dividers before the initial <code class="docutils literal notranslate"><span class="pre">'P'</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code> divider before the first <code class="docutils literal notranslate"><span class="pre">'t'</span></code>, and <code class="docutils literal notranslate"><span class="pre">2</span></code> dividers before the last <code class="docutils literal notranslate"><span class="pre">'i'</span></code>.</p>
</div>
<div class="section" id="trailing-empty-enclosures">
<span id="nested-arrays-continued-trailing-empty-enclosures"></span><h4><span class="section-number">10.12.1.3. </span>Trailing Empty Enclosures<a class="headerlink" href="#trailing-empty-enclosures" title="Permalink to this headline">#</a></h4>
<p>When the left argument <code class="docutils literal notranslate"><span class="pre">pattern</span></code> starts with an integer that is greater than one, the final result will have some leading empty enclosures.
If we want to get a result with <strong>trailing</strong> empty enclosures, we just need to make sure that the length of <code class="docutils literal notranslate"><span class="pre">pattern</span></code> is one greater than the length of the right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┬───┬───┬───┬┐
││Par│tit│ion││
└┴───┴───┴───┴┘
</span></div></div>
</div>
<p>We can use <em>mix</em> again, and we will understand how the trailing <code class="docutils literal notranslate"><span class="pre">1</span></code> creates an empty enclosure by inserting a divider right after the last item of the right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 0 0 1 0 0 1 0 0 1
P a r t i t i o n  
</span></div></div>
</div>
</div>
<div class="section" id="scalar-left-argument">
<span id="nested-arrays-continued-scalar-left-argument"></span><h4><span class="section-number">10.12.1.4. </span>Scalar Left Argument<a class="headerlink" href="#scalar-left-argument" title="Permalink to this headline">#</a></h4>
<p>So far, we have only seen how <em>partitioned enclose</em> works with a <em>vector</em> left argument.
Now, we will see what happens if the left argument is a <em>scalar</em>.</p>
<p>First, take a look at this example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│Partition│
└─────────┘
</span></div></div>
</div>
<p>We know we can omit trailing zeroes, so we might be tempted to rewrite the example above as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┬─┬─┬─┬─┬─┬─┐
│P│a│r│t│i│t│i│o│n│
└─┴─┴─┴─┴─┴─┴─┴─┴─┘
</span></div></div>
</div>
<p>However, when we do so, we get an unexpected result!
That’s because the left argument is a <em>scalar</em>, and we can only omit trailing zeroes from <em>vectors</em>.</p>
<p>When the left argument is a <em>scalar</em> <code class="docutils literal notranslate"><span class="pre">s</span></code>, it gets extended to <code class="docutils literal notranslate"><span class="pre">(≢array)⍴s</span></code>.
Therefore, the example above is equivalent to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">9</span><span class="o">⍴</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┬─┬─┬─┬─┬─┬─┐
│P│a│r│t│i│t│i│o│n│
└─┴─┴─┴─┴─┴─┴─┴─┴─┘
</span></div></div>
</div>
</div>
<div class="section" id="partitioned-enclose-with-axis">
<span id="nested-arrays-continued-partitioned-enclose-with-axis"></span><h4><span class="section-number">10.12.1.5. </span>Partitioned Enclose with Axis<a class="headerlink" href="#partitioned-enclose-with-axis" title="Permalink to this headline">#</a></h4>
<p>When we first introduced <em>partitioned enclose</em>, we mentioned that it can also accept an <em>axis specification</em>, as such: <code class="docutils literal notranslate"><span class="pre">pattern</span> <span class="pre">⊂[axis]</span> <span class="pre">array</span></code>.
Obviously, when <code class="docutils literal notranslate"><span class="pre">array</span></code> is a vector, <code class="docutils literal notranslate"><span class="pre">axis</span></code> is irrelevant because we can only have <code class="docutils literal notranslate"><span class="pre">axis</span> <span class="pre">←</span> <span class="pre">1</span></code>.</p>
<p>For the <em>axis specification</em> to be relevant, <code class="docutils literal notranslate"><span class="pre">array</span></code> needs to be of rank two or higher.
First, we want to know what is the default value for <code class="docutils literal notranslate"><span class="pre">axis</span></code>, and we can find that out with a quick test:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┐
│1│2│
│3│4│
└─┴─┘
</span></div></div>
</div>
<p>When applied to a matrix with no <em>axis specification</em>, <em>partitioned enclose</em> created enclosures around the columns of the matrix, which shows that the default axis is <code class="docutils literal notranslate"><span class="pre">≢⍴axis</span></code>, i.e., the last axis.</p>
<p>If we want to create enclosures around the rows, we can specify <code class="docutils literal notranslate"><span class="pre">axis</span> <span class="pre">←</span> <span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┐
│1 2│3 4│
└───┴───┘
</span></div></div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">⊂</span></code> returns a vector, while perhaps you expected the result to look like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍪</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┐
│1 2│
├───┤
│3 4│
└───┘
</span></div></div>
</div>
<p>This is how <em>partitioned enclose</em> works: it always returns a vector with the enclosures as items.</p>
<p>Here is another example, where we use a 3D array as the right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ABCDE
FGHIJ
KLMNO
PQRST

UVWXY
ZABCD
EFGHI
JKLMN

OPQRS
TUVWX
YZABC
DEFGH
</span></div></div>
</div>
<p>By using <em>partitioned enclose</em> along the first axis, we can get a vector with enclosures around the planes that compose <code class="docutils literal notranslate"><span class="pre">cuboid</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┐
│ABCDE│OPQRS│
│FGHIJ│TUVWX│
│KLMNO│YZABC│
│PQRST│DEFGH│
│     │     │
│UVWXY│     │
│ZABCD│     │
│EFGHI│     │
│JKLMN│     │
└─────┴─────┘
</span></div></div>
</div>
<p>The things we learned about the behaviour of the left argument of <em>partitioned enclose</em> still apply when we have a higher-dimensional right argument and/or an <em>axis specification</em>; we just need to interpret the left argument from the point of view of the correct axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊂</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┐
│ABCDE│KLMNO│
│FGHIJ│PQRST│
│     │     │
│UVWXY│EFGHI│
│ZABCD│JKLMN│
│     │     │
│OPQRS│YZABC│
│TUVWX│DEFGH│
└─────┴─────┘
</span></div></div>
</div>
<p>In this example, the left argument is <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span></code> and the axis specified is the second one, which has length</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊃⍴</span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4
</span></div></div>
</div>
<p>So, if the left argument is <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span></code> and the axis in question has length four, we are omitting a trailing zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊂</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┐
│ABCDE│KLMNO│
│FGHIJ│PQRST│
│     │     │
│UVWXY│EFGHI│
│ZABCD│JKLMN│
│     │     │
│OPQRS│YZABC│
│TUVWX│DEFGH│
└─────┴─────┘
</span></div></div>
</div>
<p>If you find it hard to visualise why the result is as shown, you can try to reason about <em>partitioned enclose</em> with an <em>axis specification</em> as a series of enclosures around indexing operations.</p>
<p>First, we can put the left argument up with the valid indices for the axis in question:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="p">)(</span><span class="o">⍳</span><span class="m">2</span><span class="o">⊃⍴</span><span class="nv">cuboid</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 0
1 2 3 4
</span></div></div>
</div>
<p>This shows that we will have an enclosure around indices <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span></code> and another one around indices <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">4</span></code>.
Now, we just have to do the indexing along the correct axis.
Because <code class="docutils literal notranslate"><span class="pre">cuboid</span></code> is a 3D array and we are working with the second index, the indexing will look like <code class="docutils literal notranslate"><span class="pre">cuboid[;??;]</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="nv">cuboid</span><span class="sr">[;</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="sr">;]</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">cuboid</span><span class="sr">[;</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="sr">;]</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┐
│ABCDE│KLMNO│
│FGHIJ│PQRST│
│     │     │
│UVWXY│EFGHI│
│ZABCD│JKLMN│
│     │     │
│OPQRS│YZABC│
│TUVWX│DEFGH│
└─────┴─────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="o">⊂</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">cuboid</span><span class="p">)</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="nv">cuboid</span><span class="sr">[;</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="sr">;]</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">cuboid</span><span class="sr">[;</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="sr">;]</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
</div>
<div class="section" id="wrap-up">
<span id="nested-arrays-continued-wrap-up"></span><h4><span class="section-number">10.12.1.6. </span>Wrap-up<a class="headerlink" href="#wrap-up" title="Permalink to this headline">#</a></h4>
<p>Now that we have seen the various nuances associated with <em>partitioned enclose</em>, we can bundle them up together.
In the expression <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">pattern</span> <span class="pre">⊂[axis]</span> <span class="pre">array</span></code>, we have that:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">array</span></code> may be any array;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code> may be a non-negative integer scalar or a <em>simple</em> numeric vector composed of non-negative integers;</p></li>
<li><p>if left unspecified, <code class="docutils literal notranslate"><span class="pre">axis</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">≢⍴array</span></code>, i.e., the last axis of <code class="docutils literal notranslate"><span class="pre">array</span></code>;</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">pattern</span></code> is a scalar <code class="docutils literal notranslate"><span class="pre">s</span></code>, it is extended to <code class="docutils literal notranslate"><span class="pre">(axis⊃⍴array)⍴s</span></code>;</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">pattern</span></code> is a vector, its maximum length is <code class="docutils literal notranslate"><span class="pre">1+axis⊃⍴array</span></code> and if the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> length is not the maximum, it is extended with trailing zeroes;</p></li>
<li><p>each non-zero element in <code class="docutils literal notranslate"><span class="pre">pattern</span></code> specifies how many dividers to insert before the corresponding position along the appropriate axis of <code class="docutils literal notranslate"><span class="pre">array</span></code>;</p></li>
<li><p>each enclosure has rank <code class="docutils literal notranslate"><span class="pre">≢⍴array</span></code> and shape <code class="docutils literal notranslate"><span class="pre">⍴array</span></code>, except in the position specified by <code class="docutils literal notranslate"><span class="pre">axis</span></code>;</p></li>
<li><p>the result <code class="docutils literal notranslate"><span class="pre">r</span></code> is a vector containing all the enclosures specified by the <code class="docutils literal notranslate"><span class="pre">pattern</span></code>; and</p></li>
<li><p>the length of <code class="docutils literal notranslate"><span class="pre">r</span></code> is <code class="docutils literal notranslate"><span class="pre">+⌿pattern</span></code> (after extensions).</p></li>
</ul>
<!-- end --></div>
</div>
<div class="section" id="partition">
<span id="nested-arrays-continued-partition"></span><h3><span class="section-number">10.12.2. </span>Partition<a class="headerlink" href="#partition" title="Permalink to this headline">#</a></h3>
<p>The <em>partition</em> function is the dyadic usage of <code class="docutils literal notranslate"><span class="pre">⊆</span></code>, and is somewhat similar to the <em>partitioned enclose</em> function.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">pattern</span> <span class="pre">⊆</span> <span class="pre">array</span></code>, <code class="docutils literal notranslate"><span class="pre">pattern</span></code> must be a simple vector of non-negative integers, with the same length as the specified axis of the array to be partitioned.
It operates as follows:</p>
<ul class="simple">
<li><p>the first enclosure starts with the first item of the array;</p></li>
<li><p>each enclosure ends when the next value of <code class="docutils literal notranslate"><span class="pre">pattern</span></code> is greater than the current one; and</p></li>
<li><p>the items which correspond to zeroes in <code class="docutils literal notranslate"><span class="pre">pattern</span></code> are removed.</p></li>
</ul>
<div class="section" id="working-on-vectors">
<span id="nested-arrays-continued-working-on-vectors"></span><h4><span class="section-number">10.12.2.1. </span>Working on Vectors<a class="headerlink" href="#working-on-vectors" title="Permalink to this headline">#</a></h4>
<p>We shall work with characters, but of course we could have worked with numbers just as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">pattern</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="nv">pattern</span><span class="w"> </span><span class="o">⊆</span><span class="w"> </span><span class="s1">&#39;Once upon a time&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬────┬───┬────┐
│Onc│e up│n a│ tim│
└───┴────┴───┴────┘
</span></div></div>
</div>
<p>The four enclosures correspond to the beginning of the array, plus the three increments: <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">→</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">→</span> <span class="pre">3</span></code>, and <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">→</span> <span class="pre">9</span></code>.
You will also notice that two characters have disappeared, because they corresponded to zeroes in the pattern.</p>
<p>This definition can be used to group the items of a vector according to a given vector of keys, provided that the keys are ordered in ascending order.
For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">area</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">57</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">85</span><span class="w"> </span><span class="m">85</span><span class="w"></span>
<span class="nv">cash</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">81</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">42</span><span class="w"> </span><span class="m">53</span><span class="w"></span>
<span class="nv">area</span><span class="w"> </span><span class="o">⊆</span><span class="w"> </span><span class="nv">cash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬───────────┬──┬────────┬─────┐
│17 10│21 45 75 41│30│81 20 11│42 53│
└─────┴───────────┴──┴────────┴─────┘
</span></div></div>
</div>
<p>This definition is also extremely convenient to divide a character string into a vector of strings on the basis of a separator.
For example, let us partition a vector at each of its blank characters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">phrase</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Panama is a canal between Atlantic and Pacific&#39;</span><span class="w"></span>
<span class="o">↑</span><span class="nv">phrase</span><span class="p">(</span><span class="nv">phrase</span><span class="o">≠</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">P a n a m a   i s   a   c a n a l   b e t w e e n   A t l a n t i c   a n d   P a c i f i c
1 1 1 1 1 1 0 1 1 0 1 0 1 1 1 1 1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 0 1 1 1 0 1 1 1 1 1 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">phrase</span><span class="o">≠</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">⊆</span><span class="nv">phrase</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──┬─┬─────┬───────┬────────┬───┬───────┐
│Panama│is│a│canal│between│Atlantic│and│Pacific│
└──────┴──┴─┴─────┴───────┴────────┴───┴───────┘
</span></div></div>
</div>
<p>The blanks have been removed, because they matched the zeroes, and a new enclosure starts at the beginning of each word, corresponding to the increment <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">→</span> <span class="pre">1</span></code>.
As you might imagine, this is extremely useful in many circumstances.
One can write a function to do it, with the separator passed as a left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Cut</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">~</span><span class="bp">⍵</span><span class="o">∊</span><span class="bp">⍺</span><span class="p">)</span><span class="o">⊆</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="o">↑</span><span class="s1">&#39; &#39;</span><span class="nv">Cut</span><span class="w"> </span><span class="nv">phrase</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Panama  
is      
a       
canal   
between 
Atlantic
and     
Pacific 
</span></div></div>
</div>
<p>In fact, we wrote the function to accept not just a single separator, but a list of separators, by replacing the perhaps more obvious <code class="docutils literal notranslate"><span class="pre">(⍵≠⍺)</span></code> by <code class="docutils literal notranslate"><span class="pre">(~⍵∊⍺)</span></code>.
Now we can use it like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="s1">&#39;mw&#39;</span><span class="w"> </span><span class="nv">Cut</span><span class="w"> </span><span class="nv">phrase</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Pana                    
a is a canal bet        
een Atlantic and Pacific
</span></div></div>
</div>
</div>
<div class="section" id="working-on-higher-rank-arrays">
<span id="nested-arrays-continued-working-on-higher-rank-arrays"></span><h4><span class="section-number">10.12.2.2. </span>Working on Higher-Rank Arrays<a class="headerlink" href="#working-on-higher-rank-arrays" title="Permalink to this headline">#</a></h4>
<p>Although <em>partition</em> is very simple, and clearly useful, when applied to vectors, the situation is more complex when it is applied to matrices or higher-rank arrays.
This is in contrast to the definition of <em>partitioned enclose</em>, which works on any rank arrays in a very straightforward way.
We shall not study the more complex application of <em>partition</em> here; if you are interested, please refer to <a class="reference internal" href="#nested-arrays-continued-high-rank-partition"><span class="std std-numref">Section 10.16.3</span></a> at the end of this chapter.</p>
</div>
</div>
</div>
<div class="section" id="union-intersection">
<span id="nested-arrays-continued-union-intersection"></span><h2><span class="section-number">10.13. </span>Union &amp; Intersection<a class="headerlink" href="#union-intersection" title="Permalink to this headline">#</a></h2>
<p>In mathematics, one uses the two functions <em>union</em> and <em>intersection</em> to compare two sets of values.
Dyalog APL provides the same functions, with the same symbols as the ones used in mathematics:</p>
<ul class="simple">
<li><p><em>union</em>, <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">∪</span> <span class="pre">right</span></code> (typed with <kbd>APL</kbd> + <kbd>v</kbd>), returns a vector containing all the items of <code class="docutils literal notranslate"><span class="pre">left</span></code>, followed by the items of <code class="docutils literal notranslate"><span class="pre">right</span></code> which do not appear in <code class="docutils literal notranslate"><span class="pre">left</span></code>.
Both <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> must be scalars or vectors.
Equivalent to <code class="docutils literal notranslate"><span class="pre">left,right~left</span></code>.</p></li>
<li><p><em>intersection</em>, <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">∩</span> <span class="pre">right</span></code> (typed with <kbd>APL</kbd> + <kbd>c</kbd>), returns a vector containing the items of <code class="docutils literal notranslate"><span class="pre">left</span></code> that also appear in <code class="docutils literal notranslate"><span class="pre">right</span></code>.
Both <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> must be scalars or vectors.
Equivalent to <code class="docutils literal notranslate"><span class="pre">(left∊right)/left</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">15</span><span class="w"> </span><span class="m">76</span><span class="w"> </span><span class="m">43</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="o">∪</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">43</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">76</span><span class="w"> </span><span class="m">93</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">15 76 43 80 11 20 93
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;we&#39;</span><span class="w"> </span><span class="s1">&#39;are&#39;</span><span class="w"> </span><span class="s1">&#39;so&#39;</span><span class="w"> </span><span class="s1">&#39;happy&#39;</span><span class="w"> </span><span class="o">∩</span><span class="w"> </span><span class="s1">&#39;why&#39;</span><span class="w"> </span><span class="s1">&#39;are&#39;</span><span class="w"> </span><span class="s1">&#39;you&#39;</span><span class="w"> </span><span class="s1">&#39;so&#39;</span><span class="w"> </span><span class="s1">&#39;tired?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬──┐
│are│so│
└───┴──┘
</span></div></div>
</div>
<p>Note that these functions do not remove duplicates (because, in mathematics, all the items of a set are supposedly distinct):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">∪</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 2 2 3 3 5 5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;if&#39;</span><span class="w"> </span><span class="s1">&#39;we&#39;</span><span class="w"> </span><span class="s1">&#39;had&#39;</span><span class="w"> </span><span class="s1">&#39;had&#39;</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="w"> </span><span class="s1">&#39;car&#39;</span><span class="w"> </span><span class="o">∩</span><span class="w"> </span><span class="s1">&#39;have&#39;</span><span class="w"> </span><span class="s1">&#39;you&#39;</span><span class="w"> </span><span class="s1">&#39;had&#39;</span><span class="w"> </span><span class="s1">&#39;lunch&#39;</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┐
│had│had│
└───┴───┘
</span></div></div>
</div>
</div>
<div class="section" id="enlist">
<span id="nested-arrays-continued-enlist"></span><h2><span class="section-number">10.14. </span>Enlist<a class="headerlink" href="#enlist" title="Permalink to this headline">#</a></h2>
<p><em>Enlist</em> is the monadic usage of <em>epsilon</em> <code class="docutils literal notranslate"><span class="pre">∊</span></code>.
<em>Enlist</em> returns a vector of all the simple scalars contained in an array.
This could, at first sight, look very much like <em>ravel</em>, but it is <strong>not</strong> the same for nested arrays.
<em>Ravel</em> just rearranges the top-level items of an array, while <em>enlist</em> removes all levels of nesting and returns a simple vector.
Let us compare the two functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="s1">&#39;One&#39;</span><span class="w"> </span><span class="s1">&#39;Two&#39;</span><span class="w"> </span><span class="s1">&#39;Three&#39;</span><span class="w"> </span><span class="s1">&#39;Four&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬────┐
│One  │Two │
├─────┼────┤
│Three│Four│
└─────┴────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="nv">test</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬─────┬────┐
│One│Two│Three│Four│
└───┴───┴─────┴────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∊</span><span class="nv">test</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">OneTwoThreeFour
</span></div></div>
</div>
<div class="figure align-default" id="apler-expert-blue">
<span id="fig-apler-expert-blue"></span><img alt="_images/APLer-Expert_Blue.PNG" src="_images/APLer-Expert_Blue.PNG" />
<p class="caption"><span class="caption-number">Fig. 10.1 </span><span class="caption-text">Expert APLer determining how to best hammer a nail.</span><a class="headerlink" href="#apler-expert-blue" title="Permalink to this image">#</a></p>
</div>
</div>
<div class="section" id="exercises">
<span id="nested-arrays-continued-exercises"></span><h2><span class="section-number">10.15. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<div class="exercise admonition" id="ex-quantitiessold">

<p class="admonition-title"><span class="caption-number">Exercise 10.5 </span></p>
<div class="section" id="exercise-content">
<p>You are given two vectors.
The first contains the reference codes for some items in a warehouse.
Identical codes are grouped, but not necessarily in ascending order.
The second vector contains the quantities of each item sold during the day or the week.</p>
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">QuantitiesSold</span></code> that accepts these two vectors as arguments and calculates how many items of each reference code have been sold. Preferably, use a partitioning function.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ref</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">47</span><span class="w"> </span><span class="m">47</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">50</span><span class="w"></span>
<span class="nv">qty</span><span class="w"> </span><span class="kd">←</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">11</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">39</span><span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ref</span><span class="w"> </span><span class="nv">QuantitiesSold</span><span class="w"> </span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 39 10 152 19
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">13</span><span class="w"> </span><span class="m">39</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">152</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">ref</span><span class="w"> </span><span class="nv">QuantitiesSold</span><span class="w"> </span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-high-dim-index-of">

<p class="admonition-title"><span class="caption-number">Exercise 10.6 </span></p>
<div class="section" id="exercise-content">
<p>You are given two character matrices with the same number of columns.
Let us call them <code class="docutils literal notranslate"><span class="pre">big</span></code> and <code class="docutils literal notranslate"><span class="pre">small</span></code>.</p>
<p>You are asked to find where the rows of <code class="docutils literal notranslate"><span class="pre">small</span></code> appear in <code class="docutils literal notranslate"><span class="pre">big</span></code>. i.e., for each row in <code class="docutils literal notranslate"><span class="pre">small</span></code> find the index of the same row in <code class="docutils literal notranslate"><span class="pre">big</span></code>.
For those rows of <code class="docutils literal notranslate"><span class="pre">small</span></code> which do not appear in <code class="docutils literal notranslate"><span class="pre">big</span></code>, you can return the value <code class="docutils literal notranslate"><span class="pre">0</span></code>, or <code class="docutils literal notranslate"><span class="pre">1+≢big</span></code>.</p>
<p>Currently, <em>index of</em> <code class="docutils literal notranslate"><span class="pre">⍳</span></code> works on matrices, but this hasn’t always been the case.
Thus, can you solve this exercise without using <em>index of</em> on matrices?
(Using <em>index of</em> on vectors is still allowed!)</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">big</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1  2
3  4
5  6
7  8
9 10
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="o">⍪</span><span class="m">8</span><span class="o">+</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2
 3  4
 9 10
11 12
</span></div></div>
</div>
<p>The result should be</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">big</span><span class="w"> </span><span class="o">⍳</span><span class="w"> </span><span class="nv">small</span><span class="w">  </span><span class="c1">⍝ 1 2 5 0 is also acceptable.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 5 6
</span></div></div>
</div>
<div class="exercise admonition" id="ex-empty-vectors">

<p class="admonition-title"><span class="caption-number">Exercise 10.7 </span></p>
<div class="section" id="exercise-content">
<p>A <em>partitioned enclose</em> with a single zero as the left argument returns an empty vector.
However, as you know already, not all empty vectors are the same.
When working with empty vectors, we also work with prototypes, because an empty vector knows what it would contain if it were not empty.</p>
<p>Go over the expressions that follow and build the empty vector that <em>matches</em> the result of the empty <em>partitioned enclose</em>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂'Partition'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂⍳10</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂⍬</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂3</span> <span class="pre">2⍴⎕A</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂3</span> <span class="pre">4</span> <span class="pre">5⍴⍳60</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂(1</span> <span class="pre">2</span> <span class="pre">3)(4</span> <span class="pre">5</span> <span class="pre">6)(7</span> <span class="pre">8</span> <span class="pre">9)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂('cat')('dog')(7</span> <span class="pre">8</span> <span class="pre">9)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂(14</span> <span class="pre">'cat'</span> <span class="pre">8)('a'</span> <span class="pre">2</span> <span class="pre">'c'</span> <span class="pre">4)(1</span> <span class="pre">2</span> <span class="pre">3)</span></code></p></li>
</ul>
</div>
</div>
<p>The first one is already solved:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">sol</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="o">⍴⊂</span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="p">(</span><span class="m">0</span><span class="o">⊂</span><span class="s1">&#39;Partition&#39;</span><span class="p">)</span><span class="o">≡</span><span class="nv">sol</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-startandend">

<p class="admonition-title"><span class="caption-number">Exercise 10.8 </span></p>
<div class="section" id="exercise-content">
<p>Write a monadic function <code class="docutils literal notranslate"><span class="pre">StartAndEnd</span></code> that, given a word or a list of words, returns a Boolean vector where 1 indicates a word that starts and ends with the same letter. Each word will have at least one letter and will consist entirely of either uppercase (A–Z) or lowercase (a–z) letters. Words consisting of a single letter can be scalars and <strong>are</strong> considered to start and end with the same letter.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;area&#39;</span><span class="w"> </span><span class="s1">&#39;banana&#39;</span><span class="w"> </span><span class="s1">&#39;shoes&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;cape&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;z&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-extract-subvectors">

<p class="admonition-title"><span class="caption-number">Exercise 10.9 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">Extract</span></code> that accepts a character vector left argument (let us call it <code class="docutils literal notranslate"><span class="pre">text</span></code>) and an integer vector right argument (let us call it <code class="docutils literal notranslate"><span class="pre">start</span></code>).
We would like to extract a part of <code class="docutils literal notranslate"><span class="pre">text</span></code> as a <em>simple</em> character vector.
The extract is defined as a number of sub-vectors, each being five characters long, and starting at the positions given by <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;This boring text has been typed just for a little experiment.&#39;</span><span class="w"></span>
<span class="nv">start</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">52</span><span class="w"></span>
<span class="nv">text</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="nv">start</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">borintypedxperi
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;borintypedxperi&#39;</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="nv">start</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-extractl">

<p class="admonition-title"><span class="caption-number">Exercise 10.10 </span></p>
<div class="section" id="exercise-content">
<p>This exercise is the same as the previous one, but instead of extracting five characters each time, you are asked to extract a variable number of characters specified by the variable <code class="docutils literal notranslate"><span class="pre">long</span></code>.</p>
</div>
</div>
<p>You can use the same example as above plus the additional variable <code class="docutils literal notranslate"><span class="pre">length</span></code>:</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">length</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="nv">text</span><span class="w"> </span><span class="nv">ExtractL</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="nv">length</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">bortyped juxper
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;bortyped juxper&#39;</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="nv">ExtractL</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="nv">length</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
</div>
<div class="section" id="the-specialist-s-section">
<span id="nested-arrays-continued-the-specialists-section"></span><h2><span class="section-number">10.16. </span>The Specialist’s Section<a class="headerlink" href="#the-specialist-s-section" title="Permalink to this headline">#</a></h2>
<br />
<center>
<i>Each chapter is followed by a "Specialist's Section" like this one. This section is dedicated to skilled APLers who wish to improve their knowledge.</i>
You will find here rare or complex usages of the concepts presented in this chapter, or discover extended explanations which need the knowledge of some symbols that will be seen much further in the book.
<p><b>If you are exploring APL for the first time, skip this section and go to the next chapter.</b></p>
</center><div class="section" id="compatibility-and-migration-level">
<span id="nested-arrays-continued-compatibility-and-migration-level"></span><h3><span class="section-number">10.16.1. </span>Compatibility and Migration Level<a class="headerlink" href="#compatibility-and-migration-level" title="Permalink to this headline">#</a></h3>
<div class="section" id="migration-level">
<span id="nested-arrays-continued-migration-level"></span><h4><span class="section-number">10.16.1.1. </span>Migration Level<a class="headerlink" href="#migration-level" title="Permalink to this headline">#</a></h4>
<p>In the early 1980s, a number of “second-generation” APL systems evolved to support <em>nested arrays</em>.
Dyalog APL entered the market just as these systems were starting to appear, and decided to adopt the APL2 specification that IBM had been presenting to the world.
In the event, unfortunately, the APL2 specification changed very late in this process, after Dyalog had more or less released Dyalog APL (or so the story goes).
As a result, there are some minor differences between the dialects.</p>
<p>Just to give you an idea of the (sometimes) subtle differences, let us take a look at the expression <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c[2]</span></code>, where <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">c</span></code> are three vectors; for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
<span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c[2]</span></code> is ambiguous; it may be interpreted in two different ways:</p>
<ul class="simple">
<li><p>does it mean “create a 3-item vector made of <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and the second item of <code class="docutils literal notranslate"><span class="pre">c</span></code>”; or</p></li>
<li><p>does it mean “create a 3-item vector made of <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">c</span></code>, and then take the second item of it (that is to say, <code class="docutils literal notranslate"><span class="pre">b</span></code> enclosed)?</p></li>
</ul>
<p>IBM chose the first interpretation, and in an IBM-compatible implementation of APL the result would be <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2</span> <span class="pre">3)</span> <span class="pre">(4</span> <span class="pre">5</span> <span class="pre">6)</span> <span class="pre">8</span></code>.</p>
<p>In Dyalog APL, indexing is a function like any other function, in that it takes as its argument the entire vector on its left.
The result is therefore <code class="docutils literal notranslate"><span class="pre">⊂4</span> <span class="pre">5</span> <span class="pre">6</span></code> (<code class="docutils literal notranslate"><span class="pre">⊂</span></code> because strand notation nested the items):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┐
│4 5 6│
└─────┘
</span></div></div>
</div>
<p>As a minor player at the time, Dyalog wished to move the product in the direction of APL2, and in order to help the people who needed to use both IBM’s APL2 and Dyalog APL, and to make it easier to migrate an application from APL2 to Dyalog, a compatibility feature was introduced into Dyalog APL via a special <em>system variable</em> named <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code>, where the letters “ML” stand for “migration level”.</p>
<p>The default value for <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>To use code written according to IBM’s conventions, it is possible to set <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> to higher values (up to <code class="docutils literal notranslate"><span class="pre">3</span></code>), and obtain an increasing (but not total) level of compatibility with IBM’s APL2.
In other words, setting <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code> means “the Dyalog way”, which also shows that the default value for <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> is a small compromise between Dyalog’s original specification and APL2.
Today, Dyalog has become a major player in the APL market.
Pressure on Dyalog users to move in the direction of APL2 has faded and many users prefer the Dyalog definitions.
The unfortunate result of the story is that, depending on the roots of an application, code may be written to use any one of the possible migration levels.</p>
<p>In this book we use the default value of <code class="docutils literal notranslate"><span class="pre">⎕ML</span> <span class="pre">←</span> <span class="pre">1</span></code>, but we shall mention how some operations could be written in IBM’s notation.</p>
<p>It should be emphasised that when you select a non-zero value for <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code>, the “Dyalog way” of operation will no longer be available for the primitive functions that are sensitive to the selected value of <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code>.</p>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p><code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> is a normal <em>system variable</em>.
It can be localised in a function header or in a dynamic function, so that its influence is restricted to that function.</p>
</div>
</div>
<div class="section" id="a-list-of-differences">
<span id="nested-arrays-continued-a-list-of-differences"></span><h4><span class="section-number">10.16.1.2. </span>A List of Differences<a class="headerlink" href="#a-list-of-differences" title="Permalink to this headline">#</a></h4>
<p>This list is not a complete list of language differences between IBM APL2 and Dyalog.
It only lists the features of Dyalog APL that can be made to function like those of APL2 by setting <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> appropriately.</p>
<p>The first column contains the operation we are talking about;
the second and third columns compare how you perform that operation the “Dyalog way” (with <code class="docutils literal notranslate"><span class="pre">⎕ML</span> <span class="pre">←</span> <span class="pre">0</span></code>) or in APL2, respectively; and the fourth column contains additional comments.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Operation</p></th>
<th class="text-align:left head"><p>Dyalog’s implementation</p></th>
<th class="text-align:left head"><p>IBM’s implementation</p></th>
<th class="text-align:left head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Mix</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">↑[n]var</span></code> with <code class="docutils literal notranslate"><span class="pre">n</span></code> decimal</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⊃[n]var</span></code> with <code class="docutils literal notranslate"><span class="pre">n</span></code> integer or decimal</p></td>
<td class="text-align:left"><p>Same behaviour, different symbols. IBM’s definition requires <code class="docutils literal notranslate"><span class="pre">⎕ML≥2</span></code>.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Split</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">↓[n]var</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⊂[n]</span></code></p></td>
<td class="text-align:left"><p>Same behaviour, different symbols. IBM’s definition requires <code class="docutils literal notranslate"><span class="pre">⎕ML≥1</span></code>.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Partition</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">pat⊂[n]var</span></code> with <code class="docutils literal notranslate"><span class="pre">pat</span></code> Boolean</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">pat⊂[n]var</span></code> with <code class="docutils literal notranslate"><span class="pre">pat</span></code> integer</p></td>
<td class="text-align:left"><p>Same syntax, but different behaviour. With <code class="docutils literal notranslate"><span class="pre">⎕ML≥3</span></code>, Dyalog’s <code class="docutils literal notranslate"><span class="pre">⊂</span></code> becomes the same as <code class="docutils literal notranslate"><span class="pre">⊆</span></code>, because <code class="docutils literal notranslate"><span class="pre">⊆</span></code> behaves like IBM’s partition.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>First</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⊃var</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">↑var</span></code></p></td>
<td class="text-align:left"><p>Same behaviour, different symbols. IBM’s definition requires <code class="docutils literal notranslate"><span class="pre">⎕ML≥2</span></code>.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Enlist</p></td>
<td class="text-align:left"><p>n/a</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∊var</span></code></p></td>
<td class="text-align:left"><p>No Dyalog equivalent. Requires <code class="docutils literal notranslate"><span class="pre">⎕ML&gt;0</span></code>, but because the default value of <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> is 1, <em>enlist</em> is typically available in Dyalog.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Type</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∊var</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">↑0⍴⊂var</span></code></p></td>
<td class="text-align:left"><p>No special symbol in IBM’s definition. The IBM expression requires <code class="docutils literal notranslate"><span class="pre">⎕ML≥2</span></code>. Because <code class="docutils literal notranslate"><span class="pre">⎕ML←1</span></code> is the default, <code class="docutils literal notranslate"><span class="pre">∊</span></code> is  generally the <em>enlist</em> function, not the <em>type</em> function. See <a class="reference internal" href="#nested-arrays-continued-computing-the-type-and-prototype"><span class="std std-numref">Section 10.16.2</span></a>.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Depth</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">≡var</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">≡var</span></code></p></td>
<td class="text-align:left"><p>If the items of <code class="docutils literal notranslate"><span class="pre">var</span></code> have non-uniform depths, the IBM definition returns the absolute value of the depth rather than a negative value. IBM’s definition requires <code class="docutils literal notranslate"><span class="pre">⎕ML≥2</span></code>.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⎕TC</span></code></p></td>
<td class="text-align:left"><p>Backspace, Linefeed, Newline</p></td>
<td class="text-align:left"><p>Backspace, Newline, Linefeed</p></td>
<td class="text-align:left"><p>The order of the contents of <code class="docutils literal notranslate"><span class="pre">⎕TC</span></code> changes. IBM’s definition requires <code class="docutils literal notranslate"><span class="pre">⎕ML≥3</span></code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="computing-the-type-and-prototype">
<span id="nested-arrays-continued-computing-the-type-and-prototype"></span><h3><span class="section-number">10.16.2. </span>Computing the Type and Prototype<a class="headerlink" href="#computing-the-type-and-prototype" title="Permalink to this headline">#</a></h3>
<p>In <a class="reference internal" href="#nested-arrays-continued-type-prototype-fill-item"><span class="std std-numref">Section 10.9</span></a> we defined the <em>type</em> of an array and the <em>prototype</em> of an array, and yet, we have not discussed how to compute it.
However, you may have noticed that the discussion about <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> referenced a primitive called <em>type</em>.</p>
<div class="section" id="migration-level-zero">
<span id="nested-arrays-continued-migration-level-zero"></span><h4><span class="section-number">10.16.2.1. </span>Migration Level Zero<a class="headerlink" href="#migration-level-zero" title="Permalink to this headline">#</a></h4>
<p>In Dyalog APL, when <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> is set to <code class="docutils literal notranslate"><span class="pre">0</span></code> (the value that separates Dyalog APL from APL2 the most), the <em>epsilon</em> glyph stops representing the function <em>enlist</em> and becomes the function <em>type</em>.</p>
<p>In other words, the original versions of Dyalog APL included a function that computed the <em>type</em> of an array, and that function was <code class="docutils literal notranslate"><span class="pre">∊</span></code>.
However, in the present day, the default value of <code class="docutils literal notranslate"><span class="pre">⎕ML</span> <span class="pre">←</span> <span class="pre">1</span></code> means this function is generally not available.</p>
<p>Of course we can set <code class="docutils literal notranslate"><span class="pre">⎕ML</span> <span class="pre">←</span> <span class="pre">0</span></code> and see it in action:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕ML</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="o">∊</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─┬────────┐
│0│0 0│ │┌────┬─┐│
│ │0 0│ ││0   │0││
│ │   │ │├────┼─┤│
│ │   │ ││    │0││
│ │   │ │└────┴─┘│
└─┴───┴─┴────────┘
</span></div></div>
</div>
<p>We can even check that we determined the <em>type</em> of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code> correctly before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwashType</span><span class="o">≡∊</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Similarly, if <code class="docutils literal notranslate"><span class="pre">⎕ML</span> <span class="pre">←</span> <span class="pre">0</span></code>, we can easily compute the <em>prototype</em> of an array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∊⊃</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>We can see that <code class="docutils literal notranslate"><span class="pre">0</span></code> really is the <em>prototype</em> of <code class="docutils literal notranslate"><span class="pre">hogwash</span></code> because when we <em>overtake</em> with <code class="docutils literal notranslate"><span class="pre">↑</span></code>, the <em>fill items</em> are <code class="docutils literal notranslate"><span class="pre">0</span></code>s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="o">↑</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┬─┬────────┬─┬─┐
│19│1 2│A│┌────┬─┐│0│0│
│  │3 4│P││5   │8││ │ │
│  │   │L│├────┼─┤│ │ │
│  │   │ ││Nuts│9││ │ │
│  │   │ │└────┴─┘│ │ │
└──┴───┴─┴────────┴─┴─┘
</span></div></div>
</div>
<p>Now, before we forget, let us restore <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> to its default value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕ML</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="migration-level-non-zero">
<span id="nested-arrays-continued-migration-level-non-zero"></span><h4><span class="section-number">10.16.2.2. </span>Migration Level Non-zero<a class="headerlink" href="#migration-level-non-zero" title="Permalink to this headline">#</a></h4>
<p>When we are working with the default <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> value – or any non-zero <code class="docutils literal notranslate"><span class="pre">⎕ML</span></code> value, for that matter – we cannot use the primitive function <em>type</em> <code class="docutils literal notranslate"><span class="pre">∊</span></code> because that function is not available.
In those cases, we must resort to other techniques to determine the <em>type</em> or the <em>prototype</em> of an array.</p>
<p>To determine the <em>prototype</em> of an array, we can reshape the array to be empty, and then ask for its first element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="m">0</span><span class="o">⍴</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Similarly, to determine the <em>type</em> of an array <code class="docutils literal notranslate"><span class="pre">arr</span></code>, we can ask for the <em>prototype</em> of an array which has <code class="docutils literal notranslate"><span class="pre">arr</span></code> as the first item:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="m">0</span><span class="o">⍴⊂</span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─┬────────┐
│0│0 0│ │┌────┬─┐│
│ │0 0│ ││0   │0││
│ │   │ │├────┼─┤│
│ │   │ ││    │0││
│ │   │ │└────┴─┘│
└─┴───┴─┴────────┘
</span></div></div>
</div>
<p>It is understandable if you find these two ways of determining the <em>prototype</em> and the <em>type</em> unsatisfying.
After all, we are defining them in terms of themselves.</p>
<p>Another alternative follows, with a dfn that computes the <em>type</em> of an array recursively:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">type</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="m">0</span><span class="o">=≡</span><span class="bp">⍵:</span><span class="w"> </span><span class="o">⊃</span><span class="p">(</span><span class="bp">⍵</span><span class="o">≡⍕</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⌽</span><span class="m">0</span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="c1">⍝ Is ⍵ a simple scalar?</span><span class="w"></span>
<span class="w">    </span><span class="bp">∇</span><span class="na">¨</span><span class="bp">⍵</span><span class="w">                </span><span class="c1">⍝ If not, recurse.</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">type</span><span class="w"> </span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─┬────────┐
│0│0 0│ │┌────┬─┐│
│ │0 0│ ││0   │0││
│ │   │ │├────┼─┤│
│ │   │ ││    │0││
│ │   │ │└────┴─┘│
└─┴───┴─┴────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hogwashType</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>After having defined <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">prototype</span></code> follows trivially:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">prototype</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">type</span><span class="o">⊃</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">prototype</span><span class="w"> </span><span class="nv">hogwash</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
</div>
</div>
<div class="section" id="high-rank-partition">
<span id="nested-arrays-continued-high-rank-partition"></span><h3><span class="section-number">10.16.3. </span>High-rank Partition<a class="headerlink" href="#high-rank-partition" title="Permalink to this headline">#</a></h3>
<p>We studied the function <em>partition</em> applied to vectors in <a class="reference internal" href="#nested-arrays-continued-partition"><span class="std std-numref">Section 10.12.2</span></a>; it appeared to be extremely useful.</p>
<p>Its use is much more complex when applied to arrays of arbitrary rank.
Let us just try it on a matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2SO4
CaCO3
Fe2O3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊆</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┐
│H2│SO4│
├──┼───┤
│Ca│CO3│
├──┼───┤
│Fe│2O3│
└──┴───┘
</span></div></div>
</div>
<p>As we can see, <em>partition</em> operates along the specified axis, but it also separates all the items along the other axis, as if the matrix were seen through a grid.
In other words, <em>partition</em> <code class="docutils literal notranslate"><span class="pre">⊂</span></code> will preserve the rank of its argument array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≢⍴</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≢⍴</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊆</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<p>This is unlike <em>partitioned enclose</em>, which always returns a vector where each item has the original rank:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊂</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───┐
│H2│SO4│
│Ca│CO3│
│Fe│2O3│
└──┴───┘
</span></div></div>
</div>
<p>Although visually similar, the result of applying <em>partitioned enclose</em> is a vector of length 2, and each of its items, in turn is a sub-matrix of the original matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">r</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">¨</span><span class="nv">r</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┐
│3 2│3 3│
└───┴───┘
</span></div></div>
</div>
<p>For <em>partition</em>, it is the other way around: the result is still a matrix, it’s the items that become vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊆</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">¨</span><span class="nv">r</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┐
│2│3│
├─┼─┤
│2│3│
├─┼─┤
│2│3│
└─┴─┘
</span></div></div>
</div>
<p>Once more, be careful about the <strong>visual</strong> similarity of the results if <code class="docutils literal notranslate"><span class="pre">]box</span></code> happens to be OFF:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">box</span><span class="w"> </span><span class="nv">off</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊆</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊂</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"></span>
<span class="sr">]</span><span class="nv">box</span><span class="w"> </span><span class="nv">on</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Was ON
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace"> H2  SO4 
 Ca  CO3 
 Fe  2O3 
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace"> H2  SO4 
 Ca  CO3 
 Fe  2O3 
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">Was OFF
</span></div></div>
</div>
<p>Let us try using <em>partition</em> on a 3D array to see what the result looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ABCDE
FGHIJ
KLMNO
PQRST

UVWXY
ZABCD
EFGHI
JKLMN

OPQRS
TUVWX
YZABC
DEFGH
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">⊆</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬──┬──┬──┬──┐
│A │B │C │D │E │
├──┼──┼──┼──┼──┤
│F │G │H │I │J │
├──┼──┼──┼──┼──┤
│KP│LQ│MR│NS│OT│
└──┴──┴──┴──┴──┘
┌──┬──┬──┬──┬──┐
│U │V │W │X │Y │
├──┼──┼──┼──┼──┤
│Z │A │B │C │D │
├──┼──┼──┼──┼──┤
│EJ│FK│GL│HM│IN│
└──┴──┴──┴──┴──┘
┌──┬──┬──┬──┬──┐
│O │P │Q │R │S │
├──┼──┼──┼──┼──┤
│T │U │V │W │X │
├──┼──┼──┼──┼──┤
│YD│ZE│AF│BG│CH│
└──┴──┴──┴──┴──┘
</span></div></div>
</div>
<p>Once more, we see that the rank of the original array is preserved and that each scalar of the new array contains a vector.</p>
<div class="remark admonition">
<p class="admonition-title">Rules</p>
<p>In <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">pattern</span> <span class="pre">⊆[axis]</span> <span class="pre">array</span></code>:</p>
<ul class="simple">
<li><p>the result <code class="docutils literal notranslate"><span class="pre">r</span></code> is an array of the same rank as <code class="docutils literal notranslate"><span class="pre">array</span></code>;</p></li>
<li><p>the dimensions of the result and of the right argument array match, except possibly along the axis specified by <code class="docutils literal notranslate"><span class="pre">axis</span></code>; and</p></li>
<li><p>the length of the specified axis of the result is the number of partitions defined by <code class="docutils literal notranslate"><span class="pre">pattern</span></code>, which is <code class="docutils literal notranslate"><span class="pre">≢∪⌈\pattern</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="ambiguous-representation">
<span id="nested-arrays-continued-ambiguous-representation"></span><h3><span class="section-number">10.16.4. </span>Ambiguous Representation<a class="headerlink" href="#ambiguous-representation" title="Permalink to this headline">#</a></h3>
<p>Even with <code class="docutils literal notranslate"><span class="pre">]box</span></code> ON, and with the <code class="docutils literal notranslate"><span class="pre">]display</span></code> user command, there are times where the visual representations of arrays are ambiguous:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="s1">&#39;7&#39;</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 8 7 9
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">display</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────┐
│5 8 7 9│
└+──────┘
</span></div></div>
</div>
<p>In this form, the dash which should tell us that the <code class="docutils literal notranslate"><span class="pre">7</span></code> is a character is indistinguishable from the dashes used to draw the box.
We just know that one (or more) of the four items is a character because the <code class="docutils literal notranslate"><span class="pre">+</span></code> symbol tells us that this array is mixed.</p>
<p>A convenient way to distinguish between numbers and letters is to look at the <em>type</em> of the array and compare it with <code class="docutils literal notranslate"><span class="pre">0</span></code> (for numbers) or <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> (for letters):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="nv">type</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 1 0
</span></div></div>
</div>
</div>
<div class="section" id="pick-inside-a-scalar">
<span id="nested-arrays-continued-pick-inside-a-scalar"></span><h3><span class="section-number">10.16.5. </span>Pick Inside a Scalar<a class="headerlink" href="#pick-inside-a-scalar" title="Permalink to this headline">#</a></h3>
<p>Suppose that one item of a nested variable is a vector which has been enclosed twice, and we would like to select one value out of its contents.
For example, how can we select the letter <code class="docutils literal notranslate"><span class="pre">'P'</span></code> in the following vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">nv</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="o">⊂</span><span class="s1">&#39;CARPACCIO&#39;</span><span class="p">)(</span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬───────────┬─────┐
│3 5 2│┌─────────┐│6 8 1│
│     ││CARPACCIO││     │
│     │└─────────┘│     │
└─────┴───────────┴─────┘
</span></div></div>
</div>
<p>We might attempt to write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="nv">nv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR
      2 1 4⊃nv
           ∧
</pre></div>
</div>
</div>
</div>
<p>but that is incorrect because the second item of <code class="docutils literal notranslate"><span class="pre">nv</span></code> is an enclosed scalar.
The index <code class="docutils literal notranslate"><span class="pre">1</span></code> would have been appropriate for a one-item vector, but not for a scalar.</p>
<p>The correct answer is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="no">⍬</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="nv">nv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">P
</span></div></div>
</div>
</div>
</div>
<div class="section" id="solutions">
<span id="nested-arrays-continued-solutions"></span><h2><span class="section-number">10.17. </span>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline">#</a></h2>
<p>The following solutions we propose are not necessarily the “best” ones; perhaps you will find other solutions that we have never considered.
APL is a very rich language, and due to the general nature of its primitive functions and operators there are always plenty of different ways to express different solutions to a given problem.
Which one is “the best” depends on many things, for example the level of experience of the programmer, the importance of system performance, the required behaviour in border cases, the requirement to meet certain programming standards and also personal preferences.
This is one of the reasons why APL is so pleasant to teach and to learn!</p>
<p>We advise you to try and solve the exercises before reading the solutions!</p>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-10">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-depth-rank-shape"> Exercise 10.1</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>A very reasonable thing to do first is figure out the depth, rank, and shape, of the two arrays we are working with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Francis
Carmen 
Luciano
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  21.21 1534.88 375.46  704.5
1125.14 1963.52 464.45 1438.25
 796.53 1569    157.14  886.59
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cm</span></code> is a <em>simple</em> (character) matrix, hence has depth <code class="docutils literal notranslate"><span class="pre">1</span></code>; because it is a matrix, its rank is <code class="docutils literal notranslate"><span class="pre">2</span></code> and its shape is <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">7</span></code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nm</span></code> is a <em>simple</em> (numeric) matrix, hence has depth <code class="docutils literal notranslate"><span class="pre">1</span></code>; because it is a matrix, its rank is <code class="docutils literal notranslate"><span class="pre">2</span></code> and its shape is <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">4</span></code>.</p></li>
</ul>
<p>We can start by verifying this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">≡</span><span class="bp">⍵</span><span class="p">)(</span><span class="o">≢⍴</span><span class="bp">⍵</span><span class="p">)(</span><span class="o">⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="w"> </span><span class="c1">⍝ Depth, Rank, and Shape of an array.</span><span class="w"></span>
<span class="nv">DRS</span><span class="w"> </span><span class="nv">cm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬───┐
│1│2│3 7│
└─┴─┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬───┐
│1│2│3 4│
└─┴─┴───┘
</span></div></div>
</div>
<ul class="simple">
<li><p>For the expression <code class="docutils literal notranslate"><span class="pre">(⊂cm)(⊂nm)</span></code>, we are enclosing both matrices into scalars.
Then, <em>strand notation</em> will try to build a vector out of the different things it can find.
Because it can find two things, <code class="docutils literal notranslate"><span class="pre">⊂cm</span></code> and <code class="docutils literal notranslate"><span class="pre">⊂nm</span></code>, the result will be a 2-item vector: rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, shape <code class="docutils literal notranslate"><span class="pre">,2</span></code>.</p></li>
</ul>
<p>We just have to determine the depth of the result.
To determine the depth of a vector, we first have to determine the depth of all of its items.
In this case, that will be <code class="docutils literal notranslate"><span class="pre">≡⊂cm</span></code> and <code class="docutils literal notranslate"><span class="pre">≡⊂nm</span></code>.
Both of these represent enclosures of simple matrices, so the depth of the enclosure is one plus the depth of the simple matrix, i.e. <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Thus, the result is a vector where all items have depth <code class="docutils literal notranslate"><span class="pre">2</span></code> and, therefore, the result has depth <code class="docutils literal notranslate"><span class="pre">3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="nv">cm</span><span class="p">)(</span><span class="o">⊂</span><span class="nv">nm</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│3│1│2│
└─┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p>For the expression <code class="docutils literal notranslate"><span class="pre">(⊂cm),(⊂nm)</span></code>, what changes is the usage of the <em>catenate</em> primitive to build the final result, instead of letting strand notation do its work.
Again, we have that the building blocks are <code class="docutils literal notranslate"><span class="pre">⊂cm</span></code> and <code class="docutils literal notranslate"><span class="pre">⊂nm</span></code>, but now <em>catenate</em> uses those as the items that build the final result.
Because we are <em>catenating</em> two scalars, we get a 2-item vector: rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, shape <code class="docutils literal notranslate"><span class="pre">,2</span></code>.
However, this time the matrices themselves become the items of the vector, thus its depth is only <code class="docutils literal notranslate"><span class="pre">2</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="nv">cm</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">nm</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬──────────────────────────────┐
│Francis│  21.21 1534.88 375.46  704.5 │
│Carmen │1125.14 1963.52 464.45 1438.25│
│Luciano│ 796.53 1569    157.14  886.59│
└───────┴──────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="nv">cm</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="nv">nm</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│2│1│2│
└─┴─┴─┘
</span></div></div>
</div>
<p>This contrasts with the previous expression, where the items of the vector were the enclosed scalars.</p>
<ul class="simple">
<li><p>Finally, for the expression <code class="docutils literal notranslate"><span class="pre">cm,⊂nm</span></code>, we have something that won’t be homogeneous, and thus the result is going to have a negative depth.
Notice that <em>catenate</em> is being used between a matrix (<code class="docutils literal notranslate"><span class="pre">cm</span></code>), and a scalar (<code class="docutils literal notranslate"><span class="pre">⊂nm</span></code>).
As you’ve seen in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-catenating-scalars"><span class="std std-numref">Section 4.11.3</span></a>, catenating a scalar to a matrix makes it so that the scalar is repeated over the rows of the matrix, to extend the matrix by one column.</p></li>
</ul>
<p>Because the matrix <code class="docutils literal notranslate"><span class="pre">cm</span></code> had <code class="docutils literal notranslate"><span class="pre">7</span></code> columns, the matrix <code class="docutils literal notranslate"><span class="pre">cm,⊂nm</span></code> will have <code class="docutils literal notranslate"><span class="pre">8</span></code> columns, and its number of rows will remain unchanged, meaning the final shape is <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">8</span></code>.
Its rank will also remain unchanged.
What changes is the depth, because the result will no longer be a <em>simple</em> character matrix, but a nested matrix:
some of the elements will be characters, others will be numeric matrices.
Thus, the result will have some elements of depth <code class="docutils literal notranslate"><span class="pre">0</span></code> and others of depth <code class="docutils literal notranslate"><span class="pre">1</span></code>, making it so that the final depth is <code class="docutils literal notranslate"><span class="pre">¯2</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cm</span><span class="o">,⊂</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┬─┬─┬─┬─┬──────────────────────────────┐
│F│r│a│n│c│i│s│  21.21 1534.88 375.46  704.5 │
│ │ │ │ │ │ │ │1125.14 1963.52 464.45 1438.25│
│ │ │ │ │ │ │ │ 796.53 1569    157.14  886.59│
├─┼─┼─┼─┼─┼─┼─┼──────────────────────────────┤
│C│a│r│m│e│n│ │  21.21 1534.88 375.46  704.5 │
│ │ │ │ │ │ │ │1125.14 1963.52 464.45 1438.25│
│ │ │ │ │ │ │ │ 796.53 1569    157.14  886.59│
├─┼─┼─┼─┼─┼─┼─┼──────────────────────────────┤
│L│u│c│i│a│n│o│  21.21 1534.88 375.46  704.5 │
│ │ │ │ │ │ │ │1125.14 1963.52 464.45 1438.25│
│ │ │ │ │ │ │ │ 796.53 1569    157.14  886.59│
└─┴─┴─┴─┴─┴─┴─┴──────────────────────────────┘
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-11">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-depth-rank-shape2"> Exercise 10.2</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Let’s take the three vectors we need and work with them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
<span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span> <span class="pre">×</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code> is a 3-item nested vector, and all the sub-vectors have depth 1, so <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code> has depth <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Multiplying with <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span></code> doesn’t change the structure, only the contents, so <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span> <span class="pre">×</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span></code> is a 3-item vector of rank <code class="docutils literal notranslate"><span class="pre">1</span></code> and depth <code class="docutils literal notranslate"><span class="pre">2</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│2│1│3│
└─┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(10</span> <span class="pre">20),a</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">a</span></code> is a 3-item <em>simple</em> vector and <code class="docutils literal notranslate"><span class="pre">(10</span> <span class="pre">20)</span></code> is a 2-item <em>simple</em> vector, so their catenation yields a 5-item <em>simple</em> vector, thus its depth is <code class="docutils literal notranslate"><span class="pre">1</span></code>, its rank is <code class="docutils literal notranslate"><span class="pre">1</span></code>, and its shape is <code class="docutils literal notranslate"><span class="pre">,5</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="o">,</span><span class="nv">a</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│1│1│5│
└─┴─┴─┘
</span></div></div>
</div>
<p>Note that the parenthesis are superfluous and can be removed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="nv">a</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│1│1│5│
└─┴─┴─┘
</span></div></div>
</div>
<p>The same is true for the next expression:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(10</span> <span class="pre">20),a</span> <span class="pre">b</span></code></p></li>
</ul>
<p>Now we are catenating <code class="docutils literal notranslate"><span class="pre">(10</span> <span class="pre">20)</span></code>, which is a <em>simple</em> numeric vector, with <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span></code>, which is a 2-item nested vector. <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span></code> has depth <code class="docutils literal notranslate"><span class="pre">2</span></code>, rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, and shape <code class="docutils literal notranslate"><span class="pre">,2</span></code>.
When we <em>catenate</em> the two vectors, we get a heterogeneous 4-item vector, thus its depth will be <code class="docutils literal notranslate"><span class="pre">¯2</span></code>, its rank will be <code class="docutils literal notranslate"><span class="pre">1</span></code>, and its shape will be <code class="docutils literal notranslate"><span class="pre">,4</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="o">,</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬─┬─┐
│¯2│1│4│
└──┴─┴─┘
</span></div></div>
</div>
<p>As mentioned before, removing the parenthesis doesn’t change the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬─┬─┐
│¯2│1│4│
└──┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">2</span> <span class="pre">×</span> <span class="pre">c[2]</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">c[2]</span></code> is a <em>simple</em> scalar, thus multiplying it with <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">2</span></code> won’t change the structure of the array.
Now, <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">2</span></code> is a 3-item vector that is not homogeneous, because <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are nested vectors.
<code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> have depth <code class="docutils literal notranslate"><span class="pre">1</span></code>, thus the final array will have depth <code class="docutils literal notranslate"><span class="pre">2</span></code>, rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, and shape <code class="docutils literal notranslate"><span class="pre">,3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬─┬─┐
│¯2│1│3│
└──┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">10×a</span> <span class="pre">20×b</span></code></p></li>
</ul>
<p>The <em>strand</em> <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">20</span></code> creates a 2-item vector that is being multiplied by <code class="docutils literal notranslate"><span class="pre">b</span></code>, but <code class="docutils literal notranslate"><span class="pre">b</span></code> is a 3-item vector, thus we will get a <code class="docutils literal notranslate"><span class="pre">LENGTH</span> <span class="pre">ERROR</span></code> if we try to evaluate this expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">×</span><span class="nv">a</span><span class="w"> </span><span class="m">20</span><span class="o">×</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      10×a 20×b
             ∧
</pre></div>
</div>
</div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-12">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-depth-rank-shape3"> Exercise 10.3</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We continue our work:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">+/a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
</ul>
<p>The <em>strand</em> <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code> builds a 3-item vector, and the <code class="docutils literal notranslate"><span class="pre">+/</span></code> will reduce it to a single scalar containing the result of <code class="docutils literal notranslate"><span class="pre">a+b+c</span></code> so, in other words, <code class="docutils literal notranslate"><span class="pre">+/a</span> <span class="pre">b</span> <span class="pre">c</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">⊂a+b+c</span></code>.
<code class="docutils literal notranslate"><span class="pre">a+b+c</span></code> evaluates to a 3-item <em>simple</em> vector of depth <code class="docutils literal notranslate"><span class="pre">1</span></code>, thus <code class="docutils literal notranslate"><span class="pre">⊂a+b+c</span></code> has depth <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Because it is a scalar, it has rank <code class="docutils literal notranslate"><span class="pre">0</span></code> and shape <code class="docutils literal notranslate"><span class="pre">⍬</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬┐
│2│0││
└─┴─┴┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">+/¨a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
</ul>
<p>This expression is slightly different from the previous one in that the operator <em>each</em> <code class="docutils literal notranslate"><span class="pre">¨</span></code> was put next to the <em>plus-reduction</em>.
Because of the <em>each</em>, we will sum each of the three vectors, each of them producing a single scalar.
Now, it’s important to understand that <code class="docutils literal notranslate"><span class="pre">f¨array</span></code> doesn’t change the outer structure of <code class="docutils literal notranslate"><span class="pre">array</span></code>.
So, if <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code> is a 3-item vector, <code class="docutils literal notranslate"><span class="pre">f¨a</span> <span class="pre">b</span> <span class="pre">c</span></code> will <em>still</em> be a 3-item vector.
In our case, because <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">←</span> <span class="pre">+/</span></code>, we will get a 3-item <em>simple</em> numeric vector, meaning the final depth is <code class="docutils literal notranslate"><span class="pre">1</span></code>, the rank is <code class="docutils literal notranslate"><span class="pre">1</span></code>, and the shape is <code class="docutils literal notranslate"><span class="pre">,3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="o">+</span><span class="na">/¨</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│1│1│3│
└─┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1/¨a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
</ul>
<p>The use of <code class="docutils literal notranslate"><span class="pre">¨</span></code> again tells us that the result will be a 3-item vector.
Now we are left with examining the contents of the resulting vector.
Because the left argument to <em>compress</em> isn’t enclosed, <em>compress each</em> will do <code class="docutils literal notranslate"><span class="pre">1/a</span></code>, <code class="docutils literal notranslate"><span class="pre">0/b</span></code>, and <code class="docutils literal notranslate"><span class="pre">1/c</span></code>.
<code class="docutils literal notranslate"><span class="pre">1/a</span></code> and <code class="docutils literal notranslate"><span class="pre">1/c</span></code> don’t change the right argument arrays, but <code class="docutils literal notranslate"><span class="pre">0/b</span></code> produces an empty vector.
Thus, the result is equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">⍬</span> <span class="pre">c</span></code>.
However, this doesn’t change any of the characteristics of <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code>, and the result is still a 3-item vector with rank <code class="docutils literal notranslate"><span class="pre">1</span></code> and depth <code class="docutils literal notranslate"><span class="pre">2</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">/¨</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│2│1│3│
└─┴─┴─┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="no">⍬</span><span class="w"> </span><span class="nv">c</span><span class="o">≡</span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="na">/¨</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(a</span> <span class="pre">b</span> <span class="pre">c)⍳4</span> <span class="pre">5</span> <span class="pre">6</span></code></p></li>
</ul>
<p>This is a tricky question, because <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">←</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6</span></code> might lead you into thinking that the result is <code class="docutils literal notranslate"><span class="pre">2</span></code>.
However, <em>index of</em> looks at its left argument and finds a vector (although a <em>nested</em> one) so it will look at the right argument as a collection of scalars, and it will check for the position of each scalar in the left argument vector.
Because none of the scalars <code class="docutils literal notranslate"><span class="pre">4</span></code>, <code class="docutils literal notranslate"><span class="pre">5</span></code>, and <code class="docutils literal notranslate"><span class="pre">6</span></code>, are in the left argument vector, the final result is <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span> <span class="pre">4</span></code> which is a vector of depth <code class="docutils literal notranslate"><span class="pre">1</span></code>, rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, and shape <code class="docutils literal notranslate"><span class="pre">,3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="o">⍳</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w">  </span><span class="c1">⍝ the parenthesis are superfluous</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 4 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="o">⍳</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│1│1│3│
└─┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">10</span> <span class="pre">3</span> <span class="pre">∊</span> <span class="pre">a</span></code></p></li>
</ul>
<p>The result of a <em>membership</em> operation is an array with the same shape as the left argument, so it will be a 3-item vector.
Then, each scalar in the result is either a <code class="docutils literal notranslate"><span class="pre">0</span></code> or a <code class="docutils literal notranslate"><span class="pre">1</span></code>, so the result will be a <em>simple</em> vector: depth <code class="docutils literal notranslate"><span class="pre">1</span></code>, rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, and shape <code class="docutils literal notranslate"><span class="pre">,3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">∊</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│1│1│3│
└─┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(⊂1</span> <span class="pre">0</span> <span class="pre">1)/¨a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
</ul>
<p>This is similar to one of the previous expressions, but now the left argument to <code class="docutils literal notranslate"><span class="pre">/¨</span></code> is enclosed, meaning that <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span></code> is the left argument that is used when compressing each of the items of the right argument <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code>.
The operator <em>each</em> makes it so that the final result is a 3-item vector as well.
Then, each of its scalars is the result of doing <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">0</span> <span class="pre">1/</span></code> on one of <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, or <code class="docutils literal notranslate"><span class="pre">c</span></code>; the results of which are always a 2-item <em>simple</em> vector.
Therefore, the final result will be a nested vector of depth <code class="docutils literal notranslate"><span class="pre">2</span></code>, rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, and shape <code class="docutils literal notranslate"><span class="pre">,3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="na">/¨</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┐
│1 3│4 6│7 9│
└───┴───┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="p">(</span><span class="o">⊂</span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="na">/¨</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│2│1│3│
└─┴─┴─┘
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">10</span> <span class="pre">3</span> <span class="pre">∊</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></code></p></li>
</ul>
<p>As seen above, the structure of the result of <em>membership</em> <code class="docutils literal notranslate"><span class="pre">∊</span></code> depends on the left argument <strong>only</strong>, so we have again that the result has depth <code class="docutils literal notranslate"><span class="pre">1</span></code>, rank <code class="docutils literal notranslate"><span class="pre">1</span></code>, and shape <code class="docutils literal notranslate"><span class="pre">,3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DRS</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">∊</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┐
│1│1│3│
└─┴─┴─┘
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-13">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-reductions"> Exercise 10.4</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We want to know what <code class="docutils literal notranslate"><span class="pre">+/na</span></code> and <code class="docutils literal notranslate"><span class="pre">,/na</span></code> evaluate to, given <code class="docutils literal notranslate"><span class="pre">na</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">na</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬───┬─┬─┐
│1│2│3 4│7│8│
│ │ │5 6│ │ │
└─┴─┴───┴─┴─┘
</span></div></div>
</div>
<p>The simplest way to think about this is to write down the expression that the <em>reduction</em> is equivalent to:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
<p>Notice the final <em>enclose</em> to guarantee that the result is a scalar: it’s there because <em>reduce</em> is supposed to reduce the rank of the argument. If we <em>reduce</em> a vector, the result will be a scalar, even if an enclosed one.</p>
<p>We have a series of scalar additions and, in the middle, addition with a matrix.
There are no shape mismatches, and thus we can just add all the scalars to all the positions in the matrix.
<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">7</span> <span class="pre">+</span> <span class="pre">8</span></code> is <code class="docutils literal notranslate"><span class="pre">18</span></code>, thus the final result is <code class="docutils literal notranslate"><span class="pre">⊂18+2</span> <span class="pre">2⍴3</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6</span></code>, or <code class="docutils literal notranslate"><span class="pre">⊂2</span> <span class="pre">2⍴21</span> <span class="pre">22</span> <span class="pre">23</span> <span class="pre">24</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">na</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┐
│21 22│
│23 24│
└─────┘
</span></div></div>
</div>
<p>As for <code class="docutils literal notranslate"><span class="pre">,/na</span></code>, we can do a similar exercise.
However, now we can’t shuffle things into the order that we prefer because <code class="docutils literal notranslate"><span class="pre">,</span></code> is not commutative.</p>
<p>Starting from the right, we first evaluate <code class="docutils literal notranslate"><span class="pre">7,8</span></code> to get <code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">8</span></code>, and then we evaluate <code class="docutils literal notranslate"><span class="pre">(2</span> <span class="pre">2⍴3</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6),7</span> <span class="pre">8</span></code>.
Because the left argument to <em>catenate</em> is a matrix and the right argument is a vector, <em>catenate</em> will try to spread the vector across the rows of the matrix.
Because the number of rows matches the elements in the vector, that happens successfully and the result is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3⍴3</span> <span class="pre">4</span> <span class="pre">7</span> <span class="pre">5</span> <span class="pre">6</span> <span class="pre">8</span></code>.
Then, we <em>catenate</em> two scalars (separately) to the left of the matrix, so those get replicated across the rows.</p>
<p>The final result is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│1 2 3 4 7│
│1 2 5 6 8│
└─────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="na">/</span><span class="nv">na</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│1 2 3 4 7│
│1 2 5 6 8│
└─────────┘
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-14">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-quantitiessold"> Exercise 10.5</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We have the two vectors here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ref</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">47</span><span class="w"> </span><span class="m">47</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">83</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">50</span><span class="w"></span>
<span class="nv">qty</span><span class="w"> </span><span class="kd">←</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">11</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">39</span><span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>And we want to use a partitioning function to figure out how many items of each reference were sold.
In order to do that, we can try to create a Boolean vector that identifies whenever the vector <code class="docutils literal notranslate"><span class="pre">ref</span></code> reaches a new reference.
If we do a pairwise <em>not-equals</em> reduction, we get quite close:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="nv">ref</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 0 0 0 0 1 1 0 0 1 0
</span></div></div>
</div>
<p>The only issue is that this fails to identify the initial reference, but we can fix it by <em>catenating</em> a <code class="docutils literal notranslate"><span class="pre">1</span></code> in the beginning:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="nv">ref</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 0 0 0 0 1 1 0 0 1 0
</span></div></div>
</div>
<p>With that out of the way, we can use <em>partitioned enclose</em> to get a nested vector where each sub-vector contains the quantities sold for that reference:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="nv">ref</span><span class="w"> </span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">47 47 83 83 83 83 83 29 36 36 36 50 50
 5  8  3 18 11  1  6 10 61 52 39  8 11
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="nv">ref</span><span class="p">)</span><span class="o">⊂</span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───────────┬──┬────────┬────┐
│5 8│3 18 11 1 6│10│61 52 39│8 11│
└───┴───────────┴──┴────────┴────┘
</span></div></div>
</div>
<p>Finally, we can add those up with an <em>each</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/¨</span><span class="p">(</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="nv">ref</span><span class="p">)</span><span class="o">⊂</span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 39 10 152 19
</span></div></div>
</div>
<p>Alternatively, we can <em>mix</em> the results after <em>partitioned enclose</em> and then sum along the last axis.
The <em>partitioned enclose</em> is likely to return sub-vectors that do not have the same length, which means that <em>fill items</em> are inserted when we <em>mix</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="p">(</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="nv">ref</span><span class="p">)</span><span class="o">⊂</span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 5  8  0 0 0
 3 18 11 1 6
10  0  0 0 0
61 52 39 0 0
 8 11  0 0 0
</span></div></div>
</div>
<p>However, that doesn’t change the final result because adding zeroes does nothing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="o">↑</span><span class="p">(</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="nv">ref</span><span class="p">)</span><span class="o">⊂</span><span class="nv">qty</span><span class="w">  </span><span class="c1">⍝ still correct</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 39 10 152 19
</span></div></div>
</div>
<p>Let’s wrap it into a function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">QuantitiesSold</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="o">↑</span><span class="p">(</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="bp">⍺</span><span class="p">)</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">ref</span><span class="w"> </span><span class="nv">QuantitiesSold</span><span class="w"> </span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 39 10 152 19
</span></div></div>
</div>
<p>If we wanted to return the quantities and the respective references, we could use the same Boolean vector to compress the references and partition the quantities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">QuantitiesSoldAndRefs</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">pat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">pat</span><span class="na">/</span><span class="bp">⍺</span><span class="p">)</span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">↑</span><span class="nv">pat</span><span class="o">⊂</span><span class="bp">⍵</span><span class="p">)</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ref</span><span class="w"> </span><span class="nv">QuantitiesSoldAndRefs</span><span class="w"> </span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">47 83 29  36 50
13 39 10 152 19
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-15">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-high-dim-index-of"> Exercise 10.6</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>In order to be able to look the rows of a matrix up on the rows of another matrix, we just need to use <em>split</em> to turn both matrices into vectors of rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">big</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1  2
3  4
5  6
7  8
9 10
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="o">⍪</span><span class="m">8</span><span class="o">+</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2
 3  4
 9 10
11 12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">↓</span><span class="nv">big</span><span class="p">)</span><span class="o">⍳↓</span><span class="nv">small</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 5 6
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-16">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-empty-vectors"> Exercise 10.7</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>In order to understand the results of the empty <em>partitioned encloses</em>, it is helpful to think about what the result would be if it were a “normal” <em>partitioned enclose</em>.</p>
<p>For example, for the solved case, here is a “normal” <em>partitioned enclose</em> of <code class="docutils literal notranslate"><span class="pre">'Partition'</span></code>, using an arbitrary left argument with a couple of <code class="docutils literal notranslate"><span class="pre">1</span></code>s and a couple of <code class="docutils literal notranslate"><span class="pre">0</span></code>s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="o">⊂</span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬──┬────┐
│Par│ti│tion│
└───┴──┴────┘
</span></div></div>
</div>
<p>The result is, thus, a vector of character vectors.
So, if the left argument is <code class="docutils literal notranslate"><span class="pre">0</span></code>, we get “an empty vector of empty character vectors”.
Here is a vector of empty character vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┬┬┬┐
│││││
└┴┴┴┘
</span></div></div>
</div>
<p>But this vector has 4 elements.
To make it empty, we need to reshape it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">


</span></div></div>
</div>
<p>But it is a waste of typing effort to write four <code class="docutils literal notranslate"><span class="pre">''</span></code>, for nothing, when we can just let <em>reshape</em> take care of reusing data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="o">⍴</span><span class="m">4</span><span class="o">⍴⊂</span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">


</span></div></div>
</div>
<p>Now, reshaping twice is redundant, so we can keep only the last reshape:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="o">⍴⊂</span><span class="s1">&#39;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">


</span></div></div>
</div>
<p>This <em>matches</em> the empty result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂</span><span class="s1">&#39;Partition&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Let us follow a similar reasoning for the remaining expressions.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂⍳10</span></code></p></li>
</ul>
<p>This is very similar to the example above, except the data is numeric instead of textual, so the result is an empty vector of empty numeric vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="no">⍬</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂⍬</span></code></p></li>
</ul>
<p>This is an attempt at a tricky question, but remember that <code class="docutils literal notranslate"><span class="pre">⍬</span></code> <em>is</em> a <em>simple</em> numeric vector, although an empty one.
Thus, the solution is the same:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="no">⍬</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂3</span> <span class="pre">2⍴⎕A</span></code></p></li>
</ul>
<p>The <em>partitioned enclose</em> of a character matrix is a vector of character matrices, so the result of the empty <em>partitioned enclose</em> is going to be an empty vector of empty character matrices.
Now, the question is: what is the shape of those empty matrices?</p>
<p>Well, by modifying the left argument to <em>partitioned enclose</em>, we can vary the number of columns in the sub-matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="o">⊂</span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┐
│A│B│
│C│D│
│E│F│
└─┴─┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="o">⊂</span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┐
│AB│
│CD│
│EF│
└──┘
</span></div></div>
</div>
<p>But we see that the sub-matrices always have three rows, because that is how many rows the original matrix has.
Hence, the final result is an empty vector of empty character matrices with three rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂</span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂3</span> <span class="pre">4</span> <span class="pre">5⍴⍳60</span></code></p></li>
</ul>
<p>The train of thought for this example is very similar to the previous one, except we are working with an array of rank three.
The basic premise is the same, though, and that’s that modifying the pattern of the left argument of <em>partitioned enclose</em> is going to alter the dimension of the last axis of each sub-result, but each sub-result will have a shape that starts with <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">4</span></code>.</p>
<p>Hence, the final result is an empty vector of empty cuboids with shapes <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">4</span> <span class="pre">0</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">0</span><span class="o">⍴</span><span class="no">⍬</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⍴⍳</span><span class="m">60</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂(1</span> <span class="pre">2</span> <span class="pre">3)(4</span> <span class="pre">5</span> <span class="pre">6)(7</span> <span class="pre">8</span> <span class="pre">9)</span></code></p></li>
</ul>
<p>The right argument to <em>partitioned enclose</em> is a nested vector, so the result would generally be a vector, where each item would be a vector of triples of integers.
So, in this case, the result is an empty vector of empty vectors of triples of integers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">3</span><span class="o">⍴</span><span class="no">⍬</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w"></span>
<span class="c1">⍝      ↑ the triples of integers</span><span class="w"></span>
<span class="c1">⍝   ↑ the empty vectors of triples of integers</span><span class="w"></span>
<span class="c1">⍝↑ the empty vector of empty vectors of triples of integers</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂('cat')('dog')(7</span> <span class="pre">8</span> <span class="pre">9)</span></code></p></li>
</ul>
<p>This example is very similar to the previous one, except now we have a <em>mixed</em> vector.
However, when working with empty vectors, <em>fill items</em>, and <em>prototypes</em>, what matters is the first item of the vector, which is a 3-item character vector in  this case.
Thus, the result will be the same as before, except we have triples of characters instead of triples of integers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">)(</span><span class="s1">&#39;dog&#39;</span><span class="p">)(</span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w"></span>
<span class="c1">⍝      ↑ the triples of characters ...</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0⊂(14</span> <span class="pre">'cat'</span> <span class="pre">8)('a'</span> <span class="pre">2</span> <span class="pre">'c'</span> <span class="pre">4)(1</span> <span class="pre">2</span> <span class="pre">3)</span></code></p></li>
</ul>
<p>Solving this final expression requires applying the same thought process as before.
The first item is a 5-item vector with an integer, three characters, and another integer, so that is exactly what we shall recreate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">0</span><span class="o">⍴⊂</span><span class="m">0</span><span class="s1">&#39;   &#39;</span><span class="m">0</span><span class="p">)</span><span class="o">≡</span><span class="m">0</span><span class="o">⊂</span><span class="p">(</span><span class="m">14</span><span class="w"> </span><span class="s1">&#39;cat&#39;</span><span class="w"> </span><span class="m">8</span><span class="p">)(</span><span class="s1">&#39;a&#39;</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s1">&#39;c&#39;</span><span class="w"> </span><span class="m">4</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-17">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-startandend"> Exercise 10.8</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>To check if a word starts and ends with the same character, we can take a character from the front, one from the back, and compare those:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">word</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;area&#39;</span><span class="w"></span>
<span class="p">(</span><span class="m">1</span><span class="o">↑</span><span class="nv">word</span><span class="p">)</span><span class="o">=</span><span class="m">¯1</span><span class="o">↑</span><span class="nv">word</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>However, we can also make use of the <em>first</em> primitive that we just learned about.
<em>First</em> <code class="docutils literal notranslate"><span class="pre">⊃</span></code> picks the first character in a character vector, we are just left with picking the last element of the word.
An interesting way to look at it is by realising that the last element of a (character) vector is the <em>first</em> element of the <em>reverse</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃⌽</span><span class="s1">&#39;last&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">t
</span></div></div>
</div>
<p>Thus, given a vector of words, we can use <em>each</em> to work on each word separately:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=⊃⌽</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="bp">⍵</span><span class="w"> </span><span class="kt">}</span><span class="w"></span>
<span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;area&#39;</span><span class="w"> </span><span class="s1">&#39;banana&#39;</span><span class="w"> </span><span class="s1">&#39;shoes&#39;</span><span class="w">    </span><span class="c1">⍝ 1 0 1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1
</span></div></div>
</div>
<p>The functions appears to be working, so let us test it on the other examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;cape&#39;</span><span class="w">                     </span><span class="c1">⍝ 0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1
</span></div></div>
</div>
<p>Ok, <em>clearly</em> the function is not working yet.
The issue is that the argument <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a 4-item vector and <code class="docutils literal notranslate"><span class="pre">{(⊃⍵)=⊃⌽⍵}¨</span></code> is going to traverse <em>each</em> of the characters of that vector.
The fix for this is using the primitive function <em>nest</em> to preprocess the argument, to guarantee that the argument is always nested.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=⊃⌽</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="o">⊆</span><span class="bp">⍵</span><span class="w"> </span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;area&#39;</span><span class="w"> </span><span class="s1">&#39;banana&#39;</span><span class="w"> </span><span class="s1">&#39;shoes&#39;</span><span class="w">    </span><span class="c1">⍝ 1 0 1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;cape&#39;</span><span class="w">                     </span><span class="c1">⍝ 0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">StartAndEnd</span><span class="w"> </span><span class="s1">&#39;z&#39;</span><span class="w">                        </span><span class="c1">⍝ 1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-18">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-extract-subvectors"> Exercise 10.9</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>In order to extract the sub-vectors from the big character vector, we need to take the starting indices and count five indices starting from there:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">start</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">52</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">¯1</span><span class="o">+⊂⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┬──────────────┬──────────────┐
│6 7 8 9 10│27 28 29 30 31│52 53 54 55 56│
└──────────┴──────────────┴──────────────┘
</span></div></div>
</div>
<p>Now, the most pragmatic thing to do is to <em>enlist</em> all those indices and index directly into the character vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;This boring text has been typed just for a little experiment.&#39;</span><span class="w"></span>
<span class="nv">text</span><span class="sr">[</span><span class="o">∊</span><span class="nv">start</span><span class="o">+</span><span class="m">¯1</span><span class="o">+⊂⍳</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">borintypedxperi
</span></div></div>
</div>
<p>Putting this in a function gives:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Extract</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="bp">⍺</span><span class="sr">[</span><span class="o">∊</span><span class="bp">⍵</span><span class="o">+</span><span class="m">¯1</span><span class="o">+⊂⍳</span><span class="m">5</span><span class="sr">]</span><span class="w"> </span><span class="kt">}</span><span class="w"></span>
<span class="nv">text</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="nv">start</span><span class="w"></span>
<span class="c1">⍝ &#39;borintypedxperi&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">borintypedxperi
</span></div></div>
</div>
<div class="solution admonition" id="Nested-Arrays-Continued-solution-19">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-extractl"> Exercise 10.10</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>This exercise is very similar to the previous one, except that now we don’t extract sub-vectors of fixed length, the lengths depend on the right argument.
Fixing this can be done by using <em>iota each</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">length</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">ExtractL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">start</span><span class="w"> </span><span class="nv">length</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍺</span><span class="sr">[</span><span class="o">∊</span><span class="nv">start</span><span class="o">+</span><span class="m">¯1</span><span class="o">+⍳</span><span class="na">¨</span><span class="nv">length</span><span class="sr">]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span><span class="w"> </span><span class="nv">ExtractL</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="nv">length</span><span class="w"></span>
<span class="c1">⍝ &#39;bortyped juxper&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">bortyped juxper
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Special-Syntax.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">9. </span>Special Syntax</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Operators.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">11. </span>Operators</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Bernard Legrand, reworked by Rodrigo Girão Serrão.<br/>
  
    <div class="extra_footer">
      <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
</a></p>
<p>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>