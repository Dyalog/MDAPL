
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5. User-Defined Functions &#8212; Mastering Dyalog APL</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. First-Aid Kit" href="First-Aid-Kit.html" />
    <link rel="prev" title="4. Some Primitive Functions" href="Some-Primitive-Functions.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Mastering Dyalog APL</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction.html">
   1. Introduction - Will You Play APL With Me?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Getting-Started.html">
   2. Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Data-and-Variables.html">
   3. Data and Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Some-Primitive-Functions.html">
   4. Some Primitive Functions
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5. User-Defined Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="First-Aid-Kit.html">
   6. First-Aid Kit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Execute-and-Format-Control.html">
   7. Execute &amp; Format Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Working-on-Data-Shape.html">
   8. Working on Data Shape
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Special-Syntax.html">
   9. Special Syntax
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Nested-Arrays-Continued.html">
   10. Nested Arrays (Continued)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Operators.html">
   11. Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Tacit-Programming.html">
   12. Tacit Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Mathematical-Functions.html">
   13. Mathematical Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendices.html">
   14. Appendices
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Dyalog/MDAPL"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Dyalog/MDAPL/edit/master/docs/User-Defined-Functions.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/User-Defined-Functions.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#landmarks">
   5.1. Landmarks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-definitions">
     5.1.1. Some Definitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-your-environment">
     5.1.2. Configure Your Environment
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-do-you-need">
       5.1.2.1. What Do You Need?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-text-editor-what-for">
       5.1.2.2. A Text Editor; What For?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-dfns">
   5.2. Simple Dfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition">
     5.2.1. Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unnamed-dfns">
     5.2.2. Unnamed Dfns
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modifying-the-code">
     5.2.3. Modifying The Code
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-dfns">
   5.3. More on Dfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characteristics">
     5.3.1. Characteristics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-working-example">
     5.3.2. A Working Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#local-variables">
     5.3.3. Local Variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#default-left-argument">
     5.3.4. Default Left Argument
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#returning-the-result">
     5.3.5. Returning the Result
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises-on-dfns">
   5.4. Exercises on Dfns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dfns-in-depth">
   5.5. Dfns in Depth
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#guards">
     5.5.1. Guards
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shy-result">
     5.5.2. Shy Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lexical-scoping">
     5.5.3. Lexical Scoping
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tradfns">
   5.6. Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-first-example">
     5.6.1. A First Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-default-isn-t-local">
     5.6.2. The Default Isn’t Local
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-sub-functions">
     5.6.3. Defining Sub-Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-second-example">
     5.6.4. A Second Example
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#another-possible-syntax">
       5.6.4.1. Another Possible Syntax
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-scoping">
     5.6.5. Dynamic Scoping
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flow-control-in-tradfns">
   5.7. Flow Control in Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview">
     5.7.1. Overview
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-execution">
     5.7.2. Conditional Execution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-conditions-if-endif">
       5.7.2.1. Simple Conditions (
       <code class="docutils literal notranslate">
        <span class="pre">
         :If
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndIf
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#alternative-processing-if-else-endif">
       5.7.2.2. Alternative Processing (
       <code class="docutils literal notranslate">
        <span class="pre">
         :If
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Else
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndIf
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#composite-conditions-orif-andif">
       5.7.2.3. Composite Conditions (
       <code class="docutils literal notranslate">
        <span class="pre">
         :OrIf
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :AndIf
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cascading-conditions-elseif-else">
       5.7.2.4. Cascading Conditions (
       <code class="docutils literal notranslate">
        <span class="pre">
         :ElseIf
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Else
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#alternative-solutions">
       5.7.2.5. Alternative Solutions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disparate-conditions">
     5.7.3. Disparate Conditions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clauses-select-case-caselist">
       5.7.3.1. Clauses (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Select
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Case
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :CaseList
        </span>
       </code>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predefined-loops">
     5.7.4. Predefined Loops
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#basic-use-for-in-endfor">
       5.7.4.1. Basic Use (
       <code class="docutils literal notranslate">
        <span class="pre">
         :For
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :In
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndFor
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#control-of-iterations">
       5.7.4.2. Control of Iterations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-loops">
     5.7.5. Conditional Loops
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bottom-controlled-loop-repeat-until">
       5.7.5.1. Bottom-Controlled Loop (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Repeat
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Until
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#top-controlled-loop-while-endwhile">
       5.7.5.2. Top-Controlled Loop (
       <code class="docutils literal notranslate">
        <span class="pre">
         :While
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndWhile
        </span>
       </code>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exception-control">
     5.7.6. Exception Control
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skip-to-the-next-iteration-continue">
       5.7.6.1. Skip to the Next Iteration (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Continue
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#leave-the-loop-leave">
       5.7.6.2. Leave the Loop (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Leave
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#jump-to-another-statement-goto">
       5.7.6.3. Jump to Another Statement (
       <code class="docutils literal notranslate">
        <span class="pre">
         :GoTo
        </span>
       </code>
       )
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#jump-destinations">
         5.7.6.3.1. Jump Destinations
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quit-this-function-return">
       5.7.6.4. Quit This Function (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Return
        </span>
       </code>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#endless-loops">
     5.7.7. Endless Loops
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-slow-function">
       5.7.7.1. A Slow Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#weak-and-strong-interrupts">
       5.7.7.2. Weak and Strong Interrupts
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-can-you-generate-an-interrupt">
       5.7.7.3. How Can You Generate an Interrupt
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-a-weak-interrupt">
       5.7.7.4. First a Weak Interrupt
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#and-now-a-strong-interrupt">
       5.7.7.5. And Now a Strong Interrupt
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#traditional-flow-control">
     5.7.8. Traditional Flow Control
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#equivalence-with-modern-flow-control">
       5.7.8.1. Equivalence With Modern Flow Control
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-destinations">
       5.7.8.2. Multiple Destinations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modern-and-traditional-controls-cooperate">
     5.7.9. Modern and Traditional Controls Cooperate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dfns-versus-tradfns">
   5.8. Dfns Versus Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison">
     5.8.1. Comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-cases">
     5.8.2. Use Cases
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#input-output-and-format">
   5.9. Input, Output and Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-input-and-output-methods">
     5.9.1. Some Input and Output Methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#format">
     5.9.2. Format
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#monadic-format">
       5.9.2.1. Monadic Format
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dyadic-format">
       5.9.2.2. Dyadic Format
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#displaying-intermediate-results">
     5.9.3. Displaying Intermediate Results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-global-variables">
     5.9.4. Using Global Variables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#global-constants">
       5.9.4.1. Global Constants
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exchanging-data-with-a-csv-file">
     5.9.5. Exchanging Data With a CSV File
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#importing-data">
       5.9.5.1. Importing Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exporting-data">
       5.9.5.2. Exporting Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exchanging-data-with-an-excel-worksheet">
       5.9.5.3. Exchanging Data With an Excel Worksheet
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-or-writing-a-text-file">
     5.9.6. Reading or Writing a Text File
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#printing-results-on-a-printer">
     5.9.7. Printing Results on a Printer
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-a-graphical-user-interface">
     5.9.8. Using a Graphical User Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#requesting-values-from-the-keyboard">
     5.9.9. Requesting Values From the Keyboard
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quad-evaluated-input">
       5.9.9.1. Quad-Evaluated Input
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quote-quad-character-input">
       5.9.9.2. Quote-Quad Character Input
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fetching-data-from-the-web">
     5.9.10. Fetching Data From the Web
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#syntax-considerations">
   5.10. Syntax Considerations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comments-and-statement-separators">
     5.10.1. Comments and Statement Separators
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#comments">
       5.10.1.1. Comments
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statement-separators">
       5.10.1.2. Statement Separators
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-should-a-function-return-a-result">
     5.10.2. Why Should a Function Return a Result?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#different-types-of-functions">
     5.10.3. Different Types of Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-is-an-explicit-result">
       5.10.3.1. What Is an Explicit Result?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#six-major-types-of-functions-valence">
       5.10.3.2. Six Major Types of Functions (Valence)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ambivalent-functions">
       5.10.3.3. Ambivalent Functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-ambivalent-function">
       5.10.3.4. Example Ambivalent Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shy-result-in-a-tradfn">
       5.10.3.5. Shy Result in a Tradfn
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#an-argument-used-as-a-result">
       5.10.3.6. An Argument Used as a Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nested-argument-and-result">
     5.10.4. Nested Argument and Result
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nested-right-argument">
       5.10.4.1. Nested Right Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choice-of-syntax">
       5.10.4.2. Choice of Syntax
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nested-result">
       5.10.4.3. Nested Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choice-of-names">
     5.10.5. Choice of Names
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recursion">
   5.11. Recursion
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recursion-in-dfns">
     5.11.1. Recursion in Dfns
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assigning-names-to-functions">
   5.12. Assigning Names to Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-the-text-editor">
   5.13. About the Text Editor
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#invoking-the-text-editor">
     5.13.1. Invoking the Text Editor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-can-you-edit">
     5.13.2. What Can You Edit?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-can-you-do">
     5.13.3. What Can You Do?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cut-copy-paste">
       5.13.3.1. Cut / Copy / Paste
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#drag-drop-restrictions">
       5.13.3.2. Drag/Drop Restrictions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exit-the-editor">
       5.13.3.3. Exit the Editor
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#undo-redo-replay">
     5.13.4. Undo, Redo, Replay
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#undo">
       5.13.4.1. Undo
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#redo">
       5.13.4.2. Redo
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#replay-input-lines">
       5.13.4.3. Replay Input Lines
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#miscellaneous">
   5.14. Miscellaneous
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-of-variables-and-functions">
     5.14.1. List of Variables and Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-of-the-result">
     5.14.2. Use of the Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vector-representation">
     5.14.3. Vector Representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#source-code-management">
     5.14.4. Source Code Management
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises-on-tradfns">
   5.15. Exercises on Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-variants">
     5.15.1. Exercise Variants
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   5.16. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shadowed-names">
     5.16.1. Shadowed Names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scoping-in-nested-function-calls">
     5.16.2. Scoping in Nested Function Calls
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reading-the-caller-s-names">
       5.16.2.1. Reading the Caller’s Names
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modifying-the-caller-s-names">
       5.16.2.2. Modifying the Caller’s Names
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loop-control">
     5.16.3. Loop Control
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#labels-and-the-branch-arrow">
     5.16.4. Labels and the Branch Arrow
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#niladic-arrow">
       5.16.4.1. Niladic Arrow
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#branch-to-a-wrong-label">
       5.16.4.2. Branch to a Wrong Label
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-conditional-execution">
     5.16.5. Other Conditional Execution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conditional-execution-using-execute">
       5.16.5.1. Conditional Execution Using Execute
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conditional-execution-using-the-power-operator">
       5.16.5.2. Conditional Execution Using the Power Operator
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#name-category">
     5.16.6. Name Category
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bare-output">
     5.16.7. Bare Output
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ineach">
     5.16.8.
     <code class="docutils literal notranslate">
      <span class="pre">
       :InEach
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tail-recursion">
     5.16.9. Tail Recursion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   5.17. Solutions
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>User-Defined Functions</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#landmarks">
   5.1. Landmarks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-definitions">
     5.1.1. Some Definitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-your-environment">
     5.1.2. Configure Your Environment
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-do-you-need">
       5.1.2.1. What Do You Need?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-text-editor-what-for">
       5.1.2.2. A Text Editor; What For?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-dfns">
   5.2. Simple Dfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition">
     5.2.1. Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unnamed-dfns">
     5.2.2. Unnamed Dfns
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modifying-the-code">
     5.2.3. Modifying The Code
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-dfns">
   5.3. More on Dfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characteristics">
     5.3.1. Characteristics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-working-example">
     5.3.2. A Working Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#local-variables">
     5.3.3. Local Variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#default-left-argument">
     5.3.4. Default Left Argument
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#returning-the-result">
     5.3.5. Returning the Result
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises-on-dfns">
   5.4. Exercises on Dfns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dfns-in-depth">
   5.5. Dfns in Depth
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#guards">
     5.5.1. Guards
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shy-result">
     5.5.2. Shy Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lexical-scoping">
     5.5.3. Lexical Scoping
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tradfns">
   5.6. Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-first-example">
     5.6.1. A First Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-default-isn-t-local">
     5.6.2. The Default Isn’t Local
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-sub-functions">
     5.6.3. Defining Sub-Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-second-example">
     5.6.4. A Second Example
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#another-possible-syntax">
       5.6.4.1. Another Possible Syntax
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-scoping">
     5.6.5. Dynamic Scoping
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flow-control-in-tradfns">
   5.7. Flow Control in Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview">
     5.7.1. Overview
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-execution">
     5.7.2. Conditional Execution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-conditions-if-endif">
       5.7.2.1. Simple Conditions (
       <code class="docutils literal notranslate">
        <span class="pre">
         :If
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndIf
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#alternative-processing-if-else-endif">
       5.7.2.2. Alternative Processing (
       <code class="docutils literal notranslate">
        <span class="pre">
         :If
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Else
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndIf
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#composite-conditions-orif-andif">
       5.7.2.3. Composite Conditions (
       <code class="docutils literal notranslate">
        <span class="pre">
         :OrIf
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :AndIf
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cascading-conditions-elseif-else">
       5.7.2.4. Cascading Conditions (
       <code class="docutils literal notranslate">
        <span class="pre">
         :ElseIf
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Else
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#alternative-solutions">
       5.7.2.5. Alternative Solutions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disparate-conditions">
     5.7.3. Disparate Conditions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clauses-select-case-caselist">
       5.7.3.1. Clauses (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Select
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Case
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :CaseList
        </span>
       </code>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predefined-loops">
     5.7.4. Predefined Loops
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#basic-use-for-in-endfor">
       5.7.4.1. Basic Use (
       <code class="docutils literal notranslate">
        <span class="pre">
         :For
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :In
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndFor
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#control-of-iterations">
       5.7.4.2. Control of Iterations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-loops">
     5.7.5. Conditional Loops
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bottom-controlled-loop-repeat-until">
       5.7.5.1. Bottom-Controlled Loop (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Repeat
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :Until
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#top-controlled-loop-while-endwhile">
       5.7.5.2. Top-Controlled Loop (
       <code class="docutils literal notranslate">
        <span class="pre">
         :While
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndWhile
        </span>
       </code>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exception-control">
     5.7.6. Exception Control
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skip-to-the-next-iteration-continue">
       5.7.6.1. Skip to the Next Iteration (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Continue
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#leave-the-loop-leave">
       5.7.6.2. Leave the Loop (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Leave
        </span>
       </code>
       )
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#jump-to-another-statement-goto">
       5.7.6.3. Jump to Another Statement (
       <code class="docutils literal notranslate">
        <span class="pre">
         :GoTo
        </span>
       </code>
       )
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#jump-destinations">
         5.7.6.3.1. Jump Destinations
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quit-this-function-return">
       5.7.6.4. Quit This Function (
       <code class="docutils literal notranslate">
        <span class="pre">
         :Return
        </span>
       </code>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#endless-loops">
     5.7.7. Endless Loops
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-slow-function">
       5.7.7.1. A Slow Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#weak-and-strong-interrupts">
       5.7.7.2. Weak and Strong Interrupts
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-can-you-generate-an-interrupt">
       5.7.7.3. How Can You Generate an Interrupt
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-a-weak-interrupt">
       5.7.7.4. First a Weak Interrupt
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#and-now-a-strong-interrupt">
       5.7.7.5. And Now a Strong Interrupt
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#traditional-flow-control">
     5.7.8. Traditional Flow Control
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#equivalence-with-modern-flow-control">
       5.7.8.1. Equivalence With Modern Flow Control
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-destinations">
       5.7.8.2. Multiple Destinations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modern-and-traditional-controls-cooperate">
     5.7.9. Modern and Traditional Controls Cooperate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dfns-versus-tradfns">
   5.8. Dfns Versus Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison">
     5.8.1. Comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-cases">
     5.8.2. Use Cases
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#input-output-and-format">
   5.9. Input, Output and Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-input-and-output-methods">
     5.9.1. Some Input and Output Methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#format">
     5.9.2. Format
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#monadic-format">
       5.9.2.1. Monadic Format
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dyadic-format">
       5.9.2.2. Dyadic Format
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#displaying-intermediate-results">
     5.9.3. Displaying Intermediate Results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-global-variables">
     5.9.4. Using Global Variables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#global-constants">
       5.9.4.1. Global Constants
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exchanging-data-with-a-csv-file">
     5.9.5. Exchanging Data With a CSV File
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#importing-data">
       5.9.5.1. Importing Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exporting-data">
       5.9.5.2. Exporting Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exchanging-data-with-an-excel-worksheet">
       5.9.5.3. Exchanging Data With an Excel Worksheet
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-or-writing-a-text-file">
     5.9.6. Reading or Writing a Text File
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#printing-results-on-a-printer">
     5.9.7. Printing Results on a Printer
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-a-graphical-user-interface">
     5.9.8. Using a Graphical User Interface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#requesting-values-from-the-keyboard">
     5.9.9. Requesting Values From the Keyboard
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quad-evaluated-input">
       5.9.9.1. Quad-Evaluated Input
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quote-quad-character-input">
       5.9.9.2. Quote-Quad Character Input
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fetching-data-from-the-web">
     5.9.10. Fetching Data From the Web
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#syntax-considerations">
   5.10. Syntax Considerations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comments-and-statement-separators">
     5.10.1. Comments and Statement Separators
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#comments">
       5.10.1.1. Comments
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#statement-separators">
       5.10.1.2. Statement Separators
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-should-a-function-return-a-result">
     5.10.2. Why Should a Function Return a Result?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#different-types-of-functions">
     5.10.3. Different Types of Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-is-an-explicit-result">
       5.10.3.1. What Is an Explicit Result?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#six-major-types-of-functions-valence">
       5.10.3.2. Six Major Types of Functions (Valence)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ambivalent-functions">
       5.10.3.3. Ambivalent Functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-ambivalent-function">
       5.10.3.4. Example Ambivalent Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shy-result-in-a-tradfn">
       5.10.3.5. Shy Result in a Tradfn
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#an-argument-used-as-a-result">
       5.10.3.6. An Argument Used as a Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nested-argument-and-result">
     5.10.4. Nested Argument and Result
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nested-right-argument">
       5.10.4.1. Nested Right Argument
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choice-of-syntax">
       5.10.4.2. Choice of Syntax
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nested-result">
       5.10.4.3. Nested Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choice-of-names">
     5.10.5. Choice of Names
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recursion">
   5.11. Recursion
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recursion-in-dfns">
     5.11.1. Recursion in Dfns
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assigning-names-to-functions">
   5.12. Assigning Names to Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-the-text-editor">
   5.13. About the Text Editor
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#invoking-the-text-editor">
     5.13.1. Invoking the Text Editor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-can-you-edit">
     5.13.2. What Can You Edit?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-can-you-do">
     5.13.3. What Can You Do?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cut-copy-paste">
       5.13.3.1. Cut / Copy / Paste
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#drag-drop-restrictions">
       5.13.3.2. Drag/Drop Restrictions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exit-the-editor">
       5.13.3.3. Exit the Editor
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#undo-redo-replay">
     5.13.4. Undo, Redo, Replay
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#undo">
       5.13.4.1. Undo
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#redo">
       5.13.4.2. Redo
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#replay-input-lines">
       5.13.4.3. Replay Input Lines
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#miscellaneous">
   5.14. Miscellaneous
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-of-variables-and-functions">
     5.14.1. List of Variables and Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-of-the-result">
     5.14.2. Use of the Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vector-representation">
     5.14.3. Vector Representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#source-code-management">
     5.14.4. Source Code Management
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises-on-tradfns">
   5.15. Exercises on Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-variants">
     5.15.1. Exercise Variants
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   5.16. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shadowed-names">
     5.16.1. Shadowed Names
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scoping-in-nested-function-calls">
     5.16.2. Scoping in Nested Function Calls
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reading-the-caller-s-names">
       5.16.2.1. Reading the Caller’s Names
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modifying-the-caller-s-names">
       5.16.2.2. Modifying the Caller’s Names
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loop-control">
     5.16.3. Loop Control
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#labels-and-the-branch-arrow">
     5.16.4. Labels and the Branch Arrow
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#niladic-arrow">
       5.16.4.1. Niladic Arrow
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#branch-to-a-wrong-label">
       5.16.4.2. Branch to a Wrong Label
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-conditional-execution">
     5.16.5. Other Conditional Execution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conditional-execution-using-execute">
       5.16.5.1. Conditional Execution Using Execute
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conditional-execution-using-the-power-operator">
       5.16.5.2. Conditional Execution Using the Power Operator
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#name-category">
     5.16.6. Name Category
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bare-output">
     5.16.7. Bare Output
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ineach">
     5.16.8.
     <code class="docutils literal notranslate">
      <span class="pre">
       :InEach
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tail-recursion">
     5.16.9. Tail Recursion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   5.17. Solutions
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="user-defined-functions">
<span id="user-defined-functions-user-defined-functions"></span><h1><span class="section-number">5. </span>User-Defined Functions<a class="headerlink" href="#user-defined-functions" title="Permalink to this headline">#</a></h1>
<div class="section" id="landmarks">
<span id="user-defined-functions-landmarks"></span><h2><span class="section-number">5.1. </span>Landmarks<a class="headerlink" href="#landmarks" title="Permalink to this headline">#</a></h2>
<div class="section" id="some-definitions">
<span id="user-defined-functions-some-definitions"></span><h3><span class="section-number">5.1.1. </span>Some Definitions<a class="headerlink" href="#some-definitions" title="Permalink to this headline">#</a></h3>
<p>In previous chapters we made a distinction between the functions and operators which are part of APL, like <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">×</span></code>, <code class="docutils literal notranslate"><span class="pre">⌈</span></code> and <code class="docutils literal notranslate"><span class="pre">/</span></code> (we refer to them as <em>primitives</em>), and those functions and operators that are created by the user which are represented, not by a symbol, but by a name like <code class="docutils literal notranslate"><span class="pre">Average</span></code> (we say they are <em>user-defined</em>).</p>
<p>We also made an important distinction between <em>functions</em>, which apply to data and which return data, and <em>operators</em>, which apply to functions or data and produce <em>derived</em> functions (see <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-definition"><span class="std std-numref">Section 4.8.2</span></a>).</p>
<p>This means that we can distinguish between 4 major categories of processing tools:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Category</p></th>
<th class="text-align:left head"><p>Name</p></th>
<th class="text-align:center head"><p>Examples</p></th>
<th class="text-align:center head"><p>Refer to</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Built-in tools</p></td>
<td class="text-align:left"><p>Primitive functions</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">+</span></code> <code class="docutils literal notranslate"><span class="pre">×</span></code> <code class="docutils literal notranslate"><span class="pre">⌈</span></code> <code class="docutils literal notranslate"><span class="pre">⍴</span></code></p></td>
<td class="text-align:center"><p>Previous chapters</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p>Primitive operators</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">/</span></code></p></td>
<td class="text-align:center"><p><a class="reference internal" href="Operators.html"><span class="doc std std-doc">Chapter on <em>operators</em></span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>User-defined tools</p></td>
<td class="text-align:left"><p><em>User-defined functions</em></p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">Average</span></code></p></td>
<td class="text-align:center"><p>This chapter</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p>User-defined operators</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><a class="reference internal" href="Operators.html#operators-user-defined-operators"><span class="std std-numref">Section 11.13</span></a></p></td>
</tr>
</tbody>
</table>
<p>This chapter is devoted to user-defined <em>functions</em>. The subject of user-defined <em>operators</em> will be covered later.</p>
<p>We can further categorise user-defined functions according to the way they process data. Firstly we can distinguish between <em>direct</em> and <em>procedural</em> <strong>functions</strong>:</p>
<ul class="simple">
<li><p><em>direct</em> functions (commonly referred to as <em>dfns</em>) are defined in a very formal manner; they are usually designed for pure calculation, without any external or user interfaces. <em>Dfns</em> do not allow loops except by recursion and have limited options for conditional programming; and</p></li>
<li><p><em>procedural</em> functions (commonly referred to as <em>tradfns</em>, short for <em>traditional functions</em>) are less formal and look much more like programs written in other languages; they provide greater flexibility for building major applications which involve user interfaces, access to files or databases and other external interfaces. <em>Tradfns</em> may take no arguments and behave like scripts.</p></li>
</ul>
<p>Even though you may write entire systems with dfns, you might prefer to restrict their use to encapsulate statements that, together, perform some meaningful operation on the data given. We will start by covering the syntax and characteristics of dfns, then we will do the same for tradfns, and then <a class="reference internal" href="#user-defined-functions-dfns-versus-tradfns"><span class="std std-numref">Section 5.8</span></a> will compare the main characteristics of both of them, to help you understand when and why each should be used.</p>
<p>The second distinction we can make concerns the number of arguments a user-defined function can have.</p>
<ul class="simple">
<li><p><em>dyadic</em> functions take two arguments which are placed on either side of the function (<code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">f</span> <span class="pre">Y</span></code>);</p></li>
<li><p><em>monadic</em> functions take a single argument which is placed to the right of the function (<code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">Y</span></code>);</p></li>
<li><p><em>niladic</em> functions take no argument at all; and</p></li>
<li><p><em>ambivalent</em> functions are dyadic functions whose left argument is optional.</p></li>
</ul>
</div>
<div class="section" id="configure-your-environment">
<span id="user-defined-functions-configure-your-environment"></span><h3><span class="section-number">5.1.2. </span>Configure Your Environment<a class="headerlink" href="#configure-your-environment" title="Permalink to this headline">#</a></h3>
<p>Dyalog APL has a highly configurable development and debugging environment, designed to fit the requirements of very different kinds of programmers. This environment is controlled by configuration parameters; let us determine which context will suit you best.</p>
<div class="section" id="what-do-you-need">
<span id="user-defined-functions-what-do-you-need"></span><h4><span class="section-number">5.1.2.1. </span>What Do You Need?<a class="headerlink" href="#what-do-you-need" title="Permalink to this headline">#</a></h4>
<p>All you need (except for love) is:</p>
<ul class="simple">
<li><p>a window in which to type expressions that you want to be executed (white Session window);</p></li>
<li><p>one or more windows in which to create/modify user-defined functions (grey Edit windows); and</p></li>
<li><p>one or more windows to debug execution errors (black Trace window).</p></li>
</ul>
<p>The colours above refer to the positions of the windows in <a class="reference internal" href="#fig-ide-window-layout"><span class="std std-numref">Fig. 5.1</span></a>, <a class="reference internal" href="#fig-ide-window-horizontal-layout"><span class="std std-numref">Fig. 5.2</span></a>, and <a class="reference internal" href="#fig-ide-floating-window-layout"><span class="std std-numref">Fig. 5.3</span></a>.</p>
<p>The default configuration is consistent with other software development tools and in it is possible to divide the session window into three parts which can be resized, as shown in <a class="reference internal" href="#fig-ide-window-layout"><span class="std std-numref">Fig. 5.1</span></a>:</p>
<div class="figure align-default" id="ide-window-layout">
<span id="fig-ide-window-layout"></span><img alt="_images/IDE_Window_Layout.png" src="_images/IDE_Window_Layout.png" />
<p class="caption"><span class="caption-number">Fig. 5.1 </span><span class="caption-text">The default window configuration.</span><a class="headerlink" href="#ide-window-layout" title="Permalink to this image">#</a></p>
</div>
<p>This configuration provides a single Edit window and a single Trace window, each of which is “docked” along one of the Session window borders. You can dock these windows along any of the Session window sides. For example, <a class="reference internal" href="#fig-ide-window-horizontal-layout"><span class="std std-numref">Fig. 5.2</span></a> shows a configuration with three horizontal panes, highly suitable for entering and editing very long statements.</p>
<div class="figure align-default" id="ide-window-horizontal-layout">
<span id="fig-ide-window-horizontal-layout"></span><img alt="_images/IDE_Window_Horizontal_Layout.png" src="_images/IDE_Window_Horizontal_Layout.png" />
<p class="caption"><span class="caption-number">Fig. 5.2 </span><span class="caption-text">The Edit and Trace windows in a horizontal layout.</span><a class="headerlink" href="#ide-window-horizontal-layout" title="Permalink to this image">#</a></p>
</div>
<p>The Edit window supports the <em>Multiple Document Interface</em> (MDI). This means that you can work on more than one function at a time:</p>
<ul class="simple">
<li><p>on the Windows interpreter you can use the “Window” menu to <em>Tile</em> and <em>Cascade</em>, or you can maximise any one of the functions to concentrate solely upon it; or</p></li>
<li><p>if you are using RIDE the default behaviour is to open a tab per item you are editing.</p></li>
</ul>
<p>If you are working on a relatively small screen you may find that you prefer to work with “floating” windows in a layout similar to the one in <a class="reference internal" href="#fig-ide-floating-window-layout"><span class="std std-numref">Fig. 5.3</span></a>:</p>
<div class="figure align-default" id="ide-floating-window-layout">
<span id="fig-ide-floating-window-layout"></span><img alt="_images/IDE_Floating_Window_Layout.png" src="_images/IDE_Floating_Window_Layout.png" />
<p class="caption"><span class="caption-number">Fig. 5.3 </span><span class="caption-text">“floating” windows layout.</span><a class="headerlink" href="#ide-floating-window-layout" title="Permalink to this image">#</a></p>
</div>
<ul class="simple">
<li><p>on the Windows interpreter, you can either:</p>
<ul>
<li><p>grab the border of a sub-window (Edit or Trace) and then drag and drop it in the middle of the session window, as an independent floating window; or</p></li>
<li><p>enable the “Classic Dyalog mode”, which can be set under “Options” ⇨ “Configure…” ⇨ “Trace/Edit” as shown in <a class="reference internal" href="#fig-ide-configure-classic-mode"><span class="std std-numref">Fig. 5.4</span></a>.</p></li>
</ul>
</li>
</ul>
<div class="figure align-default" id="ide-configure-classic-mode">
<span id="fig-ide-configure-classic-mode"></span><img alt="_images/IDE_Configure_Classic_Mode.png" src="_images/IDE_Configure_Classic_Mode.png" />
<p class="caption"><span class="caption-number">Fig. 5.4 </span><span class="caption-text">Option to set “Classic Dyalog mode”.</span><a class="headerlink" href="#ide-configure-classic-mode" title="Permalink to this image">#</a></p>
</div>
<ul class="simple">
<li><p>if you are using RIDE you can go to “Edit” ⇨ “Preferences” ⇨ “Windows” and enable “Floating windows” as shown in <a class="reference internal" href="#fig-ride-configure-floating-windows"><span class="std std-numref">Fig. 5.5</span></a>:</p></li>
</ul>
<div class="figure align-default" id="ride-configure-floating-windows">
<span id="fig-ride-configure-floating-windows"></span><img alt="_images/RIDE_Configure_Floating_Windows.png" src="_images/RIDE_Configure_Floating_Windows.png" />
<p class="caption"><span class="caption-number">Fig. 5.5 </span><span class="caption-text">Enable “floating” windows in RIDE.</span><a class="headerlink" href="#ride-configure-floating-windows" title="Permalink to this image">#</a></p>
</div>
<p>Working with floating windows has the added benefit of allowing you to have a stack of trace windows (as opposed to a single trace window), showing which functions call which other. This will be explored in <a class="reference internal" href="First-Aid-Kit.html#first-aid-kit-choose-your-configuration"><span class="std std-numref">Section 6.3.2</span></a>.</p>
</div>
<div class="section" id="a-text-editor-what-for">
<span id="user-defined-functions-a-text-editor-what-for"></span><h4><span class="section-number">5.1.2.2. </span>A Text Editor; What For?<a class="headerlink" href="#a-text-editor-what-for" title="Permalink to this headline">#</a></h4>
<p>Some dfns can be defined by a single expression and so are easy to define inside the session. We used this technique before to define a function named <code class="docutils literal notranslate"><span class="pre">Average</span></code> and here we do it again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Average</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>However, as one defines more complex functions, it can become more complicated to define dfns in the session window.</p>
<p>For one, the ability to define multi-line dfns in the session was only made available with Dyalog 18.0. In these notebooks you can see that multi-line dfns are defined in cells that start with <code class="docutils literal notranslate"><span class="pre">]dinput</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Average</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷≢</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>In the Windows interpreter an expression like the one above might result in a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code>, as you type <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">←</span> <span class="pre">{</span></code>, then hit <kbd>Enter</kbd> to change line, and then the interpreter tries to execute the line you entered, instead of allowing you to continue the definition of <code class="docutils literal notranslate"><span class="pre">Average</span></code>. To change this behaviour and allow for multi-line dfns, you can go to “Options” ⇨ “Configure…” ⇨ “Session” and check the experimental multi-line input box at the bottom. (If you are reading this and this book is old enough, the “<em>experimental</em>” multi-line input may no longer be <em>experimental</em>.)</p>
<p>If you are using RIDE and this capability is not ON by default, you can turn it ON by setting the <code class="docutils literal notranslate"><span class="pre">DYALOG_LINEEDITOR_MODE</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">1</span></code> in the connection menu, like demonstrated in <a class="reference internal" href="#fig-ride-enable-multiline-input"><span class="std std-numref">Fig. 5.6</span></a>.</p>
<div class="figure align-default" id="ride-enable-multiline-input">
<span id="fig-ride-enable-multiline-input"></span><img alt="_images/RIDE_Enable_Multiline_Input.png" src="_images/RIDE_Enable_Multiline_Input.png" />
<p class="caption"><span class="caption-number">Fig. 5.6 </span><span class="caption-text">Configuring RIDE to allow for multi-line input.</span><a class="headerlink" href="#ride-enable-multiline-input" title="Permalink to this image">#</a></p>
</div>
<p>Despite multi-line input, it is easier and more appropriate to edit multi-line dfns and tradfns in a suitable text editor. The built-in editors for the Windows interpreter and for RIDE are likely to be suitable for you, but other alternatives exist. You can find an enumeration of most of the available alternatives over at <a class="reference external" href="https://aplwiki.com/wiki/Text_editors">the APL Wiki</a>. We will also cover this in more depth in <span class="xref myst">the chapter about source code management</span>.</p>
</div>
</div>
</div>
<div class="section" id="simple-dfns">
<span id="user-defined-functions-simple-dfns"></span><h2><span class="section-number">5.2. </span>Simple Dfns<a class="headerlink" href="#simple-dfns" title="Permalink to this headline">#</a></h2>
<div class="section" id="definition">
<span id="user-defined-functions-definition"></span><h3><span class="section-number">5.2.1. </span>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">#</a></h3>
<p>Dfns are a set of statements enclosed by curly braces <code class="docutils literal notranslate"><span class="pre">{}</span></code>, so a simple dfn is typically created with the syntax <code class="docutils literal notranslate"><span class="pre">Name</span> <span class="pre">←</span> <span class="pre">{</span> <span class="pre">definition</span> <span class="pre">}</span></code> where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Name</span></code> is the function name. It is followed by a definition, delimited by a pair of curly braces <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code>. This definition may make use of one or two variables named <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code>, which represent the values to be processed. <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code> are called <em>arguments</em> of the function;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍵</span></code> (<kbd>APL</kbd>+<kbd>w</kbd>) is a generic symbol which represents the right argument of the function; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍺</span></code> (<kbd>APL</kbd>+<kbd>a</kbd>) is a generic symbol which represents the left argument if the function is dyadic.</p></li>
</ul>
<p>Here is an example monadic dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Average</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>And here are two more dyadic dfns, and an example showing how they can be used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Plus</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">Times</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="m">3</span><span class="w"> </span><span class="nv">Times</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">48
</span></div></div>
</div>
<p>Notice the final statement above is strictly equivalent to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">48
</span></div></div>
</div>
<p>as the order of evaluation is the same.</p>
<p>The arguments <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code> are read-only (they cannot be reassigned) and are limited in scope to only being visible within the function itself. The only exception to the “read-only rule” is when providing a default left argument to the dfn, which we’ll cover in <a class="reference internal" href="#user-defined-functions-default-left-argument"><span class="std std-numref">Section 5.3.4</span></a>.</p>
<p>The developer does not need to declare anything about the shape or internal representation of the arguments and the result. This information is automatically obtained from the arrays provided as its arguments. This is similar to the behaviour of dynamically typed programming languages, such as Python or Javascript. So, our functions can work on any arrays.</p>
<p>A scalar added to a matrix returns a matrix. No need to specify it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">12</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 14 15
16 17 18
</span></div></div>
</div>
<p>And a vector of integer numbers multiplied by a scalar fractional number returns a vector of fractional numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7.3</span><span class="w"> </span><span class="nv">Times</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">34</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">16</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">73 248.2 379.6 116.8
</span></div></div>
</div>
<p>These simple dfns are well suited for pure calculations of straightforward array manipulation. For example, here is how we can calculate the hypotenuse of a right-angled triangle from the lengths of the two other sides:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Hypo</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="o">*</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="m">0.5</span><span class="kt">}</span><span class="w"></span>
<span class="nv">Hypo</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Hypo</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13
</span></div></div>
</div>
</div>
<div class="section" id="unnamed-dfns">
<span id="user-defined-functions-unnamed-dfns"></span><h3><span class="section-number">5.2.2. </span>Unnamed Dfns<a class="headerlink" href="#unnamed-dfns" title="Permalink to this headline">#</a></h3>
<p>A dfn can be defined and then discarded immediately after it has been used, in which case it does not need a name. For example, the geometric mean of a set of n values is defined as the nth root of their product. The function can be defined and used inline like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">*÷≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7.8657
</span></div></div>
</div>
<p>But because we didn’t assign it to a name, it was discarded after being used and can’t be used again. This kind of function is similar to <em>inline</em>, <em>anonymous</em> or <em>lambda</em> functions in other languages.</p>
<p>A special case is <code class="docutils literal notranslate"><span class="pre">{}</span></code>. This function does nothing, but placed at the left of an expression, it can be used to prevent the result of the expression from being displayed on the screen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{}</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="modifying-the-code">
<span id="user-defined-functions-modifying-the-code"></span><h3><span class="section-number">5.2.3. </span>Modifying The Code<a class="headerlink" href="#modifying-the-code" title="Permalink to this headline">#</a></h3>
<p>Single line dfns may be modified using the function editor, as will be explained in the next section. They can also be redefined entirely, as many times as necessary, as shown:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Magic</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">+</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Magic</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">÷+</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Magic</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍺</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We defined <code class="docutils literal notranslate"><span class="pre">Magic</span></code> and then changed it twice. Only the most recent definition will survive.</p>
<p>Now we will delve into how to define and use more complex dfns. For this we will explore the built-in editor that comes with your interpreter and you will also learn some more syntax to empower your dfns.</p>
</div>
</div>
<div class="section" id="more-on-dfns">
<span id="user-defined-functions-more-on-dfns"></span><h2><span class="section-number">5.3. </span>More on Dfns<a class="headerlink" href="#more-on-dfns" title="Permalink to this headline">#</a></h2>
<p>The dfns we wrote in the previous section were very simple and consisted of a single statement. We will now use the text editor to define multi-line dfns.</p>
<div class="section" id="characteristics">
<span id="user-defined-functions-characteristics"></span><h3><span class="section-number">5.3.1. </span>Characteristics<a class="headerlink" href="#characteristics" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Generally, the opening and closing braces are placed alone on the first and last lines. This is not mandatory, it is just a convention;</p></li>
<li><p>dfns might be commented at will;</p></li>
<li><p>one can create as many variables as needed: they are automatically deemed to be local variables, which means they only exist while inside the dfn. Note that this is opposite to the default behaviour of tradfns, where all variables are global (cf. <a class="reference internal" href="#user-defined-functions-local-variables"><span class="std std-numref">Section 5.3.3</span></a> and <a class="reference internal" href="#user-defined-functions-the-default-isnt-local"><span class="std std-numref">Section 5.6.2</span></a>);</p></li>
<li><p>the arguments <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code> retain the values passed to them as arguments and may not be changed. Any attempt to modify them causes a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code> to be reported, except when <em>defaulting the left argument</em> (cf. <a class="reference internal" href="#user-defined-functions-default-left-argument"><span class="std std-numref">Section 5.3.4</span></a>);</p></li>
<li><p>as soon as an expression generates a result that is not assigned to a name or used in any other way, the function terminates, and the value of that expression is returned as the result of the function. If the function contains more lines they will not be executed (cf. <a class="reference internal" href="#user-defined-functions-returning-the-result"><span class="std std-numref">Section 5.3.5</span></a>); and</p></li>
<li><p>traditional <em>control structures</em> and <em>branching</em> cannot be used in dfns (cf. <a class="reference internal" href="#user-defined-functions-guards"><span class="std std-numref">Section 5.5.1</span></a>).</p></li>
</ul>
<p>We will explore these characteristics in the following sections.</p>
</div>
<div class="section" id="a-working-example">
<span id="user-defined-functions-a-working-example"></span><h3><span class="section-number">5.3.2. </span>A Working Example<a class="headerlink" href="#a-working-example" title="Permalink to this headline">#</a></h3>
<p>As an example, let us see how we could define a function to calculate the <em>harmonic mean</em> of a vector of numbers. The harmonic mean of a vector is the inverse of the sum of the inverses of the numbers in the vector. This will become clearer when you see the code.</p>
<p>First of all, we must choose a name for our new function. We will choose to name it <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code>.</p>
<p>Among the multiple ways of invoking the text editor, let us use a very simple one: type the command <code class="docutils literal notranslate"><span class="pre">)ed</span></code> followed by a space and the name of the function to create: <code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">HarmonicMean</span></code>.</p>
<p>Unless you already redefined the defaults, a mostly empty window should open to the right of the session. We include an example screenshot of such a window from the Windows interpreter, in <a class="reference internal" href="#fig-win-editor"><span class="std std-numref">Fig. 5.7</span></a>:</p>
<div class="figure align-default" id="win-editor">
<span id="fig-win-editor"></span><img alt="_images/Win_Editor.png" src="_images/Win_Editor.png" />
<p class="caption"><span class="caption-number">Fig. 5.7 </span><span class="caption-text">The edit window opened by the command <code class="docutils literal notranslate"><span class="pre">)ED</span> <span class="pre">HarmonicMean</span></code>.</span><a class="headerlink" href="#win-editor" title="Permalink to this image">#</a></p>
</div>
<p>Now that we have a window in which to define our dfn, we can go ahead and implement the harmonic mean. We shall split the process into a series of simple steps, as shown in <a class="reference internal" href="#fig-win-editor-harmonic-mean"><span class="std std-numref">Fig. 5.8</span></a>: calculate the inverses, sum them, invert the sum.</p>
<div class="figure align-default" id="win-editor-harmonic-mean">
<span id="fig-win-editor-harmonic-mean"></span><img alt="_images/Win_Editor_Harmonic_Mean.png" src="_images/Win_Editor_Harmonic_Mean.png" />
<p class="caption"><span class="caption-number">Fig. 5.8 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function defined in the edit window.</span><a class="headerlink" href="#win-editor-harmonic-mean" title="Permalink to this image">#</a></p>
</div>
<p>We also define it in this notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">HarmonicMean</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">inverses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">÷</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">sum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">inverses</span><span class="w"></span>
<span class="w">    </span><span class="o">÷</span><span class="nv">sum</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now that we know how to compute the harmonic mean of a vector of numbers, we just have to <em>fix</em> it so that we can use it in our session. <em>Fixing</em> a function is somewhat analogous to compilation in other programming languages, but can also be seen as a sort of “File save” followed by an “import” in interpreted languages. There are many ways to fix a function:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Interpreter</p></th>
<th class="text-align:left head"><p><em>Fix</em> method</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Windows interpreter</p></td>
<td class="text-align:left"><p>go to “File” ⇨ “Fix”</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>RIDE</p></td>
<td class="text-align:left"><p>right-click the edit window ⇨ “Fix”</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>both</p></td>
<td class="text-align:left"><p>press <kbd>Esc</kbd> (also closes the edit window)</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>both</p></td>
<td class="text-align:left"><p>define a custom keyboard shortcut</p></td>
</tr>
</tbody>
</table>
<p>Following one of the appropriate methods should make the <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function available for use in the session window. You can make sure it worked by simply typing in the name of the function and pressing <kbd>Enter</kbd> in the session:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">{
     inverses←÷⍵
     sum←+/inverses
     ÷sum
 }
</span></div></div>
</div>
<p>If instead of getting the source code of the function you get a <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code>, then the function wasn’t properly fixed.</p>
<p>Now that we can compute the harmonic mean of a vector of numbers, we can answer questions like the following:</p>
<p>“<em>If I take 6 hours to paint a wall and you take 2 hours, how much time will we need to paint the wall if we do it together?</em>”</p>
<p>This type of question can be answered by taking the harmonic mean of the individual times:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.5
</span></div></div>
</div>
<p>So the two of us would take one and a half hours to paint the whole wall.</p>
<p>Similarly, if we had further help from two people who could paint the whole wall in 4 and 5 hours, respectively, the four of us would need</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">times</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="o">⊢</span><span class="nv">hours</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="nv">times</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
<p>hours, or approximately</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="m">60</span><span class="o">×</span><span class="nv">hours</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">53
</span></div></div>
</div>
<p>minutes.</p>
<p>After using your function for a bit you realise it is over-complicated, in the sense that it involves too many intermediate steps and you wish to get rid of those. If your edit window is still open, you can simply edit the function and fix it again. If the edit window was closed, you can type <code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">HarmonicMean</span></code> again or you can double-click the name <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> in the session. Both options will open the appropriate edit window.</p>
<p>After having done so, perhaps you rewrite your function to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">HarmonicMean</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">inverses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">÷</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Then you fix it and use it again a couple of times:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="nv">times</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DOMAIN ERROR: Divide by zero
HarmonicMean[1] inverses←÷⍵
                         ∧
</pre></div>
</div>
</div>
</div>
<p>But now it resulted in an error, and the error messages says <code class="docutils literal notranslate"><span class="pre">HarmonicMean[1]</span> <span class="pre">inverses←÷⍵</span></code>. This <code class="docutils literal notranslate"><span class="pre">HarmonicMean[1]</span></code> means the error was in line 1 of the <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function. Right next to it, it also shows the part of the code that caused the error, but suppose you had a really long file, perhaps with multiple functions. How would you find the appropriate line in the first place?</p>
<p>Thankfully, both RIDE and the Windows interpreter have an option that can be set to display line numbers (cf. <a class="reference internal" href="#fig-win-editor-toggle-line-numbers"><span class="std std-numref">Fig. 5.9</span></a> and <a class="reference internal" href="#fig-ride-editor-toggle-line-numbers"><span class="std std-numref">Fig. 5.10</span></a>).</p>
<div class="figure align-default" id="win-editor-toggle-line-numbers">
<span id="fig-win-editor-toggle-line-numbers"></span><img alt="_images/Win_Editor_Toggle_Line_Numbers.png" src="_images/Win_Editor_Toggle_Line_Numbers.png" />
<p class="caption"><span class="caption-number">Fig. 5.9 </span><span class="caption-text">Option to toggle line numbers in RIDE (to the right) and the Windows interpreter (to the left).</span><a class="headerlink" href="#win-editor-toggle-line-numbers" title="Permalink to this image">#</a></p>
</div>
<div class="figure align-default" id="ride-editor-toggle-line-numbers">
<span id="fig-ride-editor-toggle-line-numbers"></span><img alt="_images/RIDE_Editor_Toggle_Line_Numbers.png" src="_images/RIDE_Editor_Toggle_Line_Numbers.png" />
<p class="caption"><span class="caption-number">Fig. 5.10 </span><span class="caption-text">Option to toggle line numbers in RIDE, currently OFF.</span><a class="headerlink" href="#ride-editor-toggle-line-numbers" title="Permalink to this image">#</a></p>
</div>
<p>Different people like to comment their code in different ways, and naturally dfns can be commented. For illustrative purposes, consider the dfn that follows, which has comments before any statement, inline with some statements, between the statements and at the end of the dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">HarmonicMean</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">⍝ Monadic function to compute the harmonic mean of a vector</span><span class="w"></span>
<span class="w">    </span><span class="nv">inverses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">÷</span><span class="bp">⍵</span><span class="w">   </span><span class="c1">⍝ This inverts the numbers in the argument</span><span class="w"></span>
<span class="w">    </span><span class="c1">⍝ and then</span><span class="w"></span>
<span class="w">    </span><span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span><span class="w">     </span><span class="c1">⍝ we sum those inverses and return them.</span><span class="w"></span>
<span class="w">    </span><span class="c1">⍝ Of course this will give an error if 0 is in the input argument.</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The comments do <em>not</em> affect the behaviour of the function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="nv">times</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
</div>
<div class="section" id="local-variables">
<span id="user-defined-functions-local-variables"></span><h3><span class="section-number">5.3.3. </span>Local Variables<a class="headerlink" href="#local-variables" title="Permalink to this headline">#</a></h3>
<p>Notice that our <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function makes use of an intermediate variable, <code class="docutils literal notranslate"><span class="pre">inverses</span></code>. Let us check its value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: inverses
      inverses
      ∧
</pre></div>
</div>
</div>
</div>
<p>We got a <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code> because <code class="docutils literal notranslate"><span class="pre">inverses</span></code> isn’t defined. It is a <em>local variable</em>, that is, a variable that lives within the dfn only while the dfn is being executed. As soon as we exit the dfn the variable stops existing.</p>
<p>The notion of <em>local</em> variable is opposed to the notion of <em>global variable</em>, which is a variable that lives in the session and thus can be accessed from anywhere. Useful global variables are functions themselves, because defining them globally means they can be used from within other functions.</p>
<p>As an example, we already defined the functions <code class="docutils literal notranslate"><span class="pre">Average</span></code> and <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> in the session. Let us now define a dfn named <code class="docutils literal notranslate"><span class="pre">AMHM</span></code> that checks empirically a mathematical theorem: that the arithmetic mean is always larger than or equal to the harmonic mean of a set of numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">AMHM</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">am</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Average</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">hm</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">am</span><span class="w"> </span><span class="o">≥</span><span class="w"> </span><span class="nv">hm</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">AMHM</span><span class="w"> </span><span class="o">⍳</span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">AMHM</span><span class="w"> </span><span class="nv">times</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Notice how the definition of <code class="docutils literal notranslate"><span class="pre">AMHM</span></code> uses both the <code class="docutils literal notranslate"><span class="pre">Average</span></code> and <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> dfns without defining them inside <code class="docutils literal notranslate"><span class="pre">AMHM</span></code>. This works because they were previously defined in the session.</p>
<p>For larger applications, proper source code management is needed and you should make sure the functions <code class="docutils literal notranslate"><span class="pre">Average</span></code> and <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> have been fixed when you use them inside <code class="docutils literal notranslate"><span class="pre">AMHM</span></code>, but that is a concern for later.</p>
</div>
<div class="section" id="default-left-argument">
<span id="user-defined-functions-default-left-argument"></span><h3><span class="section-number">5.3.4. </span>Default Left Argument<a class="headerlink" href="#default-left-argument" title="Permalink to this headline">#</a></h3>
<p>It was mentioned above that the values of <code class="docutils literal notranslate"><span class="pre">⍺</span></code> and <code class="docutils literal notranslate"><span class="pre">⍵</span></code>, the variables that represent the arguments to a dfn, cannot be assigned to. The only exception to this is when specifying a default left argument. This is relevant because a dyadic dfn can always be used monadically, as from the syntactic point of view its left argument <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is always optional. If the left argument is not present it is possible to assign a default value to <code class="docutils literal notranslate"><span class="pre">⍺</span></code> by means of a normal assignment. If <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is given a value because the dfn was called dyadically, such assignment is skipped.</p>
<p>Consider a function which calculates the nth root of a number, but which is normally used to calculate square roots. You can specify that the default value of the left argument (when omitted) is 2, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Root</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">*÷</span><span class="bp">⍺</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If we don’t specify the left argument of <code class="docutils literal notranslate"><span class="pre">Root</span></code>, it computes the square root. <code class="docutils literal notranslate"><span class="pre">Root</span></code> is thus said to be an ambivalent function, because it can be used both monadically and dyadically (cf. <a class="reference internal" href="#user-defined-functions-ambivalent-functions"><span class="std std-numref">Section 5.10.3.3</span></a>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Root</span><span class="w"> </span><span class="m">625</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">25
</span></div></div>
</div>
<p>But if we specify <code class="docutils literal notranslate"><span class="pre">⍺</span></code>, then the <code class="docutils literal notranslate"><span class="pre">⍺</span> <span class="pre">←</span> <span class="pre">2</span></code> assignment is skipped:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="nv">Root</span><span class="w"> </span><span class="m">625</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<p>Because the assignment with <code class="docutils literal notranslate"><span class="pre">⍺←</span></code> is skipped entirely if <code class="docutils literal notranslate"><span class="pre">⍺</span></code> was provided, you should be careful with any side effects the expression to the right of <code class="docutils literal notranslate"><span class="pre">⍺←</span></code> might produce. We illustrate this with the following (silly) example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Silly</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w">        </span><span class="c1">⍝ This assignment always happens</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w">    </span><span class="c1">⍝ Not executed if ⍺ already has a value</span><span class="w"></span>
<span class="w">    </span><span class="nv">a</span><span class="w">            </span><span class="c1">⍝ Return a</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Silly</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<p>Because we didn’t provide a left argument, the <code class="docutils literal notranslate"><span class="pre">⍺</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">←</span> <span class="pre">2</span></code> line is executed and <code class="docutils literal notranslate"><span class="pre">a</span></code> becomes 2.</p>
<p>On the other hand, if we provide a left argument the <code class="docutils literal notranslate"><span class="pre">⍺</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">←</span> <span class="pre">2</span></code> line is skipped and <code class="docutils literal notranslate"><span class="pre">a</span></code> remains 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="nv">Silly</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>As for <code class="docutils literal notranslate"><span class="pre">⍵</span></code>, attempting to assign to <code class="docutils literal notranslate"><span class="pre">⍵</span></code> makes no sense: a dfn is always called monadically <em>or</em> dyadically, so the right argument is <em>always</em> present. Here’s a function that computes the square root of <code class="docutils literal notranslate"><span class="pre">⍵</span></code>, except that first it tries to assign 10 to <code class="docutils literal notranslate"><span class="pre">⍵</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">RootOf10</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">*</span><span class="m">0.5</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Simply typing the name of the function shows its code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RootOf10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">{
     ⍵←10
     ⍵*0.5
 }
</span></div></div>
</div>
<p>And calling it monadically raises an error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RootOf10</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SYNTAX ERROR
RootOf10[1] ⍵←10
             ∧
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="returning-the-result">
<span id="user-defined-functions-returning-the-result"></span><h3><span class="section-number">5.3.5. </span>Returning the Result<a class="headerlink" href="#returning-the-result" title="Permalink to this headline">#</a></h3>
<p>We mentioned above that a dfn executes its statements until the first statement that does not assign its value. Here is a curious dfn with 4 statements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Count</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="m">3</span><span class="w"></span>
<span class="w">    </span><span class="m">10</span><span class="o">÷</span><span class="m">0</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Notice that all four statements are simple. If we run <code class="docutils literal notranslate"><span class="pre">Count</span></code>, what will the result be?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Count</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The result we get is 1 because the first statement evaluates to 1 (obviously) and then we do nothing with it, so that is what the dfn returns. It doesn’t matter what we wrote afterwards and it doesn’t even matter that the very last statement would give a <code class="docutils literal notranslate"><span class="pre">DOMAIN</span> <span class="pre">ERROR</span></code>.</p>
<p>These superfluous statements should be avoided, as they will sooner or later cause unnecessary confusion.</p>
<p>As a basic debugging tool, it is possible to modify statements to display intermediate results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Count</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="m">3</span><span class="w"></span>
<span class="w">    </span><span class="m">10</span><span class="o">÷</span><span class="m">0</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Count</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
2
3
DOMAIN ERROR: Divide by zero
Count[4] 10÷0
           ∧
</pre></div>
</div>
</div>
</div>
<p>Be careful: by using <code class="docutils literal notranslate"><span class="pre">⎕←</span></code> to display intermediate results, suddenly we are doing <em>something</em> with the superfluous statements and they are all being executed (we even reached the error statement).</p>
<p>And even if we remove the statement that gives an error, the function will still return something other than the original 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Count</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="m">3</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Count</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
2
3
</span></div></div>
</div>
<p>Now the function returned 3 instead of 1! So always be careful with which statement is actually giving the final result and avoid any extraneous statements.</p>
</div>
</div>
<div class="section" id="exercises-on-dfns">
<span id="user-defined-functions-exercises-on-dfns"></span><h2><span class="section-number">5.4. </span>Exercises on Dfns<a class="headerlink" href="#exercises-on-dfns" title="Permalink to this headline">#</a></h2>
<p>You are ready to solve simple problems. We <strong>strongly recommend</strong> that you try to solve all the following exercises before you continue further in this chapter.
Many of the exercises are followed by some examples you can use to check your work.</p>
<div class="exercise admonition" id="ex-extract">

<p class="admonition-title"><span class="caption-number">Exercise 5.1 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">Extract</span></code> which returns the first <code class="docutils literal notranslate"><span class="pre">⍺</span></code> items of any given vector <code class="docutils literal notranslate"><span class="pre">⍵</span></code>.</p>
</div>
</div>
<p>Here are some examples:</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">18</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">45 86 31
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">45</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">18</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="s1">&#39;can you do it?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">can yo
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;can yo&#39;</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="s1">&#39;can you do it?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-ignore">

<p class="admonition-title"><span class="caption-number">Exercise 5.2 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">Ignore</span></code> which ignores the first <code class="docutils literal notranslate"><span class="pre">⍺</span></code> items of any given vector <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and only returns the remainder.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">18</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20 75 62 18
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">20</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">18</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="s1">&#39;can you do it?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">u do it?
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;u do it?&#39;</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="s1">&#39;can you do it?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-reverse">

<p class="admonition-title"><span class="caption-number">Exercise 5.3 </span></p>
<div class="section" id="exercise-content">
<p>Write a monadic function <code class="docutils literal notranslate"><span class="pre">Reverse</span></code> which returns the items of a vector in reverse order.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Reverse</span><span class="w"> </span><span class="s1">&#39;snoitalutargnoc&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">congratulations
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Reverse</span><span class="w"> </span><span class="s1">&#39;!ti did uoY&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You did it!
</span></div></div>
</div>
<div class="exercise admonition" id="ex-totalise">

<p class="admonition-title"><span class="caption-number">Exercise 5.4 </span></p>
<div class="section" id="exercise-content">
<p>Write a monadic function <code class="docutils literal notranslate"><span class="pre">Totalise</span></code> which appends row and column totals to a numeric matrix.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">75</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">51</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">28</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">75 14 86 20
31 16 40 51
22 64 31 28
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">totMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Totalise</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 75 14  86 20 195
 31 16  40 51 138
 22 64  31 28 145
128 94 157 99 478
</span></div></div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">mat</span></code> occupies the upper left corner of <code class="docutils literal notranslate"><span class="pre">totMat</span></code>:</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">totMat</span><span class="w"> </span><span class="o">∊</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 0
1 1 1 1 0
1 1 1 1 0
0 0 0 0 0
</span></div></div>
</div>
<div class="exercise admonition" id="ex-lengths">

<p class="admonition-title"><span class="caption-number">Exercise 5.5 </span></p>
<div class="section" id="exercise-content">
<p>Write a monadic function <code class="docutils literal notranslate"><span class="pre">Lengths</span></code> which returns the lengths of the words contained in a text vector.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span><span class="w"> </span><span class="s1">&#39;This seems to be a good solution&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 5 2 2 1 4 8
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">Lengths</span><span class="w"> </span><span class="s1">&#39;This seems to be a good solution&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-to">

<p class="admonition-title"><span class="caption-number">Exercise 5.6 </span></p>
<div class="section" id="exercise-content">
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">To</span></code> which produces the series of integer values between the limits given by its two arguments.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">17</span><span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="m">29</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17 18 19 20 21 22 23 24 25 26 27 28 29
</span></div></div>
</div>
<div class="exercise admonition" id="ex-frame">

<p class="admonition-title"><span class="caption-number">Exercise 5.7 </span></p>
<div class="section" id="exercise-content">
<p>Develop a monadic function <code class="docutils literal notranslate"><span class="pre">Frame</span></code> which puts a frame around a text matrix. For the first version, just concatenate minus signs above and under the matrix, and vertical bars down both sides. Then, update the function to replace the four corners by four <code class="docutils literal notranslate"><span class="pre">+</span></code> signs.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">towns</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">10</span><span class="o">⍴</span><span class="s1">&#39;Canberra  Paris     WashingtonMoscow    Martigues Mexico    &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  
Paris     
Washington
Moscow    
Martigues 
Mexico    
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="nv">towns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">+----------+
|Canberra  |
|Paris     |
|Washington|
|Moscow    |
|Martigues |
|Mexico    |
+----------+
</span></div></div>
</div>
<p>Finally, you can improve the appearance of the result by changing the function to use line-drawing symbols. You enter line-drawing symbols by using <code class="docutils literal notranslate"><span class="pre">⎕UCS</span></code>, a <em>system function</em> that converts characters to integers and vice-versa:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9472</span><span class="w"> </span><span class="m">9474</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">─│
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9484</span><span class="w"> </span><span class="m">9488</span><span class="w"> </span><span class="m">9492</span><span class="w"> </span><span class="m">9496</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┐└┘
</span></div></div>
</div>
<p>Correspondingly, applying <code class="docutils literal notranslate"><span class="pre">⎕UCS</span></code> to those characters yields the original integers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕UCS</span><span class="w"> </span><span class="s1">&#39;─│┌┐└┘&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9472 9474 9484 9488 9492 9496
</span></div></div>
</div>
<p>After improving your function, the result should look like this:</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="nv">towns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┐
│Canberra  │
│Paris     │
│Washington│
│Moscow    │
│Martigues │
│Mexico    │
└──────────┘
</span></div></div>
</div>
<div class="exercise admonition" id="ex-frame-vec">

<p class="admonition-title"><span class="caption-number">Exercise 5.8 </span></p>
<div class="section" id="exercise-content">
<p>It is very likely that the function you wrote for the previous exercise works on matrices but not on vectors. Can you make it work on both?</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="s1">&#39;We are not out of the wood&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────────────────────┐
│We are not out of the wood│
└──────────────────────────┘
</span></div></div>
</div>
<div class="exercise admonition" id="ex-switch">

<p class="admonition-title"><span class="caption-number">Exercise 5.9 </span></p>
<div class="section" id="exercise-content">
<p>Write a function <code class="docutils literal notranslate"><span class="pre">Switch</span></code> which replaces a given letter by another one in a text vector. The letter to replace is given first; the replacing letter is given second.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;tc&#39;</span><span class="w"> </span><span class="nv">Switch</span><span class="w"> </span><span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A bird in che hand is worch cwo in che bush
</span></div></div>
</div>
<div class="exercise admonition" id="ex-swap">

<p class="admonition-title"><span class="caption-number">Exercise 5.10 </span></p>
<div class="section" id="exercise-content">
<p>Modify the previous function so that it commutes the two letters.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ei&#39;</span><span class="w"> </span><span class="nv">Swap</span><span class="w"> </span><span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A berd en thi hand es worth two en thi bush
</span></div></div>
</div>
</div>
<div class="section" id="dfns-in-depth">
<span id="user-defined-functions-dfns-in-depth"></span><h2><span class="section-number">5.5. </span>Dfns in Depth<a class="headerlink" href="#dfns-in-depth" title="Permalink to this headline">#</a></h2>
<p>In this section we will cover a couple of more advanced subtleties about dfns, and then we will move on to learn about tradfns.</p>
<div class="section" id="guards">
<span id="user-defined-functions-guards"></span><h3><span class="section-number">5.5.1. </span>Guards<a class="headerlink" href="#guards" title="Permalink to this headline">#</a></h3>
<p>Previously we said that control structures cannot be used in dfns. However, it is possible to have a dfn conditionally calculate a result, by using a <em>guard</em>.</p>
<p>A <em>guard</em> is any expression which generates a one-item Boolean result, followed by a colon.</p>
<p>The expression placed to the right of a <em>guard</em> is executed only if the <em>guard</em> is true. In a dfn, this looks like <code class="docutils literal notranslate"><span class="pre">guard:</span> <span class="pre">expr</span></code> and works similarly to a</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guard</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">expr</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>of some popular programming languages.</p>
<p>For example, this function will give a result equal to <code class="docutils literal notranslate"><span class="pre">'Positive'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Zero'</span></code> or <code class="docutils literal notranslate"><span class="pre">'Negative'</span></code> if the argument <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is respectively greater than, equal to, or smaller than zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Sign</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">&gt;</span><span class="m">0</span><span class="bp">:</span><span class="w"> </span><span class="s1">&#39;Positive&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">=</span><span class="m">0</span><span class="bp">:</span><span class="w"> </span><span class="s1">&#39;Zero&#39;</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;Negative&#39;</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Positive
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="m">¯3.6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Negative
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Zero
</span></div></div>
</div>
</div>
<div class="section" id="shy-result">
<span id="user-defined-functions-shy-result"></span><h3><span class="section-number">5.5.2. </span>Shy Result<a class="headerlink" href="#shy-result" title="Permalink to this headline">#</a></h3>
<p>Dfns can be written in such a way that they return a <em>shy result</em>. A <em>shy result</em> is a result which is returned, but not displayed by default.</p>
<p>Consider a function which deletes a file from disk and returns a result equal to 1 (file deleted) or 0 (file not found). Usually, one doesn’t care if the file did not exist, so the result is not needed. But sometimes it may be important to check whether the file really existed and has been removed. So, sometimes a result is useless and sometimes it is useful… this is the reason why shy results have been invented.</p>
<p>In a dfn, a shy result happens when the last expression that is evaluated is assigned to a (local) name, as opposed to just leaving the result of the expression unassigned. For this to happen, one has to be careful to leave the closing curly brace <code class="docutils literal notranslate"><span class="pre">}</span></code> next to that final statement, instead of having <code class="docutils literal notranslate"><span class="pre">}</span></code> alone in a new line.</p>
<p>Here is the function above, written without guards and with a shy result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;NegativeZero    Positive&#39;</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="o">+×</span><span class="bp">⍵</span><span class="sr">;]</span><span class="w"> </span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="m">¯3.6</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">Sign</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Zero    
</span></div></div>
</div>
<p>Notice what happens if we were to format <code class="docutils literal notranslate"><span class="pre">Sign</span></code> as we have formatted previous dfns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Sign</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">s</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;NegativeZero    Positive&#39;</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="o">+×</span><span class="bp">⍵</span><span class="sr">;]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span><span class="w"> </span><span class="m">¯3.6</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">Sign</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: No result was provided when the context expected one
      ⎕←Sign 0
        ∧
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code> we get above is a very subtle error. Because the <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">←</span> <span class="pre">...</span></code> statement is an assignment, when executing the <code class="docutils literal notranslate"><span class="pre">Sign</span></code> dfn the interpreter goes on to execute the expression on the next line, but the next line has <em>no</em> expression and so the interpreter raises a <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code>. If we want to have a shy result on a multi-line dfn, we <em>must</em> have the final curly brace on the same line as the final statement.</p>
</div>
<div class="section" id="lexical-scoping">
<span id="user-defined-functions-lexical-scoping"></span><h3><span class="section-number">5.5.3. </span>Lexical Scoping<a class="headerlink" href="#lexical-scoping" title="Permalink to this headline">#</a></h3>
<p><em>Lexical scoping</em> (also referred to as <em>static scoping</em>) is the mechanism that turns local and global variables into relative notions that depend on the context in which dfns were defined: dfns usually have access to global variables, but the variables that are “global” depend on where the dfn was written.</p>
<p>As a purely illustrative example, consider the function defined below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">MultiplyBy10</span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="w">            </span><span class="c1">⍝ define some variable</span><span class="w"></span>
<span class="w">    </span><span class="nv">TimesV</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">v</span><span class="o">×</span><span class="bp">⍵</span><span class="kt">}</span><span class="w">    </span><span class="c1">⍝ multiply something with v</span><span class="w"></span>
<span class="w">    </span><span class="nv">TimesV</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MultiplyBy10</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">50
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MultiplyBy10</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">100
</span></div></div>
</div>
<p>Notice how the <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> function takes your input and gives it to the <code class="docutils literal notranslate"><span class="pre">TimesV</span></code> function, which is defined as a function that “<em>takes its input (<code class="docutils literal notranslate"><span class="pre">⍵</span></code>) and multiplies it with <code class="docutils literal notranslate"><span class="pre">v</span></code></em>”. But what is <code class="docutils literal notranslate"><span class="pre">v</span></code>? We do not give a value to <code class="docutils literal notranslate"><span class="pre">v</span></code> inside <code class="docutils literal notranslate"><span class="pre">TimesV</span></code>, so when APL encounters the expression <code class="docutils literal notranslate"><span class="pre">v×⍵</span></code> it looks at its surroundings for the meaning of <code class="docutils literal notranslate"><span class="pre">v</span></code>. Because <code class="docutils literal notranslate"><span class="pre">v</span></code> was defined in the enclosing dfn as <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">←</span> <span class="pre">10</span></code>, that is the value that is used.</p>
<p>Consider now a similar example, but with more occurrences of the variable <code class="docutils literal notranslate"><span class="pre">v</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">100</span><span class="w">          </span><span class="c1">⍝ (1)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">MultiplyBy10</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">GiveMeV</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">        </span><span class="nv">v</span><span class="w"></span>
<span class="w">    </span><span class="kt">}</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w">         </span><span class="c1">⍝ (3)</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">GiveMeV</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1">⍝ (4)</span><span class="w"></span>
<span class="w">    </span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="w">       </span><span class="c1">⍝ (5)</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w">         </span><span class="c1">⍝ (6)</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">GiveMeV</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1">⍝ (7)</span><span class="w"></span>
<span class="w">    </span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">×</span><span class="bp">⍵</span><span class="w">     </span><span class="c1">⍝ (8)</span><span class="w"></span>
<span class="w">    </span><span class="nv">v</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w">             </span><span class="c1">⍝ (2)</span><span class="w"></span>
<span class="nv">MultiplyBy10</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w">             </span><span class="c1">⍝ (9)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">100
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">100
100
10
10
30
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">100
</span></div></div>
</div>
<p>Let us go over the assignments and the outputs of the code above:</p>
<ul class="simple">
<li><p>we start by defining the variable <code class="docutils literal notranslate"><span class="pre">v</span></code> in our session and we set it to 100 (1);</p></li>
<li><p>we then define a function named <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> which happens to contain another dfn inside it;</p></li>
<li><p>then we print the value of the session variable <code class="docutils literal notranslate"><span class="pre">v</span></code> and we see its value is 100 (2);</p></li>
<li><p>then we call the dfn <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> with argument <code class="docutils literal notranslate"><span class="pre">3</span></code> and</p>
<ul>
<li><p>we define a new dfn named <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code>;</p></li>
<li><p>we print the value of <code class="docutils literal notranslate"><span class="pre">v</span></code> (3). <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> doesn’t know what <code class="docutils literal notranslate"><span class="pre">v</span></code> is and so it looks for it in the session and finds a <code class="docutils literal notranslate"><span class="pre">v</span></code> whose value is 100, because of (1);</p></li>
<li><p>we then call the function <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> which simply returns <code class="docutils literal notranslate"><span class="pre">v</span></code> and we print it (4). <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> doesn’t know what <code class="docutils literal notranslate"><span class="pre">v</span></code> is, so it asks <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code>, which in turns asks the session, which knows of a <code class="docutils literal notranslate"><span class="pre">v</span></code> whose value is 100, because of (1);</p></li>
<li><p>we then define <code class="docutils literal notranslate"><span class="pre">v</span></code> to be 10 inside of <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> (5), making <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> aware of a variable <code class="docutils literal notranslate"><span class="pre">v</span></code>;</p></li>
<li><p>then we print <code class="docutils literal notranslate"><span class="pre">v</span></code> inside <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> (6), which is 10 because we just defined it as such;</p></li>
<li><p>then we call <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> again and we print its result (7). <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> doesn’t know what <code class="docutils literal notranslate"><span class="pre">v</span></code> is, so it asks <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code>, that <em>now knows</em> what <code class="docutils literal notranslate"><span class="pre">v</span></code> is: it is 10 because of (5);</p></li>
<li><p>and we finish executing the <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> dfn by assigning 30 to <code class="docutils literal notranslate"><span class="pre">v</span></code> (8), which we then return from the dfn;</p></li>
</ul>
</li>
<li><p>we leave the <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> dfn call and 30 gets printed because that was the result of the dfn call;</p></li>
<li><p>finally we print <code class="docutils literal notranslate"><span class="pre">v</span></code> once more, and the session knows <code class="docutils literal notranslate"><span class="pre">v</span></code> is 100, so that is what we print (9).</p></li>
</ul>
<p>That might look confusing, but I assure you it makes a lot of sense. Just go through the code calmly and make sure you understand what each part does separately. Then, simulate the execution of the code with some pen and paper and write down what you think should get printed at each step. Then read the explanation above and compare it to what you thought was supposed to happen. You will get used to lexical scoping in no time.</p>
<p>Lexical scoping can reveal itself to be extremely useful in languages where functions can return other functions, which is <em>not</em> the case with APL. Even so, lexical scoping will prove to be helpful later down the road: imagine a large(r) function inside which we define a small utility dfn to use with an operator, but we want the dfn to make use of things we have already computed inside the outer function. Lexical scoping kicks in at that point, allowing the inner dfn to access everything the outer function already computed.</p>
<p>This concludes the more advanced topics on dfns. If you are used to programming in other programming languages that follow paradigms other than the array-oriented one, dfns may look very limited in their lack of conventional control structures and looping structures. As it turns out, in writing good array-oriented programs you can usually do away without these. What is more, the power of many of the built-in operators you will learn about in <a class="reference internal" href="Operators.html"><span class="doc std std-doc">a future chapter</span></a> will cover that gap in a very suitable way.</p>
</div>
</div>
<div class="section" id="tradfns">
<span id="user-defined-functions-tradfns"></span><h2><span class="section-number">5.6. </span>Tradfns<a class="headerlink" href="#tradfns" title="Permalink to this headline">#</a></h2>
<p><em>Tradfns</em>, which were previously referred to as <em>procedural functions</em>, are mainly used for complex calculations involving many variables, interactions with a user, file input/output of data, etc. They look much like functions or programs in more traditional programming languages.</p>
<p>Tradfn is short for “traditional function”, because in the beginning APL did not have support for dfns. Hence, when dfns were a novelty, tradfns were the <em>traditional</em> functions that had been around for a while.</p>
<div class="section" id="a-first-example">
<span id="user-defined-functions-a-first-example"></span><h3><span class="section-number">5.6.1. </span>A First Example<a class="headerlink" href="#a-first-example" title="Permalink to this headline">#</a></h3>
<p>Tradfns are composed of a <em>header</em> and one or more <em>statements</em> (function lines), so invoking a text editor to enter these lines of text will make your life easier.</p>
<p>As an example, let us see how we could define the <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> from before as a tradfn. Let us call it <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code>, for <em>traditional harmonic mean</em>.</p>
<p>Let us open the editor with <code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">TradHarmonicMean</span></code> and outright define our function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">mean</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">TradHarmonicMean</span><span class="w"> </span><span class="nv">argVector</span><span class="w"></span>
<span class="w">    </span><span class="nv">inverses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">÷</span><span class="nv">argVector</span><span class="w"></span>
<span class="w">    </span><span class="nv">mean</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now I will break it down for you:</p>
<p>The function is delimited by a pair of <code class="docutils literal notranslate"><span class="pre">∇</span></code> symbols. This special symbol is named <em>del</em> in English, or <em>carrot</em> (because of its shape) in some French-speaking countries. You can type a <em>del</em> with <kbd>APL</kbd>+<kbd>g</kbd>. In Jupyter notebooks and in the session, those are mandatory. If you define the tradfn in the text editor, you can omit them (cf. <a class="reference internal" href="#fig-editor-tradharmonicmean"><span class="std std-numref">Fig. 5.11</span></a>);</p>
<p>The first line of the tradfn is the header and tells APL that:</p>
<ul class="simple">
<li><p>the tradfn is going to be called <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code>;</p></li>
<li><p>it expects a right argument which will be named <code class="docutils literal notranslate"><span class="pre">argVector</span></code>; and</p></li>
<li><p>it will return the value we store in the variable named <code class="docutils literal notranslate"><span class="pre">mean</span></code>.</p></li>
</ul>
<p>The subsequent lines have the statements of the function itself and, in particular, the final line in which we perform the <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">←</span> <span class="pre">...</span></code> assignment is where we establish the result that will be returned by the tradfn.</p>
<div class="figure align-default" id="editor-tradharmonicmean">
<span id="fig-editor-tradharmonicmean"></span><img alt="_images/Editor_TradHarmonicMean.png" src="_images/Editor_TradHarmonicMean.png" />
<p class="caption"><span class="caption-number">Fig. 5.11 </span><span class="caption-text">A tradfn defined in the editor and without delimiting Del characters.</span><a class="headerlink" href="#editor-tradharmonicmean" title="Permalink to this image">#</a></p>
</div>
<p>The function is now available for use:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TradHarmonicMean</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.5
</span></div></div>
</div>
</div>
<div class="section" id="the-default-isn-t-local">
<span id="user-defined-functions-the-default-isnt-local"></span><h3><span class="section-number">5.6.2. </span>The Default Isn’t Local<a class="headerlink" href="#the-default-isn-t-local" title="Permalink to this headline">#</a></h3>
<p>Just like when we defined <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> as our first dfn, our tradfn uses a temporary variable called <code class="docutils literal notranslate"><span class="pre">inverses</span></code>. Let us check its value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.5 0.166667
</span></div></div>
</div>
<p>When we did the same check in <a class="reference internal" href="#user-defined-functions-local-variables"><span class="std std-numref">Section 5.3.3</span></a>, we couldn’t access the value of <code class="docutils literal notranslate"><span class="pre">inverses</span></code> because it was not defined in the session, it was a variable that was local to the dfn. Clearly, this works differently in tradfns.</p>
<p>If you were paying attention, you will have noticed that in <a class="reference internal" href="#fig-editor-tradharmonicmean"><span class="std std-numref">Fig. 5.11</span></a> there’s two colours being used (the actual colours might differ between the Windows IDE and RIDE, and you might also have changed your colour scheme to something else):</p>
<ul class="simple">
<li><p>black for the names <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code> and <code class="docutils literal notranslate"><span class="pre">inverses</span></code>; and</p></li>
<li><p>grey for the names <code class="docutils literal notranslate"><span class="pre">argVector</span></code> and <code class="docutils literal notranslate"><span class="pre">mean</span></code>.</p></li>
</ul>
<p>So what do the colours mean?</p>
<p>The names in black are the variables that are global, variables that remain in the workspace after they have been assigned values during execution of the function. These names can refer to existing variables - intentionally or not - and may produce undesirable side effects.</p>
<p>The names in grey are temporary variable names used during function execution. Once execution is complete, these temporary variables are destroyed. Right before that, the tradfn returns the <em>value</em> of the return variable - <code class="docutils literal notranslate"><span class="pre">mean</span></code> in our example - and then discards its <em>name</em>.</p>
<p>That means neither <code class="docutils literal notranslate"><span class="pre">argVector</span></code> nor <code class="docutils literal notranslate"><span class="pre">mean</span></code> should be available after execution of the tradfn ends:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mean</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: mean
      mean
      ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">argVector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: argVector
      argVector
      ∧
</pre></div>
</div>
</div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">inverses</span></code> is coloured in black, we can see it can interfere with the variables in our workspace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;The inverses are calculated by use of monadic ÷&#39;</span><span class="w"></span>
<span class="nv">TradHarmonicMean</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.48
</span></div></div>
</div>
<p>And suddenly <code class="docutils literal notranslate"><span class="pre">inverses</span></code> is no longer what you defined:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0.5 0.333333 0.25
</span></div></div>
</div>
<p>All the variables created during execution of the tradfn that are not referenced in the header are considered to be global variables. To avoid any unpredictable side effects, it is recommended that you declare as local all the variables used by a function. This is done by specifying their names in the header, each prefixed by a <em>semi-colon</em>, as shown in this new definition of <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">mean</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">TradHarmonicMean</span><span class="w"> </span><span class="nv">argVector</span><span class="sr">;</span><span class="w"> </span><span class="nv">inverses</span><span class="w"></span>
<span class="w">    </span><span class="nv">inverses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">÷</span><span class="nv">argVector</span><span class="w"></span>
<span class="w">    </span><span class="nv">mean</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;The inverses are calculated by use of monadic ÷&#39;</span><span class="w"></span>
<span class="nv">TradHarmonicMean</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.48
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">The inverses are calculated by use of monadic ÷
</span></div></div>
</div>
<p>As we can see, <code class="docutils literal notranslate"><span class="pre">inverses</span></code> is now treated as a local variable.</p>
<div class="tip admonition">
<p class="admonition-title">Rules</p>
<ul class="simple">
<li><p>All the names referenced in the header of a function (including its result and arguments) are <em>local</em> to the function. They will exist only during the execution of the function.</p></li>
<li><p>Operations made on local variables do not affect <em>global</em> variables having the same names.</p></li>
<li><p><em>Global</em> and <em>local</em> are relative notions: when a tradfn calls another sub function, variables local to the calling function are global for the called function. This will be further explored in <a class="reference internal" href="#user-defined-functions-dynamic-scoping"><span class="std std-numref">Section 5.6.5</span></a>.</p></li>
<li><p>All the variables used in a tradfn should preferably be declared local, unless you specifically intend otherwise.</p></li>
</ul>
</div>
</div>
<div class="section" id="defining-sub-functions">
<span id="user-defined-functions-defining-sub-functions"></span><h3><span class="section-number">5.6.3. </span>Defining Sub-Functions<a class="headerlink" href="#defining-sub-functions" title="Permalink to this headline">#</a></h3>
<p>As we have seen, dfns can be defined inside other dfns. Similarly, dfns can be defined inside tradfns and used right away. The precautions mentioned above, that need to be taken with respect to <em>global</em> versus <em>local</em> variables, still apply. In short, do not forget to localise the name of a temporary dfn unless you really mean for it to become global.</p>
</div>
<div class="section" id="a-second-example">
<span id="user-defined-functions-a-second-example"></span><h3><span class="section-number">5.6.4. </span>A Second Example<a class="headerlink" href="#a-second-example" title="Permalink to this headline">#</a></h3>
<p>You may remember from previous chapters our two matrices <code class="docutils literal notranslate"><span class="pre">forecast</span></code> and <code class="docutils literal notranslate"><span class="pre">actual</span></code>, representing sales of 4 products over 6 months:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="o">⊢</span><span class="nv">forecast</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">×?</span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="m">55</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90 160 420 500  20  30
110 450 170 370 290 360
340 190 320 120 510 370
150 460 240 520 490 280
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="o">⊢</span><span class="nv">actual</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">forecast</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">¯10</span><span class="o">+?</span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 89 166 420 508  12  23
111 453 177 365 284 352
349 192 329 115 515 374
160 467 234 519 485 283
</span></div></div>
</div>
<p>It would be nice to interlace the columns of those two matrices to make it easier to compare forecast and actual sales for the same month. Furthermore, because this might be useful for other pairs of matrices, let’s create a general function to do the job; let’s call it <code class="docutils literal notranslate"><span class="pre">Interlace</span></code>.</p>
<p>The result we would like to obtain is schematised in the table below, with <code class="docutils literal notranslate"><span class="pre">f</span></code> being shorthand for <code class="docutils literal notranslate"><span class="pre">forecast</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code> being shorthand for <code class="docutils literal notranslate"><span class="pre">actual</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;1]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;1]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;2]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;2]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;3]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;3]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;4]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;4]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;5]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;5]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;6]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;6]</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>90</p></td>
<td class="text-align:center"><p>89</p></td>
<td class="text-align:center"><p>160</p></td>
<td class="text-align:center"><p>166</p></td>
<td class="text-align:center"><p>420</p></td>
<td class="text-align:center"><p>420</p></td>
<td class="text-align:center"><p>500</p></td>
<td class="text-align:center"><p>508</p></td>
<td class="text-align:center"><p>20</p></td>
<td class="text-align:center"><p>12</p></td>
<td class="text-align:center"><p>30</p></td>
<td class="text-align:center"><p>23</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>110</p></td>
<td class="text-align:center"><p>111</p></td>
<td class="text-align:center"><p>450</p></td>
<td class="text-align:center"><p>453</p></td>
<td class="text-align:center"><p>170</p></td>
<td class="text-align:center"><p>177</p></td>
<td class="text-align:center"><p>370</p></td>
<td class="text-align:center"><p>365</p></td>
<td class="text-align:center"><p>290</p></td>
<td class="text-align:center"><p>284</p></td>
<td class="text-align:center"><p>360</p></td>
<td class="text-align:center"><p>352</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>340</p></td>
<td class="text-align:center"><p>349</p></td>
<td class="text-align:center"><p>190</p></td>
<td class="text-align:center"><p>192</p></td>
<td class="text-align:center"><p>320</p></td>
<td class="text-align:center"><p>329</p></td>
<td class="text-align:center"><p>120</p></td>
<td class="text-align:center"><p>115</p></td>
<td class="text-align:center"><p>510</p></td>
<td class="text-align:center"><p>515</p></td>
<td class="text-align:center"><p>370</p></td>
<td class="text-align:center"><p>374</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>150</p></td>
<td class="text-align:center"><p>160</p></td>
<td class="text-align:center"><p>460</p></td>
<td class="text-align:center"><p>467</p></td>
<td class="text-align:center"><p>240</p></td>
<td class="text-align:center"><p>234</p></td>
<td class="text-align:center"><p>520</p></td>
<td class="text-align:center"><p>519</p></td>
<td class="text-align:center"><p>490</p></td>
<td class="text-align:center"><p>485</p></td>
<td class="text-align:center"><p>280</p></td>
<td class="text-align:center"><p>283</p></td>
</tr>
</tbody>
</table>
<p>The first thing you must decide is how this function will be used:</p>
<ul class="simple">
<li><p>will you pass both matrices on right: <code class="docutils literal notranslate"><span class="pre">Interlace</span> <span class="pre">forecast</span> <span class="pre">actual</span></code>; or</p></li>
<li><p>one on the left and one on the right: <code class="docutils literal notranslate"><span class="pre">forecast</span> <span class="pre">Interlace</span> <span class="pre">actual</span></code>?</p></li>
</ul>
<p>Both solutions are valid; it is only a question of personal taste and ease of use. Our first tradfn was monadic so let us make this one dyadic.</p>
<p>Having decided on the calling syntax, we just have to know how the header of a dyadic tradfn looks like. If we call <code class="docutils literal notranslate"><span class="pre">r</span></code> to the result and <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> to the left and right arguments, respectively, then the tradfn header is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">Interlace</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>which may then be updated to include local variables.</p>
<p>The names <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span></code> do not matter to the APL system. Replacing <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> with <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> or <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> would be perfectly valid and obviously easier to recall than if we replaced them with <code class="docutils literal notranslate"><span class="pre">potatoes</span></code> and <code class="docutils literal notranslate"><span class="pre">ocarina</span></code>. However, you should pick names which help you remember what the function is doing. For example, in a general-purpose function like this, you should probably avoid using too specific names like <code class="docutils literal notranslate"><span class="pre">forecast</span></code> and <code class="docutils literal notranslate"><span class="pre">actual</span></code>: that would imply that this function only works on arrays containing forecast and actual data. Such names might also confuse the distinction between local and global names.</p>
<p>Now that the header is set, how shall we interlace our two matrices? Have a go at it, if you fancy.</p>
<p>We suggest the following steps:</p>
<ul class="simple">
<li><p>calculate the size of the result <code class="docutils literal notranslate"><span class="pre">r</span></code>. It will be a matrix with as many rows as <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>, but twice as many columns;</p></li>
<li><p>create <code class="docutils literal notranslate"><span class="pre">r</span></code> filled with zeroes;</p></li>
<li><p>calculate the indices of its even columns;</p></li>
<li><p>fill the even columns with <code class="docutils literal notranslate"><span class="pre">y</span></code>;</p></li>
<li><p>calculate the indices of its odd columns and fill them with <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
</ul>
<p>The final function could be written as follows. Do not forget to localise your variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">Interlace</span><span class="w"> </span><span class="nv">y</span><span class="sr">;</span><span class="w"> </span><span class="nv">size</span><span class="sr">;</span><span class="w"> </span><span class="nv">even</span><span class="w"></span>
<span class="w">    </span><span class="nv">size</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">×⍴</span><span class="nv">x</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">size</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="nv">even</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="o">×⍳</span><span class="p">(</span><span class="o">⍴</span><span class="nv">x</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="o">-</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We can now apply the function to any pair of variables, provided they have the same size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">forecast</span><span class="w"> </span><span class="nv">Interlace</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90  89 160 166 420 420 500 508  20  12  30  23
110 111 450 453 170 177 370 365 290 284 360 352
340 349 190 192 320 329 120 115 510 515 370 374
150 160 460 467 240 234 520 519 490 485 280 283
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="nv">Interlace</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">¯5</span><span class="w"> </span><span class="m">¯7</span><span class="w"> </span><span class="m">¯1</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">¯8</span><span class="w"> </span><span class="m">¯9</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 ¯5 2 ¯7 3 ¯1
4 ¯2 5 ¯8 6 ¯9
</span></div></div>
</div>
<div class="section" id="another-possible-syntax">
<span id="user-defined-functions-another-possible-syntax"></span><h4><span class="section-number">5.6.4.1. </span>Another Possible Syntax<a class="headerlink" href="#another-possible-syntax" title="Permalink to this headline">#</a></h4>
<p>If you had decided instead to make the function monadic, it could look very similar to the one above. We just changed the header a bit and added a new statement at the beginning:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Interlace</span><span class="w"> </span><span class="nv">couple</span><span class="sr">;</span><span class="w"> </span><span class="nv">x</span><span class="sr">;</span><span class="w"> </span><span class="nv">y</span><span class="sr">;</span><span class="w"> </span><span class="nv">size</span><span class="sr">;</span><span class="w"> </span><span class="nv">even</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">couple</span><span class="w"></span>
<span class="w">    </span><span class="nv">size</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">×⍴</span><span class="nv">x</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">size</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="nv">even</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="o">×⍳</span><span class="p">(</span><span class="o">⍴</span><span class="nv">x</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="o">-</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Interlace</span><span class="w"> </span><span class="nv">forecast</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90  89 160 166 420 420 500 508  20  12  30  23
110 111 450 453 170 177 370 365 290 284 360 352
340 349 190 192 320 329 120 115 510 515 370 374
150 160 460 467 240 234 520 519 490 485 280 283
</span></div></div>
</div>
</div>
</div>
<div class="section" id="dynamic-scoping">
<span id="user-defined-functions-dynamic-scoping"></span><h3><span class="section-number">5.6.5. </span>Dynamic Scoping<a class="headerlink" href="#dynamic-scoping" title="Permalink to this headline">#</a></h3>
<p><em>Dynamic scoping</em> (as opposed to <em>static</em> scoping, as seen in <a class="reference internal" href="#user-defined-functions-lexical-scoping"><span class="std std-numref">Section 5.5.3</span></a>) is the scoping mechanism that tradfns use: when a tradfn calls another tradfn, the callee can see the caller’s local variables, even if the callee was defined <em>outside</em> of the caller.</p>
<p>To explore what this means, consider the following tradfns. Do not worry about their arguments and return values as they are not meaningful. What matters are the assignments to <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> and the prints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">PrintAB</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">SetAThenPrint</span><span class="w"> </span><span class="nv">y</span><span class="sr">;</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">PrintAB</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">SetBThenPrint</span><span class="w"> </span><span class="nv">y</span><span class="sr">;</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
<span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">PrintAB</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>and let us define <em>global</em> variables <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> with character values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now let us call <code class="docutils literal notranslate"><span class="pre">SetAThenPrint</span></code>. Before looking at the code that follows, what do you expect to be printed?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetAThenPrint</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
b
0
</span></div></div>
</div>
<p>Did it match your expectations? Can you now guess what will happen if we execute <code class="docutils literal notranslate"><span class="pre">SetBThenPrint</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetBThenPrint</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">a
2
0
</span></div></div>
</div>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code> was defined as a standalone tradfn which prints two variables. Because <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are never defined inside <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code>, surely <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code> will be printing global values. Then, depending on what function called <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code>, either <code class="docutils literal notranslate"><span class="pre">a</span></code> or <code class="docutils literal notranslate"><span class="pre">b</span></code> are taken from the context of the enclosing <em>calling</em> function.</p>
<p>Let us try to define the same functions but with dfns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">PrintCD</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">d</span><span class="w"></span>
<span class="w">    </span><span class="m">0</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">SetCThenPrint</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">    </span><span class="nv">PrintCD</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">SetDThenPrint</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">d</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="w">    </span><span class="nv">PrintCD</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">c</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;c&#39;</span><span class="w"></span>
<span class="nv">d</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;d&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>What will happen if we call <code class="docutils literal notranslate"><span class="pre">SetCThenPrint</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetCThenPrint</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">c
d
0
</span></div></div>
</div>
<p>Even though <code class="docutils literal notranslate"><span class="pre">SetCThenPrint</span></code> modified the value of <code class="docutils literal notranslate"><span class="pre">c</span></code> to be 3, the <code class="docutils literal notranslate"><span class="pre">PrintCD</span></code> function was defined in the workspace, and hence its lexical scoping tells it to look for <code class="docutils literal notranslate"><span class="pre">c</span></code> among its own variables, and among the global variables in the workspace. <code class="docutils literal notranslate"><span class="pre">PrintCD</span></code> does not have access to the local variables of the dfn that called it.</p>
<p>That is why, if we call <code class="docutils literal notranslate"><span class="pre">SetDThenPrint</span></code>, we get the exact same output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetDThenPrint</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">c
d
0
</span></div></div>
</div>
<p>Perhaps the difference between dynamic and lexical scoping becomes even more clear if we consider yet another family of tradfns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">PrintE</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">e</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Notice that if you call <code class="docutils literal notranslate"><span class="pre">PrintE</span></code> right now it will cause an error, because there is no variable <code class="docutils literal notranslate"><span class="pre">e</span></code> defined anywhere:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">e</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: e
      e
      ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">PrintE</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: e
PrintE[1] ⎕←e
            ∧
</pre></div>
</div>
</div>
</div>
<p>Now let us define a tradfn that makes use of a <em>local</em> variable <code class="docutils literal notranslate"><span class="pre">e</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">SetLocalE</span><span class="w"> </span><span class="nv">y</span><span class="sr">;</span><span class="w"> </span><span class="nv">e</span><span class="w"></span>
<span class="w">    </span><span class="nv">e</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">PrintE</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If we call <code class="docutils literal notranslate"><span class="pre">SetLocalE</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code> will be defined inside <code class="docutils literal notranslate"><span class="pre">SetLocalE</span></code> and then, when <code class="docutils literal notranslate"><span class="pre">PrintE</span></code> gets called, the dynamic scoping will make <code class="docutils literal notranslate"><span class="pre">e</span></code> visible as a global variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetLocalE</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
0
</span></div></div>
</div>
<p>After <code class="docutils literal notranslate"><span class="pre">SetLocalE</span></code> is executed, our workspace still has no variable <code class="docutils literal notranslate"><span class="pre">e</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">e</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: e
      e
      ∧
</pre></div>
</div>
</div>
</div>
<p>Scoping can become messy quickly, and that is why it is recommended that you always provide the information your functions need as arguments, and return the results explicitly instead of relying on modifying some global variable(s).
In <a class="reference internal" href="#user-defined-functions-scoping-in-nested-function-calls"><span class="std std-numref">Section 5.16.2</span></a> we will see this can become even more confusing when you start having dfns calling tradfns and tradfns calling dfns.</p>
</div>
</div>
<div class="section" id="flow-control-in-tradfns">
<span id="user-defined-functions-flow-control-in-tradfns"></span><h2><span class="section-number">5.7. </span>Flow Control in Tradfns<a class="headerlink" href="#flow-control-in-tradfns" title="Permalink to this headline">#</a></h2>
<div class="section" id="overview">
<span id="user-defined-functions-overview"></span><h3><span class="section-number">5.7.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h3>
<p>Apart from extremely simple calculations, most programs rely on certain statements being executed only if a given condition is satisfied (conditional execution) or on a set of statements being executed again and again, until a given limit is reached (looping). The APL language offers a special set of syntactic elements to control the flow of statements inside tradfns.</p>
<p>In the very first versions of APL, the only way to implement conditional execution and looping was to use the symbol <code class="docutils literal notranslate"><span class="pre">→</span></code> (the <em>branch arrow</em>, typed with <kbd>APL</kbd>+<kbd>]</kbd>). This was used to jump from one statement to another, skipping over other statements (conditional execution) or jumping back to repeat a set of statements again (looping). The branch arrow is equivalent to the GOTO statement in other languages. Contemporary versions of APL include a special set of keywords which offer a much more flexible, easy to use and easy to read way to control the flow of execution. They are also very similar to those used in most other languages. These are known as <em>control structures</em>.</p>
<p>We shall begin by using control structures and then introduce you later to the old way of programming (using <code class="docutils literal notranslate"><span class="pre">→</span></code>), only because you may come across it in some existing programs and it will be helpful to be able to read those.</p>
<p>Control structures are blocks of statements which begin and end with special keywords. These keywords are all <strong>prefixed</strong> with a <em>colon</em>, like <code class="docutils literal notranslate"><span class="pre">:If</span></code> or <code class="docutils literal notranslate"><span class="pre">:Repeat</span></code>. This prevents the names of your variables to clash with these keywords.</p>
<p>The keywords can be typed in lower or upper case, but Dyalog APL will always store and display them using a fixed spelling convention commonly known as CamelCase or, more specifically, PascalCase. Following this convention, a keyword has an upper case first letter and the following letters in lower case. Composite keywords like “<code class="docutils literal notranslate"><span class="pre">EndIf</span></code>” and “<code class="docutils literal notranslate"><span class="pre">GoTo</span></code>” capitalise the first letter of each word.</p>
<p>Opening keywords are used to begin the conditional execution or repeated execution of a block of statements. Usually (but not always), the block is ended by a corresponding keyword that starts with <code class="docutils literal notranslate"><span class="pre">:End</span></code>.</p>
<p>The sets of opening/closing keywords are shown below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Opening</p></th>
<th class="text-align:left head"><p>Closing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:If</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndIf</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:For</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndFor</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Select</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndSelect</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Repeat</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Until</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndRepeat</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:While</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndWhile</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Until</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Trap</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndTrap</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:With</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndWith</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Hold</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndHold</span></code></p></td>
</tr>
</tbody>
</table>
<p>The primary keywords shown above can be complemented by additional keywords which qualify more precisely what is to be done:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:Else</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:ElseIf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:AndIf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:OrIf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:Case</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:CaseList</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:Until</span></code></p></li>
</ul>
<p>And finally, some keywords may be used to conditionally alter the flow of execution within a control structure.</p>
<p>The following keywords will not be studied in this chapter:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:Trap...</span> <span class="pre">:EndTrap</span></code> concerns event processing and will be seen in <span class="xref myst">the chapter “Event Handling”</span>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:With...</span> <span class="pre">:EndWith</span></code> concerns the GUI interface and namespaces and will be covered in <span class="xref myst">the chapter on GUIs</span> and in <span class="xref myst">the chapter on namespaces</span>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:Hold...</span> <span class="pre">:EndHold</span></code> concerns <em>multi threading</em>.</p></li>
</ul>
</div>
<div class="section" id="conditional-execution">
<span id="user-defined-functions-conditional-execution"></span><h3><span class="section-number">5.7.2. </span>Conditional Execution<a class="headerlink" href="#conditional-execution" title="Permalink to this headline">#</a></h3>
<div class="section" id="simple-conditions-if-endif">
<span id="user-defined-functions-simple-conditions-ifendif"></span><h4><span class="section-number">5.7.2.1. </span>Simple Conditions (<code class="docutils literal notranslate"><span class="pre">:If</span></code>/<code class="docutils literal notranslate"><span class="pre">:EndIf</span></code>)<a class="headerlink" href="#simple-conditions-if-endif" title="Permalink to this headline">#</a></h4>
<p>The clauses <code class="docutils literal notranslate"><span class="pre">:If</span></code> and <code class="docutils literal notranslate"><span class="pre">:EndIf</span></code> delimit a block of statements (Block <strong>1</strong> in <a class="reference internal" href="#fig-control-flow-if-endif"><span class="std std-numref">Fig. 5.12</span></a>), which will be executed only if the condition specified by the <code class="docutils literal notranslate"><span class="pre">:If</span></code> clause is satisfied.</p>
<div class="figure align-default" id="control-flow-if-endif">
<span id="fig-control-flow-if-endif"></span><img alt="_images/Control_Flow_If_EndIf.png" src="_images/Control_Flow_If_EndIf.png" />
<p class="caption"><span class="caption-number">Fig. 5.12 </span><span class="caption-text">A diagram with the usage of <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:EndIf</span></code>.</span><a class="headerlink" href="#control-flow-if-endif" title="Permalink to this image">#</a></p>
</div>
<p>Here is the explanation of what happens inside the function of the diagram <a class="reference internal" href="#fig-control-flow-if-endif"><span class="std std-numref">Fig. 5.12</span></a>:</p>
<ul class="simple">
<li><p>if present, Block <strong>0</strong> will always be executed, as will Block <strong>2</strong>;</p></li>
<li><p><em>Condition</em> is any expression whose result is a Boolean scalar or one-item array; for example, <code class="docutils literal notranslate"><span class="pre">code∊list</span></code>, <code class="docutils literal notranslate"><span class="pre">price&gt;100</span></code> or <code class="docutils literal notranslate"><span class="pre">values∧.=0</span></code>; and</p></li>
<li><p>Block <strong>1</strong> will be executed if <em>Condition</em> is satisfied.</p></li>
</ul>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Our keyboard has been damaged: we can no longer use the <em>absolute value</em> key. Perhaps a tradfn could replace it? Try writing a tradfn using an <code class="docutils literal notranslate"><span class="pre">:If</span></code> clause.</p>
</div>
<p>Here is a possible solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">AbsVal</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">        </span><span class="nv">y</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">-</span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">AbsVal</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">AbsVal</span><span class="w"> </span><span class="m">¯3.4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3.4
</span></div></div>
</div>
<p>If the argument is positive (or zero), the function does nothing and just returns the argument it received. If the argument is negative, it returns the corresponding positive value.</p>
</div>
<div class="section" id="alternative-processing-if-else-endif">
<span id="user-defined-functions-alternative-processing-ifelseendif"></span><h4><span class="section-number">5.7.2.2. </span>Alternative Processing (<code class="docutils literal notranslate"><span class="pre">:If</span></code>/<code class="docutils literal notranslate"><span class="pre">:Else</span></code>/<code class="docutils literal notranslate"><span class="pre">:EndIf</span></code>)<a class="headerlink" href="#alternative-processing-if-else-endif" title="Permalink to this headline">#</a></h4>
<p>In the previous example if <em>Condition</em> is satisfied, Block <strong>1</strong> is executed; otherwise nothing is done. But sometimes we would like to execute one set of statements (Block <strong>1</strong>) if <em>Condition</em> is satisfied or an alternative one (Block <strong>2</strong>) if it is not.</p>
<p>For this, we use the additional keyword <code class="docutils literal notranslate"><span class="pre">:Else</span></code> as shown in <a class="reference internal" href="#fig-control-flow-if-else-endif"><span class="std std-numref">Fig. 5.13</span></a>:</p>
<div class="figure align-default" id="control-flow-if-else-endif">
<span id="fig-control-flow-if-else-endif"></span><img alt="_images/Control_Flow_If_Else_EndIf.png" src="_images/Control_Flow_If_Else_EndIf.png" />
<p class="caption"><span class="caption-number">Fig. 5.13 </span><span class="caption-text">A diagram with the usage of <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:Else...</span> <span class="pre">:EndIf</span></code>.</span><a class="headerlink" href="#control-flow-if-else-endif" title="Permalink to this image">#</a></p>
</div>
<p>Blocks <strong>0</strong> and <strong>3</strong> will always be executed, if present. Block <strong>1</strong> will be executed if <em>Condition</em> <strong>is</strong> satisfied and Block <strong>2</strong> will be executed if <em>Condition</em> is <strong>not</strong> satisfied. Notice this means that exactly <em>one</em> of the two blocks gets executed. Never both, and never none.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Let us try to find the real roots of the quadratic equation <span class="math notranslate nohighlight">\(ax^2 + bx + c = 0\)</span>, given the values of <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span> and <span class="math notranslate nohighlight">\(c\)</span>. If the quantity <span class="math notranslate nohighlight">\(\Delta = b^2 - 4ac\)</span> is negative, it is known that the two solutions of this equation are complex numbers. <span class="math notranslate nohighlight">\(\Delta\)</span> is commonly referred to as the <a class="reference external" href="https://en.wikipedia.org/wiki/Quadratic_equation#Discriminant">discriminant</a> of the equation.</p>
</div>
<p>We can write a tradfn that computes the two roots by means of the <a class="reference external" href="https://en.wikipedia.org/wiki/Quadratic_equation#Quadratic_formula_and_its_derivation">quadratic formula</a>, except that it issues an error message if there are no real roots. We will use an <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:Else...</span> <span class="pre">:EndIf</span></code> clause for this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">QuadRoot</span><span class="w"> </span><span class="nv">abc</span><span class="sr">;</span><span class="w"> </span><span class="nv">a</span><span class="sr">;</span><span class="w"> </span><span class="nv">b</span><span class="sr">;</span><span class="w"> </span><span class="nv">c</span><span class="sr">;</span><span class="w"> </span><span class="nv">delta</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">abc</span><span class="w"></span>
<span class="w">    </span><span class="nv">delta</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">b</span><span class="o">*</span><span class="m">2</span><span class="p">)</span><span class="o">-</span><span class="m">4</span><span class="o">×</span><span class="nv">a</span><span class="o">×</span><span class="nv">c</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">delta</span><span class="o">≥</span><span class="m">0</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nv">b</span><span class="p">)</span><span class="o">+</span><span class="m">1</span><span class="w"> </span><span class="m">¯1</span><span class="o">×</span><span class="nv">delta</span><span class="o">*</span><span class="m">0.5</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">÷</span><span class="m">2</span><span class="o">×</span><span class="nv">a</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;No roots&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">QuadRoot</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯1.5 5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">QuadRoot</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">No roots
</span></div></div>
</div>
</div>
<div class="section" id="composite-conditions-orif-andif">
<span id="user-defined-functions-composite-conditions-orifandif"></span><h4><span class="section-number">5.7.2.3. </span>Composite Conditions (<code class="docutils literal notranslate"><span class="pre">:OrIf</span></code>/<code class="docutils literal notranslate"><span class="pre">:AndIf</span></code>)<a class="headerlink" href="#composite-conditions-orif-andif" title="Permalink to this headline">#</a></h4>
<p>Multiple conditions can be combined using the Boolean functions <em>or</em> and <em>and</em>.</p>
<p>Consider the diagram <a class="reference internal" href="#fig-control-flow-orif"><span class="std std-numref">Fig. 5.14</span></a>:</p>
<div class="figure align-default" id="control-flow-orif">
<span id="fig-control-flow-orif"></span><img alt="_images/Control_Flow_OrIf.png" src="_images/Control_Flow_OrIf.png" />
<p class="caption"><span class="caption-number">Fig. 5.14 </span><span class="caption-text">A diagram with the usage of <code class="docutils literal notranslate"><span class="pre">:OrIf</span></code>.</span><a class="headerlink" href="#control-flow-orif" title="Permalink to this image">#</a></p>
</div>
<p>If present, Block <strong>0</strong> and Block <strong>3</strong> will always be executed. Block <strong>1</strong> and <em>Condition</em> <strong>2</strong> are only executed if <em>Condition</em> <strong>1</strong> is <strong>not</strong> satisfied. Block <strong>2</strong> is executed if <em>Condition</em> <strong>1</strong> <strong>OR</strong> <em>Condition</em> <strong>2</strong> <strong>is</strong> satisfied.</p>
<p>In many cases, the same result could be obtained by a more traditional APL approach using <code class="docutils literal notranslate"><span class="pre">∨</span></code>: <code class="docutils literal notranslate"><span class="pre">:If</span> <span class="pre">(Condition</span> <span class="pre">1)</span> <span class="pre">∨</span> <span class="pre">(Condition</span> <span class="pre">2)</span></code>.</p>
<p>However, suppose that Block <strong>1</strong> and/or <em>Condition</em> <strong>2</strong> need a lot of computing time.</p>
<ul class="simple">
<li><p>The traditional APL solution will always evaluate both <em>Condition</em> <strong>1</strong> and <em>Condition</em> <strong>2</strong>, combine the results, and decide what to do.</p></li>
<li><p>With the “<code class="docutils literal notranslate"><span class="pre">:OrIf</span></code>” technique, if <em>Condition</em> <strong>1</strong> is satisfied, Block <strong>2</strong> will be immediately executed, and neither Block <strong>1</strong> nor <em>Condition</em> <strong>2</strong> will be evaluated. This may sometimes save a lot of processing time.</p></li>
</ul>
<p>Using the <code class="docutils literal notranslate"><span class="pre">:OrIf</span></code> clause will thus enable what is usually referred to as <em>short-circuiting</em> in other programming languages.</p>
<p>Note that the optional Block <strong>1</strong> may be useful to prepare the variables to be referenced in <em>Condition</em> <strong>2</strong>, but can also be omitted.</p>
<p>We have a similar structure with the <code class="docutils literal notranslate"><span class="pre">:AndIf</span></code> clause, as seen in <a class="reference internal" href="#fig-control-flow-andif"><span class="std std-numref">Fig. 5.15</span></a>:</p>
<div class="figure align-default" id="control-flow-andif">
<span id="fig-control-flow-andif"></span><img alt="_images/Control_Flow_AndIf.png" src="_images/Control_Flow_AndIf.png" />
<p class="caption"><span class="caption-number">Fig. 5.15 </span><span class="caption-text">A diagram with the usage of <code class="docutils literal notranslate"><span class="pre">:AndIf</span></code>.</span><a class="headerlink" href="#control-flow-andif" title="Permalink to this image">#</a></p>
</div>
<p>Again, Block <strong>0</strong> and Block <strong>3</strong> will always be executed. Block <strong>1</strong> is optional and will only be executed if <em>Condition</em> <strong>1</strong> <strong>is</strong> satisfied. Likewise, <em>Condition</em> <strong>2</strong> will be executed only if <em>Condition</em> <strong>1</strong> is satisfied. Finally, Block <strong>2</strong> is executed if both <em>Condition</em> <strong>1</strong> <strong>AND</strong> <em>Condition</em> <strong>2</strong> are satisfied.</p>
<div class="tip admonition">
<p class="admonition-title">Rule</p>
<p>For <code class="docutils literal notranslate"><span class="pre">:OrIf</span></code> and <code class="docutils literal notranslate"><span class="pre">:AndIf</span></code>, Block <strong>1</strong> and <em>Condition</em> <strong>2</strong> are only executed if the result of <em>Condition</em> <strong>1</strong> is <strong>not</strong> enough to determine the result of the Boolean operation combining conditions <strong>1</strong> and <strong>2</strong>.</p>
</div>
<p>In many cases, the same result could be obtained by a more traditional APL approach using <code class="docutils literal notranslate"><span class="pre">∧</span></code>: <code class="docutils literal notranslate"><span class="pre">:If</span> <span class="pre">(Condition</span> <span class="pre">1)</span> <span class="pre">∧</span> <span class="pre">(Condition</span> <span class="pre">2)</span></code>.</p>
<p>However, it may be that <em>Condition</em> <strong>2</strong> cannot be evaluated if <em>Condition</em> <strong>1</strong> is not satisfied. For example, we want to execute Block <strong>2</strong> if the variable <code class="docutils literal notranslate"><span class="pre">var</span></code> exists and is smaller than the argument <code class="docutils literal notranslate"><span class="pre">arg</span></code>. It is obvious that <code class="docutils literal notranslate"><span class="pre">var&lt;arg</span></code> cannot be evaluated if the variable <code class="docutils literal notranslate"><span class="pre">var</span></code> does not even exist. The two conditions must be evaluated separately:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">CheckVar</span><span class="w"> </span><span class="nv">arg</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="m">2</span><span class="o">=</span><span class="nf">⎕NC</span><span class="s1">&#39;var&#39;</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;var exists&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">AndIf</span><span class="w"> </span><span class="nv">var</span><span class="o">&lt;</span><span class="nv">arg</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;var is smaller than arg&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">var</span></code> doesn’t exist as a variable in our workspace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: var
      var
      ∧
</pre></div>
</div>
</div>
</div>
<p>Hence <code class="docutils literal notranslate"><span class="pre">CheckVar</span></code> should do nothing and return 0:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CheckVar</span><span class="w"> </span><span class="m">1000</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>If <em>Condition</em> <strong>1</strong> is not satisfied neither Block <strong>1</strong> nor <em>Condition</em> <strong>2</strong> are executed. This may also save some computing time in more complex tradfns.</p>
<p>Now we set <code class="docutils literal notranslate"><span class="pre">var</span></code> to some value and we can then check it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">500</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CheckVar</span><span class="w"> </span><span class="m">1000</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">var exists
var is smaller than arg
1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CheckVar</span><span class="w"> </span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">var exists
0
</span></div></div>
</div>
<p>Note that you may not combine <code class="docutils literal notranslate"><span class="pre">:OrIf</span></code> and <code class="docutils literal notranslate"><span class="pre">:AndIf</span></code> within the same control structure. The following code will generate a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">surface</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">BadSyntaxTradfn</span><span class="w"> </span><span class="nv">args</span><span class="sr">;</span><span class="w"> </span><span class="nv">width</span><span class="sr">;</span><span class="w"> </span><span class="nv">length</span><span class="sr">;</span><span class="w"> </span><span class="nv">height</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">width</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="nv">height</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">args</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">width</span><span class="o">&lt;</span><span class="m">20</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">AndIf</span><span class="w"> </span><span class="nv">length</span><span class="o">&lt;</span><span class="m">100</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">OrIf</span><span class="w"> </span><span class="nv">height</span><span class="o">&lt;</span><span class="m">5</span><span class="w"></span>
<span class="w">        </span><span class="nv">surface</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">        </span><span class="nv">surface</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">width</span><span class="o">×</span><span class="nv">length</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">BadSyntaxTradfn</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SYNTAX ERROR
BadSyntaxTradfn[2] :If width&lt;20
                            ∧
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cascading-conditions-elseif-else">
<span id="user-defined-functions-cascading-conditions-elseifelse"></span><h4><span class="section-number">5.7.2.4. </span>Cascading Conditions (<code class="docutils literal notranslate"><span class="pre">:ElseIf</span></code>/<code class="docutils literal notranslate"><span class="pre">:Else</span></code>)<a class="headerlink" href="#cascading-conditions-elseif-else" title="Permalink to this headline">#</a></h4>
<p>Sometimes, if the first condition is not satisfied, perhaps a second or a third one will be. In each case, a different set of statements will be executed. This type of logic may be controlled by one or more “<code class="docutils literal notranslate"><span class="pre">:ElseIf</span></code>” clauses. And if none of these conditions are satisfied, perhaps another block of statements is to be executed; this may be controlled by a final “<code class="docutils literal notranslate"><span class="pre">:Else</span></code>”, as we have seen earlier.</p>
<p>Depending on the problem, “<code class="docutils literal notranslate"><span class="pre">:Else</span></code>” may be present or not. If there is no “<code class="docutils literal notranslate"><span class="pre">:Else</span></code>” clause and no condition has been satisfied, nothing will be executed inside the <code class="docutils literal notranslate"><span class="pre">:If</span></code> block.</p>
<div class="figure align-default" id="control-flow-elseif">
<span id="fig-control-flow-elseif"></span><img alt="_images/Control_Flow_ElseIf.png" src="_images/Control_Flow_ElseIf.png" />
<p class="caption"><span class="caption-number">Fig. 5.16 </span><span class="caption-text">A diagram with multiple usages of <code class="docutils literal notranslate"><span class="pre">:ElseIf</span></code> clauses.</span><a class="headerlink" href="#control-flow-elseif" title="Permalink to this image">#</a></p>
</div>
<p>By now, you should be able to tell by yourself that Block <strong>0</strong> and Block <strong>5</strong> in <a class="reference internal" href="#fig-control-flow-elseif"><span class="std std-numref">Fig. 5.16</span></a>, if present, will always be executed.</p>
<p>For the conditions and the remaining blocks, a simple rule applies:</p>
<div class="tip admonition">
<p class="admonition-title">Rule</p>
<p>Using <a class="reference internal" href="#fig-control-flow-elseif"><span class="std std-numref">Fig. 5.16</span></a> as reference for the rule examples:</p>
<blockquote>
<div><ul class="simple">
<li><p>the conditions are executed in turn, until one of them is satisfied. When one condition is satisfied, its corresponding block is executed. For example, if <em>Condition</em> <strong>1</strong> is not satisfied and <em>Condition</em> <strong>2</strong> <strong>is</strong> satisfied, then Block <strong>2</strong> <strong>is</strong> executed;</p></li>
<li><p>as soon as one condition is satisfied and its block is executed, all other conditions and blocks inside the <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:EndIf</span></code> control structure are ignored. For example, if <em>Condition</em> <strong>2</strong> is the first condition to be satisfied, then <em>Condition</em> <strong>3</strong> is <strong>not</strong> executed (<strong>even</strong> if <em>Condition</em> <strong>3</strong> would be satisfied), as neither are Block <strong>3</strong> nor Block <strong>4</strong>; and</p></li>
<li><p>if none of the conditions is satisfied and an <code class="docutils literal notranslate"><span class="pre">:Else</span></code> clause is present, then its corresponding block is executed. For example, if conditions <strong>1</strong> to <strong>3</strong> are not satisfied, then Block <strong>4</strong> is satisfied.</p></li>
</ul>
<p>Hence, all conditional blocks (blocks <strong>1</strong> to <strong>4</strong>) are mutually exclusive.</p>
</div></blockquote>
</div>
<p>For example, suppose that the first condition is <code class="docutils literal notranslate"><span class="pre">var&lt;100</span></code> and the second is <code class="docutils literal notranslate"><span class="pre">var&lt;200</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">var</span></code> happens to be equal to 33, it is both smaller than 100 and 200, but only the block of statements attached to <code class="docutils literal notranslate"><span class="pre">var&lt;100</span></code> will be executed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">VarLevels</span><span class="w"> </span><span class="nv">var</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">var</span><span class="o">&lt;</span><span class="m">100</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;var is &lt; than 100&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">100</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">ElseIf</span><span class="w"> </span><span class="nv">var</span><span class="o">&lt;</span><span class="m">200</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;var is &lt; than 200&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">200</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;var is too big&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">var</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">VarLevels</span><span class="w"> </span><span class="m">33</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">var is &lt; than 100
100
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">VarLevels</span><span class="w"> </span><span class="m">133</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">var is &lt; than 200
200
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">VarLevels</span><span class="w"> </span><span class="m">350</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">var is too big
350
</span></div></div>
</div>
</div>
<div class="section" id="alternative-solutions">
<span id="user-defined-functions-alternative-solutions"></span><h4><span class="section-number">5.7.2.5. </span>Alternative Solutions<a class="headerlink" href="#alternative-solutions" title="Permalink to this headline">#</a></h4>
<p>Now you know how to use control structures to write conditional expressions. However, this does not mean that you always <em>have to</em> or <em>should</em> use control structures. The richness of the APL language often makes it more convenient to express condition calculations using a more mathematical approach.</p>
<p>For example, suppose that you need to comment on the result of a football or rugby match by displaying “<em>Won</em>”, “<em>Draw</em>” or “<em>Lost</em>”, depending on the scores of the two teams. Here are two solutions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">x</span><span class="o">&gt;</span><span class="nv">y</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Won&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">ElseIf</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="nv">y</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Draw&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Lost&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Won
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Draw
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Lost
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">which</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="o">+×</span><span class="nv">x</span><span class="o">-</span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="s1">&#39;LostDrawWon &#39;</span><span class="p">)</span><span class="sr">[</span><span class="nv">which</span><span class="sr">;]</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Won 
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Draw
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="nv">Comment</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Lost
</span></div></div>
</div>
<p>Which solution you prefer is probably a matter of taste and previous experience, both yours and of whoever is to read and maintain the programs you write. Notice that only the second solution is suitable for a dfn.</p>
</div>
</div>
<div class="section" id="disparate-conditions">
<span id="user-defined-functions-disparate-conditions"></span><h3><span class="section-number">5.7.3. </span>Disparate Conditions<a class="headerlink" href="#disparate-conditions" title="Permalink to this headline">#</a></h3>
<div class="section" id="clauses-select-case-caselist">
<span id="user-defined-functions-clauses-selectcasecaselist"></span><h4><span class="section-number">5.7.3.1. </span>Clauses (<code class="docutils literal notranslate"><span class="pre">:Select</span></code>/<code class="docutils literal notranslate"><span class="pre">:Case</span></code>/<code class="docutils literal notranslate"><span class="pre">:CaseList</span></code>)<a class="headerlink" href="#clauses-select-case-caselist" title="Permalink to this headline">#</a></h4>
<p>Sometimes it is necessary to execute completely different sets of statements, depending on the value of a specific <em>control expression</em>, hereafter called the <em>control value</em>.</p>
<p>To achieve this, we use “<code class="docutils literal notranslate"><span class="pre">:Select</span></code>”, with additional “<code class="docutils literal notranslate"><span class="pre">:Case</span></code>” or “<code class="docutils literal notranslate"><span class="pre">:CaseList</span></code>” clauses.</p>
<p>The sequence begins with <code class="docutils literal notranslate"><span class="pre">:Select</span></code> followed by the <em>control expression</em>.</p>
<p>It is then followed by any number of blocks, each of which will be executed if the <em>control value</em> is equal to one of the values specified in the corresponding clause:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:Case</span></code> for a single value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:CaseList</span></code> for a list of possible values.</p></li>
</ul>
<p>The sequence ends with <code class="docutils literal notranslate"><span class="pre">:EndSelect</span></code>.</p>
<p>You can have as many <code class="docutils literal notranslate"><span class="pre">:Case</span></code> or <code class="docutils literal notranslate"><span class="pre">:CaseList</span></code> clauses as you need and in any order.</p>
<p>If the control value is not equal to any of the specified values, nothing is executed, unless there is one final <code class="docutils literal notranslate"><span class="pre">:Else</span></code> clause.</p>
<p>Like with <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:ElseIf...</span> <span class="pre">:Else</span></code>, the blocks are mutually exclusive. The <code class="docutils literal notranslate"><span class="pre">:Case</span></code> statements are examined from the top and once a match is found and the corresponding block of statements has been executed, execution will continue with the first line after the <code class="docutils literal notranslate"><span class="pre">:EndSelect</span></code> statement - even if the <em>control value</em> matches other <code class="docutils literal notranslate"><span class="pre">:Case</span></code> or <code class="docutils literal notranslate"><span class="pre">:CaseList</span></code> statements.</p>
<p>In <a class="reference internal" href="#fig-control-flow-select"><span class="std std-numref">Fig. 5.17</span></a>, the <em>control expression</em> is simply <code class="docutils literal notranslate"><span class="pre">District</span></code> and the <em>control value</em> is whatever value the variable holds. Then, Block <strong>1</strong> is executed if <code class="docutils literal notranslate"><span class="pre">District</span></code> is equal to 50, Block <strong>2</strong> is executed if <code class="docutils literal notranslate"><span class="pre">District</span></code> is equal to 19 and Block <strong>3</strong> is executed if <code class="docutils literal notranslate"><span class="pre">District</span></code> is equal to 41, 42 or 53, but not if <code class="docutils literal notranslate"><span class="pre">District</span></code> is equal to 50. In that case, Block <strong>1</strong> will already have been executed and the execution won’t reach this <code class="docutils literal notranslate"><span class="pre">:CaseList</span></code>. Therefore, we conclude that including 50 in this <code class="docutils literal notranslate"><span class="pre">:CaseList</span></code> is superfluous and we better remove it to avoid any confusion. Finally, Block <strong>4</strong> is only executed if <code class="docutils literal notranslate"><span class="pre">District</span></code> is not equal to any of the values listed above.</p>
<div class="figure align-default" id="control-flow-select">
<span id="fig-control-flow-select"></span><img alt="_images/Control_Flow_Select.png" src="_images/Control_Flow_Select.png" />
<p class="caption"><span class="caption-number">Fig. 5.17 </span><span class="caption-text">A diagram with the usage of <code class="docutils literal notranslate"><span class="pre">:Select</span></code>, <code class="docutils literal notranslate"><span class="pre">:Case</span></code> and <code class="docutils literal notranslate"><span class="pre">:CaseList</span></code>.</span><a class="headerlink" href="#control-flow-select" title="Permalink to this image">#</a></p>
</div>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>Values specified in <code class="docutils literal notranslate"><span class="pre">:Case</span></code> or <code class="docutils literal notranslate"><span class="pre">:CaseList</span></code> clauses can be numbers, characters or even nested arrays.</p>
</div>
<p>Here is an example using all of those:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">arg</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">CasePotpourri</span><span class="w"> </span><span class="nv">arg</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Select</span><span class="w"> </span><span class="nv">arg</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">CaseList</span><span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"> </span><span class="s1">&#39;no&#39;</span><span class="w"> </span><span class="s1">&#39;doubt&#39;</span><span class="w">  </span><span class="c1">⍝ 3 possible values</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;yes no doubt&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">CaseList</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">7</span><span class="p">)(</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="s1">&#39;Null&#39;</span><span class="w">    </span><span class="c1">⍝ 3 different possible vectors</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;some vector&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Case</span><span class="w"> </span><span class="s1">&#39;BERLIN&#39;</span><span class="w">                </span><span class="c1">⍝ 1 single word</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">CaseList</span><span class="w"> </span><span class="s1">&#39;PARIS&#39;</span><span class="w">             </span><span class="c1">⍝ 5 possible letters</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;A French letter&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;no match...&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndSelect</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CasePotpourri</span><span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">yes no doubt
yes
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CasePotpourri</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">some vector
2 7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CasePotpourri</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A French letter
I
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CasePotpourri</span><span class="w"> </span><span class="s1">&#39;BERLIN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Germany
BERLIN
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CasePotpourri</span><span class="w"> </span><span class="s1">&#39;PARIS&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">no match...
PARIS
</span></div></div>
</div>
<p>Be careful with the last three examples where a character vector is used, and the relevant <code class="docutils literal notranslate"><span class="pre">:Case</span> <span class="pre">'BERLIN'</span></code> and <code class="docutils literal notranslate"><span class="pre">:CaseList</span> <span class="pre">'PARIS'</span></code> clauses in the tradfn:</p>
<ul class="simple">
<li><p>if the keyword is <code class="docutils literal notranslate"><span class="pre">:Case</span></code>, the control value must match the entire character vector “<code class="docutils literal notranslate"><span class="pre">'BERLIN'</span></code>”; and</p></li>
<li><p>if the keyword is <code class="docutils literal notranslate"><span class="pre">:CaseList</span></code>, the control value may be any one letter out of the five letters in “<code class="docutils literal notranslate"><span class="pre">'PARIS'</span></code>”. Any subset, like “<code class="docutils literal notranslate"><span class="pre">'PAR'</span></code>” will not be recognised as matching.</p></li>
</ul>
<div class="warning admonition">
<p class="admonition-title">Warning</p>
<p>The control value must be <strong>strictly</strong> identical to the value(s) specified in the <code class="docutils literal notranslate"><span class="pre">:Case</span></code> clause(s), i.e. the result of using <code class="docutils literal notranslate"><span class="pre">≡</span></code> with the control value and the matching value in the clause should be 1.</p>
</div>
<p>For example, in the preceding diagram, there is a clause <code class="docutils literal notranslate"><span class="pre">:Case</span> <span class="pre">50</span></code> (scalar). If the control value is equal to <code class="docutils literal notranslate"><span class="pre">1⍴50</span></code> (a one-item vector), it is not strictly identical to the specified array (the scalar <code class="docutils literal notranslate"><span class="pre">50</span></code>) and the corresponding set of statements will <strong>not</strong> be executed. In fact,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">50</span><span class="o">≡</span><span class="p">(</span><span class="m">1</span><span class="o">⍴</span><span class="m">50</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
</div>
</div>
<div class="section" id="predefined-loops">
<span id="user-defined-functions-predefined-loops"></span><h3><span class="section-number">5.7.4. </span>Predefined Loops<a class="headerlink" href="#predefined-loops" title="Permalink to this headline">#</a></h3>
<div class="section" id="basic-use-for-in-endfor">
<span id="user-defined-functions-basic-use-forinendfor"></span><h4><span class="section-number">5.7.4.1. </span>Basic Use (<code class="docutils literal notranslate"><span class="pre">:For</span></code>/<code class="docutils literal notranslate"><span class="pre">:In</span></code>/<code class="docutils literal notranslate"><span class="pre">:EndFor</span></code>)<a class="headerlink" href="#basic-use-for-in-endfor" title="Permalink to this headline">#</a></h4>
<p>In many iterative calculations a set of statements is repeated over and over again, and on each iteration a new value is given to a particular variable. We will refer to this variable as the <em>control variable</em>.</p>
<p>If the values of the control variable can be predefined before the beginning of the loop, we recommend that you use the <code class="docutils literal notranslate"><span class="pre">:For</span></code> clause, with the following syntax: <code class="docutils literal notranslate"><span class="pre">:For</span> <span class="pre">controlVariable</span> <span class="pre">:In</span> <span class="pre">listOfValues</span></code>.</p>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">:For</span></code> is followed by the name of the control variable. In the same statement, the keyword <code class="docutils literal notranslate"><span class="pre">:In</span></code> is followed by an expression returning the list of values to be assigned to the control variable on each iteration. Here is an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">ZapMe</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">zap</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">82</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">zap</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">zap</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ZapMe</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">50
82
27
11
11
</span></div></div>
</div>
<p>The block of statements between the <code class="docutils literal notranslate"><span class="pre">:For</span></code> and <code class="docutils literal notranslate"><span class="pre">:EndFor</span></code> will be executed 4 times: once with <code class="docutils literal notranslate"><span class="pre">zap</span> <span class="pre">←</span> <span class="pre">50</span></code>, then with <code class="docutils literal notranslate"><span class="pre">zap</span> <span class="pre">←</span> <span class="pre">82</span></code>, then with <code class="docutils literal notranslate"><span class="pre">zap</span> <span class="pre">←</span> <span class="pre">27</span></code>, and finally with <code class="docutils literal notranslate"><span class="pre">zap</span> <span class="pre">←</span> <span class="pre">11</span></code>.</p>
<p>Generally, the block of statements makes some reference to the <em>control variable</em>, for example as part of a calculation, but this is not mandatory.</p>
<p>This technique has one great advantage: the number of iterations is predefined, and it is impossible to accidentally program an endless loop.</p>
</div>
<div class="section" id="control-of-iterations">
<span id="user-defined-functions-control-of-iterations"></span><h4><span class="section-number">5.7.4.2. </span>Control of Iterations<a class="headerlink" href="#control-of-iterations" title="Permalink to this headline">#</a></h4>
<p>The values assigned to the control variable can be whatever values are needed by the algorithm:</p>
<ul class="simple">
<li><p>a list of numeric values like <code class="docutils literal notranslate"><span class="pre">66+4×⍳20</span></code>;</p></li>
<li><p>a nested vector like <code class="docutils literal notranslate"><span class="pre">(5</span> <span class="pre">4)(3</span> <span class="pre">0</span> <span class="pre">8)(4</span> <span class="pre">7)(2</span> <span class="pre">5</span> <span class="pre">9)</span></code>;</p></li>
<li><p>a list of letters like <code class="docutils literal notranslate"><span class="pre">'DYALOG'</span></code>; or</p></li>
<li><p>a list of words like <code class="docutils literal notranslate"><span class="pre">'Madrid'</span> <span class="pre">'Paris'</span> <span class="pre">'Tokyo'</span> <span class="pre">'Ushuaia'</span></code>.</p></li>
</ul>
<p>It is also possible to use a <em>set</em> of control values, rather than just a single one.</p>
<p>For example, with <code class="docutils literal notranslate"><span class="pre">:For</span> <span class="pre">(code</span> <span class="pre">qty)</span> <span class="pre">:In</span> <span class="pre">(5</span> <span class="pre">8)(2</span> <span class="pre">3)(7</span> <span class="pre">4)</span></code> the loop will be executed:</p>
<ul class="simple">
<li><p>first with <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">←</span> <span class="pre">5</span></code> and <code class="docutils literal notranslate"><span class="pre">qty</span> <span class="pre">←</span> <span class="pre">8</span></code>;</p></li>
<li><p>then with <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">←</span> <span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">qty</span> <span class="pre">←</span> <span class="pre">3</span></code>; and</p></li>
<li><p>finally with <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">←</span> <span class="pre">7</span></code> and <code class="docutils literal notranslate"><span class="pre">qty</span> <span class="pre">←</span> <span class="pre">4</span></code>.</p></li>
</ul>
<p>In most cases, this kind of iterative process is executed to completion. However, it is possible to take an early exit when some condition or other is met. This can be done using the <code class="docutils literal notranslate"><span class="pre">:Leave</span></code> clause or using an explicit branch, like will be explained later.</p>
<p>A special variant of <code class="docutils literal notranslate"><span class="pre">:In</span></code> named <code class="docutils literal notranslate"><span class="pre">:InEach</span></code> is explained in <a class="reference internal" href="#user-defined-functions-ineach"><span class="std std-numref">Section 5.16.8</span></a> at the end of this chapter.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Let us try to find all the possible divisors of a given integer.</p>
</div>
<p>A possible solution is to check the remainder of that value against all integers starting from 1, up to the number itself. If the remainder is 0, the integer can be appended to the vector of results, which has been initialised as an empty vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">divs</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Divisors</span><span class="w"> </span><span class="nv">n</span><span class="sr">;</span><span class="w"> </span><span class="nv">rem</span><span class="sr">;</span><span class="w"> </span><span class="nv">div</span><span class="w"></span>
<span class="w">    </span><span class="nv">divs</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="no">⍬</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">div</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="o">⍳</span><span class="nv">n</span><span class="w"></span>
<span class="w">        </span><span class="nv">rem</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">div</span><span class="o">|</span><span class="nv">n</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">rem</span><span class="o">=</span><span class="m">0</span><span class="w"></span>
<span class="w">            </span><span class="nv">divs</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">divs</span><span class="o">,</span><span class="nv">div</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Divisors</span><span class="w"> </span><span class="m">3219</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 3 29 37 87 111 1073 3219
</span></div></div>
</div>
<p>This example hopefully shows that it is straightforward to write simple, predefined loops using control structures. If you are used to other programming languages that do not offer array processing features, you may even find this way of writing programs very natural.</p>
<p>However, it turns out that many simple, predefined loops like this one are very tightly coupled to the structure or values of the data that they are working on: the number of items in a list, the number of rows in a matrix or, as in this example, the number of positive integers less than or equal to a particular value.</p>
<p>In such cases it is very often possible to express the entire algorithm in a very straightforward way, without any explicit loops. Usually the result is a much shorter program that is much easier to read and which runs considerably faster than the solution using explicit loops.</p>
<p>For example, in the example above it is possible to replace the loop by a vector of possible divisors produced by the <em>index generator</em>. The algorithm is unchanged, but the program is shorter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">DivisorsNoLoops</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="m">0</span><span class="o">=</span><span class="p">(</span><span class="o">⍳</span><span class="bp">⍵</span><span class="p">)</span><span class="o">|</span><span class="bp">⍵</span><span class="p">)</span><span class="na">/</span><span class="o">⍳</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DivisorsNoLoops</span><span class="w"> </span><span class="m">3219</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 3 29 37 87 111 1073 3219
</span></div></div>
</div>
<p>and about 100 times faster:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">runtime</span><span class="w"> </span><span class="o">-</span><span class="nv">c</span><span class="w"> </span><span class="s1">&#39;Divisors 3219&#39;</span><span class="w"> </span><span class="s1">&#39;DivisorsNoLoops 3219&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">                                                                                
  Divisors 3219        → 1.7E¯3 |   0% ⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕ 
  DivisorsNoLoops 3219 → 2.1E¯5 | -99%                                          
</span></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">]runtime</span> <span class="pre">-c</span></code> is a user command that can be used to compare two or more pieces of code. It uses the first expression as the baseline and then compares the run time of the subsequent pieces of code against the first one. Here, the <code class="docutils literal notranslate"><span class="pre">-99%</span></code> on the second line means <code class="docutils literal notranslate"><span class="pre">DivisorsNoLoops</span></code> is 100 times faster, which can also be understood by comparing the run times (in seconds) of each expression, the <code class="docutils literal notranslate"><span class="pre">1.1E¯3</span></code> and <code class="docutils literal notranslate"><span class="pre">1.1E¯5</span></code> above (the exact numbers might fluctuate, depending on factors like how the CPU is feeling, the machine the code gets ran on, etc.)</p>
<p>Of course, sometimes the processing that is to take place inside the loop is so complex that it is infeasible to rewrite the program so that it doesn’t use an explicit loop. For example, the existence of a dependency such that the calculations taking place in one iteration are dependent on the results produced in the previous iteration will generally make it harder to write a program without an explicit loop.</p>
</div>
</div>
<div class="section" id="conditional-loops">
<span id="user-defined-functions-conditional-loops"></span><h3><span class="section-number">5.7.5. </span>Conditional Loops<a class="headerlink" href="#conditional-loops" title="Permalink to this headline">#</a></h3>
<p>In the previous section we used the term “predefined loop” because the number of iterations was controlled by an expression executed before the loop starts. It is also possible to program loops which are repeated until a given condition is satisfied.</p>
<p>Two methods are available:</p>
<ul class="simple">
<li><p>using <code class="docutils literal notranslate"><span class="pre">:Repeat...</span> <span class="pre">:Until</span></code>; and</p></li>
<li><p>using <code class="docutils literal notranslate"><span class="pre">:While...</span> <span class="pre">:EndWhile</span></code>.</p></li>
</ul>
<p>The two methods are similar, but there are some important differences:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:Repeat</span></code>:</p>
<ul>
<li><p>when the loop is initialised, the condition is <strong>not</strong> yet satisfied (generally);</p></li>
<li><p>the program loops <em>until</em> this condition <strong>becomes</strong> satisfied;</p></li>
<li><p>the “Loop or Stop” test is placed at the <strong>bottom</strong> of the loop; and</p></li>
<li><p>the instructions in the loop are executed at least once.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">:While</span></code>:</p>
<ul>
<li><p>when the loop is initialised, the condition <strong>is</strong> (generally) satisfied;</p></li>
<li><p>the program loops as long as it <strong>remains</strong> satisfied;</p></li>
<li><p>the “Loop or Stop” test is placed at the <strong>beginning</strong> of the loop; and</p></li>
<li><p>the instructions in the loop may not be executed at all.</p></li>
</ul>
</li>
</ul>
<div class="section" id="bottom-controlled-loop-repeat-until">
<span id="user-defined-functions-bottom-controlled-loop-repeatuntil"></span><h4><span class="section-number">5.7.5.1. </span>Bottom-Controlled Loop (<code class="docutils literal notranslate"><span class="pre">:Repeat</span></code>/<code class="docutils literal notranslate"><span class="pre">:Until</span></code>)<a class="headerlink" href="#bottom-controlled-loop-repeat-until" title="Permalink to this headline">#</a></h4>
<p>The control variables involved in the test are often initialised before the loop begins, but they can be created during the execution of the loop because the test is placed at the bottom.</p>
<p>Then the block of statements delimited by <code class="docutils literal notranslate"><span class="pre">:Repeat...</span> <span class="pre">:Until</span></code> is executed repeatedly up to the point where the condition specified after <code class="docutils literal notranslate"><span class="pre">:Until</span></code> becomes satisfied.</p>
<p>This condition may involve one or more variables. It is obvious that the statements contained in the loop must modify some of those control variables, or import them from an external source, so that the condition is satisfied after a limited number of iterations. This is the programmer’s responsibility.</p>
<p>Here is an example usage of <code class="docutils literal notranslate"><span class="pre">:Repeat...</span> <span class="pre">:Until</span></code> to calculate after how many years an investment reaches a target value, if it grows at a fixed rate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">years</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">rate</span><span class="w"> </span><span class="nv">ComputeGrowthTime</span><span class="w"> </span><span class="nv">values</span><span class="sr">;</span><span class="w"> </span><span class="nv">amount</span><span class="sr">;</span><span class="w"> </span><span class="nv">target</span><span class="w"></span>
<span class="w">    </span><span class="nv">years</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">amount</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">values</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Repeat</span><span class="w"></span>
<span class="w">        </span><span class="nv">amount</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">amount</span><span class="o">×</span><span class="m">1</span><span class="o">+</span><span class="nv">rate</span><span class="w">   </span><span class="c1">⍝ accumulate interest</span><span class="w"></span>
<span class="w">        </span><span class="nv">years</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">years</span><span class="o">+</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Until</span><span class="w"> </span><span class="nv">amount</span><span class="o">≥</span><span class="nv">target</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0.02</span><span class="w"> </span><span class="nv">ComputeGrowthTime</span><span class="w"> </span><span class="m">10000</span><span class="w"> </span><span class="m">25000</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">47
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0.03</span><span class="w"> </span><span class="nv">ComputeGrowthTime</span><span class="w"> </span><span class="m">10000</span><span class="w"> </span><span class="m">25000</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">31
</span></div></div>
</div>
<p>This means that if you invested 10.000 in an investment that grew 2% every year, then your investment’s value would surpass 25.000 after 47 years. If the growth rate is 3% instead, you would need 31 years instead.</p>
<p>The test is made on the bottom line of the loop, immediately after <code class="docutils literal notranslate"><span class="pre">:Until</span></code>, so the loop is executed at least once.</p>
<p>The “Loop or Stop” control is made at the bottom of each loop, but it is also possible to add one or more intermediate conditions which cause an exit from the loop using a <code class="docutils literal notranslate"><span class="pre">:Leave</span></code> clause or a <em>branch arrow</em> (this will be explained in <a class="reference internal" href="#user-defined-functions-modern-and-traditional-controls-cooperate"><span class="std std-numref">Section 5.7.9</span></a>).</p>
<div class="remark admonition">
<p class="admonition-title">special case </p>
<p>It is possible to replace <code class="docutils literal notranslate"><span class="pre">:Until</span></code> with <code class="docutils literal notranslate"><span class="pre">:EndRepeat</span></code>. However, because there is no longer a loop control expression, the program would loop endlessly. For this reason it is necessary to employ intermediate tests to exit the loop when using this technique.</p>
</div>
</div>
<div class="section" id="top-controlled-loop-while-endwhile">
<span id="user-defined-functions-top-controlled-loop-whileendwhile"></span><h4><span class="section-number">5.7.5.2. </span>Top-Controlled Loop (<code class="docutils literal notranslate"><span class="pre">:While</span></code>/<code class="docutils literal notranslate"><span class="pre">:EndWhile</span></code>)<a class="headerlink" href="#top-controlled-loop-while-endwhile" title="Permalink to this headline">#</a></h4>
<p>Because the test is now placed at the top of the loop, control variables involved in the test must be initialised before the loop begins.</p>
<p>Then the block of statements limited by <code class="docutils literal notranslate"><span class="pre">:While</span></code>/<code class="docutils literal notranslate"><span class="pre">:EndWhile</span></code> will be executed repeatedly as long as the condition specified after <code class="docutils literal notranslate"><span class="pre">:While</span></code> remains satisfied.</p>
<p>This condition may involve one or more variables. It is obvious that the statements contained in the loop must modify some of those control variables so that the condition is satisfied after a limited number of iterations. This is the programmer’s responsibility.</p>
<p>As an example, let us implement a function that takes a positive integer and computes its <a class="reference external" href="https://en.wikipedia.org/wiki/Collatz_conjecture">“Collatz path”</a>. The Collatz path of a positive integer is built by starting at the number given and then:</p>
<ul class="simple">
<li><p>if the number <span class="math notranslate nohighlight">\(n\)</span> you are at is odd, go to <span class="math notranslate nohighlight">\(3n + 1\)</span>; or</p></li>
<li><p>if the number <span class="math notranslate nohighlight">\(n\)</span> you are at is even, go to <span class="math notranslate nohighlight">\(\frac{n}{2}\)</span>.</p></li>
</ul>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Collatz_conjecture">Collatz conjecture</a> states that any positive integer eventually goes to 1. This tradfn can help us visualise this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">CollatzPath</span><span class="w"> </span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="nv">path</span><span class="sr">[</span><span class="o">≢</span><span class="nv">path</span><span class="sr">]</span><span class="o">≠</span><span class="m">1</span><span class="w"></span>
<span class="w">        </span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">path</span><span class="sr">[</span><span class="o">≢</span><span class="nv">path</span><span class="sr">]</span><span class="w"></span>
<span class="w">        </span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">((</span><span class="nv">n</span><span class="o">÷</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="m">3</span><span class="o">×</span><span class="nv">n</span><span class="p">))</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">|</span><span class="nv">n</span><span class="sr">]</span><span class="w"></span>
<span class="w">        </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">path</span><span class="o">,</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">11 34 17 52 26 13 40 20 10 5 16 8 4 2 1
</span></div></div>
</div>
<p>The test is made in the top line of the loop, immediately after <code class="docutils literal notranslate"><span class="pre">:While</span></code>, so it is possible that the block of statements inside the loop will never be executed. In our case, when <code class="docutils literal notranslate"><span class="pre">CollatzPath</span></code> is called with 1 as its argument.</p>
<p>The “Loop or Stop” control is made at each beginning of a new iteration but it is also possible to add a second control at the bottom of the loop, replacing <code class="docutils literal notranslate"><span class="pre">:EndWhile</span></code> with a <code class="docutils literal notranslate"><span class="pre">:Until</span></code> clause, just like we did for the <code class="docutils literal notranslate"><span class="pre">:Repeat</span></code> loop.</p>
</div>
</div>
<div class="section" id="exception-control">
<span id="user-defined-functions-exception-control"></span><h3><span class="section-number">5.7.6. </span>Exception Control<a class="headerlink" href="#exception-control" title="Permalink to this headline">#</a></h3>
<div class="section" id="skip-to-the-next-iteration-continue">
<span id="user-defined-functions-skip-to-the-next-iteration-continue"></span><h4><span class="section-number">5.7.6.1. </span>Skip to the Next Iteration (<code class="docutils literal notranslate"><span class="pre">:Continue</span></code>)<a class="headerlink" href="#skip-to-the-next-iteration-continue" title="Permalink to this headline">#</a></h4>
<p>In any kind of loop (<code class="docutils literal notranslate"><span class="pre">:For</span></code>-<code class="docutils literal notranslate"><span class="pre">:EndFor</span></code>/<code class="docutils literal notranslate"><span class="pre">:Repeat</span></code>-<code class="docutils literal notranslate"><span class="pre">:Until</span></code>/<code class="docutils literal notranslate"><span class="pre">:While</span></code>-<code class="docutils literal notranslate"><span class="pre">:EndWhile</span></code>) this clause indicates that the program must abandon the current iteration and skip to the next one:</p>
<ul class="simple">
<li><p>in a <code class="docutils literal notranslate"><span class="pre">:For</span></code> loop, this means that the next value(s) of the control variable(s) are set, and the execution continues from the line immediately below the <code class="docutils literal notranslate"><span class="pre">:For</span></code> statement;</p></li>
<li><p>in a <code class="docutils literal notranslate"><span class="pre">:Repeat</span></code> loop, this means that the execution continues from the line immediately below the <code class="docutils literal notranslate"><span class="pre">:Repeat</span></code> statement; and</p></li>
<li><p>in a <code class="docutils literal notranslate"><span class="pre">:While</span></code> loop, this means that the execution continues from the line containing the <code class="docutils literal notranslate"><span class="pre">:While</span></code> statement.</p></li>
</ul>
<p>For the <code class="docutils literal notranslate"><span class="pre">:For</span></code> loop, the execution only proceeds inside the loop if there are any more values for the control variable(s) to take. Similarly, we only execute more iterations of the <code class="docutils literal notranslate"><span class="pre">:Repeat</span></code> and <code class="docutils literal notranslate"><span class="pre">:While</span></code> loops if their conditions still allow.</p>
<p>Consider this tradfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">ContinueInsideWhile</span><span class="w"> </span><span class="nv">r</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="nv">r</span><span class="o">&gt;</span><span class="m">0</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;start of the loop&#39;</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">Continue</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;bottom of the loop&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯3</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ContinueInsideWhile</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">start of the loop
2
start of the loop
1
0
</span></div></div>
</div>
<p>Because of the <code class="docutils literal notranslate"><span class="pre">:Continue</span></code> clause, we never hit the second print and the assignment that would set <code class="docutils literal notranslate"><span class="pre">r</span></code> to -3. When <code class="docutils literal notranslate"><span class="pre">r</span></code> is decreased to 0 and we hit the <code class="docutils literal notranslate"><span class="pre">:Continue</span></code> clause, the control expression in front of the <code class="docutils literal notranslate"><span class="pre">:While</span></code> is evaluated and because <code class="docutils literal notranslate"><span class="pre">0&gt;0</span></code> evaluates to 0, the whole <code class="docutils literal notranslate"><span class="pre">:While</span></code> loop is finally finished.</p>
<p>Usually, <code class="docutils literal notranslate"><span class="pre">:Continue</span></code> statements are nested within other control structures so that we only skip a part of the loop if certain conditions are met.</p>
</div>
<div class="section" id="leave-the-loop-leave">
<span id="user-defined-functions-leave-the-loop-leave"></span><h4><span class="section-number">5.7.6.2. </span>Leave the Loop (<code class="docutils literal notranslate"><span class="pre">:Leave</span></code>)<a class="headerlink" href="#leave-the-loop-leave" title="Permalink to this headline">#</a></h4>
<p>This clause causes the program to stop the current iteration and to skip any future iterations, aborting the loop immediately, and continuing execution from the line immediately below the bottom end of the loop.</p>
<p><code class="docutils literal notranslate"><span class="pre">:Leave</span></code> works with any kind of loop.</p>
</div>
<div class="section" id="jump-to-another-statement-goto">
<span id="user-defined-functions-jump-to-another-statement-goto"></span><h4><span class="section-number">5.7.6.3. </span>Jump to Another Statement (<code class="docutils literal notranslate"><span class="pre">:GoTo</span></code>)<a class="headerlink" href="#jump-to-another-statement-goto" title="Permalink to this headline">#</a></h4>
<p>This clause is used to explicitly jump from the current statement to another one, with the following syntax: <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">destination</span></code>.</p>
<p>In most cases, <code class="docutils literal notranslate"><span class="pre">destination</span></code> is the <em>label</em> of another statement in the same program.</p>
<p>A <em>label</em> is a word placed at the beginning of a statement followed by a colon. It is used as a reference to the statement. It can be followed by an APL expression, but for readability it is recommended that you put a label on a line of its own. For example, in</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Next</span><span class="bp">:</span><span class="w"></span>
<span class="nv">val</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">goal</span><span class="o">-</span><span class="nv">val</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Next</span></code> is a <em>label</em>. <code class="docutils literal notranslate"><span class="pre">Next</span></code> is considered by the interpreter to be a variable whose value is the number of the line on which it is placed. It is used as a destination point both by the traditional <em>branch arrow</em> and by the <code class="docutils literal notranslate"><span class="pre">:GoTo</span></code> clause, like this: <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">Next</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">→Next</span></code> (cf. <a class="reference internal" href="#user-defined-functions-traditional-flow-control"><span class="std std-numref">Section 5.7.8</span></a>). Be careful not to include the colon after the branch name when referencing to it after a <code class="docutils literal notranslate"><span class="pre">:GoTo</span></code> or after a <code class="docutils literal notranslate"><span class="pre">→</span></code>.</p>
<div class="section" id="jump-destinations">
<span id="user-defined-functions-jump-destinations"></span><h5><span class="section-number">5.7.6.3.1. </span>Jump Destinations<a class="headerlink" href="#jump-destinations" title="Permalink to this headline">#</a></h5>
<p>The following conventions apply to the <code class="docutils literal notranslate"><span class="pre">destination</span></code> of a jump:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">destination</span></code></p></th>
<th class="text-align:left head"><p>Behaviour of executing <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">destination</span></code> or <code class="docutils literal notranslate"><span class="pre">→destination</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Valid label</p></td>
<td class="text-align:left"><p>Skip to the statement referenced by that label.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td class="text-align:left"><p>Quit the current function and return to the calling environment.</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">⍬</span></code></p></td>
<td class="text-align:left"><p>Do not jump anywhere but continue on to the next statement.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="quit-this-function-return">
<span id="user-defined-functions-quit-this-function-return"></span><h4><span class="section-number">5.7.6.4. </span>Quit This Function (<code class="docutils literal notranslate"><span class="pre">:Return</span></code>)<a class="headerlink" href="#quit-this-function-return" title="Permalink to this headline">#</a></h4>
<p>This clause causes the tradfn to terminate immediately and has exactly the same effect as <code class="docutils literal notranslate"><span class="pre">→0</span></code> or <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">0</span></code>. Control returns to the calling environment.</p>
</div>
</div>
<div class="section" id="endless-loops">
<span id="user-defined-functions-endless-loops"></span><h3><span class="section-number">5.7.7. </span>Endless Loops<a class="headerlink" href="#endless-loops" title="Permalink to this headline">#</a></h3>
<p>Whatever your skills you may inadvertently create a function which runs endlessly. Usually this is due to an inappropriate loop definition.</p>
<p>However, sometimes APL may appear to be unnecessarily executing the same set of statements again and again in an endless loop, when in fact it just has to process a very large amount of data or perform some heavy calculations.</p>
<p>Fortunately you can interrupt the execution of a function using two kinds of interrupts: weak and strong. Let us see what this means.</p>
<div class="section" id="a-slow-function">
<span id="user-defined-functions-a-slow-function"></span><h4><span class="section-number">5.7.7.1. </span>A Slow Function<a class="headerlink" href="#a-slow-function" title="Permalink to this headline">#</a></h4>
<p>Let us consider the function below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">Endless</span><span class="sr">;</span><span class="w"> </span><span class="nv">i</span><span class="w"></span>
<span class="w">    </span><span class="nv">i</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Repeat</span><span class="w"></span>
<span class="w">        </span><span class="nf">⎕DL</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">        </span><span class="o">⊢</span><span class="nv">i</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Until</span><span class="w"> </span><span class="nv">i</span><span class="o">=</span><span class="m">20</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>This function is not really endless, but the line <code class="docutils literal notranslate"><span class="pre">⎕DL</span> <span class="pre">3</span></code> makes it DeLay all execution for (approximately) 3 seconds, so the whole loop should take about a minute to finish execution. (You will learn more about <code class="docutils literal notranslate"><span class="pre">⎕DL</span></code> and related functions later down the road.)</p>
<p>The line <code class="docutils literal notranslate"><span class="pre">⊢i</span> <span class="pre">←</span> <span class="pre">i+1</span></code> has the final <code class="docutils literal notranslate"><span class="pre">⊢</span></code> so the iteration number is printed as the loop progresses. However, if you are running the Jupyter Notebook version of this chapter, the numbers only show up after the iterations are all complete. This is due to a current shortcoming of the Dyalog APL kernel.</p>
<p><strong><center>Don’t run this function yet!</center></strong></p>
</div>
<div class="section" id="weak-and-strong-interrupts">
<span id="user-defined-functions-weak-and-strong-interrupts"></span><h4><span class="section-number">5.7.7.2. </span>Weak and Strong Interrupts<a class="headerlink" href="#weak-and-strong-interrupts" title="Permalink to this headline">#</a></h4>
<p>If you issue a <em>weak interrupt</em>, the computer will complete the execution of the statement that it is currently processing. Then it will halt the function before executing the next statement. We recommend using a weak interrupt whenever possible because it allows the user to restart the function at the point it was interrupted (cf. <a class="reference internal" href="First-Aid-Kit.html"><span class="doc std std-doc">the chapter with the first aid kit</span></a>).</p>
<p>If you issue a <em>strong interrupt</em>, the computer will complete the execution of the APL primitive that it is currently processing. Then it will interrupt the function before executing the next primitive.</p>
<p>For example, in the <code class="docutils literal notranslate"><span class="pre">Endless</span></code> function above, it could calculate <code class="docutils literal notranslate"><span class="pre">i+1</span></code> and stop before executing the assignment <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">←</span> <span class="pre">i+1</span></code>. Of course, if the user restarts the statement, it will be executed again in its entirety (it is impossible to resume execution in the middle of a statement).</p>
<p>Note that it is impossible to interrupt the execution of a primitive like <code class="docutils literal notranslate"><span class="pre">i+1</span></code> itself, and sometimes the execution of some primitives may take a long time.</p>
</div>
<div class="section" id="how-can-you-generate-an-interrupt">
<span id="user-defined-functions-how-can-you-generate-an-interrupt"></span><h4><span class="section-number">5.7.7.3. </span>How Can You Generate an Interrupt<a class="headerlink" href="#how-can-you-generate-an-interrupt" title="Permalink to this headline">#</a></h4>
<p>If you are using the Windows IDE, by going to “Action” ⇨ “Interrupt” you can issue a <em>weak interrupt</em>. Similarly, RIDE’s “Action” ⇨ “Weak Interrupt” will do the trick.</p>
<p>In order to issue a strong interrupt, you either:</p>
<ul class="simple">
<li><p>go to “Action” ⇨ “Strong Interrupt” if you are using RIDE; or</p></li>
<li><p>if you are using the Windows IDE, go to the system tray, look for the Dyalog APL icon, click it and then select “Strong Interrupt” (cf. <a class="reference internal" href="#fig-win-strong-interrupt"><span class="std std-numref">Fig. 5.18</span></a>).</p></li>
</ul>
<div class="figure align-default" id="win-strong-interrupt">
<span id="fig-win-strong-interrupt"></span><img alt="_images/Win_Strong_Interrupt.png" src="_images/Win_Strong_Interrupt.png" />
<p class="caption"><span class="caption-number">Fig. 5.18 </span><span class="caption-text">Issuing a strong interrupt in the Windows IDE.</span><a class="headerlink" href="#win-strong-interrupt" title="Permalink to this image">#</a></p>
</div>
<p>The method explained above for the strong interrupts on the Windows IDE also works for weak interrupts. <strong>Be patient!</strong> If Dyalog APL is doing some heavy calculations for you, there may be a few seconds delay from when you click the APL icon until the menu shown above appears.</p>
<p>After you issue an interrupt (weak or strong) there may be a few more seconds delay before the interrupt actually occurs.</p>
<p>Now, let’s test it.</p>
</div>
<div class="section" id="first-a-weak-interrupt">
<span id="user-defined-functions-first-a-weak-interrupt"></span><h4><span class="section-number">5.7.7.4. </span>First a Weak Interrupt<a class="headerlink" href="#first-a-weak-interrupt" title="Permalink to this headline">#</a></h4>
<p>Start running the function and, after a couple of iterations, issue a weak interrupt as you learned in the previous section.</p>
<p>Sadly, the Jupyter Notebook interface has limited capability for dealing with interrupts, so for the remainder of this explanation you will be presented with some figures to illustrate the process.</p>
<p>If we define the tradfn on the Windows IDE, run it and then hit “Action” ⇨ “Interrupt”, what happens is illustrated in <a class="reference internal" href="#fig-win-endless-weak-interrupt"><span class="std std-numref">Fig. 5.19</span></a>.</p>
<div class="figure align-default" id="win-endless-weak-interrupt">
<span id="fig-win-endless-weak-interrupt"></span><img alt="_images/Win_Endless_Weak_Interrupt.png" src="_images/Win_Endless_Weak_Interrupt.png" />
<p class="caption"><span class="caption-number">Fig. 5.19 </span><span class="caption-text">A weak interrupt issued in the Windows IDE.</span><a class="headerlink" href="#win-endless-weak-interrupt" title="Permalink to this image">#</a></p>
</div>
<p>Notice the <code class="docutils literal notranslate"><span class="pre">Endless[4]</span></code> message is below the few iteration numbers that were printed, and the stack trace window (that opened at the bottom) has highlighted that same line: line 4. This means that the function has been interrupted just before executing line number 4, and you can be sure that line 3 has finished.</p>
<p>To back out from the interrupted state of execution, press the <kbd>Esc</kbd> key as many times as needed, or execute the command <code class="docutils literal notranslate"><span class="pre">)reset</span></code>, which will be explained shortly.</p>
</div>
<div class="section" id="and-now-a-strong-interrupt">
<span id="user-defined-functions-and-now-a-strong-interrupt"></span><h4><span class="section-number">5.7.7.5. </span>And Now a Strong Interrupt<a class="headerlink" href="#and-now-a-strong-interrupt" title="Permalink to this headline">#</a></h4>
<p>Run the function again, and after some time issue a strong interrupt.</p>
<p>The result should be slightly different, as you can see in <a class="reference internal" href="#fig-win-endless-strong-interrupt"><span class="std std-numref">Fig. 5.20</span></a>:</p>
<div class="figure align-default" id="win-endless-strong-interrupt">
<span id="fig-win-endless-strong-interrupt"></span><img alt="_images/Win_Endless_Strong_Interrupt.png" src="_images/Win_Endless_Strong_Interrupt.png" />
<p class="caption"><span class="caption-number">Fig. 5.20 </span><span class="caption-text">A strong interrupt issued in the Windows IDE.</span><a class="headerlink" href="#win-endless-strong-interrupt" title="Permalink to this image">#</a></p>
</div>
<p>This time, the message <code class="docutils literal notranslate"><span class="pre">Endless[3]</span> <span class="pre">⎕DL</span> <span class="pre">3</span></code> tells you the line it was executing when it got interrupted, and the caret sign tells you which operation was being carried over. In this case, we did not let the 3 second delay finish.</p>
</div>
</div>
<div class="section" id="traditional-flow-control">
<span id="user-defined-functions-traditional-flow-control"></span><h3><span class="section-number">5.7.8. </span>Traditional Flow Control<a class="headerlink" href="#traditional-flow-control" title="Permalink to this headline">#</a></h3>
<p>In early versions of APL, a unique symbol - the <em>branch arrow</em> (<code class="docutils literal notranslate"><span class="pre">→</span></code>, typed with <kbd>APL</kbd>+<kbd>]</kbd>) - provided the only means to override the order in which statements were executed. Today you should only use this mechanism when maintaining code which is already written in this style.</p>
<p>The <em>branch arrow</em> works in exactly the same way as the <code class="docutils literal notranslate"><span class="pre">:GoTo</span></code> clause. <code class="docutils literal notranslate"><span class="pre">→destination</span></code> and <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">destination</span></code> are strictly equivalent.</p>
<p><code class="docutils literal notranslate"><span class="pre">destination</span></code> should <strong>always</strong> be a <em>label</em>. Remember: a <em>label</em> is a word placed at the beginning of a statement and <strong>followed</strong> by a <em>colon</em>. Specifying a statement number (i.e. <code class="docutils literal notranslate"><span class="pre">→47</span></code>) would become incorrect as soon as you add or remove lines before that line number.</p>
<div class="section" id="equivalence-with-modern-flow-control">
<span id="user-defined-functions-equivalence-with-modern-flow-control"></span><h4><span class="section-number">5.7.8.1. </span>Equivalence With Modern Flow Control<a class="headerlink" href="#equivalence-with-modern-flow-control" title="Permalink to this headline">#</a></h4>
<p>Using small tricks makes it possible to use <code class="docutils literal notranslate"><span class="pre">→</span></code> to emulate the modern keywords that control the flow of a program. Figuring out how to emulate all the keywords can be an interesting <em>educational exercise</em> but those tricks should be avoided in modern code.</p>
<p>As an example, we will see how we can emulate an <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:EndIf</span></code> clause. For that, you need to remember that jumping to an empty <code class="docutils literal notranslate"><span class="pre">destination</span></code> does nothing (cf. <a class="reference internal" href="#user-defined-functions-jump-destinations"><span class="std std-numref">Section 5.7.6.3.1</span></a>), so that statements are executed sequentially.</p>
<p>Consider the following program:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="nv">IsItExpensive</span><span class="w"> </span><span class="nv">money</span><span class="w"></span>
<span class="w">    </span><span class="kd">→</span><span class="p">(</span><span class="o">~</span><span class="nv">price</span><span class="o">≤</span><span class="nv">money</span><span class="p">)</span><span class="o">⍴</span><span class="nv">expensive</span><span class="w">  </span><span class="c1">⍝[1]</span><span class="w"></span>
<span class="w">    </span><span class="nv">money</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">money</span><span class="o">-</span><span class="nv">price</span><span class="w">        </span><span class="c1">⍝[2]</span><span class="w"></span>
<span class="w">    </span><span class="nv">expensive</span><span class="bp">:</span><span class="w">                 </span><span class="c1">⍝[3]</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">13</span><span class="w"> </span><span class="nv">IsItExpensive</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">13</span><span class="w"> </span><span class="nv">IsItExpensive</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10
</span></div></div>
</div>
<p>The program above uses <code class="docutils literal notranslate"><span class="pre">(~price≤money)⍴expensive</span></code> to emulate an <code class="docutils literal notranslate"><span class="pre">:If</span></code> clause and the <code class="docutils literal notranslate"><span class="pre">expensive:</span></code> line acts as the <code class="docutils literal notranslate"><span class="pre">:EndIf</span></code> clause. If you have enough <code class="docutils literal notranslate"><span class="pre">money</span></code> to buy something that costs <code class="docutils literal notranslate"><span class="pre">price</span></code>, it will return how much money you have left after making the purchase. If you don’t have enough money, your money is returned unchanged.</p>
<p>Let us walk through the execution of the two example calls above to see exactly how this works:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">13</span> <span class="pre">IsItExpensive</span> <span class="pre">20</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">expensive</span></code> is the label that is defined on line 3, so its value is 3 as if it were a regular variable;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">price≤money</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code> because <code class="docutils literal notranslate"><span class="pre">13≤20</span></code> and hence <code class="docutils literal notranslate"><span class="pre">~price≤money</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(~price≤money)⍴expensive</span></code> is thus equivalent to <code class="docutils literal notranslate"><span class="pre">0⍴3</span></code> which evaluates to <code class="docutils literal notranslate"><span class="pre">⍬</span></code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">→⍬</span></code> does nothing (as explained in <a class="reference internal" href="#user-defined-functions-jump-destinations"><span class="std std-numref">Section 5.7.6.3.1</span></a>) and the program proceeds to lines 2 and 3.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">13</span> <span class="pre">IsItExpensive</span> <span class="pre">10</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">expensive</span></code> is the label that is defined on line 3, so its value is 3 as if it were a regular variable;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">price≤money</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code> because <code class="docutils literal notranslate"><span class="pre">13≤10</span></code> is not satisfied, hence <code class="docutils literal notranslate"><span class="pre">~price≤money</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(~price≤money)⍴expensive</span></code> is thus equivalent to <code class="docutils literal notranslate"><span class="pre">1⍴3</span></code> which evaluates to <code class="docutils literal notranslate"><span class="pre">3</span></code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">→3</span></code> makes the program jump to line 3, skipping line 2.</p></li>
</ul>
</li>
</ul>
<p>This kind of conditional jump can be summarised like <code class="docutils literal notranslate"><span class="pre">→(~condition)⍴</span> <span class="pre">destination</span></code>.</p>
<p>Using control structures, we would have written</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="nv">SaneIsItExpensive</span><span class="w"> </span><span class="nv">money</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">price</span><span class="o">≤</span><span class="nv">money</span><span class="w"></span>
<span class="w">        </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;I have enough money&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">money</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">money</span><span class="o">-</span><span class="nv">price</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">13</span><span class="w"> </span><span class="nv">SaneIsItExpensive</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">I have enough money
7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">13</span><span class="w"> </span><span class="nv">SaneIsItExpensive</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10
</span></div></div>
</div>
<p>or even better, without control structures at all we could write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">IsItExpensiveDfn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">-</span><span class="bp">⍺</span><span class="o">×</span><span class="bp">⍺</span><span class="o">≤</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">13</span><span class="w"> </span><span class="nv">IsItExpensiveDfn</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">13</span><span class="w"> </span><span class="nv">IsItExpensiveDfn</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10
</span></div></div>
</div>
<p>This example above shows that programming without explicit control flow is something that is quite feasible and, often times, very elegant.</p>
<p>In your road to mastering Dyalog APL you will want to train your brain to write programs more like the <code class="docutils literal notranslate"><span class="pre">IsItExpensiveDfn</span></code> above and less like the <code class="docutils literal notranslate"><span class="pre">SaneIsItExpensive</span></code>, and definitely not like the labelled <code class="docutils literal notranslate"><span class="pre">IsItExpensive</span></code>!</p>
</div>
<div class="section" id="multiple-destinations">
<span id="user-defined-functions-multiple-destinations"></span><h4><span class="section-number">5.7.8.2. </span>Multiple Destinations<a class="headerlink" href="#multiple-destinations" title="Permalink to this headline">#</a></h4>
<p>One can also use <code class="docutils literal notranslate"><span class="pre">→</span></code> with multiple labels on the right, in which case program execution jumps to the <em>first</em> label in the vector of labels. Just consider the following dummy program, where we use explicit line numbers so we can print them as the tradfn executes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">MultipleDestinations</span><span class="w"></span>
<span class="w">    </span><span class="kd">→</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
<span class="w">    </span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="m">3</span><span class="w"></span>
<span class="w">    </span><span class="m">4</span><span class="w"></span>
<span class="w">    </span><span class="m">5</span><span class="w"></span>
<span class="w">    </span><span class="m">6</span><span class="w"></span>
<span class="w">    </span><span class="m">7</span><span class="w"></span>
<span class="w">    </span><span class="m">8</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MultipleDestinations</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4
5
6
7
8
</span></div></div>
</div>
<p>Try changing the numbers in front of the <code class="docutils literal notranslate"><span class="pre">→</span></code> above and see how the numbers printed change.</p>
</div>
</div>
<div class="section" id="modern-and-traditional-controls-cooperate">
<span id="user-defined-functions-modern-and-traditional-controls-cooperate"></span><h3><span class="section-number">5.7.9. </span>Modern and Traditional Controls Cooperate<a class="headerlink" href="#modern-and-traditional-controls-cooperate" title="Permalink to this headline">#</a></h3>
<p>It is sometimes convenient to mix modern and traditional flow control in order to simplify the code.</p>
<p>Consider a loop in which we must terminate the execution of the function if the condition <code class="docutils literal notranslate"><span class="pre">x&lt;3</span></code> becomes satisfied. With modern control structures, the function would probably include a</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="na">...</span><span class="w"></span>
<span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">x</span><span class="o">&lt;</span><span class="m">3</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Return</span><span class="w"></span>
<span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="na">...</span><span class="w"></span>
</pre></div>
</div>
<p>which takes up 3 lines. This might be a bit cumbersome. It is possible to use fewer statements using an explicit branch:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="na">...</span><span class="w"></span>
<span class="bp">:</span><span class="nv">GoTo</span><span class="w"> </span><span class="p">(</span><span class="nv">x</span><span class="o">&lt;</span><span class="m">3</span><span class="p">)</span><span class="na">/</span><span class="m">0</span><span class="w"></span>
<span class="na">...</span><span class="w"></span>
</pre></div>
</div>
<p>or equivalently</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="na">...</span><span class="w"></span>
<span class="kd">→</span><span class="p">(</span><span class="nv">x</span><span class="o">&lt;</span><span class="m">3</span><span class="p">)</span><span class="na">/</span><span class="m">0</span><span class="w"></span>
<span class="na">...</span><span class="w"></span>
</pre></div>
</div>
<p>since the branch arrow and the <code class="docutils literal notranslate"><span class="pre">:GoTo</span></code> keyword are equivalent.</p>
<p>Something very similar could be written if we need to leave a loop when a given condition becomes satisfied. For example, instead of</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">:</span><span class="nv">Repeat</span><span class="w"></span>
<span class="w">    </span><span class="na">...</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">cond</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">Leave</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="w">    </span><span class="na">...</span><span class="w"></span>
<span class="bp">:</span><span class="nv">EndRepeat</span><span class="w"></span>
<span class="na">...</span><span class="w"></span>
</pre></div>
</div>
<p>one could write</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">:</span><span class="nv">Repeat</span><span class="w"></span>
<span class="w">    </span><span class="na">...</span><span class="w"></span>
<span class="w">    </span><span class="kd">→</span><span class="nv">cond</span><span class="na">/</span><span class="nv">hell</span><span class="w"></span>
<span class="w">    </span><span class="na">...</span><span class="w"></span>
<span class="bp">:</span><span class="nv">EndRepeat</span><span class="w"></span>
<span class="nv">hell</span><span class="bp">:</span><span class="w"></span>
<span class="na">...</span><span class="w"></span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>Branching using <code class="docutils literal notranslate"><span class="pre">→</span></code> or <code class="docutils literal notranslate"><span class="pre">:GoTo</span></code> is not recommended as a general tool for programming flow control. It is briefly explained here mainly in order to help you understand existing code and to show that the technique may be useful and feasible in special situations. You should, in general, either use control structures or avoid them altogether with alternative formulations of your algorithm(s).</p>
</div>
<div class="warning admonition">
<p class="admonition-title">Warning</p>
<p>Colons are placed <strong>before</strong> a keyword (e.g. <code class="docutils literal notranslate"><span class="pre">:For</span></code>) but <strong>after</strong> a label (e.g. <code class="docutils literal notranslate"><span class="pre">hell:</span></code> above).</p>
</div>
</div>
</div>
<div class="section" id="dfns-versus-tradfns">
<span id="user-defined-functions-dfns-versus-tradfns"></span><h2><span class="section-number">5.8. </span>Dfns Versus Tradfns<a class="headerlink" href="#dfns-versus-tradfns" title="Permalink to this headline">#</a></h2>
<!-- (TODO) Ask for feedback on this particular section. -->
<!-- (TODO) Write this section as a comparison between dfns and tradfns, when to use one or the other. -->
<div class="section" id="comparison">
<span id="user-defined-functions-comparison"></span><h3><span class="section-number">5.8.1. </span>Comparison<a class="headerlink" href="#comparison" title="Permalink to this headline">#</a></h3>
<p>Having seen how dfns and tradfns work in practice, it is time to compare their main characteristics, so that we can understand what are the use cases in which each of them shines.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Characteristic</p></th>
<th class="text-align:left head"><p>dfns</p></th>
<th class="text-align:left head"><p>tradfns</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Argument names</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⍺</span></code> is the left argument and <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is the right argument.</p></td>
<td class="text-align:left"><p>The names are specified in the header of the function.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Reassigning the arguments</p></td>
<td class="text-align:left"><p>Disallowed, except to define default left argument.</p></td>
<td class="text-align:left"><p>Allowed.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Return value</p></td>
<td class="text-align:left"><p>The value of the first statement whose value is not assigned to a variable.</p></td>
<td class="text-align:left"><p>The value of the variable specified in the header.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Shy result</p></td>
<td class="text-align:left"><p>Last expression needs to be an assignment and must be followed by the closing <code class="docutils literal notranslate"><span class="pre">}</span></code>.</p></td>
<td class="text-align:left"><p>Enclose the header variable in <code class="docutils literal notranslate"><span class="pre">{}</span></code>.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Variable scope</p></td>
<td class="text-align:left"><p>Local by default.</p></td>
<td class="text-align:left"><p>Global by default.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Traditional flow control</p></td>
<td class="text-align:left"><p>Limited to usage of guards, in the form of <code class="docutils literal notranslate"><span class="pre">condition:</span> <span class="pre">statement</span></code>.</p></td>
<td class="text-align:left"><p>Complex flow control with control structures such as <code class="docutils literal notranslate"><span class="pre">:If</span></code>, <code class="docutils literal notranslate"><span class="pre">:For</span></code>, and <code class="docutils literal notranslate"><span class="pre">:While</span></code>.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Scoping</p></td>
<td class="text-align:left"><p>Lexical.</p></td>
<td class="text-align:left"><p>Dynamic.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="use-cases">
<span id="user-defined-functions-use-cases"></span><h3><span class="section-number">5.8.2. </span>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">#</a></h3>
<p>Based on the characteristics of both dfns and tradfns, there a few <em>rules of thumb</em> that help determine the situations in which dfns are more suitable and the situations in which tradfns are more suitable.
Please, bear in mind that these are just guidelines to help you pick the right tool for the job, but ultimately the choice is yours and will boil down to your experience, personal preference, the context you are programming in, etc.</p>
<p>As already mentioned before, dfns shine when one wants to create a user-defined function with a clean and well-defined data flow, taking some arguments in and processing them to produce a result.
Functions of this sort are usually such that they always return the same value when given the same arguments, which means you can have a high degree of confidence that the function works as expected provided you test it thoroughly.</p>
<p>Tradfns are very helpful when you need to create a more complex function, or something that resembles a script in other languages, and you simply need the type of flow control that tradfns offer.
In those cases, it makes sense to have a tradfn that represents the program you want to create, and then the tradfn itself calls several other functions (that could very well be dfns) that process the arguments and do useful things with them.
On top of that, if you have a complex function that is not working as it should, you may find it easier to debug if it contains control structures rather than if the flow control of the program were controlled by recursion or operators: with control structures you get more fine-grained control over where in the code you want to start debugging and how to do it.
We will explore these ideas in more detail in <a class="reference internal" href="First-Aid-Kit.html"><span class="doc std std-doc">the “First Aid Kit” chapter</span></a>.</p>
<p>From the characteristics of both types of user-defined functions, it also follows that if you want to create a relatively short function, a dfn is probably the best option:
dfns are very simple to define and the definitions themselves take up little space (as opposed to tradfns whose headers take up more space, especially if you then localise all the variables you use – which you generally should).
As an example, in <a class="reference external" href="https://www.dyalogaplcompetition.com/">Dyalog’s annual APL problem solving competition</a>, the first ten problems usually have a one-line solution, and those have to be submitted as dfns.</p>
</div>
</div>
<div class="section" id="input-output-and-format">
<span id="user-defined-functions-input-output-and-format"></span><h2><span class="section-number">5.9. </span>Input, Output and Format<a class="headerlink" href="#input-output-and-format" title="Permalink to this headline">#</a></h2>
<p>Up to now, our functions processed values passed as arguments, and returned results which could be used in an expression, assigned to a variable, or displayed. But a function can also get data from other sources and/or it can produce results which are not APL variables, but, for example, printed material or data files. In this section you will learn some useful techniques to write such functions.</p>
<p>This section will also help you use data that you may have already have stored in Excel worksheets or in text files on disk.</p>
<div class="section" id="some-input-and-output-methods">
<span id="user-defined-functions-some-input-and-output-methods"></span><h3><span class="section-number">5.9.1. </span>Some Input and Output Methods<a class="headerlink" href="#some-input-and-output-methods" title="Permalink to this headline">#</a></h3>
<p>Here are some of the most typical methods used by a function to get input data or output results.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Some Input/Output methods</p></th>
<th class="text-align:center head"><p>Input</p></th>
<th class="text-align:center head"><p>Output</p></th>
<th class="text-align:center head"><p>cf.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Display a result returned at function completion</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Display intermediate values during execution</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-displaying-intermediate-results"><span class="std std-numref">Section 5.9.3</span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Use or modify a global variable</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-using-global-variables"><span class="std std-numref">Section 5.9.4</span></a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Exchange data with a spreadsheet (e.g. Microsoft Excel)</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-exchanging-data-with-an-excel-worksheet"><span class="std std-numref">Section 5.9.5.3</span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Read or write data from/to a file (or a database)</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-reading-or-writing-a-text-file"><span class="std std-numref">Section 5.9.6</span></a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Print data on a printer</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-printing-results-on-a-printer"><span class="std std-numref">Section 5.9.7</span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Exchange data with a graphical user interface</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-using-a-graphical-user-interface"><span class="std std-numref">Section 5.9.8</span></a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Get data typed by the user on the keyboard</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-requesting-values-from-the-keyboard"><span class="std std-numref">Section 5.9.9</span></a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Use Internet facilities to get/send data</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p><a class="reference internal" href="#user-defined-functions-fetching-data-from-the-web"><span class="std std-numref">Section 5.9.10</span></a></p></td>
</tr>
</tbody>
</table>
<p>Not all of these possibilities will be explained here; we shall limit our investigations to some simple methods that you may test immediately, using some utility functions we define for you. “I/O” is a common abbreviation for “input and output”.</p>
<p>We also provide some text files and spreadsheets that you can use for experimentation:</p>
<ul class="simple">
<li><p>a CSV file <code class="docutils literal notranslate"><span class="pre">BasicCarSales.csv</span></code>;</p></li>
<li><p>text files <code class="docutils literal notranslate"><span class="pre">mlk.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">report.txt</span></code>.</p></li>
</ul>
<p>We recommend that you place those files in a reference directory where they will be preserved, and copy them to a test directory where you will be able to make some experiments and modify them at will. You can get these helper files from <a class="reference external" href="https://github.com/RojerGS/MDAPL/blob/master/../res/testfiles.rar">here</a>.</p>
<p>We also suggest that you create a global variable in your WS with the path to that test directory, to avoid repeating it in all the tests you will do.</p>
<p>For example, we will set</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">filepath</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We recommend that you set this global variable with the <em>absolute path</em> to the folder as it is easier to get an absolute path to work.</p>
<p>In the following sections we will refer to this variable <code class="docutils literal notranslate"><span class="pre">filepath</span></code>.</p>
</div>
<div class="section" id="format">
<span id="user-defined-functions-format"></span><h3><span class="section-number">5.9.2. </span>Format<a class="headerlink" href="#format" title="Permalink to this headline">#</a></h3>
<p>In the preceding pages we found that we can display, on the screen, any kind of results: numbers, text or a mixture of numbers and characters in nested arrays. Now we shall try to output data to external media, like graphic interfaces, disk files or printers. Most of those media only accept text. For example, it is impossible to send numbers to a printer: we must first convert them to printable characters.</p>
<p>The APL language includes two such conversion tools: a function named <em>format</em>, represented by the symbol <code class="docutils literal notranslate"><span class="pre">⍕</span></code> and typed with <kbd>APL</kbd>+<kbd>’</kbd>, and a <em>system function</em> named <code class="docutils literal notranslate"><span class="pre">⎕FMT</span></code>. You can remember <code class="docutils literal notranslate"><span class="pre">⍕</span></code>’s position on the keyboard because <code class="docutils literal notranslate"><span class="pre">⍕</span></code> transforms its argument into a character array, and you input characters with a quote <code class="docutils literal notranslate"><span class="pre">'</span></code>, hence <code class="docutils literal notranslate"><span class="pre">⍕</span></code> is <kbd>APL</kbd>+<kbd>’</kbd>.</p>
<p>These facilities will be studied in detail in <a class="reference internal" href="Execute-and-Format-Control.html"><span class="doc std std-doc">a subsequent chapter</span></a> but we will introduce here the basic use of <em>format</em>.</p>
<div class="section" id="monadic-format">
<span id="user-defined-functions-monadic-format"></span><h4><span class="section-number">5.9.2.1. </span>Monadic Format<a class="headerlink" href="#monadic-format" title="Permalink to this headline">#</a></h4>
<p>Monadic <em>format</em> converts any array (numbers, characters and nested arrays) into its character representation. The result is exactly the same as what you see when you display the array in the APL session, because in fact, APL internally uses monadic <em>format</em> to display arrays:</p>
<ul class="simple">
<li><p>character values are not converted: they remain unchanged; and</p></li>
<li><p>numeric and nested values are transformed into vectors or matrices of characters.</p></li>
</ul>
<p>Here are some examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⍕</span><span class="s1">&#39;album&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">chemistry</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="s1">&#39;H2SO4CaCO3Fe2O3&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H2SO4
CaCO3
Fe2O3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⍕</span><span class="nv">chemistry</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">'album'</span></code> and <code class="docutils literal notranslate"><span class="pre">chemistry</span></code> are left unchanged because they are character arrays.</p>
<p>However, the 3-item numeric vector</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="m">52</span><span class="w"> </span><span class="m">69</span><span class="w"> </span><span class="m">76</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3
</span></div></div>
</div>
<p>becomes an 8-item character vector once converted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⍕</span><span class="m">52</span><span class="w"> </span><span class="m">69</span><span class="w"> </span><span class="m">76</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8
</span></div></div>
</div>
<p>In <a class="reference internal" href="Data-and-Variables.html"><span class="doc std std-doc">a previous chapter</span></a> we used a 2 by 3 nested matrix named <code class="docutils literal notranslate"><span class="pre">nesMat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">nesMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;Dyalog&#39;</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⍴</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬───┬─────┐
│Dyalog│44 │Hello│
├──────┼───┼─────┤
│27    │8 6│1 2 0│
│      │2 4│0 0 5│
└──────┴───┴─────┘
</span></div></div>
</div>
<p>Notice this matrix has 2 rows and 3 columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">nesMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 3
</span></div></div>
</div>
<p>Once converted into text, it will become 20 characters wide and it will span 3 rows, because the second row of <code class="docutils literal notranslate"><span class="pre">nesMat</span></code> contained two small matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">u</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍕</span><span class="nv">nesMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 20
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">u</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> Dyalog   44  Hello 
     27  8 6  1 2 0 
         2 4  0 0 5 
</span></div></div>
</div>
</div>
<div class="section" id="dyadic-format">
<span id="user-defined-functions-dyadic-format"></span><h4><span class="section-number">5.9.2.2. </span>Dyadic Format<a class="headerlink" href="#dyadic-format" title="Permalink to this headline">#</a></h4>
<p>Dyadic <em>format</em> applies <strong>only</strong> to numeric values. It converts them into text in a format controlled by the left argument, which is made up of two numbers:</p>
<ul class="simple">
<li><p>the first number indicates the number of characters (the width of the output) to be used to represent each numeric value; and</p></li>
<li><p>the second number indicates how many decimal digits will be displayed.</p></li>
</ul>
<p>Let us make some experiments with the following matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="o">⊢</span><span class="nv">nm</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">200000</span><span class="p">)</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  21.21 1534.88 375.46  704.5
1125.14 1963.52 464.45 1438.25
 796.53 1569    157.14  886.59
</span></div></div>
</div>
<p>For example, if we want each number to be right aligned in a field with 8 characters of width and with 2 decimal digits, we’d use</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="o">⍕</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   21.21 1534.88  375.46  704.50
 1125.14 1963.52  464.45 1438.25
  796.53 1569.00  157.14  886.59
</span></div></div>
</div>
<p>The result has of course 3 rows and 32 columns (4 times 8 characters):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="o">⍕</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 32
</span></div></div>
</div>
<p>Instead, we may prefer to have each number in a cell 6 characters wide, with no decimal digits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="o">⍕</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">    21  1535   375   705
  1125  1964   464  1438
   797  1569   157   887
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="o">⍕</span><span class="nv">nm</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 24
</span></div></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>Values are not truncated, but <strong>rounded</strong>.</p>
</div>
<p>As an example, consider the second value of the first row:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nm</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1534.88
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="o">⍕</span><span class="nv">nm</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1535
</span></div></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>Any attempt to apply dyadic <code class="docutils literal notranslate"><span class="pre">⍕</span></code> to characters will cause a <code class="docutils literal notranslate"><span class="pre">DOMAIN</span> <span class="pre">ERROR</span></code>.</p>
</div>
<p><em>Format</em> will be studied in detail in <a class="reference internal" href="Execute-and-Format-Control.html"><span class="doc std std-doc">a later chapter</span></a>.</p>
</div>
</div>
<div class="section" id="displaying-intermediate-results">
<span id="user-defined-functions-displaying-intermediate-results"></span><h3><span class="section-number">5.9.3. </span>Displaying Intermediate Results<a class="headerlink" href="#displaying-intermediate-results" title="Permalink to this headline">#</a></h3>
<p>During normal execution, most applications do not use the session window (the development environment); all input/output is typically done with more user-friendly interfaces. However, during the development of an application, it may be useful for experimental or debugging purposes to have a function display intermediate results.</p>
<p>This can be accomplished in 2 different ways:</p>
<ul class="simple">
<li><p>inside a tradfn, if the result of an expression is not assigned to a variable it gets displayed;</p>
<ul>
<li><p>in particular, if you add <code class="docutils literal notranslate"><span class="pre">⊢</span></code> to the beginning of any line, that line will display its value, even if the line is an assignment (e.g. the line <code class="docutils literal notranslate"><span class="pre">⊢v</span> <span class="pre">←</span> <span class="pre">2×3</span></code> will assign 6 to <code class="docutils literal notranslate"><span class="pre">v</span></code> and display it);</p></li>
</ul>
</li>
<li><p>any intermediate result can be displayed by assigning it to the <em>quad</em> symbol (<code class="docutils literal notranslate"><span class="pre">⎕</span></code>, typed with <kbd>APL</kbd>+<kbd>l</kbd>), and this assignment can even be placed in the middle of statements to check intermediate values:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">chemistry</span><span class="sr">[</span><span class="m">1</span><span class="sr">;]</span><span class="o">,</span><span class="nv">chemistry</span><span class="sr">[</span><span class="m">3</span><span class="sr">;]</span><span class="p">)</span><span class="o">,</span><span class="vg">⎕</span><span class="kd">←</span><span class="o">,</span><span class="nv">chemistry</span><span class="sr">[</span><span class="vg">⎕</span><span class="kd">←</span><span class="o">⍸</span><span class="nv">chemistry</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┐
│1 2│3 3│
└───┴───┘
22
H2SO4Fe2O3
</span></div></div>
</div>
<p>Because we used <code class="docutils literal notranslate"><span class="pre">⎕←</span></code> three times, three values got displayed one after the other, on three successive lines of the screen, in the order that they were evaluated:</p>
<ol class="simple">
<li><p>   First <code class="docutils literal notranslate"><span class="pre">⍸chemistry='2'</span></code>,</p></li>
<li><p>   then <code class="docutils literal notranslate"><span class="pre">,chemistry[⍸chemistry='2']</span></code></p></li>
<li><p>   and then <code class="docutils literal notranslate"><span class="pre">chemistry[1;],chemistry[3;]</span></code>.</p></li>
</ol>
<p>We <strong>recommend</strong> that you use this last method, which is the most explicit and which can be easily detected by any text search utility function.
Following a similar reasoning, the use of implicit output by adding <code class="docutils literal notranslate"><span class="pre">⊢</span></code> to the left end of a statement is discouraged:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⊢</span></code> cannot be used to print intermediate results;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⊢</span></code> cannot be used in dfns because a dfn will return if an expression has a <code class="docutils literal notranslate"><span class="pre">⊢</span></code> on the left end; and</p></li>
<li><p>uses of <code class="docutils literal notranslate"><span class="pre">⊢</span></code> for the purpose of implicit output cannot be easily searched for, because <code class="docutils literal notranslate"><span class="pre">⊢</span></code> might be used for other purposes.</p></li>
</ul>
</div>
<div class="section" id="using-global-variables">
<span id="user-defined-functions-using-global-variables"></span><h3><span class="section-number">5.9.4. </span>Using Global Variables<a class="headerlink" href="#using-global-variables" title="Permalink to this headline">#</a></h3>
<p>A function can use (as input) or modify (as output) the contents of one or more variables which are global to it. The variables may be completely global, or they may be local to a calling function (so-called <em>semi-global</em> variables).</p>
<p>For example, as we suggested earlier, a global variable may contain a path used by dozens of functions in a workspace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">filepath</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/
</span></div></div>
</div>
<p>It will be possible for any function to use this path to prefix some file names, for example as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">file1</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">filepath</span><span class="o">,</span><span class="s1">&#39;sales.xls&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/sales.xls
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">file2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">filepath</span><span class="o">,</span><span class="s1">&#39;customers.txt&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/customers.txt
</span></div></div>
</div>
<p>Storing common parameters, like a folder path, in global variables can often be very convenient. For example, it makes it very easy to have the system use another set of files without changing any functions. This technique can for example be used to switch between running on test data and on production data.</p>
<p>Similarly, a function can output values into global variables, which may be used by many other functions sharing the same workspace.</p>
<p>You must be very cautious when using this technique:</p>
<ul class="simple">
<li><p>maintenance of functions using global variables is complex because it is difficult to keep track of the different statements which use or update those variables;</p></li>
<li><p>if an error occurs, and if several functions can modify these global variables, it may be very difficult to determine which of them had last modified a variable involved in the error; and</p></li>
<li><p>if function execution is interrupted and restarted, global values set before the interruption may conflict with new ones calculated in a different context. For example, if the function increments a global variable in line <code class="docutils literal notranslate"><span class="pre">[1]</span></code> but crashes in line <code class="docutils literal notranslate"><span class="pre">[2]</span></code>, and you restart the function, you will have the global variable incremented twice instead of once, as you had expected. Such errors are <em>very</em> nasty, as they can lead to other errors or breakdowns much later in the execution. It can be close to impossible to find the causes of such errors in a systematic way.</p></li>
</ul>
<p>Such a technique should be restricted to a limited number of variables, clearly identified and documented by any convenient method: a common name prefix, an automated system of references, etc.</p>
<p>Sometimes when starting an application it is necessary to read a lot of settings from a file and make the settings available to all the programs that constitute the application. In such a situation it would make sense to write a program to read the settings from the file and store them in global variables in the workspace.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>Whenever possible, favour explicit exchange of values through arguments and results.</p>
</div>
<div class="section" id="global-constants">
<span id="user-defined-functions-global-constants"></span><h4><span class="section-number">5.9.4.1. </span>Global Constants<a class="headerlink" href="#global-constants" title="Permalink to this headline">#</a></h4>
<p>Because of the reasons explained above, programmers are discouraged from writing new values to global variables, but from the text above it is also clear that global variables can be very useful.</p>
<p>In particular, it is often very useful to use global variables to store important pieces of information that are <em>constant</em> throughout the whole execution of your application. This way, these important pieces of information can be accessed from within your functions with ease. It is a common convention (and a convention that is not specific to APL) to name these global constants in all uppercase letters and to <strong>not</strong> update their values after the variable is initialised.</p>
<p>As an example, the folder in which our files reside can be declared as a global constant:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">FILEPATH</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Notice that from the language point of view, <code class="docutils literal notranslate"><span class="pre">FILEPATH</span></code> is just like any other variable and it <em>can</em> be modified:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">FILEPATH</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>So it is indeed up to the programmer to respect the convention or not. We will respect the convention and hence we’ll redefine <code class="docutils literal notranslate"><span class="pre">FILEPATH</span></code> to its original value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">FILEPATH</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="exchanging-data-with-a-csv-file">
<span id="user-defined-functions-exchanging-data-with-a-csv-file"></span><h3><span class="section-number">5.9.5. </span>Exchanging Data With a CSV File<a class="headerlink" href="#exchanging-data-with-a-csv-file" title="Permalink to this headline">#</a></h3>
<p>As per the Wikipedia,</p>
<blockquote>
<div><p><em>A Comma-Separated Values (CSV) file is a delimited text file that uses a comma to separate values. Each line of the file is a data record. Each record consists of one or more fields, separated by commas. The use of the comma as a field separator is the source of the name for this file format. A CSV file typically stores tabular data (numbers and text) in plain text, in which case each line will have the same number of fields.</em></p>
</div></blockquote>
<p>Even though the CSV format is not fully standardised, it is a fairly common format and is suitable for sharing simple data.</p>
<p>APL has many system functions for I/O with files, including a system function <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> to read and write data to CSV files.</p>
<div class="section" id="importing-data">
<span id="user-defined-functions-importing-data"></span><h4><span class="section-number">5.9.5.1. </span>Importing Data<a class="headerlink" href="#importing-data" title="Permalink to this headline">#</a></h4>
<p>Reading data from a CSV file can be as simple as giving it the path to the file you want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">contents</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕CSV</span><span class="w"> </span><span class="nv">FILEPATH</span><span class="o">,</span><span class="s1">&#39;BasicCarSales.csv&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FILE NAME ERROR: C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/BasicCarSales.csv: Unable to open file (&quot;The syste
m cannot find the path specified.&quot;)
      ⎕←contents←⎕CSV FILEPATH,&#39;BasicCarSales.csv&#39;
                 ∧
</pre></div>
</div>
</div>
</div>
<p>The return value is a matrix with one row per line of text in the file and one column per data entry:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">contents</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: contents
      ⍴contents
       ∧
</pre></div>
</div>
</div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> to read data and have it separate the header for you and convert columns into the appropriate data types. For example, we can tell <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> to convert columns 2, 3 and 4 to numbers and to split the header:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">contents</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕CSV</span><span class="w"> </span><span class="p">(</span><span class="nv">FILEPATH</span><span class="o">,</span><span class="s1">&#39;BasicCarSales.csv&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FILE NAME ERROR: C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/BasicCarSales.csv: Unable to open file (&quot;The syste
m cannot find the path specified.&quot;)
      ⎕←contents←⎕CSV(FILEPATH,&#39;BasicCarSales.csv&#39;)&#39;&#39;(1 2 2 2)1
                 ∧
</pre></div>
</div>
</div>
</div>
<p>More advanced use cases of <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> can be found in <span class="xref myst">the appropriate section</span> or in the documentation page for <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code>. As an exercise, open the <a class="reference external" href="https://help.dyalog.com/latest/#Language/System%20Functions/csv.htm">docs for <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code></a> (by clicking the link or typing <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> in your interpreter and then pressing <kbd>F1</kbd>) and try to understand what the <code class="docutils literal notranslate"><span class="pre">1</span></code> in <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">2)</span></code> does. Learning to read documentation pages may seem daunting at first, but it is an acquired skill that is very helpful for programmers.</p>
</div>
<div class="section" id="exporting-data">
<span id="user-defined-functions-exporting-data"></span><h4><span class="section-number">5.9.5.2. </span>Exporting Data<a class="headerlink" href="#exporting-data" title="Permalink to this headline">#</a></h4>
<p>Exporting data to a CSV file is done in a similar fashion, by passing in the data as the left argument to <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code>. The data given can be the whole table or a 2-element vector like above, where the first element is the data and the second one is the header. If the file didn’t exist already, one could write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">contents</span><span class="w"> </span><span class="nf">⎕CSV</span><span class="w"> </span><span class="nv">FILEPATH</span><span class="o">,</span><span class="s1">&#39;BasicCarSales.csv&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: contents
      contents ⎕CSV FILEPATH,&#39;BasicCarSales.csv&#39;
      ∧
</pre></div>
</div>
</div>
</div>
<p>to save <code class="docutils literal notranslate"><span class="pre">contents</span></code> in the specified file.</p>
<p>Because the file already exists, you can see that APL issues a <code class="docutils literal notranslate"><span class="pre">FILE</span> <span class="pre">NAME</span> <span class="pre">ERROR</span></code>. You can think of this as being similar to that prompt you get whenever you try to close a window with unsaved changes: it is annoying whenever you <em>really</em> want to close without saving and it asks you if you are sure, but you are glad it exists when you accidentally try to close the window amidst your work. To force <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> to overwrite an already existing file, you will first need to learn about <em>variant</em> in <a class="reference internal" href="Operators.html"><span class="doc std std-doc">the “Operators” chapter</span></a>.</p>
</div>
<div class="section" id="exchanging-data-with-an-excel-worksheet">
<span id="user-defined-functions-exchanging-data-with-an-excel-worksheet"></span><h4><span class="section-number">5.9.5.3. </span>Exchanging Data With an Excel Worksheet<a class="headerlink" href="#exchanging-data-with-an-excel-worksheet" title="Permalink to this headline">#</a></h4>
<p>Many applications are based on an intelligent partnership between Excel and APL:</p>
<ul class="simple">
<li><p>some users enter data in a set of worksheets with a predefined structure;</p></li>
<li><p>APL reads the sheets and processes the data with much greater power, precision and flexibility than Excel is capable of; and</p></li>
<li><p>finally, APL outputs results into one or more worksheets, in which the user can modify the presentation, define additional simple calculations and produce simple graphs.</p></li>
</ul>
<p>However, this only works out of the box if your operating system is Windows. The “loaddata.dws” workspace, distributed as part of the Dyalog APL system, contains a set of professional grade functions to read from and write to text files, Excel workbooks, CSV files, SQL databases and XML files.</p>
</div>
</div>
<div class="section" id="reading-or-writing-a-text-file">
<span id="user-defined-functions-reading-or-writing-a-text-file"></span><h3><span class="section-number">5.9.6. </span>Reading or Writing a Text File<a class="headerlink" href="#reading-or-writing-a-text-file" title="Permalink to this headline">#</a></h3>
<p>Files can have many different formats. Some contain integer or decimal numbers, some contain APL variables (vectors, arrays, nested values) as we shall see in <span class="xref myst">a future chapter</span>, but most files contain plain text.</p>
<p>In this chapter, we shall limit our investigations:</p>
<ul class="simple">
<li><p>to text files which can be viewed and modified using a basic text editor like Microsoft Notepad; and</p></li>
<li><p>to rather small files that can be read or written as a whole in a single operation (depending on your workspace size, you can easily read/write thousands of lines of text).</p></li>
</ul>
<p>Such a file can be considered as a long vector containing special line separation characters (“<em>carriage return</em>” and/or “<em>line feed</em>”). For that reason, when edited with Notepad, they look more or less like APL character matrices.</p>
<p>Except for special purposes, to exchange data between APL and a text file, one needs to:</p>
<ul class="simple">
<li><p>convert the read data from a file as a character vector into a more convenient APL character array (to read); or</p></li>
<li><p>convert an APL character array into a special character vector with embedded line separators (to write).</p></li>
</ul>
<p>Those conventions require some techniques we haven’t seen yet. This is the reason why we give you some predefined functions. You will find them in a workspace named <code class="docutils literal notranslate"><span class="pre">Files.dws</span></code> delivered with Dyalog APL. It contains a <em>namespace</em> (you can read about namespaces in their chapter) which itself contains the functions. To use them, you must:</p>
<ul class="simple">
<li><p>copy the <em>namespace</em> inside <code class="docutils literal notranslate"><span class="pre">Files.dws</span></code> into your active workspace (be careful with the case):</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">copy</span><span class="w"> </span><span class="nv">files</span><span class="w"> </span><span class="nv">Files</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">C:\Program Files\Dyalog\Dyalog APL-64 18.2 Unicode\ws\files.dws saved Fri Mar 18 10:04:20 2022
</span></div></div>
</div>
<p>and</p>
<ul class="simple">
<li><p>set an access path to the <em>namespace</em> contents:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕PATH</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Files&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Here are 3 functions you might find useful:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReadAllText</span></code> reads the contents of a text file and returns a character vector. The lines of the text are separated by two special characters: <em>carriage return</em> and/or <em>line feed</em>. The syntax is <code class="docutils literal notranslate"><span class="pre">result</span> <span class="pre">←</span> <span class="pre">ReadAllText</span> <span class="pre">path,fileID</span></code>:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">dream</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">ReadAllText</span><span class="w"> </span><span class="nv">FILEPATH</span><span class="o">,</span><span class="s1">&#39;mlk.txt&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FILE NAME ERROR: C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/mlk.txt: Unable to open file (&quot;The system cannot f
ind the path specified.&quot;)
ReadAllText[3] tn←name ⎕NTIE 0
                       ∧
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReadAllLines</span></code> reads the contents of a text file and returns a nested vector of character vectors, one vector per line of text in the file. The syntax is <code class="docutils literal notranslate"><span class="pre">result</span> <span class="pre">←</span> <span class="pre">ReadAllLines</span> <span class="pre">path,fileID</span></code>:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">dreamLines</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">ReadAllLines</span><span class="w"> </span><span class="nv">FILEPATH</span><span class="o">,</span><span class="s1">&#39;mlk.txt&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FILE NAME ERROR: C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/mlk.txt: Unable to open file (&quot;The system cannot f
ind the path specified.&quot;)
ReadAllText[3] tn←name ⎕NTIE 0
                       ∧
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PutText</span></code> writes a character matrix (or vector) to a file. If a file with the same name already exists, it is replaced by the new file. The function returns the number of characters written to the file. The syntax is <code class="docutils literal notranslate"><span class="pre">number</span> <span class="pre">←</span> <span class="pre">textMatrix</span> <span class="pre">PutText</span> <span class="pre">path,fileID</span></code>:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">chemistry</span><span class="w"> </span><span class="nv">PutText</span><span class="w"> </span><span class="nv">FILEPATH</span><span class="o">,</span><span class="s1">&#39;chemistry.txt&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FILE NAME ERROR: C:/Users/rodri/Documents/Dyalog/MDAPL/../res/testfiles/chemistry.txt: Unable to open file (&quot;The system ca
nnot find the path specified.&quot;)
PutText[14] tn←name ⎕NTIE 0
                    ∧
</pre></div>
</div>
</div>
</div>
<p>The workspace <code class="docutils literal notranslate"><span class="pre">loaddata.dws</span></code>, distributed as part of the Dyalog APL system, contains a set of professional grade functions to read from and write to text files, Excel workbooks, SQL databases and XML files.
<code class="docutils literal notranslate"><span class="pre">loaddata.dws</span></code> contains two functions <code class="docutils literal notranslate"><span class="pre">LoadText</span></code> and <code class="docutils literal notranslate"><span class="pre">SaveText</span></code> to complement the set of functions described above. <code class="docutils literal notranslate"><span class="pre">LoadText</span></code> and <code class="docutils literal notranslate"><span class="pre">SaveText</span></code> are designed to work with comma separated files (.CSV files) and fixed field width text files.</p>
<p>We have only used text files. Dyalog APL also includes an advanced file system designed to work very easily and efficiently with APL arrays, as well as a generalised interface to SQL databases. The APL file system is described in <span class="xref myst">its own chapter</span>. The SQL interface is not described in this tutorial; please refer instead to the specialised brochures available <a class="reference external" href="http://docs.dyalog.com/latest/">here</a>.</p>
</div>
<div class="section" id="printing-results-on-a-printer">
<span id="user-defined-functions-printing-results-on-a-printer"></span><h3><span class="section-number">5.9.7. </span>Printing Results on a Printer<a class="headerlink" href="#printing-results-on-a-printer" title="Permalink to this headline">#</a></h3>
<p>Printing your APL objects on paper should be avoided whenever possible, to help preserve the environment. If you really must print things to paper, there are a couple of alternatives you can consider.</p>
<p>Perhaps the simplest alternative is to generate a PDF with what you wish to print, and then print the PDF you generated.</p>
<p>If you are using the Windows Interpreter, you can easily print the contents of your workspace by going to “File” ⇨ “Print…”. From there, you can leave the defaults untouched and select a printer on the “Printer” tab. If you have a printer set up, you can choose it from the list of available printers. Otherwise, you can print to a PDF file. Please notice that the contents of the workspace that get printed are all of the named objects you have: variables, functions, operators, etc. If you just type <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">+</span> <span class="pre">3</span></code> in the interpreter and execute it, that does not get printed with this method – to print the log you need to go to “Log” ⇨ “Print…”.</p>
<p>If you are not in the Windows interpreter or do not wish to print all of the contents of your workspace, you can use a different approach. For that, we have to use some functionalities of APL that you haven’t seen before. Explaining these in depth is outside the scope of this chapter, but we will give an overview of how it works.</p>
<p>Here is how I would print a character vector <code class="docutils literal notranslate"><span class="pre">v</span></code> to a PDF file to be saved in my Desktop, with the name <code class="docutils literal notranslate"><span class="pre">'test.pdf'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;This is just a character vector.&#39;</span><span class="w"></span>
<span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;C:/users/rodri/Desktop/test.pdf&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕NEW</span><span class="w"> </span><span class="s1">&#39;HTMLRenderer&#39;</span><span class="w"> </span><span class="p">((</span><span class="s1">&#39;HTML&#39;</span><span class="w"> </span><span class="nv">v</span><span class="p">)(</span><span class="s1">&#39;Visible&#39;</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">r</span><span class="na">.</span><span class="nv">PrintToPDF</span><span class="w"> </span><span class="nv">path</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">erase</span><span class="w"> </span><span class="nv">r</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>What this is doing is creating a new (<code class="docutils literal notranslate"><span class="pre">⎕NEW</span></code>) object named <code class="docutils literal notranslate"><span class="pre">HTMLRenderer</span></code> that knows how to render, you guessed it, HTML. (<a class="reference external" href="https://en.wikipedia.org/wiki/HTML">HTML</a> is the markup language in which websites are written.) We then give it the character vector and ask for the window to remain invisible, with <code class="docutils literal notranslate"><span class="pre">('Visible'</span> <span class="pre">0)</span></code>. If we had written <code class="docutils literal notranslate"><span class="pre">('Visible'</span> <span class="pre">1)</span></code>, a window like the one in the figure <a class="reference internal" href="#fig-example-htmlrenderer"><span class="std std-numref">Fig. 5.21</span></a> would pop up:</p>
<div class="figure align-default" id="example-htmlrenderer">
<span id="fig-example-htmlrenderer"></span><img alt="_images/Example_HTMLRenderer.png" src="_images/Example_HTMLRenderer.png" />
<p class="caption"><span class="caption-number">Fig. 5.21 </span><span class="caption-text">An HTMLRenderer object with a sentence.</span><a class="headerlink" href="#example-htmlrenderer" title="Permalink to this image">#</a></p>
</div>
<p>After the character vector is rendered, we print the contents of the window to the path specified and then we erase the temporary variable.</p>
<p>Printing an arbitrary array is slightly more involved, because we have to convert said arbitrary array to a suitable character <em>vector</em> first. Sadly, <code class="docutils literal notranslate"><span class="pre">⍕</span></code> may not do the job because <code class="docutils literal notranslate"><span class="pre">⍕</span></code> applied to high-rank arrays still yields high-rank arrays. In order to overcome this obstacle, we need to find a way of transforming arbitrary arrays into character vectors.</p>
<p>For this end, we will be using the format function <code class="docutils literal notranslate"><span class="pre">⍕</span></code> we learned about before and the system function <code class="docutils literal notranslate"><span class="pre">⎕UCS</span></code>, that was used above in the exercise where you framed a character matrix.
What we will do is use <code class="docutils literal notranslate"><span class="pre">⍕</span></code> to convert any array into a character matrix, then to the right of the matrix catenate the newline character (that we can produce with <code class="docutils literal notranslate"><span class="pre">⎕UCS</span> <span class="pre">10</span></code>) and then ravel everything so that we have a character vector instead of a character matrix.
Finally, we wrap that character vector in a little bit of HTML code, so that the array displays nicely.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">matrix</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍕</span><span class="bp">⍵</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">vector</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">,</span><span class="nv">matrix</span><span class="o">,</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="s1">&#39;&lt;pre&gt;&#39;</span><span class="o">,</span><span class="nv">vector</span><span class="o">,</span><span class="s1">&#39;&lt;/pre&gt;&#39;</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">Process</span></code> dfn takes an array and creates a character vector that looks pretty much like the original, apart from the heading and trailing HTML code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">array</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="o">⍴⍳</span><span class="m">30</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4  5  6
 7  8  9 10 11 12
13 14 15 16 17 18
19 20 21 22 23 24
25 26 27 28 29 30
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Process</span><span class="w"> </span><span class="nv">array</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">&lt;pre&gt; 1  2  3  4  5  6
 7  8  9 10 11 12
13 14 15 16 17 18
19 20 21 22 23 24
25 26 27 28 29 30
&lt;/pre&gt;
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">101
</span></div></div>
</div>
<p>Now we can print this character vector, representing our array, to a PDF:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕NEW</span><span class="w"> </span><span class="s1">&#39;HTMLRenderer&#39;</span><span class="w"> </span><span class="p">((</span><span class="s1">&#39;HTML&#39;</span><span class="w"> </span><span class="p">(</span><span class="nv">Process</span><span class="w"> </span><span class="nv">array</span><span class="p">))(</span><span class="s1">&#39;Visible&#39;</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">r</span><span class="na">.</span><span class="nv">PrintToPDF</span><span class="w"> </span><span class="nv">path</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">erase</span><span class="w"> </span><span class="nv">r</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>This creates a PDF file that looks like the one in <a class="reference internal" href="#fig-printed-testpdf"><span class="std std-numref">Fig. 5.22</span></a>. We can see <code class="docutils literal notranslate"><span class="pre">array</span></code> was properly formatted on the top left corner:</p>
<div class="figure align-default" id="printed-testpdf">
<span id="fig-printed-testpdf"></span><img alt="_images/Printed_TestPDF.png" src="_images/Printed_TestPDF.png" />
<p class="caption"><span class="caption-number">Fig. 5.22 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">array</span></code> was printed to a PDF.</span><a class="headerlink" href="#printed-testpdf" title="Permalink to this image">#</a></p>
</div>
<p>Lastly, if you want to print a function <code class="docutils literal notranslate"><span class="pre">Func</span></code>, you can use the <code class="docutils literal notranslate"><span class="pre">Process</span></code> dfn on the <em>vector representation</em> <code class="docutils literal notranslate"><span class="pre">⎕VR</span></code> of <code class="docutils literal notranslate"><span class="pre">Func</span></code>.</p>
</div>
<div class="section" id="using-a-graphical-user-interface">
<span id="user-defined-functions-using-a-graphical-user-interface"></span><h3><span class="section-number">5.9.8. </span>Using a Graphical User Interface<a class="headerlink" href="#using-a-graphical-user-interface" title="Permalink to this headline">#</a></h3>
<p>We shall see in <span class="xref myst">a later chapter</span> how easy it can be to create graphical user interfaces (GUIs) which allow both input and output of information.</p>
<p>In the figure <a class="reference internal" href="#fig-example-gui"><span class="std std-numref">Fig. 5.23</span></a> we can see a basic GUI for a calculator. The user can press buttons to type in numbers (give <strong>input</strong> to the application) and to perform arithmetic operations on those numbers. After the results are calculated, they are shown in the white boxes at the top of the application (the application gives <strong>output</strong> to the user).</p>
<div class="figure align-default" id="example-gui">
<span id="fig-example-gui"></span><img alt="_images/Example_GUI.png" src="_images/Example_GUI.png" />
<p class="caption"><span class="caption-number">Fig. 5.23 </span><span class="caption-text">A basic calculator written in APL.</span><a class="headerlink" href="#example-gui" title="Permalink to this image">#</a></p>
</div>
</div>
<div class="section" id="requesting-values-from-the-keyboard">
<span id="user-defined-functions-requesting-values-from-the-keyboard"></span><h3><span class="section-number">5.9.9. </span>Requesting Values From the Keyboard<a class="headerlink" href="#requesting-values-from-the-keyboard" title="Permalink to this headline">#</a></h3>
<p>Here again, if the user of an application is required to enter some input data, this is often done via some user-friendly GUI interface like the previous one or from a web page. However, during the development phase or for a light application it may be simpler to use a very basic question/answer mode.</p>
<p>Two symbols are used to request input from the user:</p>
<ul class="simple">
<li><p><em>quad</em> (<code class="docutils literal notranslate"><span class="pre">⎕</span></code>) is used to enter one or more numbers; and</p></li>
<li><p><em>quote-quad</em> (<code class="docutils literal notranslate"><span class="pre">⍞</span></code>, typed with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>[</kbd>) is used to enter any string of characters.</p></li>
</ul>
<div class="section" id="quad-evaluated-input">
<span id="user-defined-functions-quad-evaluated-input"></span><h4><span class="section-number">5.9.9.1. </span>Quad-Evaluated Input<a class="headerlink" href="#quad-evaluated-input" title="Permalink to this headline">#</a></h4>
<p>The first method is no longer in common use, but can be useful when prototyping an application which needs to request input. Also, you can easily accidentally type <code class="docutils literal notranslate"><span class="pre">⎕</span></code> in the session and activate <em>quad-evaluated</em> input, so it is worth studying it briefly.</p>
<p><em>Quad</em> causes a pause in the execution of a function and allows the user to type any kind of expression. That expression is <em>evaluated</em> like any APL expression entered in the session, and its <em>result</em> is the result of the <em>quad</em> function:</p>
<ul class="simple">
<li><p>when a function executes a <em>quad</em>, it displays <code class="docutils literal notranslate"><span class="pre">⎕:</span></code> at the left margin of the screen to inform the user that he or she is expected to enter one or more values; and</p></li>
<li><p>if any error occurs during evaluation, the input <em>quad</em> is displayed over and over again, until the user succeeds in entering a valid expression.</p></li>
</ul>
<p>In the following example, a function is supposed to count how many items of its right argument there are between two limits. These limits could be passed via a left argument, but in this case we choose to ask the user to enter them during execution of the function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">Prompt1</span><span class="w"> </span><span class="nv">vector</span><span class="sr">;</span><span class="w"> </span><span class="nv">lim1</span><span class="sr">;</span><span class="w"> </span><span class="nv">lim2</span><span class="sr">;</span><span class="w"> </span><span class="nv">nb</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;What are the limits?&#39;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">lim1</span><span class="w"> </span><span class="nv">lim2</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="vg">⎕</span><span class="w"></span>
<span class="w">    </span><span class="nv">nb</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">vector</span><span class="o">&gt;</span><span class="nv">lim1</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="nv">vector</span><span class="o">&lt;</span><span class="nv">lim2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="o">⍕</span><span class="nv">nb</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39; values are comprised between &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">lim1</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39; and &#39;</span><span class="o">,⍕</span><span class="nv">lim2</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>As of the time of writing, Jupyter notebooks do not support input through <code class="docutils literal notranslate"><span class="pre">⎕</span></code> (nor through <code class="docutils literal notranslate"><span class="pre">⍞</span></code>). We do encourage <em>you</em> to try these examples out for yourself somewhere other than the Jupyter Notebook interface.</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nv">Prompt1</span><span class="w"> </span><span class="nv">salaries</span><span class="w"></span>
<span class="nv">What</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">limits</span><span class="o">?</span><span class="w"></span>
<span class="vg">⎕</span><span class="bp">:</span><span class="w"></span>
<span class="w">    </span><span class="m">1000</span><span class="w"> </span><span class="m">2000</span><span class="w"></span>
<span class="m">4</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">comprised</span><span class="w"> </span><span class="nv">between</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="m">2000</span><span class="w"></span>
</pre></div>
</div>
<p>You can use this <code class="docutils literal notranslate"><span class="pre">salaries</span></code> variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">salaries</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">20</span><span class="o">⍴</span><span class="m">5000</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2121 4778 4914 3139 4561 221 1252 1530 4475 332 3507 1829 1710 4964 3849 669 3653 3415 3867 151
</span></div></div>
</div>
<p>Let us make an error while executing the function again:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="nv">Prompt1</span><span class="w"> </span><span class="nv">salaries</span><span class="w"></span>
<span class="nv">What</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">limits</span><span class="o">?</span><span class="w"></span>
<span class="vg">⎕</span><span class="bp">:</span><span class="w"></span>
<span class="w">      </span><span class="nv">mylims</span><span class="w"></span>
<span class="nv">VALUE</span><span class="w"> </span><span class="nv">ERROR</span><span class="bp">:</span><span class="w"> </span><span class="nv">Undefined</span><span class="w"> </span><span class="nv">name</span><span class="bp">:</span><span class="w"> </span><span class="nv">mylims</span><span class="w"></span>
<span class="w">      </span><span class="nv">mylims</span><span class="w"></span>
<span class="w">      </span><span class="o">∧</span><span class="w"></span>
<span class="vg">⎕</span><span class="bp">:</span><span class="w"></span>
<span class="w">      </span><span class="o">⌊</span><span class="m">0.5</span><span class="o">+</span><span class="m">0.9</span><span class="w"> </span><span class="m">1.1</span><span class="o">×</span><span class="nv">Average</span><span class="w"> </span><span class="nv">salaries</span><span class="w">    </span>
<span class="m">0</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">comprised</span><span class="w"> </span><span class="nv">between</span><span class="w"> </span><span class="m">2472</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="m">3022</span><span class="w"></span>
</pre></div>
</div>
<p>Notice that we tried to answer with a variable name but that variable does not exist. An error message is issued, which is not very user-friendly! Then the user is automatically requested again to provide a value.</p>
<p>Then we provide a valid value with an expression that makes use of a variable, a defined function and some primitives. The expression evaluates to <code class="docutils literal notranslate"><span class="pre">2472</span> <span class="pre">3022</span></code> and those are the limits used.</p>
<div class="hint admonition">
<p class="admonition-title">Hint</p>
<p>If you accidentally start evaluated input in the session, type a <code class="docutils literal notranslate"><span class="pre">→</span></code> and then press enter, or type <kbd>Space</kbd> and then hit <kbd>Enter</kbd> to interrupt the input loop.</p>
</div>
</div>
<div class="section" id="quote-quad-character-input">
<span id="user-defined-functions-quote-quad-character-input"></span><h4><span class="section-number">5.9.9.2. </span>Quote-Quad Character Input<a class="headerlink" href="#quote-quad-character-input" title="Permalink to this headline">#</a></h4>
<p><em>Quote-quad</em> allows the user to enter a string of characters. That string is returned as the result of the <em>quote-quad</em> function.</p>
<p>If the user types nothing and just presses the <kbd>Enter</kbd> key, the returned value is an empty text vector.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">Prompt2</span><span class="sr">;</span><span class="w"> </span><span class="nv">tex</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;Type any string of characters&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">tex</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="vg">⍞</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;&quot;&#39;</span><span class="o">,</span><span class="nv">tex</span><span class="o">,</span><span class="s1">&#39;&quot; is a vector of length &#39;</span><span class="o">,⍕≢</span><span class="nv">tex</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">     </span><span class="nv">Prompt2</span><span class="w"></span>
<span class="nv">Type</span><span class="w"> </span><span class="nv">any</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">characters</span><span class="w"></span>
<span class="nv">Are</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">serious</span><span class="o">?</span><span class="w"></span>
<span class="s2">&quot;Are you serious?&quot;</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">vector</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="m">16</span><span class="w"></span>
</pre></div>
</div>
<p>You can see that the <em>quote-quad</em> does not display any prompt sign.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>Avoid using <em>Quad</em> evaluated input, as users can inadvertently (or intentionally) interfere with your own function variables.</p>
<p><em>Quote-Quad</em> remains useful for quick tests, the development of light interactive functions or scripting applications which work with redirected I/O.</p>
</div>
</div>
</div>
<div class="section" id="fetching-data-from-the-web">
<span id="user-defined-functions-fetching-data-from-the-web"></span><h3><span class="section-number">5.9.10. </span>Fetching Data From the Web<a class="headerlink" href="#fetching-data-from-the-web" title="Permalink to this headline">#</a></h3>
<p>“Fetching Data From the Web” might mean several different things. It might mean to find, download and fix some APL code, it might be to download some data files or it might be to scrape websites for information. Different tools exist to cater to different needs.</p>
<p>The most basic way of fetching data from the web involves taking a URL and asking for the data that a browser would get if you typed that URL into the address bar.</p>
<p>As an example, consider Dyalog’s URL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">URL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;https://dyalog.com&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>In order to fetch the data from that URL, we first need to load the <code class="docutils literal notranslate"><span class="pre">HttpCommand</span></code> namespace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">load</span><span class="w"> </span><span class="nv">HttpCommand</span><span class="w">    </span><span class="c1">⍝ We use ] instead of ) here.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">#.HttpCommand
</span></div></div>
</div>
<p>Now we can simply type</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">HttpCommand</span><span class="na">.</span><span class="nv">Get</span><span class="w"> </span><span class="nv">URL</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>to fetch the data from the Internet. We can inspect the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[rc: 0 | msg:  | HTTP Status: 200 "OK" | ⍴Data: 20667]
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code> is an object that contains all the information that we received when we requested the URL above. Usually, one is interested in the <code class="docutils literal notranslate"><span class="pre">data.Data</span></code>. For example, with a couple of lines of APL we can find links to all problem statements of the previous <a class="reference external" href="https://www.dyalog.com/student-competition.htm">APL Problem Solving competitions</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">URL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;https://www.dyalog.com/student-competition.htm&#39;</span><span class="w">    </span><span class="c1">⍝ The URL where the problem sets are.</span><span class="w"></span>
<span class="nv">data</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">HttpCommand</span><span class="na">.</span><span class="nv">Get</span><span class="w"> </span><span class="nv">URL</span><span class="w">                                </span><span class="c1">⍝ Fetch the page.</span><span class="w"></span>
<span class="nv">base</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊃</span><span class="p">(</span><span class="s1">&#39;&lt;base +href=&quot;(.*?)&quot;&#39;</span><span class="w"> </span><span class="nf">⎕S</span><span class="w"> </span><span class="s1">&#39;\1&#39;</span><span class="p">)</span><span class="w"> </span><span class="nv">data</span><span class="na">.</span><span class="nv">Data</span><span class="w">         </span><span class="c1">⍝ Find the base URL for the pdfs.</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">links</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;href=&quot;(.*?[.]pdf)&quot;&#39;</span><span class="w"> </span><span class="nf">⎕S</span><span class="w"> </span><span class="p">(</span><span class="nv">base</span><span class="o">,</span><span class="s1">&#39;\1&#39;</span><span class="p">))</span><span class="w"> </span><span class="nv">data</span><span class="na">.</span><span class="nv">Data</span><span class="w">  </span><span class="c1">⍝ Look for the pdf links and prepend the base.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────┬──────────────────────────────────────────────────────────────────────────┬──────────────────────────────────────────────────────────────────────────┬──────────────────────────────────────────────────────────────────────────┬──────────────────────────────────────────────────────────────────────────┐
│https://www.dyalog.com/uploads/files/student_competition/2021_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2021_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2020_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2020_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2019_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2019_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2018_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2018_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2017_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2017_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2016_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2016_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2015_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2015_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2014_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2014_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2013_problems_phase1.pdf│https://www.dyalog.com/uploads/files/student_competition/2013_problems_phase2.pdf│https://www.dyalog.com/uploads/files/student_competition/2012_problems.pdf│https://www.dyalog.com/uploads/files/student_competition/2011_problems.pdf│https://www.dyalog.com/uploads/files/student_competition/2010_problems.pdf│https://www.dyalog.com/uploads/files/student_competition/2009_problems.pdf│
└─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>Don’t worry if you do not understand the APL code above (it is simpler than it might look, but explaining it is not the purpose of this section). You can see that the code returns some hyperlinks, which point to PDF files with the problem sets that we mentioned. You can read more about <code class="docutils literal notranslate"><span class="pre">HttpCommand</span></code> <a class="reference external" href="https://www.dyalog.com/tools/tools-and-code-libraries.htm">here</a>.</p>
</div>
</div>
<div class="section" id="syntax-considerations">
<span id="user-defined-functions-syntax-considerations"></span><h2><span class="section-number">5.10. </span>Syntax Considerations<a class="headerlink" href="#syntax-considerations" title="Permalink to this headline">#</a></h2>
<div class="section" id="comments-and-statement-separators">
<span id="user-defined-functions-comments-and-statement-separators"></span><h3><span class="section-number">5.10.1. </span>Comments and Statement Separators<a class="headerlink" href="#comments-and-statement-separators" title="Permalink to this headline">#</a></h3>
<div class="section" id="comments">
<span id="user-defined-functions-comments"></span><h4><span class="section-number">5.10.1.1. </span>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">#</a></h4>
<p>It is possible to write comments in a function to make it easier to read, explain how it should be used and help future maintenance or improvements.</p>
<p>Comments begin with the symbol <em>lamp</em> <code class="docutils literal notranslate"><span class="pre">⍝</span></code> (because it “illuminates” the code). <em>Lamp</em> can be typed with <kbd>APL</kbd>+<kbd>,</kbd>.</p>
<p>They can be placed alone on a dedicated line or to the right of any statement, including the function header. All the characters placed to the right of the <em>lamp</em> are ignored by the interpreter.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>Determining when and where to comment your code is subjective but a good piece of advice is to try and <strong>not</strong> use comments to spell out <em>what</em> the code is doing; instead, consider using comments to explain <em>why</em> the code is doing what it is doing.</p>
</div>
</div>
<div class="section" id="statement-separators">
<span id="user-defined-functions-statement-separators"></span><h4><span class="section-number">5.10.1.2. </span>Statement Separators<a class="headerlink" href="#statement-separators" title="Permalink to this headline">#</a></h4>
<p>Several statements can be placed on the same line of a function, using the statement separator <em>diamond</em> <code class="docutils literal notranslate"><span class="pre">⋄</span></code>, which can be typed with <kbd>APL</kbd>+<kbd>`</kbd>. Statements are executed <strong>starting from the leftmost one</strong>.</p>
<p>Putting several statements on the same line does not save computing time and generally does not improve the readability of a function. It should be reserved for short, straightforward statements.</p>
<p>The diamond separator can also be used in <em>multithreaded programming</em> to force the execution of a set of statements without any switch to another thread. But this is outside the scope of this tutorial.</p>
<p>As an example of the usage of comments and statement separators, consider a revision of the <code class="docutils literal notranslate"><span class="pre">Interlace</span></code> function we have seen above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">Interlace</span><span class="w"> </span><span class="nv">b</span><span class="sr">;</span><span class="w"> </span><span class="nv">size</span><span class="sr">;</span><span class="w"> </span><span class="nv">even</span><span class="w">  </span><span class="c1">⍝ This is just a demo</span><span class="w"></span>
<span class="w">    </span><span class="c1">⍝ a &amp; b are matrices of the same shape</span><span class="w"></span>
<span class="w">    </span><span class="nv">size</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">×⍴</span><span class="nv">a</span><span class="w">     </span><span class="c1">⍝ the final result has twice as many columns as a</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">size</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="nv">even</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="o">×⍳</span><span class="p">(</span><span class="o">⍴</span><span class="nv">b</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="c1">⍝ final indices of the columns of b</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="o">-</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="c1">⍝ interlace</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We have placed some comments: in the header, on a dedicated line and to the right of some statements. We have also grouped the last two statements on a single line, separated by a <em>diamond</em>.</p>
</div>
</div>
<div class="section" id="why-should-a-function-return-a-result">
<span id="user-defined-functions-why-should-a-function-return-a-result"></span><h3><span class="section-number">5.10.2. </span>Why Should a Function Return a Result?<a class="headerlink" href="#why-should-a-function-return-a-result" title="Permalink to this headline">#</a></h3>
<p>During the execution of a tradfn any result which is not assigned to a variable name is immediately displayed on the screen; we used that in our functions <code class="docutils literal notranslate"><span class="pre">Prompt1</span></code> and <code class="docutils literal notranslate"><span class="pre">Prompt2</span></code> above.</p>
<p>So, let us compare two very similar tradfns and their usage:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">z</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">z</span><span class="kd">←</span><span class="nv">x</span><span class="o">+</span><span class="nv">y</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">PlusNoRes</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">x</span><span class="o">+</span><span class="nv">y</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14
</span></div></div>
</div>
<p>Apparently, both functions work very well:</p>
<ul class="simple">
<li><p>the left one calculates a local variable <code class="docutils literal notranslate"><span class="pre">z</span></code>, which has been declared to be the function result. The function returns the value of <code class="docutils literal notranslate"><span class="pre">z</span></code> as its result, and because the result is not assigned or used, it is displayed on the screen; and</p></li>
<li><p>the right one calculates <code class="docutils literal notranslate"><span class="pre">x+y</span></code>. Because this sum is not assigned, it is immediately displayed.</p></li>
</ul>
<p>But now, let us try to include these functions in more complex expressions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">×</span><span class="m">6</span><span class="w"> </span><span class="nv">Plus</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">140
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">×</span><span class="m">6</span><span class="w"> </span><span class="nv">PlusNoRes</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14
VALUE ERROR: No result was provided when the context expected one
      10×6 PlusNoRes 8
           ∧
</pre></div>
</div>
</div>
</div>
<p>Something went wrong!</p>
<ul class="simple">
<li><p>the leftmost function returns a result. The result is available to the calling expression, in this case as the right argument to the multiply function, so that we obtained the answer we wanted; but</p></li>
<li><p>the rightmost function returns no result. The value calculated in the first statement is just displayed (though we did not need it); it is <strong>not</strong> returned as a result. So, the multiply function has an argument on its left (the 10) but nothing on its right, hence the error message.</p></li>
</ul>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>Whenever you can, write functions which produce an explicit result. You can always throw the result away if you don’t need it.</p>
</div>
<p>This is not even a problem in dfns, because dfns <em>always</em> return an explicit result, or they don’t return at all.
Because dfns are the more modern way of writing user-defined functions, and because we encourage you to write your functions that process data as dfns whenever possible, this is likely not to be a common problem for you.</p>
</div>
<div class="section" id="different-types-of-functions">
<span id="user-defined-functions-different-types-of-functions"></span><h3><span class="section-number">5.10.3. </span>Different Types of Functions<a class="headerlink" href="#different-types-of-functions" title="Permalink to this headline">#</a></h3>
<div class="section" id="what-is-an-explicit-result">
<span id="user-defined-functions-what-is-an-explicit-result"></span><h4><span class="section-number">5.10.3.1. </span>What Is an Explicit Result?<a class="headerlink" href="#what-is-an-explicit-result" title="Permalink to this headline">#</a></h4>
<p>We have seen that some functions (like <code class="docutils literal notranslate"><span class="pre">Average</span></code> or <code class="docutils literal notranslate"><span class="pre">Plus</span></code>) return a result; we describe the result as being <em>explicit</em>. It means that once the function has been executed, the result is passed on to the next part of the expression which is being evaluated or, if there is none, it is displayed on the screen.</p>
<p>Some other functions (like <code class="docutils literal notranslate"><span class="pre">PlusNoRes</span></code>) do not return an explicit result. This does not mean that they do nothing; perhaps they read or write data from/to a file or an Excel worksheet, perhaps they print a graph on a printer, or perhaps they build a graphical user interface. All these consequences which arise from the execution of the function can be called <em>implicit</em> or hidden results. Anything that happens during the execution of a function and that is not communicated directly in the function’s result is generally called a <em>side effect</em> of the function (and perhaps its sub-functions).</p>
</div>
<div class="section" id="six-major-types-of-functions-valence">
<span id="user-defined-functions-six-major-types-of-functions-valence"></span><h4><span class="section-number">5.10.3.2. </span>Six Major Types of Functions (Valence)<a class="headerlink" href="#six-major-types-of-functions-valence" title="Permalink to this headline">#</a></h4>
<p>The number of arguments a function takes is termed its <em>valence</em>.</p>
<p>You have already met functions with one or two arguments (monadic or dyadic), and you can also write functions which take no arguments at all: they are called <em>niladic</em>. Though they do not receive values through arguments, they can process data introduced via the various techniques described in <a class="reference internal" href="#user-defined-functions-input-output-and-format"><span class="std std-numref">Section 5.9</span></a>. Notice that only tradfns can be niladic, as dfns take <em>at least</em> one argument.</p>
<p>Depending on whether or not they return an explicit result, tradfns can be classified as follows:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Valence</p></th>
<th class="text-align:left head"><p>With an explicit result</p></th>
<th class="text-align:left head"><p>Without an explicit result</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Niladic</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">z</span> <span class="pre">←</span>&#160;&#160; <span class="pre">function</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∇</span>&#160;&#160;&#160;&#160; <span class="pre">function</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Monadic</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">z</span> <span class="pre">←</span>&#160;&#160; <span class="pre">function</span> <span class="pre">x</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∇</span>&#160;&#160;&#160;&#160; <span class="pre">function</span> <span class="pre">y</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Dyadic</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">z</span> <span class="pre">←</span> <span class="pre">x</span> <span class="pre">function</span> <span class="pre">y</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">∇</span>&#160;&#160; <span class="pre">x</span> <span class="pre">function</span> <span class="pre">y</span></code></p></td>
</tr>
</tbody>
</table>
<p>Dfns, on the other hand, can only be of two different types: either monadic with an explicit result or dyadic with an explicit result.</p>
<p>Niladic functions which return no result are very similar to scripts written in other programming languages.</p>
<p>Some of the functions which we have already written can be classified as follows:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Syntax</p></th>
<th class="text-align:center head"><p>With result</p></th>
<th class="text-align:center head"><p>Without result</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Niladic</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">Endless</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Monadic</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">Average</span></code>, <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code></p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">Prompt1</span></code>, <code class="docutils literal notranslate"><span class="pre">Prompt2</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Dyadic</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">Interlace</span></code>, <code class="docutils literal notranslate"><span class="pre">Plus</span></code>, <code class="docutils literal notranslate"><span class="pre">Times</span></code></p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">PlusNoRes</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ambivalent-functions">
<span id="user-defined-functions-ambivalent-functions"></span><h4><span class="section-number">5.10.3.3. </span>Ambivalent Functions<a class="headerlink" href="#ambivalent-functions" title="Permalink to this headline">#</a></h4>
<p>Most APL symbols are used to represent both monadic and dyadic primitive functions. For example, the symbol <code class="docutils literal notranslate"><span class="pre">⍴</span></code> represents both the <em>shape</em> (<code class="docutils literal notranslate"><span class="pre">⍴y</span></code>) function and the <em>reshape</em> (<code class="docutils literal notranslate"><span class="pre">x⍴y</span></code>) function, and <code class="docutils literal notranslate"><span class="pre">⌈</span></code> represents both <em>ceiling</em> (<code class="docutils literal notranslate"><span class="pre">⌈y</span></code>) and <em>maximum</em> (<code class="docutils literal notranslate"><span class="pre">x⌈y</span></code>). These symbols are said to be <em>ambivalent</em>.</p>
<p>In <a class="reference internal" href="#user-defined-functions-default-left-argument"><span class="std std-numref">Section 5.3.4</span></a> we saw how to write an <em>ambivalent</em> dfn. To write an <em>ambivalent</em> tradfn, the name of the left argument in the header is specified within braces (to show that is is optional), like this: <code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">result</span> <span class="pre">←</span> <span class="pre">{left}</span> <span class="pre">Function</span> <span class="pre">right</span></code>.</p>
<p>We are now faced with a problem: this function must work correctly whether or not a left argument is provided. One of the ways to deal with this in a dfn is by specifying a default left argument. There is another way that works for both dfns and tradfns, and then there is an additional, preferred, way of dealing with this ambiguity in tradfns.</p>
<p>A way to test for the presence of the left argument is through the <em>system function</em> <code class="docutils literal notranslate"><span class="pre">⎕NC</span></code>. NC stands for <em>name classification</em>, as that is what the <code class="docutils literal notranslate"><span class="pre">⎕NC</span></code> function does: classifies the use that is being made of a given name.</p>
<p>As we shall see in <span class="xref myst">a future chapter</span>:</p>
<ul class="simple">
<li><p>the <em>name classification</em> of a variable name is 2;</p></li>
<li><p>the <em>name classification</em> of a function name is 3;</p></li>
<li><p>the <em>name classification</em> of an unused name is 0.</p></li>
</ul>
<p>As some examples, recall that <code class="docutils literal notranslate"><span class="pre">'chemistry'</span></code> is the name of a variable, <code class="docutils literal notranslate"><span class="pre">'Average'</span></code> is the name of a function and so far we haven’t used the name <code class="docutils literal notranslate"><span class="pre">'thingamabob'</span></code> for anything:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕NC</span><span class="w"> </span><span class="s1">&#39;chemistry&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕NC</span><span class="w"> </span><span class="s1">&#39;Average&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕NC</span><span class="w"> </span><span class="s1">&#39;thingamabob&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>So, we can use the expression <code class="docutils literal notranslate"><span class="pre">0=⎕NC'⍺'</span></code> to check if a dfn was called monadically and, in the example above, use <code class="docutils literal notranslate"><span class="pre">0=⎕NC'left'</span></code> to check if the tradfn was called monadically. Conversely, we can use <code class="docutils literal notranslate"><span class="pre">2=⎕NC'⍺'</span></code> to check if a dfn was called dyadically and, in the example above, use <code class="docutils literal notranslate"><span class="pre">2=⎕NC'left'</span></code> to check if the tradfn was called dyadically.</p>
<p>Just to check that it works, let us write a useless ambivalent dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Useless</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="m">0</span><span class="o">=</span><span class="nf">⎕NC</span><span class="s1">&#39;⍺&#39;</span><span class="bp">:</span><span class="w"> </span><span class="s1">&#39;monadic&#39;</span><span class="w"></span>
<span class="w">    </span><span class="m">2</span><span class="o">=</span><span class="nf">⎕NC</span><span class="s1">&#39;⍺&#39;</span><span class="bp">:</span><span class="w"> </span><span class="s1">&#39;dyadic&#39;</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;uh, what..?&#39;</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">23</span><span class="w"> </span><span class="nv">Useless</span><span class="w"> </span><span class="m">78</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">dyadic
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Useless</span><span class="w"> </span><span class="m">71</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">monadic
</span></div></div>
</div>
<p>Can you see why this <code class="docutils literal notranslate"><span class="pre">⎕NC</span></code> method is better suited for dfns than for tradfns?</p>
<p>In a dfn, the left argument is <em>always</em> called <code class="docutils literal notranslate"><span class="pre">'⍺'</span></code>, whereas for a tradfn it can change. If you change the name of the left argument in the header of the function and forget to change its name in the <code class="docutils literal notranslate"><span class="pre">⎕NC</span></code> test you can get into trouble. For that matter, it is recommended that you use a different method to check if a tradfn was called monadically:
the <em>900 I-beam</em>, or <code class="docutils literal notranslate"><span class="pre">900⌶</span></code> (where <code class="docutils literal notranslate"><span class="pre">⌶</span></code> is the <em>I-beam</em> character, typed with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>1</kbd>). The <em>I-beam</em> will be covered in <a class="reference internal" href="Operators.html"><span class="doc std std-doc">more detail</span></a>, here we ask you to close your eyes and just believe <code class="docutils literal notranslate"><span class="pre">900⌶</span></code> does what we tell you it does.</p>
<p>When used inside a tradfn, <code class="docutils literal notranslate"><span class="pre">900⌶⍬</span></code> returns 1 if the tradfn was called monadically and 0 otherwise.</p>
</div>
<div class="section" id="example-ambivalent-function">
<span id="user-defined-functions-example-ambivalent-function"></span><h4><span class="section-number">5.10.3.4. </span>Example Ambivalent Function<a class="headerlink" href="#example-ambivalent-function" title="Permalink to this headline">#</a></h4>
<p>The following tradfn rounds a numeric value to its nth decimal digit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">Round</span><span class="w"> </span><span class="nv">val</span><span class="sr">;</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">*</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">⌊</span><span class="m">0.5</span><span class="o">+</span><span class="nv">val</span><span class="o">×</span><span class="nv">t</span><span class="p">)</span><span class="o">÷</span><span class="nv">t</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">Round</span><span class="w"> </span><span class="m">41.31875</span><span class="w"> </span><span class="m">82.92413</span><span class="w"> </span><span class="m">127.71625</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">41.32 82.92 127.72
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="nv">Round</span><span class="w"> </span><span class="m">41.31875</span><span class="w"> </span><span class="m">82.92413</span><span class="w"> </span><span class="m">127.71625</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">41.32 83 127.716
</span></div></div>
</div>
<p>Now, suppose that we usually want to round values to the second decimal digit: we can decide that if we do not specify a left argument this will be the default behaviour of our function. Here is the updated version of the function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">n</span><span class="kt">}</span><span class="w"> </span><span class="nv">Round</span><span class="w"> </span><span class="nv">val</span><span class="sr">;</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="m">900</span><span class="na">⌶</span><span class="no">⍬</span><span class="w"></span>
<span class="w">        </span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w">    </span><span class="c1">⍝ default value if Round is called monadically</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">*</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">⌊</span><span class="m">0.5</span><span class="o">+</span><span class="nv">val</span><span class="o">×</span><span class="nv">t</span><span class="p">)</span><span class="o">÷</span><span class="nv">t</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now the left argument is optional and an <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:EndIf</span></code> clause detects its presence. If absent, <code class="docutils literal notranslate"><span class="pre">n</span></code> is set to 2. The expressions shown below illustrate the two ways in which the function can be used. This function really is ambivalent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="nv">Round</span><span class="w"> </span><span class="m">41.31875</span><span class="w"> </span><span class="m">82.92413</span><span class="w"> </span><span class="m">127.71625</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">41.32 83 127.716
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Round</span><span class="w"> </span><span class="m">41.31875</span><span class="w"> </span><span class="m">82.92413</span><span class="w"> </span><span class="m">127.71625</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">41.32 82.92 127.72
</span></div></div>
</div>
<p>Alternatively, consider writing a dfn in which providing a default left argument is much cleaner:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Round</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">*</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="o">⌊</span><span class="m">0.5</span><span class="o">+</span><span class="bp">⍵</span><span class="o">×</span><span class="nv">t</span><span class="p">)</span><span class="o">÷</span><span class="nv">t</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="shy-result-in-a-tradfn">
<span id="user-defined-functions-shy-result-in-a-tradfn"></span><h4><span class="section-number">5.10.3.5. </span>Shy Result in a Tradfn<a class="headerlink" href="#shy-result-in-a-tradfn" title="Permalink to this headline">#</a></h4>
<p>Like for dfns (cf. <a class="reference internal" href="#user-defined-functions-shy-result"><span class="std std-numref">Section 5.5.2</span></a>), tradfns can return a shy result: in the header of the function we enclose the name of the return variable with <code class="docutils literal notranslate"><span class="pre">{}</span></code>, like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="kt">{</span><span class="nv">r</span><span class="kt">}</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">ShyFun</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">x</span><span class="o">×</span><span class="nv">y</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">17</span><span class="w"> </span><span class="nv">ShyFun</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">ShyFun</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">51
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">×</span><span class="m">17</span><span class="w"> </span><span class="nv">ShyFun</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">510
</span></div></div>
</div>
</div>
<div class="section" id="an-argument-used-as-a-result">
<span id="user-defined-functions-an-argument-used-as-a-result"></span><h4><span class="section-number">5.10.3.6. </span>An Argument Used as a Result<a class="headerlink" href="#an-argument-used-as-a-result" title="Permalink to this headline">#</a></h4>
<p>It is possible to use the same name for the result as one of the arguments. For example, these are two valid headers: <code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">x</span> <span class="pre">←</span> <span class="pre">x</span> <span class="pre">Fun</span> <span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">y</span> <span class="pre">←</span> <span class="pre">x</span> <span class="pre">Fun</span> <span class="pre">y</span></code>.</p>
<p>This may be useful when a condition causes the function to terminate without any processing. Supposed that you want to repeatedly divide the right argument by 2, until the result becomes odd. A simple loop will do it, but if the argument is already odd, the loop stops immediately and the result is equal to the argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">DivideIt</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="m">0</span><span class="o">=</span><span class="m">2</span><span class="o">|</span><span class="nv">y</span><span class="w"></span>
<span class="w">        </span><span class="nv">y</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">y</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">y</span></code> is even the loop is executed at least once.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">y</span></code> is odd the function exists immediately and returns the unmodified value of <code class="docutils literal notranslate"><span class="pre">y</span></code> as its result.</p>
<p>Of course this is only relevant for tradfns, as dfns do not return the value of a specific variable.</p>
</div>
</div>
<div class="section" id="nested-argument-and-result">
<span id="user-defined-functions-nested-argument-and-result"></span><h3><span class="section-number">5.10.4. </span>Nested Argument and Result<a class="headerlink" href="#nested-argument-and-result" title="Permalink to this headline">#</a></h3>
<div class="section" id="nested-right-argument">
<span id="user-defined-functions-nested-right-argument"></span><h4><span class="section-number">5.10.4.1. </span>Nested Right Argument<a class="headerlink" href="#nested-right-argument" title="Permalink to this headline">#</a></h4>
<p>Both the left and right arguments of a function can be nested vectors, as in <code class="docutils literal notranslate"><span class="pre">Function</span> <span class="pre">'London'</span> <span class="pre">'UK'</span> <span class="pre">7684700</span> <span class="pre">40</span></code>, for example.</p>
<p>A composite argument of this sort is often split (dispatched) into a number of separate local variables using multiple assignment, as illustrated in the following dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Dispatch</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">country</span><span class="w"> </span><span class="nv">population</span><span class="w"> </span><span class="nv">prefix</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">country</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Dispatch</span><span class="w"> </span><span class="s1">&#39;London&#39;</span><span class="w"> </span><span class="s1">&#39;UK&#39;</span><span class="w"> </span><span class="m">7684700</span><span class="w"> </span><span class="m">40</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">UK
</span></div></div>
</div>
<p>For tradfns, a more elegant way to achieve the same thing is to specify the composite nature of the argument directly, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Dispatch</span><span class="w"> </span><span class="p">(</span><span class="nv">town</span><span class="w"> </span><span class="nv">country</span><span class="w"> </span><span class="nv">population</span><span class="w"> </span><span class="nv">prefix</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">country</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Dispatch</span><span class="w"> </span><span class="s1">&#39;London&#39;</span><span class="w"> </span><span class="s1">&#39;UK&#39;</span><span class="w"> </span><span class="m">7684700</span><span class="w"> </span><span class="m">40</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">UK
</span></div></div>
</div>
<p>Using this syntax, the items of the right argument are automatically allocated into local variables, as you could see above.</p>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>This special syntax applies <strong>only</strong> to the right argument, not to the left one. If a nested vector is passed on the left it can be split (dispatched) by multiple assignment, as suggested earlier.</p>
</div>
</div>
<div class="section" id="choice-of-syntax">
<span id="user-defined-functions-choice-of-syntax"></span><h4><span class="section-number">5.10.4.2. </span>Choice of Syntax<a class="headerlink" href="#choice-of-syntax" title="Permalink to this headline">#</a></h4>
<p>When a function <code class="docutils literal notranslate"><span class="pre">Fun</span></code> is to receive two values <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>, you now have the choice between two syntaxes:</p>
<ul class="simple">
<li><p>dyadic <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">Fun</span> <span class="pre">y</span></code></p></li>
<li><p>monadic <code class="docutils literal notranslate"><span class="pre">Fun</span> <span class="pre">(x</span> <span class="pre">y)</span></code></p></li>
</ul>
<p>The dyadic way has the advantage that the function can be used with <em>reduce</em>, while the monadic version cannot.</p>
<p>For example, we can use <code class="docutils literal notranslate"><span class="pre">Plus</span></code> in this kind of expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Plus</span><span class="na">/</span><span class="m">14</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">43</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">132
</span></div></div>
</div>
</div>
<div class="section" id="nested-result">
<span id="user-defined-functions-nested-result"></span><h4><span class="section-number">5.10.4.3. </span>Nested Result<a class="headerlink" href="#nested-result" title="Permalink to this headline">#</a></h4>
<p>Similar notation can be applied to the result of the function. Suppose that you want to return a vector of 3 separate (local) variables (named <code class="docutils literal notranslate"><span class="pre">one</span></code>, <code class="docutils literal notranslate"><span class="pre">two</span></code> and <code class="docutils literal notranslate"><span class="pre">three</span></code> in the example) as the result of the function. One way is to declare that the function returns a single named result, and to assign the 3 local variables into the result before the function terminates. Another approach is to simply declare the structure of the result in the header as illustrated below. As these names (<code class="docutils literal notranslate"><span class="pre">one</span></code>, <code class="docutils literal notranslate"><span class="pre">two</span></code> and <code class="docutils literal notranslate"><span class="pre">three</span></code>) appear in the header, they are local.</p>
<p>We exemplify this in the next tradfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="p">(</span><span class="nv">one</span><span class="w"> </span><span class="nv">two</span><span class="w"> </span><span class="nv">three</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">NestedRes</span><span class="w"> </span><span class="nv">right</span><span class="w"></span>
<span class="w">    </span><span class="nv">one</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="o">+</span><span class="nv">right</span><span class="w"></span>
<span class="w">    </span><span class="nv">two</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">right</span><span class="sr">[</span><span class="nv">left</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">three</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">two</span><span class="o">×</span><span class="nv">one</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">NestedRes</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">78</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬──┬────┐
│15 48 81│78│1170│
└────────┴──┴────┘
</span></div></div>
</div>
<p>It should be clear from the construct itself, but this special syntax also only applies to tradfns. In dfns, you would have to do something like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">NestedRes</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">one</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="o">+</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">two</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[</span><span class="bp">⍺</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">three</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">two</span><span class="o">×</span><span class="nv">one</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">one</span><span class="w"> </span><span class="nv">two</span><span class="w"> </span><span class="nv">three</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">NestedRes</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">78</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬──┬────┐
│15 48 81│78│1170│
└────────┴──┴────┘
</span></div></div>
</div>
</div>
</div>
<div class="section" id="choice-of-names">
<span id="user-defined-functions-choice-of-names"></span><h3><span class="section-number">5.10.5. </span>Choice of Names<a class="headerlink" href="#choice-of-names" title="Permalink to this headline">#</a></h3>
<p>Function names (as well as argument and result names, if you are using tradfns) can be any valid APL name, for example <code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">cain</span> <span class="pre">←</span> <span class="pre">adam</span> <span class="pre">PLUS</span> <span class="pre">eve</span></code> or <code class="docutils literal notranslate"><span class="pre">dumb</span> <span class="pre">←</span> <span class="pre">man</span> <span class="pre">WITHOUT</span> <span class="pre">voice</span></code>.</p>
<p>However, it is recommended that you use simple names, names that are easy to remember, and names that are consistent from one function to the other. This is especially important if several people have to maintain a common set of functions; any of them should be able to understand immediately which variables represent the arguments and which the result…</p>
<p>This recommendation is really about adopting a strict <em>naming convention</em>, and this applies to any serious programming project, whether it uses APL or not.</p>
<p>Here are some simple conventions that you might consider:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">z</span> <span class="pre">←</span> <span class="pre">x</span> <span class="pre">Function</span> <span class="pre">y</span></code>, often used by English-speaking developers;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">r</span> <span class="pre">←</span> <span class="pre">g</span> <span class="pre">Function</span> <span class="pre">d</span></code>, often used by French-speaking developers;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∇</span> <span class="pre">r</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">Function</span> <span class="pre">b</span></code>;</p></li>
<li><p>etc.</p></li>
</ul>
<p>However, we advise you to adopt meaningful words to indicate the nature of the arguments, for example using <code class="docutils literal notranslate"><span class="pre">numVec</span></code> for numeric vectors or <code class="docutils literal notranslate"><span class="pre">texMat</span></code> for character matrices.</p>
<p>We also recommend that you avoid modifying the arguments in the body of the function, otherwise you could make maintenance much more difficult.</p>
</div>
</div>
<div class="section" id="recursion">
<span id="user-defined-functions-recursion"></span><h2><span class="section-number">5.11. </span>Recursion<a class="headerlink" href="#recursion" title="Permalink to this headline">#</a></h2>
<p>A function is <em>recursive</em> when it calls itself, generally to calculate a step of an algorithm from the results of its previous step.</p>
<p>For example, the factorial of <span class="math notranslate nohighlight">\(n\)</span> can be defined as <span class="math notranslate nohighlight">\(n\)</span> times the factorial of <span class="math notranslate nohighlight">\(n-1\)</span>. Of course, some condition must specify when the process is supposed to stop. In our example, the factorial of 1 is not calculated, but set to 1. A recursive function could be written as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Fact</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">&lt;</span><span class="m">2</span><span class="bp">:</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">×</span><span class="nv">Fact</span><span class="w"> </span><span class="bp">⍵</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Fact</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">40320
</span></div></div>
</div>
<div class="warning admonition">
<p class="admonition-title">Warning</p>
<p><em>Recursive</em> solutions are generally very elegant, however:</p>
<ul class="simple">
<li><p>because a function may call itself a great number of times before it reaches the exit condition, this technique may need a lot of memory if the function works on huge arrays;</p></li>
<li><p>when the function calls itself, the variables calculated during one step must not interfere with the calling context. You must carefully localise all your variables if you are using a tradfn – otherwise this is already done for you. Either way, this is the reason for possible large memory consumption, as the local variables in all recursions may exist at the same time.</p></li>
</ul>
</div>
<p>A possible way to overcome some of these limitations is introduced in <a class="reference internal" href="#user-defined-functions-tail-recursion"><span class="std std-numref">Section 5.16.9</span></a>.</p>
<p>Beware that recursion is never mandatory. A recursive function can always be rewritten using looping or array-oriented techniques instead of recursion.</p>
<p>For example, one could write the dfn that follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Fact2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="o">×</span><span class="na">/</span><span class="o">⍳</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Fact2</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">40320
</span></div></div>
</div>
<p>Notice that the dfn above is preferred over a tradfn with an explicit loop like a <code class="docutils literal notranslate"><span class="pre">:For</span></code> or a <code class="docutils literal notranslate"><span class="pre">:While</span></code>.</p>
<div class="section" id="recursion-in-dfns">
<span id="user-defined-functions-recursion-in-dfns"></span><h3><span class="section-number">5.11.1. </span>Recursion in Dfns<a class="headerlink" href="#recursion-in-dfns" title="Permalink to this headline">#</a></h3>
<p>Both dfns and tradfns can be recursive by calling themselves explicitly, like you saw above. However, if you are writing a dfn you can also use the special symbol <code class="docutils literal notranslate"><span class="pre">∇</span></code> (the <em>del</em> symbol) to represent this self-call.</p>
<p>Using this symbol in our <code class="docutils literal notranslate"><span class="pre">Fact</span></code> function, we’d write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Fact</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">&lt;</span><span class="m">2</span><span class="bp">:</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">×</span><span class="bp">∇⍵</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>An implicit self-reference using <code class="docutils literal notranslate"><span class="pre">∇</span></code> needs less interpretative overhead and therefore it may execute more quickly. Moreover, it will continue to work even if the function is renamed.</p>
</div>
</div>
<div class="section" id="assigning-names-to-functions">
<span id="user-defined-functions-assigning-names-to-functions"></span><h2><span class="section-number">5.12. </span>Assigning Names to Functions<a class="headerlink" href="#assigning-names-to-functions" title="Permalink to this headline">#</a></h2>
<p>You can give names to values, through the use of variables like</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>and you can define functions, like</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TimesTwo</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">2</span><span class="o">×</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>but you can also associate a new name with an <strong>existing</strong> primitive, a user-defined function or a derived function. For example,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Rho</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="w"></span>
<span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="nv">Rho</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2
3 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Times2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">TimesTwo</span><span class="w"></span>
<span class="nv">Times2</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"></span>
<span class="nv">Sum</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10
</span></div></div>
</div>
<p>Later on, in <a class="reference internal" href="Tacit-Programming.html"><span class="doc std std-doc">the chapter about Tacit Programming</span></a> you will see that you can even assign more primitives to a name, and those will behave in a very specific way.</p>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>When assigning a new name to an existing tradfn, the contents of the original function are not duplicated.</p>
</div>
<p>For example, here is a basic tradfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Add3</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">y</span><span class="o">+</span><span class="m">3</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>And now we assign it a new name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">NewName</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Add3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If we check <code class="docutils literal notranslate"><span class="pre">NewName</span></code>’s code, it will be <code class="docutils literal notranslate"><span class="pre">Add3</span></code>’s source code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">NewName</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">    ∇  r←Add3 y
[1]    r←y+3
    ∇
</span></div></div>
</div>
<p>And finally, if we modify <code class="docutils literal notranslate"><span class="pre">Add3</span></code>, <code class="docutils literal notranslate"><span class="pre">NewName</span></code> also gets modified:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Add3</span><span class="w"> </span><span class="nv">y</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">y</span><span class="o">+</span><span class="m">30</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">NewName</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">40
</span></div></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>If you accidentally assign a function to a new name when you wanted to use that name for a value, you can use <code class="docutils literal notranslate"><span class="pre">)erase</span></code> to fix that.</p>
</div>
<p>For example, say you typed this in your interpreter and accidentally pressed <kbd>Enter</kbd>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Val</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Average</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>But what you really wanted to type was:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Val</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Average</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SYNTAX ERROR: Invalid modified assignment, or an attempt was made to change nameclass on assignment
      Val←Average 41 11 19
      ∧
</pre></div>
</div>
</div>
</div>
<p>You can see that gives a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code> because you are trying to change <code class="docutils literal notranslate"><span class="pre">Val</span></code> from a function to a value, and the interpreter doesn’t want you to do that.</p>
<p>Instead, first erase <code class="docutils literal notranslate"><span class="pre">Val</span></code> with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">erase</span><span class="w"> </span><span class="nv">Val</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>and then assign it normally:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Val</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Average</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">19</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="about-the-text-editor">
<span id="user-defined-functions-about-the-text-editor"></span><h2><span class="section-number">5.13. </span>About the Text Editor<a class="headerlink" href="#about-the-text-editor" title="Permalink to this headline">#</a></h2>
<p>Most of the features of the built-in Dyalog APL editor are very familiar to those of other common editors, but some are very specific and we therefore provide a brief description of the specific editing facilities of Dyalog APL.</p>
<div class="section" id="invoking-the-text-editor">
<span id="user-defined-functions-invoking-the-text-editor"></span><h3><span class="section-number">5.13.1. </span>Invoking the Text Editor<a class="headerlink" href="#invoking-the-text-editor" title="Permalink to this headline">#</a></h3>
<p>Double-clicking a name which represents an existing item invokes the editor and displays its contents, using the colour scheme appropriate for the type of the item (function, character matrix, nested array, etc) defined via “Options” ⇨ “Colors…” if you are using the Windows interpreter or via “Edit” ⇨ “Preferences” ⇨ “Colours” if you are using RIDE.</p>
<p>You can also invoke the editor by pressing <kbd>Shift</kbd>+<kbd>Enter</kbd> when the input cursor is inside or adjacent to the name. This is perhaps the most convenient way as, when working in an APL session, you tend to use the keyboard much more than the mouse.</p>
<p>Let us define a character matrix with the uppercase latin alphabet:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">charMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">13</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ABCDEFGHIJKLM
NOPQRSTUVWXYZ
</span></div></div>
</div>
<p>For some items (e.g. numeric matrices, some nested arrays) the editor is only good for viewing them, while for others such as functions, text vectors and text matrices, the editor can also be used to edit them. In <a class="reference internal" href="#fig-win-editor-edit-character-matrix"><span class="std std-numref">Fig. 5.24</span></a> we have invoked the editor, and changed the contents of our <code class="docutils literal notranslate"><span class="pre">charMat</span></code> variable:</p>
<div class="figure align-default" id="win-editor-edit-character-matrix">
<span id="fig-win-editor-edit-character-matrix"></span><img alt="_images/Win_Editor_Edit_Character_Matrix.png" src="_images/Win_Editor_Edit_Character_Matrix.png" />
<p class="caption"><span class="caption-number">Fig. 5.24 </span><span class="caption-text">Editing a character matrix with the built-in editor of the Windows interpreter.</span><a class="headerlink" href="#win-editor-edit-character-matrix" title="Permalink to this image">#</a></p>
</div>
<p>In <a class="reference internal" href="#fig-win-editor-edit-character-matrix"><span class="std std-numref">Fig. 5.24</span></a> the edit window tells us that we modified the character matrix. We must now fix it, like we did with dfns before, for the variable to reflect its new value. RIDE doesn’t tell you that the character matrix was modified, but you still need to fix it if you want the new changes to come into effect.</p>
<p>If we now fix the changes to <code class="docutils literal notranslate"><span class="pre">charMat</span></code>, it will become a matrix with 4 rows and 29 columns (the length of its longest row).</p>
<p>If, for some reason, you made a mistake, you can exit the edit window <em>without</em> fixing the changes by pressing <kbd>Shift</kbd>+<kbd>Esc</kbd>.</p>
<p>If a name is currently undefined (has no value), double-clicking or pressing <kbd>Shift</kbd>+<kbd>Enter</kbd> on that name invokes the editor on it as if it were a new function. This is one way to create a function.</p>
<p>You can also invoke the editor using the command <code class="docutils literal notranslate"><span class="pre">)ED</span></code> as we did before. By default, it opens a <strong>function</strong> definition, but you can explicitly specify the type of a new object by prefixing its name with a special character, as shown in the table below.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Prefix</p></th>
<th class="text-align:left head"><p>Example</p></th>
<th class="text-align:left head"><p>Object Created</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>none</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">new</span></code></p></td>
<td class="text-align:left"><p>Function</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">∇</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">∇</span> <span class="pre">borscht</span></code></p></td>
<td class="text-align:left"><p>Function</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">-</span> <span class="pre">papyrus</span></code></p></td>
<td class="text-align:left"><p>Simple character matrix</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">→</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">→</span> <span class="pre">crouton</span></code></p></td>
<td class="text-align:left"><p>Simple character vector</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">∊</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">∊</span> <span class="pre">grunt</span></code></p></td>
<td class="text-align:left"><p>Nested vector of character vectors, with one sub-vector per line</p></td>
</tr>
</tbody>
</table>
<p>See also <a class="reference internal" href="Appendices.html#appendices-invoking-the-editor"><span class="std std-numref">Section 14.2</span></a> for additional prefixes.</p>
<p>It is possible to open several edit windows using a single command. For example, <code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">Tyrex</span> <span class="pre">-moose</span></code> will open two edit windows. The first to create or edit a function named <code class="docutils literal notranslate"><span class="pre">Tyrex</span></code> and the second to create a character matrix named <code class="docutils literal notranslate"><span class="pre">moose</span></code>.</p>
<p>If a prefix is specified for the name of an already existing object, the prefix is ignored and the editor is invoked according to the type of the existing object.</p>
<p>There are some other ways to invoke the editor:</p>
<ul class="simple">
<li><p>use <code class="docutils literal notranslate"><span class="pre">⎕ED</span></code> instead of the command <code class="docutils literal notranslate"><span class="pre">)ED</span></code>. For example: <code class="docutils literal notranslate"><span class="pre">⎕ED</span> <span class="pre">'Clown'</span></code>. <code class="docutils literal notranslate"><span class="pre">⎕ED</span></code> is a <em>System function</em>, a concept that will be discussed in <span class="xref myst">a future chapter</span>;</p></li>
<li><p>type a name, or put the input cursor on an existing name, and activate the menu “Action” ⇨ “Edit”;</p></li>
<li><p>for the Windows interpreter, type a name or put the input cursor on an existing name, and click the “Edit Object” available in the toolbar (cf. <a class="reference internal" href="#fig-win-toolbar-edit-object"><span class="std std-numref">Fig. 5.25</span></a>).</p></li>
</ul>
<div class="figure align-default" id="win-toolbar-edit-object">
<span id="fig-win-toolbar-edit-object"></span><img alt="_images/Win_Toolbar_Edit_Object.png" src="_images/Win_Toolbar_Edit_Object.png" />
<p class="caption"><span class="caption-number">Fig. 5.25 </span><span class="caption-text">The “Edit Object” button in the toolbar of the Windows interpreter.</span><a class="headerlink" href="#win-toolbar-edit-object" title="Permalink to this image">#</a></p>
</div>
</div>
<div class="section" id="what-can-you-edit">
<span id="user-defined-functions-what-can-you-edit"></span><h3><span class="section-number">5.13.2. </span>What Can You Edit?<a class="headerlink" href="#what-can-you-edit" title="Permalink to this headline">#</a></h3>
<p>The following table shows the different item types that can be displayed using the text editor. Some of them can be modified (are “Editable”) while others cannot: they can only be viewed.</p>
<p>The table contains a list of the item types, the default foreground and background colours used to represent them and a “Yes” or “No” depending on whether they can be modified or not.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Item type</p></th>
<th class="text-align:center head"><p>Foreground</p></th>
<th class="text-align:center head"><p>Background</p></th>
<th class="text-align:center head"><p>Editable</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Function</p></td>
<td class="text-align:center"><p><em>various</em></p></td>
<td class="text-align:center"><p>White</p></td>
<td class="text-align:center"><p>Yes</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Character matrix</p></td>
<td class="text-align:center"><p>Green</p></td>
<td class="text-align:center"><p>Black</p></td>
<td class="text-align:center"><p>Yes</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Character vector</p></td>
<td class="text-align:center"><p>Black</p></td>
<td class="text-align:center"><p>White</p></td>
<td class="text-align:center"><p>Yes</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Vector of character vectors</p></td>
<td class="text-align:center"><p>Blue</p></td>
<td class="text-align:center"><p>Black</p></td>
<td class="text-align:center"><p>Yes</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Any numeric array</p></td>
<td class="text-align:center"><p>White</p></td>
<td class="text-align:center"><p>Grey</p></td>
<td class="text-align:center"><p>No</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Mixed array</p></td>
<td class="text-align:center"><p>Blue</p></td>
<td class="text-align:center"><p>Grey</p></td>
<td class="text-align:center"><p>No</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Object representation (<code class="docutils literal notranslate"><span class="pre">⎕OR</span></code>)</p></td>
<td class="text-align:center"><p>White</p></td>
<td class="text-align:center"><p>Red</p></td>
<td class="text-align:center"><p>No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="what-can-you-do">
<span id="user-defined-functions-what-can-you-do"></span><h3><span class="section-number">5.13.3. </span>What Can You Do?<a class="headerlink" href="#what-can-you-do" title="Permalink to this headline">#</a></h3>
<div class="section" id="cut-copy-paste">
<span id="user-defined-functions-cut-copy-paste"></span><h4><span class="section-number">5.13.3.1. </span>Cut / Copy / Paste<a class="headerlink" href="#cut-copy-paste" title="Permalink to this headline">#</a></h4>
<p>it is possible to Cut / Copy / Paste text inside an edit window but also from one edit window to another one. It is also possible to copy text from the session window and paste it into any function, operator or editable variable, or vice-versa. So, if you have entered some experimental expressions in the session you can drag and drop them into a defined function.</p>
<p>On Windows, if you installed the default keyboard layout that comes with Dyalog APL, it may happen that <kbd>Ctrl</kbd>+<kbd>c</kbd> produces an APL glyph instead of copying the selected text. If this is the case, you can either install a layout that doesn’t have these collisions, like <a class="reference external" href="https://github.com/abrudz/kbd">abrudz’s AltGr layout</a>, or you can right-click and then select Cut / Copy / Paste, instead of using the usual keyboard shortcuts.</p>
</div>
<div class="section" id="drag-drop-restrictions">
<span id="user-defined-functions-dragdrop-restrictions"></span><h4><span class="section-number">5.13.3.2. </span>Drag/Drop Restrictions<a class="headerlink" href="#drag-drop-restrictions" title="Permalink to this headline">#</a></h4>
<p>You may <em>move</em> or <em>copy</em> test using drag/drop but the following behaviour applies:</p>
<ul class="simple">
<li><p>if you drag/drop within the same Edit window, the default operation is a <em>move</em>. If you press the <kbd>Ctrl</kbd> key at the same time, the operation is a <em>copy</em>;</p></li>
<li><p>if you drag/drop text from one window to another window, the operation is always a <em>copy</em>;</p></li>
<li><p>if you drag/drop text within the Session window, the operation is always a <em>copy</em>.</p></li>
</ul>
</div>
<div class="section" id="exit-the-editor">
<span id="user-defined-functions-exit-the-editor"></span><h4><span class="section-number">5.13.3.3. </span>Exit the Editor<a class="headerlink" href="#exit-the-editor" title="Permalink to this headline">#</a></h4>
<p>We have already seen the main ways of leaving the editor:</p>
<ul class="simple">
<li><p>press the <kbd>Esc</kbd> key (or use “File” ⇨ “Exit (and Fix)” on the Windows editor). This fixes the modifications and closes the edit window;</p></li>
<li><p>press <kbd>Shift</kbd>+<kbd>Esc</kbd> (or use “File ⇨ “Exit and discard changes” on the Windows editor). This leaves the editor without saving modifications; they are lost;</p></li>
<li><p>on Windows, “File” ⇨ “Fix” fixes the modifications but does not close the edit window.</p></li>
</ul>
</div>
</div>
<div class="section" id="undo-redo-replay">
<span id="user-defined-functions-undo-redo-replay"></span><h3><span class="section-number">5.13.4. </span>Undo, Redo, Replay<a class="headerlink" href="#undo-redo-replay" title="Permalink to this headline">#</a></h3>
<div class="section" id="undo">
<span id="user-defined-functions-undo"></span><h4><span class="section-number">5.13.4.1. </span>Undo<a class="headerlink" href="#undo" title="Permalink to this headline">#</a></h4>
<p>As long as the contents of an Edit window have not been fixed, it is possible to undo all the modifications made since the last fix.</p>
<p>To <em><strong>undo</strong></em> modifications you can</p>
<ul class="simple">
<li><p>press <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Backspace</kbd> as many times as needed, or</p></li>
<li><p>activate the menu “Edit” ⇨ “Undo”.</p></li>
</ul>
<p>If your APL keyboard layout allows it, you can also use <kbd>Ctrl</kbd>+<kbd>z</kbd>.</p>
</div>
<div class="section" id="redo">
<span id="user-defined-functions-redo"></span><h4><span class="section-number">5.13.4.2. </span>Redo<a class="headerlink" href="#redo" title="Permalink to this headline">#</a></h4>
<p>Having used <em><strong>undo</strong></em>, it is possible to restore the changes that you have undone, one by one.</p>
<p>To <em><strong>redo</strong></em> modifications, you can</p>
<ul class="simple">
<li><p>press <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Enter</kbd> as many times as needed, or</p></li>
<li><p>activate the menu “Edit” ⇨ “Redo”.</p></li>
</ul>
<p>If you APL keyboard layout allows it, you can also use <kbd>Ctrl</kbd>+<kbd>y</kbd>.</p>
<p>It must be emphasised that the <em>Undo/Redo</em> facility applies only to the current window. If some pieces of text have been copied to another window, the contents of the other window are not affected by the <em>Undo</em> or <em>Redo</em> operations.</p>
</div>
<div class="section" id="replay-input-lines">
<span id="user-defined-functions-replay-input-lines"></span><h4><span class="section-number">5.13.4.3. </span>Replay Input Lines<a class="headerlink" href="#replay-input-lines" title="Permalink to this headline">#</a></h4>
<p>The same keyboard shortcuts (<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Backspace</kbd> and <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Enter</kbd>) can be used to scroll up and down the statements that you have previously entered into the session window. For example, suppose you have made several sequential calculations that generate a considerable amount of output, only then to realise you made a mistake in the beginning.</p>
<p>You <em>could</em> scroll back through the considerable amount of output to find the statement with the error. However, you can search just through the <em>input</em> statements instead (only the lines that you have entered, excluding any output), which are stored in a dedicated Input History buffer:</p>
<ul class="simple">
<li><p>press <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Backspace</kbd> to scroll back through the Input History Buffer as many times as needed;</p></li>
<li><p>press <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Enter</kbd> to scroll forward if you went too far back.</p></li>
</ul>
<p>Once you have found the line, you can change it (or not) and then execute it again by pressing the <kbd>Enter</kbd> key.</p>
<p>If you are using the Windows interpreter, you can control the size of this dedicated buffer with the following configuration parameter:
“Options” ⇨ “Configure…” ⇨ “Session” ⇨ “History buffer size”</p>
<!-- (TODO) Say how to change this for RIDE users. --></div>
</div>
</div>
<div class="section" id="miscellaneous">
<span id="user-defined-functions-miscellaneous"></span><h2><span class="section-number">5.14. </span>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">#</a></h2>
<div class="section" id="list-of-variables-and-functions">
<span id="user-defined-functions-list-of-variables-and-functions"></span><h3><span class="section-number">5.14.1. </span>List of Variables and Functions<a class="headerlink" href="#list-of-variables-and-functions" title="Permalink to this headline">#</a></h3>
<p>You can obtain a list of your variables by typing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">vars</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">FILEPATH        URL     Val     a       actual  array   b       base    c       charMat chemistry       d       file1   
file2   filepath        forecast        hours   inverses        links   mat     nesMat  nm      path    salaries        
times   towns   u       v       var     which   x       zap     
</span></div></div>
</div>
<p>and you can obtain a list of your functions by typing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">fns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">AMHM    AbsVal  Add3    Average BadSyntaxTradfn CasePotpourri   CheckVar        CollatzPath     Comment ComputeGrowthTime
ContinueInsideWhile     Count   Dispatch        DivideIt        Divisors        DivisorsNoLoops Endless Fact    Fact2   
HarmonicMean    Hypo    Interlace       IsItExpensive   IsItExpensiveDfn        Magic   MultipleDestinations    
MultiplyBy10    NestedRes       NewName Plus    PlusNoRes       PrintAB PrintCD PrintE  Process Prompt1 Prompt2 QuadRoot
Rho     Root    RootOf10        Round   SaneIsItExpensive       SetAThenPrint   SetBThenPrint   SetCThenPrint   
SetDThenPrint   SetLocalE       ShyFun  Sign    Silly   Sum     Times   Times2  TimesTwo        TradHarmonicMean        
Useless VarLevels       ZapMe   
</span></div></div>
</div>
</div>
<div class="section" id="use-of-the-result">
<span id="user-defined-functions-use-of-the-result"></span><h3><span class="section-number">5.14.2. </span>Use of the Result<a class="headerlink" href="#use-of-the-result" title="Permalink to this headline">#</a></h3>
<p>To sum up what we have already seen, once a function has been defined and we call it, its result can be:</p>
<ul class="simple">
<li><p>Immediately displayed and lost:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="nv">times</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
<ul class="simple">
<li><p>Included in an expression:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">60</span><span class="o">×</span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="nv">times</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">53.7313
</span></div></div>
</div>
<ul class="simple">
<li><p>Assigned to a variable:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hours</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">HarmonicMean</span><span class="w"> </span><span class="nv">times</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="vector-representation">
<span id="user-defined-functions-vector-representation"></span><h3><span class="section-number">5.14.3. </span>Vector Representation<a class="headerlink" href="#vector-representation" title="Permalink to this headline">#</a></h3>
<p>We saw that double-clicking on a function name invokes the editor and allows the user to edit the code. We can also type the name of the function and see its code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TradHarmonicMean</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">    ∇  mean←TradHarmonicMean argVector;inverses
[1]    inverses←÷argVector
[2]    mean←÷+/inverses
    ∇
</span></div></div>
</div>
<p>One can also obtain this representation (as a character array) using the built-in <em>system function</em> <code class="docutils literal notranslate"><span class="pre">⎕VR</span></code> (for <em>vector representation</em>) of Dyalog APL. <em>System functions</em> are a special kind of function provided with the development environment. The first character of their name is a <em>quad</em> (<code class="docutils literal notranslate"><span class="pre">⎕</span></code>) which guarantees that they cannot conflict with user-defined names, and their names are also case-insensitive:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕VR</span><span class="w"> </span><span class="s1">&#39;TradHarmonicMean&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ mean←TradHarmonicMean argVector;inverses
[1]    inverses←÷argVector
[2]    mean←÷+/inverses
     ∇
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕Vr</span><span class="w"> </span><span class="s1">&#39;TradHarmonicMean&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ mean←TradHarmonicMean argVector;inverses
[1]    inverses←÷argVector
[2]    mean←÷+/inverses
     ∇
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕vr</span><span class="w"> </span><span class="s1">&#39;TradHarmonicMean&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ mean←TradHarmonicMean argVector;inverses
[1]    inverses←÷argVector
[2]    mean←÷+/inverses
     ∇
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕vR</span><span class="w"> </span><span class="s1">&#39;TradHarmonicMean&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ mean←TradHarmonicMean argVector;inverses
[1]    inverses←÷argVector
[2]    mean←÷+/inverses
     ∇
</span></div></div>
</div>
<p>Note that this is quite unusual in a programming language. The result of <code class="docutils literal notranslate"><span class="pre">⎕VR</span></code> is a character vector representing the source code of our function, which is now available for processing by other functions in the workspace!</p>
<p>System functions will be discussed in detail in <span class="xref myst">a later chapter</span>.</p>
</div>
<div class="section" id="source-code-management">
<span id="user-defined-functions-source-code-management"></span><h3><span class="section-number">5.14.4. </span>Source Code Management<a class="headerlink" href="#source-code-management" title="Permalink to this headline">#</a></h3>
<p>Up to now, all the functions and operators we defined were created with an APL code editor and stored in an APL workspace.</p>
<p>This monolithic <em>one-workspace</em> approach to application development works well for small applications developed by single programmers, but is often inappropriate for large applications developed by single programmers. Some groups have tacked this problem by storing code in ancillary workspaces or special files. Code is then copied dynamically into the main workspace when required, using techniques that will be explained later.</p>
<p>Had the same application been developed in a more traditional language, programs would be entered and modified using a text editor, stored in separate text files, and maintained independently from one another under the aegis of a <em>source code management</em> system that allows the team of programmers to coordinate their activities and keep track of changes.</p>
<p>This type of application development approach is also available in Dyalog APL, using source code management systems like <em>SALT</em> (for <em>Simple APL Library Toolkit</em>) and <em>Link</em>.</p>
<p>These systems make it possible to store sets of APL functions, operators and variables in text files that may be edited and managed using either the built-in APL code editor or industry standard tools This makes it easier to share code between projects and teams of developers.</p>
<p>To take full advantage of this new technique of developing applications, you should first learn about <em>Namespaces</em> and related topics, notations and commands. For this reason, these tools will be studied later in <span class="xref myst">the chapter about source code management</span>.</p>
<div class="figure align-default" id="drowning">
<span id="fig-drowning"></span><img alt="_images/Drowning.png" src="_images/Drowning.png" />
<p class="caption"><span class="caption-number">Fig. 5.26 </span><span class="caption-text">Person drowning in APL glyphs is reassured by someone else telling him about the “First Aid Kit” chapter.</span><a class="headerlink" href="#drowning" title="Permalink to this image">#</a></p>
</div>
</div>
</div>
<div class="section" id="exercises-on-tradfns">
<span id="user-defined-functions-exercises-on-tradfns"></span><h2><span class="section-number">5.15. </span>Exercises on Tradfns<a class="headerlink" href="#exercises-on-tradfns" title="Permalink to this headline">#</a></h2>
<div class="exercise admonition" id="ex-maxplace">

<p class="admonition-title"><span class="caption-number">Exercise 5.11 </span></p>
<div class="section" id="exercise-content">
<p>Write a function which displays the greatest value in a numeric matrix, along with its position (row and column) in the matrix.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 89 166 420 508  12  23
111 453 177 365 284 352
349 192 329 115 515 374
160 467 234 519 485 283
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MaxPlace</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">The greatest value: 519 in row 4, column 4
</span></div></div>
</div>
<div class="exercise admonition" id="ex-convert">

<p class="admonition-title"><span class="caption-number">Exercise 5.12 </span></p>
<div class="section" id="exercise-content">
<p>Conversions from Celsius to Fahrenheit degrees and back can be done using the following formulas:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">←</span> <span class="pre">32+9×C÷5</span></code> converts from Celsius to Fahrenheit;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C</span> <span class="pre">←</span> <span class="pre">5×(F-32)÷9</span></code> converts from Fahrenheit to Celsius.</p></li>
</ul>
<p>Program a function <code class="docutils literal notranslate"><span class="pre">Convert</span></code> that makes the conversion <code class="docutils literal notranslate"><span class="pre">C→F</span></code> or <code class="docutils literal notranslate"><span class="pre">F→C</span></code> according to its right argument.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">86</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">212</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;F-C&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">30 0 100
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">30</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">212</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;F-C&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;C-F&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">44.6 59 77
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">44.6</span><span class="w"> </span><span class="m">59</span><span class="w"> </span><span class="m">77</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;C-F&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-loopsum">

<p class="admonition-title"><span class="caption-number">Exercise 5.13 </span></p>
<div class="section" id="exercise-content">
<p>Summing the items of a vector is so simple in APL (<code class="docutils literal notranslate"><span class="pre">+/vec</span></code>) that one cannot understand why this simple problem needs a loop in traditional languages! Just for fun, can you program such a loop in APL? Use control structures.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">260</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">LoopSum</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">42</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-reverloop">

<p class="admonition-title"><span class="caption-number">Exercise 5.14 </span></p>
<div class="section" id="exercise-content">
<p>In <a class="reference internal" href="#ex-reverse"><span class="std std-ref">exercise 3</span></a> you were asked to reverse the order of a vector of items. Even if it is a strange idea, can you do the same operation using a loop, moving letter after letter?</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ReverLoop</span><span class="w"> </span><span class="s1">&#39;The solution without loop was much better&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">retteb hcum saw pool tuohtiw noitulos ehT
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;retteb hcum saw pool tuohtiw noitulos ehT&#39;</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">ReverLoop</span><span class="w"> </span><span class="s1">&#39;The solution without loop was much better&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-subsum">

<p class="admonition-title"><span class="caption-number">Exercise 5.15 </span></p>
<div class="section" id="exercise-content">
<p>In a given numeric matrix with <span class="math notranslate nohighlight">\(n\)</span> columns, we would like to insert subtotals after each group of <span class="math notranslate nohighlight">\(g\)</span> columns (where <span class="math notranslate nohighlight">\(g\)</span> is a divisor of <span class="math notranslate nohighlight">\(n\)</span>).</p>
<p>Try to write a function <code class="docutils literal notranslate"><span class="pre">SubSum</span></code> to do that, following these 3 steps:</p>
<ol class="simple">
<li><p>reshape the matrix so that it fits in <span class="math notranslate nohighlight">\(g\)</span> columns only, with the necessary number of rows to contain all the values;</p></li>
<li><p>catenate, on the right, the totals of each row; and</p></li>
<li><p>reshape again that new matrix to obtain the final result.</p></li>
</ol>
</div>
</div>
<p>In the examples below, the original matrix appears in black and the subtotals appear in grey:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 89 166 420 508  12  23
111 453 177 365 284 352
349 192 329 115 515 374
160 467 234 519 485 283
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">SubSum</span> <span class="pre">actual</span></code> should give</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{matrix}
 89 &amp; 166 &amp; 420 &amp;\color{grey}{675} &amp; 508 &amp; 12 &amp;  23 &amp;\color{grey}{543} \\
111 &amp; 453 &amp; 177 &amp;\color{grey}{741} &amp; 365 &amp; 284 &amp; 352 &amp;\color{grey}{1001} \\
349 &amp; 192 &amp; 329 &amp;\color{grey}{870} &amp; 115 &amp; 515 &amp; 374 &amp;\color{grey}{1004} \\
160 &amp; 467 &amp; 234 &amp;\color{grey}{861} &amp; 519 &amp; 485 &amp; 283 &amp;\color{grey}{1287}  
\end{matrix}
\end{split}\]</div>
<p>and <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">SubSum</span> <span class="pre">actual</span></code> should give</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{matrix}
 89 &amp; 166 &amp;\color{grey}{255} &amp; 420 &amp; 508 &amp;\color{grey}{928} &amp; 12 &amp;  23 &amp;\color{grey}{35} \\
111 &amp; 453 &amp;\color{grey}{564} &amp; 177 &amp; 365 &amp;\color{grey}{542} &amp; 284 &amp; 352 &amp;\color{grey}{636} \\
349 &amp; 192 &amp;\color{grey}{541} &amp; 329 &amp; 115 &amp;\color{grey}{444} &amp; 515 &amp; 374 &amp;\color{grey}{889} \\
160 &amp; 467 &amp;\color{grey}{627} &amp; 234 &amp; 519 &amp;\color{grey}{753} &amp; 485 &amp; 283 &amp;\color{grey}{768}  
\end{matrix}
\end{split}\]</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w">    </span><span class="m">89</span><span class="w"> </span><span class="m">166</span><span class="w"> </span><span class="m">420</span><span class="w"> </span><span class="m">675</span><span class="w"> </span><span class="m">508</span><span class="w">  </span><span class="m">12</span><span class="w">  </span><span class="m">23</span><span class="w">  </span><span class="m">543</span><span class="w"></span>
<span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">,</span><span class="m">111</span><span class="w"> </span><span class="m">453</span><span class="w"> </span><span class="m">177</span><span class="w"> </span><span class="m">741</span><span class="w"> </span><span class="m">365</span><span class="w"> </span><span class="m">284</span><span class="w"> </span><span class="m">352</span><span class="w"> </span><span class="m">1001</span><span class="w"></span>
<span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">,</span><span class="m">349</span><span class="w"> </span><span class="m">192</span><span class="w"> </span><span class="m">329</span><span class="w"> </span><span class="m">870</span><span class="w"> </span><span class="m">115</span><span class="w"> </span><span class="m">515</span><span class="w"> </span><span class="m">374</span><span class="w"> </span><span class="m">1004</span><span class="w"></span>
<span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">,</span><span class="m">160</span><span class="w"> </span><span class="m">467</span><span class="w"> </span><span class="m">234</span><span class="w"> </span><span class="m">861</span><span class="w"> </span><span class="m">519</span><span class="w"> </span><span class="m">485</span><span class="w"> </span><span class="m">283</span><span class="w"> </span><span class="m">1287</span><span class="w"></span>
<span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="nv">r</span><span class="p">)</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="nv">SubSum</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w">    </span><span class="m">89</span><span class="w"> </span><span class="m">166</span><span class="w"> </span><span class="m">255</span><span class="w"> </span><span class="m">420</span><span class="w"> </span><span class="m">508</span><span class="w"> </span><span class="m">928</span><span class="w">  </span><span class="m">12</span><span class="w">  </span><span class="m">23</span><span class="w">  </span><span class="m">35</span><span class="w"></span>
<span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">,</span><span class="m">111</span><span class="w"> </span><span class="m">453</span><span class="w"> </span><span class="m">564</span><span class="w"> </span><span class="m">177</span><span class="w"> </span><span class="m">365</span><span class="w"> </span><span class="m">542</span><span class="w"> </span><span class="m">284</span><span class="w"> </span><span class="m">352</span><span class="w"> </span><span class="m">636</span><span class="w"></span>
<span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">,</span><span class="m">349</span><span class="w"> </span><span class="m">192</span><span class="w"> </span><span class="m">541</span><span class="w"> </span><span class="m">329</span><span class="w"> </span><span class="m">115</span><span class="w"> </span><span class="m">444</span><span class="w"> </span><span class="m">515</span><span class="w"> </span><span class="m">374</span><span class="w"> </span><span class="m">889</span><span class="w"></span>
<span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="o">,</span><span class="m">160</span><span class="w"> </span><span class="m">467</span><span class="w"> </span><span class="m">627</span><span class="w"> </span><span class="m">234</span><span class="w"> </span><span class="m">519</span><span class="w"> </span><span class="m">753</span><span class="w"> </span><span class="m">485</span><span class="w"> </span><span class="m">283</span><span class="w"> </span><span class="m">768</span><span class="w"></span>
<span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="o">⍴</span><span class="nv">r</span><span class="p">)</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="nv">SubSum</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="exercise admonition" id="ex-sorry">

<p class="admonition-title"><span class="caption-number">Exercise 5.16 </span></p>
<div class="section" id="exercise-content">
<p>This is a very classic problem: we want to partition a text vector each time a given separator is found and make a matrix from these pieces.
Implement this functionality in a monadic function <code class="docutils literal notranslate"><span class="pre">Separate</span></code>.</p>
</div>
</div>
<p>Please bear in mind that is exercise is very manageable if you let yourself use a couple of control flow structures.
However, solving this exercise with a dfn requires you to make an ingenious use of a primitive we have covered previously.</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="s1">&#39;You/will/need a/loop/to solve/this/exercise&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You     
will    
need a  
loop    
to solve
this    
</span></div></div>
</div>
<div class="exercise admonition" id="ex-collatzpath">

<p class="admonition-title"><span class="caption-number">Exercise 5.17 </span></p>
<div class="section" id="exercise-content">
<p>Remember when we talked about the <a class="reference external" href="https://en.wikipedia.org/wiki/Collatz_conjecture">“Collatz Conjecture”</a> earlier on? Don’t worry if you don’t. Now, you will implement a function that takes a positive integer <code class="docutils literal notranslate"><span class="pre">n</span></code> and creates a vector of numbers by successively taking the most recent number and then creating the next value according to a couple of rules:</p>
<ul class="simple">
<li><p>if the most recent number is <strong>even</strong>, the next value will be half of it;</p></li>
<li><p>if the most recent number is <strong>odd</strong>, the next value will be 1 more than the triple of it; and</p></li>
<li><p>you stop when you reach 1.</p></li>
</ul>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 16 8 4 2 1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37 112 56 28 14 7 22 11 34 17 52 26 13 40 20 10 5 16 8 4 2 1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">37</span><span class="w"> </span><span class="m">112</span><span class="w"> </span><span class="m">56</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">34</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="section" id="exercise-variants">
<span id="user-defined-functions-exercise-variants"></span><h3><span class="section-number">5.15.1. </span>Exercise Variants<a class="headerlink" href="#exercise-variants" title="Permalink to this headline">#</a></h3>
<p>Now that you were given some exercises on dfns (cf. <a class="reference internal" href="#user-defined-functions-exercises-on-dfns"><span class="std std-numref">Section 5.4</span></a>) and some exercises on tradfns (cf. <a class="reference internal" href="#user-defined-functions-exercises-on-tradfns"><span class="std std-numref">Section 5.15</span></a>), which ones can you solve with the other method? Solving exercises 11 to 17 with dfns will be harder than solving exercises 1 to 10 with tradfns.</p>
<p>Also, can you solve exercise 17 with a recursive function? Either dfn or tradfn, your choice.</p>
</div>
</div>
<div class="section" id="the-specialist-s-section">
<span id="user-defined-functions-the-specialists-section"></span><h2><span class="section-number">5.16. </span>The Specialist’s Section<a class="headerlink" href="#the-specialist-s-section" title="Permalink to this headline">#</a></h2>
<br />
<center><i>Each chapter is followed by a "Specialist's Section" like this one. This section is dedicated to skilled APLers who wish to improve their knowledge.</i>
<p>You will find here rare or complex usages of the concepts presented in this chapter, or discover extended explanations which need the knowledge of some symbols that will be seen much further in the book.</p>
<p><b>If you are exploring APL for the first time, skip this section and go to the next chapter.</b></center></p>
<div class="section" id="shadowed-names">
<span id="user-defined-functions-shadowed-names"></span><h3><span class="section-number">5.16.1. </span>Shadowed Names<a class="headerlink" href="#shadowed-names" title="Permalink to this headline">#</a></h3>
<p>A name can be localised in a tradfn only if the programmer explicitly specifies its name in the function header. But a function can dynamically define new variables or new functions, using Execute (<code class="docutils literal notranslate"><span class="pre">⍎</span></code>) and <code class="docutils literal notranslate"><span class="pre">⎕FX</span></code>.</p>
<p>So, during function execution, names of new variables and functions may be created dynamically. They could not therefore be localised explicitly when the function was written, but they can be localised, or <em>shadowed</em>, dynamically at runtime.</p>
<p>One or more names can be shadowed using the <em>system function</em> <code class="docutils literal notranslate"><span class="pre">⎕SHADOW</span></code>, which accepts a vector of names separated by blanks, or a matrix of names with one name per row (but <strong>not</strong> a nested vector of names). For example, let us define a niladic tradfn <code class="docutils literal notranslate"><span class="pre">Demonstration</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">Demonstration</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;This is just&#39;</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;a demo function&#39;</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>and have <code class="docutils literal notranslate"><span class="pre">dummy</span></code> hold its <em>canonical representation</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">dummy</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕CR</span><span class="w"> </span><span class="s1">&#39;Demonstration&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> Demonstration    
 'This is just'   
 'a demo function'
</span></div></div>
</div>
<p>Now that we have <code class="docutils literal notranslate"><span class="pre">Demonstration</span></code>’s canonical representation, we can erase the function from our workspace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">erase</span><span class="w"> </span><span class="nv">Demonstration</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now define a function <code class="docutils literal notranslate"><span class="pre">Ombra</span></code> with no localised names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">vecRepr</span><span class="w"> </span><span class="nv">Ombra</span><span class="w"> </span><span class="nv">text</span><span class="w"></span>
<span class="w">    </span><span class="nf">⎕SHADOW</span><span class="w"> </span><span class="nv">text</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">vecRepr</span><span class="sr">[</span><span class="m">1</span><span class="sr">;]</span><span class="w"></span>
<span class="w">    </span><span class="o">⍎</span><span class="nv">text</span><span class="o">,</span><span class="s1">&#39;←1&#39;</span><span class="w"></span>
<span class="w">    </span><span class="o">⍎</span><span class="nf">⎕FX</span><span class="w"> </span><span class="nv">vecRepr</span><span class="w"></span>
<span class="w">    </span><span class="c1">⍝... ⍝ Intentional error.</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Let us execute it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">dummy</span><span class="w"> </span><span class="nv">Ombra</span><span class="w"> </span><span class="s1">&#39;new&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">This is just
a demo function
</span></div></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">Ombra</span></code> above</p>
<ul class="simple">
<li><p>starts by shadowing the names <code class="docutils literal notranslate"><span class="pre">new</span></code> and <code class="docutils literal notranslate"><span class="pre">Demonstration</span></code>,</p></li>
<li><p>then dynamically creates a variable named <code class="docutils literal notranslate"><span class="pre">new</span></code></p></li>
<li><p>and finally fixes a new function named <code class="docutils literal notranslate"><span class="pre">Demonstration</span></code> and executes it.</p></li>
</ul>
<p>If you are using an interpreter, you can try uncommenting the final line of the <code class="docutils literal notranslate"><span class="pre">Ombra</span></code> tradfn so that the tracer interrupts function execution inside the tradfn. That way, you can check the names <code class="docutils literal notranslate"><span class="pre">new</span></code> and <code class="docutils literal notranslate"><span class="pre">Demonstration</span></code> have been created. But when the function completes, <code class="docutils literal notranslate"><span class="pre">new</span></code> and <code class="docutils literal notranslate"><span class="pre">Demonstration</span></code> disappear, as they were only local names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">new</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: new
      new
      ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Demonstration</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: Demonstration
      Demonstration
      ∧
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="scoping-in-nested-function-calls">
<span id="user-defined-functions-scoping-in-nested-function-calls"></span><h3><span class="section-number">5.16.2. </span>Scoping in Nested Function Calls<a class="headerlink" href="#scoping-in-nested-function-calls" title="Permalink to this headline">#</a></h3>
<div class="section" id="reading-the-caller-s-names">
<span id="user-defined-functions-reading-the-callers-names"></span><h4><span class="section-number">5.16.2.1. </span>Reading the Caller’s Names<a class="headerlink" href="#reading-the-caller-s-names" title="Permalink to this headline">#</a></h4>
<p>We have seen that dfns have lexical scoping and that tradfns have dynamic scoping, but this can become complicated when we have dfns calling tradfns and tradfns calling dfns.</p>
<p>We will now try to answer the following question: when a function calls another independent function, can the callee read a name from the caller?
We already know that if both the caller and callee are dfns, then the answer is <em>no</em>; on the other hand, if both the caller and the callee are tradfns, the answer is <em>yes</em>.
In this exploration we will also show that the answer is <em>yes</em> for the cases when a dfn calls a tradfn and when a tradfn calls a dfn:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Can a callee ↓ read a name from the caller → ?</p></th>
<th class="text-align:left head"><p>dfn</p></th>
<th class="text-align:left head"><p>tradfn</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>dfn</p></td>
<td class="text-align:left"><p>No</p></td>
<td class="text-align:left"><p>Yes</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>tradfn</p></td>
<td class="text-align:left"><p>Yes</p></td>
<td class="text-align:left"><p>Yes</p></td>
</tr>
</tbody>
</table>
<p>For our investigation we will define two “inner” functions (a dfn and a tradfn) that will act as the callee.
Then we just need to write “outer” functions that act as the callers.
To make our lives easier, all these functions will be dealing with a single variable named <code class="docutils literal notranslate"><span class="pre">t</span></code>, that we also set in the global scope:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;global var&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">InnerDfn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="no">⍬</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">InnerDfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">global var

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">InnerTradfn</span><span class="w"> </span><span class="nv">x</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">InnerTradfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">global var

</span></div></div>
</div>
<p>Now we create dfns and tradfns that assign locally to <code class="docutils literal notranslate"><span class="pre">t</span></code>, and then call the “inner” functions to see what value of <code class="docutils literal notranslate"><span class="pre">t</span></code> they actually print.
We start by confirming the answers we already have, first by showing that if a dfn calls an independent dfn, then the callee cannot see the caller’s names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">DfnCallsDfn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;DfnCallsDfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">InnerDfn</span><span class="no">⍬</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DfnCallsDfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">global var

</span></div></div>
</div>
<p>Now we show that if the callee and the caller are tradfns, then the callee can read the caller’s names, <em>even if</em> the caller localises its names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">TradfnCallsTradfn</span><span class="w"> </span><span class="nv">x</span><span class="sr">;</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;TradfnCallsTradfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">InnerTradfn</span><span class="w"> </span><span class="no">⍬</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TradfnCallsTradfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">TradfnCallsTradfn


</span></div></div>
</div>
<p>Now we are left with the dfn-tradfn and tradfn-dfn cases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">DfnCallsTradfn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;DfnCallsTradfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">InnerTradfn</span><span class="no">⍬</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DfnCallsTradfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">DfnCallsTradfn

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">TradfnCallsDfn</span><span class="w"> </span><span class="nv">x</span><span class="sr">;</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;TradfnCallsDfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">InnerDfn</span><span class="no">⍬</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TradfnCallsDfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">TradfnCallsDfn


</span></div></div>
</div>
<p>As we can see, with respect to accessing the caller’s variables, a dfn calling a tradfn and a tradfn calling a dfn behave in the same way as a tradfn that calls a tradfn, which confirms the table in the beginning of this sub-subsection.</p>
<p>It is worthwhile mentioning that the global value of <code class="docutils literal notranslate"><span class="pre">t</span></code> remains intact:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">global var
</span></div></div>
</div>
</div>
<div class="section" id="modifying-the-caller-s-names">
<span id="user-defined-functions-modifying-the-callers-names"></span><h4><span class="section-number">5.16.2.2. </span>Modifying the Caller’s Names<a class="headerlink" href="#modifying-the-caller-s-names" title="Permalink to this headline">#</a></h4>
<p>It was shown before that a called function may read the value of the caller, but can it change its value?
If the callee is a tradfn, you can change the value of the caller’s name with a plain assignment, because names in tradfns
are not localised by default:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">global var
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">InnerTradfn</span><span class="w"> </span><span class="nv">x</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;inner t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;InnerTradfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;inner t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">OuterTradfn</span><span class="w"> </span><span class="nv">x</span><span class="sr">;</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;OuterTradfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;outer t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">InnerTradfn</span><span class="no">⍬</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;outer t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">OuterTradfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">outer t: OuterTradfn
inner t: OuterTradfn
inner t: InnerTradfn
outer t: InnerTradfn

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">OuterDfn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;OuterDfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;outer t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">InnerTradfn</span><span class="no">⍬</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;outer t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="no">⍬</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">OuterDfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">outer t: OuterDfn
inner t: OuterDfn
inner t: InnerTradfn
outer t: InnerTradfn

</span></div></div>
</div>
<p>However, if the callee is a dfn, plain assignment will create a new, local variable, with the same name as the one in the caller’s scope.
That happens because names in dfns are local by default:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">InnerDfn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;inner t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;InnerDfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;inner t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="no">⍬</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">OuterTradfn</span><span class="w"> </span><span class="nv">x</span><span class="sr">;</span><span class="w"> </span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;OuterTradfn&#39;</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;outer t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">InnerDfn</span><span class="no">⍬</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;outer t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">OuterTradfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">outer t: OuterTradfn
inner t: OuterTradfn
inner t: InnerDfn
outer t: OuterTradfn

</span></div></div>
</div>
<p>In this case, if you want to modify the name of the caller you have to trick APL into thinking you are <em>reading</em> from the name and <em>writing</em> to it at the same time, for example with a redundant modified assignment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">InnerDfn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;inner t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="nv">t</span><span class="w"> </span><span class="o">⊢</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;InnerDfn&#39;</span><span class="w">    </span><span class="c1">⍝ Notice the modified assignment with ⊢</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;inner t: &#39;</span><span class="o">,</span><span class="nv">t</span><span class="w"></span>
<span class="w">    </span><span class="no">⍬</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">OuterTradfn</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">outer t: OuterTradfn
inner t: OuterTradfn
inner t: InnerDfn
outer t: InnerDfn

</span></div></div>
</div>
<p>Once again, notice that the global <code class="docutils literal notranslate"><span class="pre">t</span></code> is still intact:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">t</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">global var
</span></div></div>
</div>
<p>These short explorations show that the scoping rules can become quite intricate, so it really is best to pass information in and out of functions as arguments/return values and not rely on scoping for that.
This is, of course, just a suggestion and not a rule to follow blindly: a quintessential example of using scoping rules to your advantage is when defining a small inline dfn inside a larger function, e.g. to define a helper function that needs to be given as an operand to some operator, but that also needs access to the existing local variables.</p>
</div>
</div>
<div class="section" id="loop-control">
<span id="user-defined-functions-loop-control"></span><h3><span class="section-number">5.16.3. </span>Loop Control<a class="headerlink" href="#loop-control" title="Permalink to this headline">#</a></h3>
<p>Loops programmed with traditional branch arrows are controlled by the APL statements. Loops using <em>control structures</em> are controlled by the interpreter. For that reason, if you trace loops programmed with <code class="docutils literal notranslate"><span class="pre">:Repeat</span></code> or <code class="docutils literal notranslate"><span class="pre">:For</span></code>, you will see that the first statement of the loop is executed only once, the following iterations execute only the “useful” statements. it is different for a <code class="docutils literal notranslate"><span class="pre">:While</span></code> loop because the test is placed in the first statement.</p>
<p>This has a surprising consequence. Imagine a <code class="docutils literal notranslate"><span class="pre">:For</span></code> loop using a control variable named <code class="docutils literal notranslate"><span class="pre">again</span></code> which is supposed to take three successive values: <code class="docutils literal notranslate"><span class="pre">12</span> <span class="pre">54</span> <span class="pre">86</span></code>.</p>
<p>But the programmer erroneously alters the value of <code class="docutils literal notranslate"><span class="pre">again</span></code> during execution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">Mess</span><span class="sr">;</span><span class="w"> </span><span class="nv">again</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">again</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">54</span><span class="w"> </span><span class="m">86</span><span class="w"></span>
<span class="w">        </span><span class="nv">again</span><span class="w"></span>
<span class="w">        </span><span class="nv">again</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Who modified me?&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">again</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Mess</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
Who modified me?
54
Who modified me?
86
Who modified me?
</span></div></div>
</div>
<p>Notice that, at each iteration, <code class="docutils literal notranslate"><span class="pre">again</span></code> is modified and is then automatically reset to the correct value in the subsequent iteration.</p>
</div>
<div class="section" id="labels-and-the-branch-arrow">
<span id="user-defined-functions-labels-and-the-branch-arrow"></span><h3><span class="section-number">5.16.4. </span>Labels and the Branch Arrow<a class="headerlink" href="#labels-and-the-branch-arrow" title="Permalink to this headline">#</a></h3>
<div class="section" id="niladic-arrow">
<span id="user-defined-functions-niladic-arrow"></span><h4><span class="section-number">5.16.4.1. </span>Niladic Arrow<a class="headerlink" href="#niladic-arrow" title="Permalink to this headline">#</a></h4>
<p>A niladic <em>branch arrow</em> <code class="docutils literal notranslate"><span class="pre">→</span></code> means: quit the current execution, i.e. quit the current function and all the calling functions, whatever the depth of the execution stack.</p>
<p>This is different from branching to zero <code class="docutils literal notranslate"><span class="pre">→0</span></code> which means “<em>quit the current function and resume execution in the calling environment</em>”.</p>
<p>When an execution is interrupted, a niladic <em>branch arrow</em> clears its execution stack.</p>
<p>When an evaluated input is requested by a <em>quad</em> (<code class="docutils literal notranslate"><span class="pre">⎕</span></code>), a niladic <em>branch arrow</em> stops the request and forces an exit from the function and from all the calling functions.</p>
<p>Note, however, that a niladic <em>branch arrow</em> only clears the most current execution stack. If several functions have been interrupted and new ones started without first clearing the execution stack, you may have several active stacks. Each stack is identified by an asterisk to the right of the name of the interrupted function.</p>
<p>If you are running an interpreter, try defining the following functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Foo</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="na">...</span><span class="w"> </span><span class="c1">⍝ Intentional error.</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Goo</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">Foo</span><span class="w"> </span><span class="no">⍬</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If you run <code class="docutils literal notranslate"><span class="pre">Goo⍬</span></code>, you will get an error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Goo</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SYNTAX ERROR
Foo[1] ... ⍝ Intentional error.
                               ∧
</pre></div>
</div>
</div>
</div>
<p>But if you are using an interpreter, the trace window should open and allow you to type APL expressions to debug your function. You can, for example, call <code class="docutils literal notranslate"><span class="pre">Goo</span></code> again, by typing <code class="docutils literal notranslate"><span class="pre">Goo⍬</span></code> and then <code class="docutils literal notranslate"><span class="pre">Goo⍬</span></code> again.</p>
<p>If, after that, you run <code class="docutils literal notranslate"><span class="pre">)si</span></code>, you get something like this:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="p">)</span><span class="nv">si</span><span class="w"></span>
<span class="c1">#.Foo[1]*</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
<span class="c1">#.Foo[1]*</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
<span class="c1">#.Foo[1]*</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
</pre></div>
</div>
<p>If you instruct the debugger to skip the current line (the line with <code class="docutils literal notranslate"><span class="pre">...</span></code> that generates a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code>) and to continue execution of the current thread, then APL will move on to the <code class="docutils literal notranslate"><span class="pre">⎕</span></code> line of <code class="docutils literal notranslate"><span class="pre">Foo</span></code>, in which you could do the following:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="bp">:</span><span class="w"></span>
<span class="w">      </span><span class="p">)</span><span class="nv">si</span><span class="w"></span>
<span class="vg">⎕</span><span class="w"></span>
<span class="c1">#.Foo[2]</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
<span class="c1">#.Foo[1]*</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
<span class="c1">#.Foo[1]*</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
<span class="vg">⎕</span><span class="bp">:</span><span class="w"></span>
<span class="w">      </span><span class="kd">→</span><span class="w"></span>
<span class="w">      </span><span class="p">)</span><span class="nv">si</span><span class="w"></span>
<span class="c1">#.Foo[1]*</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
<span class="c1">#.Foo[1]*</span><span class="w"></span>
<span class="c1">#.Goo[0]</span><span class="w"></span>
<span class="w">      </span><span class="p">)</span><span class="nv">reset</span><span class="w"></span>
<span class="w">      </span><span class="p">)</span><span class="nv">si</span><span class="w"></span>
</pre></div>
</div>
<p>As you can see, several stacks were active and using <code class="docutils literal notranslate"><span class="pre">→</span></code> only cleared the most recent one. Using <code class="docutils literal notranslate"><span class="pre">)reset</span></code> cleared all the execution stacks in one go.</p>
</div>
<div class="section" id="branch-to-a-wrong-label">
<span id="user-defined-functions-branch-to-a-wrong-label"></span><h4><span class="section-number">5.16.4.2. </span>Branch to a Wrong Label<a class="headerlink" href="#branch-to-a-wrong-label" title="Permalink to this headline">#</a></h4>
<p>We said that a <em>label</em> is processed as a numeric <em>local variable</em> which takes its value from the line number on which it appears. For example, if a function contains the statement <code class="docutils literal notranslate"><span class="pre">next:</span> <span class="pre">newPrice</span> <span class="pre">←</span> <span class="pre">oldPrice×(1-discount)</span></code> on line <code class="docutils literal notranslate"><span class="pre">[23]</span></code>, then <code class="docutils literal notranslate"><span class="pre">next</span></code> is a numeric value equal to 23. It is like a “read-only variable”, since you cannot modify it: any assignment to <code class="docutils literal notranslate"><span class="pre">next</span></code> would cause a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code>. However, the value of <code class="docutils literal notranslate"><span class="pre">next</span></code> will change if some lines are deleted or inserted before line 23.</p>
<p>For this reason, the statements <code class="docutils literal notranslate"><span class="pre">→next</span></code> and <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">next</span></code> are equivalent to <code class="docutils literal notranslate"><span class="pre">→23</span></code> - but only as long as the label <code class="docutils literal notranslate"><span class="pre">next</span></code> is defined in line number 23!</p>
<p>We also said that a branch to zero causes an exit from the current function. This is also the case for any jump to a line number which is outside the number of lines in the function. For example, <code class="docutils literal notranslate"><span class="pre">→50</span></code> would terminate any function which has less than 50 lines.</p>
<p>Now take a look at these two tradfns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">MainFun</span><span class="w"></span>
<span class="w">    </span><span class="nv">SubFun</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;I&#39;&#39;m back&#39;</span><span class="w"></span>
<span class="w">    </span><span class="c1">⍝ some empty line</span><span class="w"></span>
<span class="w">    </span><span class="nv">label</span><span class="bp">:</span><span class="w"> </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Label line.&#39;</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">SubFun</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">GoTo</span><span class="w"> </span><span class="nv">label</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Can&#39;&#39;t reach this&#39;</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MainFun</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">I'm back
Label line.
</span></div></div>
</div>
<p>Here is what is going on:</p>
<ul class="simple">
<li><p>When <code class="docutils literal notranslate"><span class="pre">MainFun</span></code> is executed, <code class="docutils literal notranslate"><span class="pre">label</span></code> immediately becomes a read-only variable whose value is 4.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">SubFun</span></code> is called, <code class="docutils literal notranslate"><span class="pre">label</span></code> is local to <code class="docutils literal notranslate"><span class="pre">MainFun</span></code> but global to <code class="docutils literal notranslate"><span class="pre">SubFun</span></code>, so it is visible and is equal to 4.</p></li>
<li><p>When evaluated, the jump <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">label</span></code> (or <code class="docutils literal notranslate"><span class="pre">→next</span></code>) is equivalent to <code class="docutils literal notranslate"><span class="pre">:GoTo</span> <span class="pre">4</span></code>.</p></li>
<li><p>Because <code class="docutils literal notranslate"><span class="pre">SubFun</span></code> only has 2 lines, this jump terminates <code class="docutils literal notranslate"><span class="pre">SubFun</span></code>.</p></li>
<li><p>Execution then continues at <code class="docutils literal notranslate"><span class="pre">MainFun[2]</span></code>, not at <code class="docutils literal notranslate"><span class="pre">MainFun[4]</span></code>.</p></li>
</ul>
<p>Conclusion: be very careful when using labels and non-localised names in general!</p>
</div>
</div>
<div class="section" id="other-conditional-execution">
<span id="user-defined-functions-other-conditional-execution"></span><h3><span class="section-number">5.16.5. </span>Other Conditional Execution<a class="headerlink" href="#other-conditional-execution" title="Permalink to this headline">#</a></h3>
<p>In the course of this chapter, you have learned how to program conditional execution using control structures or traditional branching techniques.</p>
<p>APL provides two other methods: the function <em>execute</em> and the operator <em>power</em>.</p>
<div class="section" id="conditional-execution-using-execute">
<span id="user-defined-functions-conditional-execution-using-execute"></span><h4><span class="section-number">5.16.5.1. </span>Conditional Execution Using Execute<a class="headerlink" href="#conditional-execution-using-execute" title="Permalink to this headline">#</a></h4>
<p>The function <em>execute</em> (<code class="docutils literal notranslate"><span class="pre">⍎</span></code>) will be studied in more detail in <a class="reference internal" href="Execute-and-Format-Control.html"><span class="doc std std-doc">a later chapter</span></a>. It executes any character vector given as a right argument, as if it were an expression that had been typed into the APL session window. But if the vector is empty, nothing will be executed. This feature can be used to conditionally execute a statement. Let us consider the following expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">diff</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="nv">range</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯3</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="o">⍎</span><span class="p">(</span><span class="nv">diff</span><span class="o">&lt;</span><span class="nv">limit</span><span class="p">)</span><span class="na">/</span><span class="s1">&#39;range ← ¯5 5&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">range</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯3 3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">diff</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="o">⍎</span><span class="p">(</span><span class="nv">diff</span><span class="o">&lt;</span><span class="nv">limit</span><span class="p">)</span><span class="na">/</span><span class="s1">&#39;range ← ¯5 5&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">range</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯5 5
</span></div></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">(diff&lt;limit)</span></code> is satisfied, <code class="docutils literal notranslate"><span class="pre">1/'range</span> <span class="pre">←</span> <span class="pre">¯5</span> <span class="pre">5'</span></code> gives <code class="docutils literal notranslate"><span class="pre">'range</span> <span class="pre">←</span> <span class="pre">¯5</span> <span class="pre">5'</span></code> and <code class="docutils literal notranslate"><span class="pre">⍎'range</span> <span class="pre">←</span> <span class="pre">¯5</span> <span class="pre">5'</span></code> will execute the expression, setting <code class="docutils literal notranslate"><span class="pre">range</span></code> to <code class="docutils literal notranslate"><span class="pre">¯5</span> <span class="pre">5</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">(diff&lt;limit)</span></code> is <strong>not</strong> satisfied, then <code class="docutils literal notranslate"><span class="pre">0/'range</span> <span class="pre">←</span> <span class="pre">¯5</span> <span class="pre">5'</span></code> gives <code class="docutils literal notranslate"><span class="pre">''</span></code> (an empty character vector) and <code class="docutils literal notranslate"><span class="pre">⍎''</span></code> does nothing, so <code class="docutils literal notranslate"><span class="pre">range</span></code> is not assigned.</p>
<div class="tip admonition">
<p class="admonition-title">Rule</p>
<p>More generally, one can write <code class="docutils literal notranslate"><span class="pre">⍎(condition)/text</span></code>, where <code class="docutils literal notranslate"><span class="pre">text</span></code> is the quoted expression you want to evaluate conditionally.</p>
</div>
<p>When the expression on the right contains quotes, they must be doubled, and the expression may become more complex to read. Using <em>execute</em> will, in general, compromise the ability to analyse the code in order to, for example, search for references to a given function or global variable. For these reasons, and also because executed expressions run slightly slower than ordinary statements, this technique should be avoided. It is mentioned only because it has been used for years by many programmers, before better tools became available in APL.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>Prefer control structures.</p>
</div>
</div>
<div class="section" id="conditional-execution-using-the-power-operator">
<span id="user-defined-functions-conditional-execution-using-the-power-operator"></span><h4><span class="section-number">5.16.5.2. </span>Conditional Execution Using the Power Operator<a class="headerlink" href="#conditional-execution-using-the-power-operator" title="Permalink to this headline">#</a></h4>
<p>The operator <em>power</em> (<code class="docutils literal notranslate"><span class="pre">⍣</span></code>, typed with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>) will be studied in more detail in <a class="reference internal" href="Operators.html"><span class="doc std std-doc">a later chapter as well</span></a>. It must not be confused with the function <em>power</em> (<code class="docutils literal notranslate"><span class="pre">*</span></code>).</p>
<p><em>Power</em> can be used to execute a given function a set number of times. Of course, if we set that number to 1 then the function is executed once and if we set that number to 0, then the function is not executed at all. For example, in <a class="reference internal" href="#user-defined-functions-example-ambivalent-function"><span class="std std-numref">Section 5.10.3.4</span></a> we wrote a function which rounds a vector of values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
<span class="nv">vec</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">17.4269</span><span class="w"> </span><span class="m">69.8731</span><span class="w"> </span><span class="m">82.3137</span><span class="w"></span>
<span class="nv">Round</span><span class="w"> </span><span class="nv">vec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17.43 69.87 82.31
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">Round</span><span class="na">⍣</span><span class="p">(</span><span class="nv">a</span><span class="o">&gt;</span><span class="m">20</span><span class="p">))</span><span class="nv">vec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17.43 69.87 82.31
</span></div></div>
</div>
<p>In the expression above, <code class="docutils literal notranslate"><span class="pre">(a&gt;20)</span></code> evaluates to 1 because <code class="docutils literal notranslate"><span class="pre">a</span></code> is 37, and hence <code class="docutils literal notranslate"><span class="pre">Round</span></code> is applied once.</p>
<p>If we change the test to something that evaluates to 0, then <code class="docutils literal notranslate"><span class="pre">Round</span></code> is <strong>not</strong> applied:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">Round</span><span class="na">⍣</span><span class="p">(</span><span class="nv">a</span><span class="o">&gt;</span><span class="m">80</span><span class="p">))</span><span class="nv">vec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17.4269 69.8731 82.3137
</span></div></div>
</div>
<p>We must separate the operator’s right operand from the resulting derived function’s argument.</p>
<p>We can use a “no-op” function like <code class="docutils literal notranslate"><span class="pre">⊢</span></code> as separator or use parentheses.</p>
<div class="tip admonition">
<p class="admonition-title">Rule</p>
<p>More generally, one can write <code class="docutils literal notranslate"><span class="pre">{x}</span> <span class="pre">(Function⍣(condition))</span> <span class="pre">y</span></code></p>
</div>
</div>
</div>
<div class="section" id="name-category">
<span id="user-defined-functions-name-category"></span><h3><span class="section-number">5.16.6. </span>Name Category<a class="headerlink" href="#name-category" title="Permalink to this headline">#</a></h3>
<p>The system function <em>name category</em> (<code class="docutils literal notranslate"><span class="pre">⎕NC</span></code>) indicates if a name currently represents a variable, a function, an operator and so on.</p>
<p>When applied to a nested vector of names, it returns an extended result, which gives more information. For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕NC</span><span class="w"> </span><span class="s1">&#39;Round&#39;</span><span class="w"> </span><span class="s1">&#39;Foo&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3.2 3.2
</span></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">3.1</span></code> means that <code class="docutils literal notranslate"><span class="pre">Round</span></code> is a tradfn;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3.2</span></code> means that <code class="docutils literal notranslate"><span class="pre">Foo</span></code> is a dfn;</p></li>
</ul>
<p>Let us now assign some new names to some functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Round2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Round</span><span class="w"></span>
<span class="nv">Foo2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Foo</span><span class="w"></span>
<span class="nv">Rho</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="w"></span>
<span class="nv">Sum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕NC</span><span class="w"> </span><span class="s1">&#39;Round2&#39;</span><span class="w"> </span><span class="s1">&#39;Foo2&#39;</span><span class="w"> </span><span class="s1">&#39;Rho&#39;</span><span class="w"> </span><span class="s1">&#39;Sum&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3.2 3.2 3.3 3.3
</span></div></div>
</div>
<p>This makes clear that:</p>
<ul class="simple">
<li><p>assigning a new name to a user-defined function preserves its <em>name category</em>; and</p></li>
<li><p><em>primitive</em> or <em>derived</em> functions have a <em>name category</em> equal to <code class="docutils literal notranslate"><span class="pre">3.3</span></code>.</p></li>
</ul>
</div>
<div class="section" id="bare-output">
<span id="user-defined-functions-bare-output"></span><h3><span class="section-number">5.16.7. </span>Bare Output<a class="headerlink" href="#bare-output" title="Permalink to this headline">#</a></h3>
<p>When using <em>quad</em> (<code class="docutils literal notranslate"><span class="pre">⎕</span></code>) to input data, the prompt and the user’s answer appear on different lines on the screen.</p>
<p>When using a <em>quote-quad</em> (<code class="docutils literal notranslate"><span class="pre">⍞</span></code>) to input data, it is possible to force the system to issue the user with a prompt and collect their input on the same line of the screen. This is done by first assigning the prompt (a character vector) to <code class="docutils literal notranslate"><span class="pre">⍞</span></code> and then referencing <code class="docutils literal notranslate"><span class="pre">⍞</span></code>. When the assignment and reference are performed like this, as successive operations, the system does not throw a newline after the prompt and the user input is collected on the same line as the prompt. This is called <em>bare output</em>.</p>
<p>Here is an example you can try in your interpreter: <code class="docutils literal notranslate"><span class="pre">⍞←</span> <span class="pre">'This</span> <span class="pre">is</span> <span class="pre">my</span> <span class="pre">question:</span> <span class="pre">'</span> <span class="pre">⋄</span> <span class="pre">z</span> <span class="pre">←</span> <span class="pre">⍞</span></code>.</p>
<p>If you execute this and type something into the prompt, you will notice that <code class="docutils literal notranslate"><span class="pre">z</span></code> gets the complete line as value: prompt and user input.</p>
<p>Using <em>take</em> and <em>drop</em>, it is possible to remove the prompt, like in this demonstration function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Demo</span><span class="sr">;</span><span class="w"> </span><span class="nv">fn</span><span class="sr">;</span><span class="w"> </span><span class="nv">na</span><span class="sr">;</span><span class="w"> </span><span class="nv">cy</span><span class="w"></span>
<span class="w">    </span><span class="vg">⍞</span><span class="kd">←</span><span class="w"> </span><span class="m">20</span><span class="o">↑</span><span class="s1">&#39;First name ...................&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">fn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">20</span><span class="o">↓</span><span class="vg">⍞</span><span class="w"></span>
<span class="w">    </span><span class="vg">⍞</span><span class="kd">←</span><span class="w"> </span><span class="m">20</span><span class="o">↑</span><span class="s1">&#39;Name .........................&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">na</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">20</span><span class="o">↓</span><span class="vg">⍞</span><span class="w"></span>
<span class="w">    </span><span class="vg">⍞</span><span class="kd">←</span><span class="w"> </span><span class="m">20</span><span class="o">↑</span><span class="s1">&#39;Country ......................&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">cy</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">20</span><span class="o">↓</span><span class="vg">⍞</span><span class="w"></span>
<span class="w">    </span><span class="nv">info</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">fn</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">na</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">cy</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>And here is an example interaction (you can try it in your interpreter; Jupyter Notebook does not support <code class="docutils literal notranslate"><span class="pre">⎕</span></code>/<code class="docutils literal notranslate"><span class="pre">⍞</span></code> input at the time of writing):</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="nv">Demo</span><span class="w"></span>
<span class="nv">First</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="na">.........</span><span class="nv">Charles</span><span class="w"></span>
<span class="nv">Name</span><span class="w"> </span><span class="na">...............</span><span class="nv">Darwin</span><span class="w"></span>
<span class="nv">Country</span><span class="w"> </span><span class="na">............</span><span class="nv">UK</span><span class="w"></span>
<span class="nv">Charles</span><span class="w"> </span><span class="nv">Darwin</span><span class="w"> </span><span class="nv">UK</span><span class="w"></span>
</pre></div>
</div>
<p>We get all the prompts aligned and the return value only has the user’s inputs.</p>
</div>
<div class="section" id="ineach">
<span id="user-defined-functions-ineach"></span><h3><span class="section-number">5.16.8. </span><code class="docutils literal notranslate"><span class="pre">:InEach</span></code><a class="headerlink" href="#ineach" title="Permalink to this headline">#</a></h3>
<p>The control phrase <code class="docutils literal notranslate"><span class="pre">:For...</span> <span class="pre">:In</span></code> can be used to assign values to several control variables. One can also use <code class="docutils literal notranslate"><span class="pre">:InEach</span></code> which assigns one item from each of a set of nested values to the corresponding control variable. Sometimes <code class="docutils literal notranslate"><span class="pre">:In</span></code> is more convenient than <code class="docutils literal notranslate"><span class="pre">:InEach</span></code> and sometimes the reverse is true, as we will now show:</p>
<p>Let us assume that data for an invoice is represented as a number of lines, each with a quantity and a price:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">invoice1</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="p">)(</span><span class="m">20</span><span class="w"> </span><span class="m">200</span><span class="p">)(</span><span class="m">30</span><span class="w"> </span><span class="m">300</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Then we process each line in a loop using this function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">Process1</span><span class="w"> </span><span class="nv">invoice</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="p">(</span><span class="nv">q</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="nv">invoice</span><span class="w"></span>
<span class="w">        </span><span class="nv">q</span><span class="o">×</span><span class="nv">p</span><span class="w">    </span><span class="c1">⍝ &quot;Process&quot; this invoice line</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process1</span><span class="w"> </span><span class="nv">invoice1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000
4000
9000
</span></div></div>
</div>
<p>Some day somebody decides to deliver the invoice data in a slightly different way: first all the quantities, then all the prices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">invoice2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">30</span><span class="p">)(</span><span class="m">100</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">300</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Then we only need to modify our processing function to use <code class="docutils literal notranslate"><span class="pre">:InEach</span></code> instead of <code class="docutils literal notranslate"><span class="pre">:In</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">Process2</span><span class="w"> </span><span class="nv">invoice</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="p">(</span><span class="nv">q</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="bp">:</span><span class="nv">InEach</span><span class="w"> </span><span class="nv">invoice</span><span class="w"></span>
<span class="w">        </span><span class="nv">q</span><span class="o">×</span><span class="nv">p</span><span class="w">    </span><span class="c1">⍝ &quot;Process&quot; this invoice line</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Process2</span><span class="w"> </span><span class="nv">invoice2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000
4000
9000
</span></div></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Rule</p>
<p>In <code class="docutils literal notranslate"><span class="pre">:For</span> <span class="pre">vars</span> <span class="pre">:InEach</span> <span class="pre">nesVec</span></code>, <code class="docutils literal notranslate"><span class="pre">⍴vars</span></code> is equal to the shape of <code class="docutils literal notranslate"><span class="pre">nesVec</span></code>, whereas in <code class="docutils literal notranslate"><span class="pre">:For</span> <span class="pre">vars</span> <span class="pre">:In</span> <span class="pre">nesVec</span></code>, <code class="docutils literal notranslate"><span class="pre">⍴vars</span></code> is equal to the shape of each <strong>item</strong> in <code class="docutils literal notranslate"><span class="pre">nesVec</span></code>.</p>
</div>
</div>
<div class="section" id="tail-recursion">
<span id="user-defined-functions-tail-recursion"></span><h3><span class="section-number">5.16.9. </span>Tail Recursion<a class="headerlink" href="#tail-recursion" title="Permalink to this headline">#</a></h3>
<p>As was outlined in <a class="reference internal" href="#user-defined-functions-recursion"><span class="std std-numref">Section 5.11</span></a>, recursive solutions can be very elegant but may consume a lot of memory as successive calls accumulate local variables in their respective scopes.</p>
<p>For example, consider the following recursive definition of the factorial function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Factorial</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="o">≢</span><span class="nf">⎕SI</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="w"> </span><span class="o">≤</span><span class="w"> </span><span class="m">1</span><span class="bp">:</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">×</span><span class="bp">∇⍵</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Factorial</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
2
3
4
5
6
7
8
9
10
3628800
</span></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Factorial</span></code> function above makes use of <code class="docutils literal notranslate"><span class="pre">⎕SI</span></code>, the <em>state indicator</em>, to tell how many functions are in the execution stack. Think of it as a pile of all the functions that are currently being executed, with the more recent calls at the top of the stack. As we can see, when we reach the deepest level of recursion (when <code class="docutils literal notranslate"><span class="pre">⍵</span></code> hits 1) we have 10 <code class="docutils literal notranslate"><span class="pre">Factorial</span></code> calls in the stack, which are then resolved as we return from deeper levels and perform the <code class="docutils literal notranslate"><span class="pre">⍵×...</span></code> multiplication in the last line of the dfn.</p>
<p>A moment of reflection shows that, to compute the factorial of <code class="docutils literal notranslate"><span class="pre">n</span></code> with this function, the execution stack grows to size <code class="docutils literal notranslate"><span class="pre">n</span></code>. If our <code class="docutils literal notranslate"><span class="pre">Factorial</span></code> function were more complex, we would also have <code class="docutils literal notranslate"><span class="pre">n</span></code> copies of all the local variables the function would define. This duplication is what makes recursive functions potentially memory heavy. It is, however, something that the interpreter knows how to optimise in certain cases.</p>
<p>If we write a recursive function in such a way that the recursive call is <strong>the very last thing</strong> to be executed inside your function, then the interpreter knows it can discard everything from the current scope when it makes the recursive call. In fact, when we leave the recursive call we won’t have to do anything with the return value, as the recursive call was <em>the very last thing</em> we did in our function.</p>
<p>If we do this, then we are using a technique called <em>tail recursion</em>, because we are only recursing at the “tail” of the function.</p>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>Tail recursion is a feature of dfns and does not have an immediate equivalent in tradfns.</p>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">Factorial</span></code> function above, the recursive call was <em>in</em> the last expression executed but it is not the last thing that is done in the function, as we have to multiply <code class="docutils literal notranslate"><span class="pre">⍵</span></code> with the return value of the recursive call. We can, however, refactor the function to carry temporary calculations in the left argument <code class="docutils literal notranslate"><span class="pre">⍺</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">TailFactorial</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="o">≢</span><span class="nf">⎕SI</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">≤</span><span class="m">1</span><span class="bp">:</span><span class="w"> </span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="bp">⍺</span><span class="o">×</span><span class="bp">⍵</span><span class="p">)</span><span class="bp">∇⍵</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TailFactorial</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
1
1
1
1
1
1
1
1
1
3628800
</span></div></div>
</div>
<p>In this way, we can perform the multiplications as we go “down” the recursion, instead of waiting for the moment when we start coming back “up” again.</p>
<p>As an exercise, can you redo exercise 17 with a tail recursive function?</p>
</div>
</div>
<div class="section" id="solutions">
<span id="user-defined-functions-solutions"></span><h2><span class="section-number">5.17. </span>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline">#</a></h2>
<div class="solution admonition" id="User-Defined-Functions-solution-17">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-extract"> Exercise 5.1</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is the vector argument, we can use <code class="docutils literal notranslate"><span class="pre">⍵[...]</span></code> to index into <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and then we can use the <em>index generator</em> primitive to generate the indices we need, which should be the integers from <code class="docutils literal notranslate"><span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">⍺</span></code>… Except that if <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is too big, we cannot generate indices larger than the length of the vector, so we also find the minimum between <code class="docutils literal notranslate"><span class="pre">⍺</span></code> and <code class="docutils literal notranslate"><span class="pre">≢⍵</span></code>. If we don’t, we get a <code class="docutils literal notranslate"><span class="pre">INDEX</span> <span class="pre">ERROR</span></code> when indexing. Here is a possible implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Extract</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="sr">[</span><span class="o">⍳</span><span class="bp">⍺</span><span class="o">⌊≢</span><span class="bp">⍵</span><span class="sr">]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">18</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">45 86 31
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="s1">&#39;can you do it?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">can yo
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">20</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-18">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-ignore"> Exercise 5.2</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We can use a reasoning similar to that of the first exercise, except now we want to start the indices at <code class="docutils literal notranslate"><span class="pre">⍺+1</span></code> and go up until <code class="docutils literal notranslate"><span class="pre">≢⍵</span></code>. For this to happen, we first need to find out how many numbers we need. If a vector has <code class="docutils literal notranslate"><span class="pre">≢⍵</span></code> elements and we are going to drop <code class="docutils literal notranslate"><span class="pre">⍺</span></code> of them, we are going to be left with <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code>. This means <code class="docutils literal notranslate"><span class="pre">⍳(≢⍵)-⍺</span></code> will generate the correct amount of indices, but they will be starting at <code class="docutils literal notranslate"><span class="pre">1</span></code> and should start at <code class="docutils literal notranslate"><span class="pre">⍺+1</span></code>, so we just need to add <code class="docutils literal notranslate"><span class="pre">⍺</span></code> to that.</p>
<p>Finally, we just need to worry about what happens if <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is too large, i.e. if we want to ignore too many elements. The reverse of that concern is, what happens if <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code> is too small? Recall that <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code> tells you how many elements you will want to keep. But that number must be at least <code class="docutils literal notranslate"><span class="pre">0</span></code> elements (i.e. “keep no elements”) because it makes no sense to keep a negative number of elements. So we can just use <code class="docutils literal notranslate"><span class="pre">⌈</span></code> to find the maximum between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code>. If <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is too large, <code class="docutils literal notranslate"><span class="pre">0⌈(≢⍵)-⍺</span></code> gives <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">⍳0</span></code> is the empty vector <code class="docutils literal notranslate"><span class="pre">⍬</span></code>, so the indexing will work just fine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Ignore</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="sr">[</span><span class="bp">⍺</span><span class="o">+⍳</span><span class="m">0</span><span class="o">⌈</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">-</span><span class="bp">⍺</span><span class="sr">]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">18</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20 75 62 18
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="s1">&#39;can you do it?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">u do it?
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">20</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-19">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-reverse"> Exercise 5.3</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>This is another exercise on index arithmetic. Here is what we want to happen with a vector argument of length 10:</p>
<ul class="simple">
<li><p>generate the indices <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6</span> <span class="pre">7</span> <span class="pre">8</span> <span class="pre">9</span> <span class="pre">10</span></code></p></li>
<li><p>transform them into  <code class="docutils literal notranslate"><span class="pre">10</span> <span class="pre">9</span> <span class="pre">8</span> <span class="pre">7</span> <span class="pre">6</span> <span class="pre">5</span> <span class="pre">4</span> <span class="pre">3</span> <span class="pre">2</span> <span class="pre">1</span></code></p></li>
</ul>
<p>We can do this if we do the correct subtraction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">11</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 9 8 7 6 5 4 3 2 1
</span></div></div>
</div>
<p>But here <code class="docutils literal notranslate"><span class="pre">11</span></code> was a special number: it was <code class="docutils literal notranslate"><span class="pre">1+≢⍵</span></code>. So that is the general tactic we can employ:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Reverse</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">-⍳≢</span><span class="bp">⍵</span><span class="sr">]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Reverse</span><span class="w"> </span><span class="s1">&#39;snoitalutargnoc&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">congratulations
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Reverse</span><span class="w"> </span><span class="s1">&#39;!ti did uoY&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You did it!
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-20">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-totalise"> Exercise 5.4</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>This exercise can be solved by using the operator <em>reduce</em> to sum: <code class="docutils literal notranslate"><span class="pre">+/</span></code>. Then we need to specify the axis we care about with <code class="docutils literal notranslate"><span class="pre">[1]</span></code> and <code class="docutils literal notranslate"><span class="pre">[2]</span></code>.</p>
<p>If we do <code class="docutils literal notranslate"><span class="pre">+/[1]</span></code> then we are reducing across the first axis, which means we get the sums along the columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">75</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">51</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">28</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">75 14 86 20
31 16 40 51
22 64 31 28
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">128 94 157 99
</span></div></div>
</div>
<p>We can then catenate the original matrix to these column sums vertically (by using <code class="docutils literal notranslate"><span class="pre">⍪</span></code>), and then use <code class="docutils literal notranslate"><span class="pre">+/[2]</span></code> to find the row sums and catenate them with <code class="docutils literal notranslate"><span class="pre">,</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Totalise</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">colSums</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="o">⍪</span><span class="nv">colSums</span><span class="w"></span>
<span class="w">    </span><span class="nv">rowSums</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">r</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="o">,</span><span class="nv">rowSums</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Totalise</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 75 14  86 20 195
 31 16  40 51 138
 22 64  31 28 145
128 94 157 99 478
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">totMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">75</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">86</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">195</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">51</span><span class="w"> </span><span class="m">138</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">145</span><span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="m">94</span><span class="w"> </span><span class="m">157</span><span class="w"> </span><span class="m">99</span><span class="w"> </span><span class="m">478</span><span class="w"></span>
<span class="nv">totMat</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">Totalise</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-21">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-lengths"> Exercise 5.5</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>When reading this exercise, one should immediately realise that we are going to need to find <em>where</em> the blank spaces are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;This seems to be a good solution&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="nv">text</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 11 14 17 19 24
</span></div></div>
</div>
<p>These indices tell where the blank spaces were in the character vector, and in between those indices are the indices that correspond to word characters:</p>
<ul class="simple">
<li><p>the first word has indices <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span></code></p>
<ul>
<li><p>then there is a space at position <code class="docutils literal notranslate"><span class="pre">5</span></code></p></li>
</ul>
</li>
<li><p>the second word has indices <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">7</span> <span class="pre">8</span> <span class="pre">9</span> <span class="pre">10</span></code></p>
<ul>
<li><p>then there is a space at position <code class="docutils literal notranslate"><span class="pre">11</span></code></p></li>
</ul>
</li>
<li><p>…</p>
<ul>
<li><p>then there is a space at position <code class="docutils literal notranslate"><span class="pre">24</span></code></p></li>
</ul>
</li>
<li><p>the last word has indices <code class="docutils literal notranslate"><span class="pre">25</span> <span class="pre">26</span> <span class="pre">27</span> <span class="pre">28</span> <span class="pre">29</span> <span class="pre">30</span> <span class="pre">31</span> <span class="pre">32</span></code></p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">32</span></code> above is <code class="docutils literal notranslate"><span class="pre">≢text</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≢</span><span class="nv">text</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">32
</span></div></div>
</div>
<p>From the list above we can see that most words are <em>between</em> spaces, but the first and last words may not be between spaces. We can fix this by <em>forcing</em> the first and last words to be <em>between</em> spaces if we add a single <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to the beginning and to the end of our variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">text</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 6 12 15 18 20 25 34
</span></div></div>
</div>
<p>Now we have</p>
<ul class="simple">
<li><p>the first space at position <code class="docutils literal notranslate"><span class="pre">1</span></code></p>
<ul>
<li><p>the first word in positions <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">5</span></code></p></li>
</ul>
</li>
<li><p>a space at position <code class="docutils literal notranslate"><span class="pre">6</span></code></p>
<ul>
<li><p>a word in positions <code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">8</span> <span class="pre">9</span> <span class="pre">10</span> <span class="pre">11</span></code></p></li>
</ul>
</li>
<li><p>…</p></li>
<li><p>a space at position <code class="docutils literal notranslate"><span class="pre">25</span></code></p>
<ul>
<li><p>the last word in positions <code class="docutils literal notranslate"><span class="pre">26</span> <span class="pre">27</span> <span class="pre">28</span> <span class="pre">29</span> <span class="pre">30</span> <span class="pre">31</span> <span class="pre">32</span> <span class="pre">33</span></code></p></li>
</ul>
</li>
<li><p>the final space at position <code class="docutils literal notranslate"><span class="pre">34</span></code></p></li>
</ul>
<p>So we can find the lengths of those runs of non-spaces by subtracting positions of consecutive spaces and then subtracting 1 from those, because <code class="docutils literal notranslate"><span class="pre">6-1</span></code> gives 5, but between 1 and 6 there’s only 4 integers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Lengths</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">spaces</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">idx</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="p">(</span><span class="o">≢</span><span class="nv">spaces</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="m">¯1</span><span class="o">+</span><span class="nv">spaces</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="nv">idx</span><span class="sr">]</span><span class="o">-</span><span class="nv">spaces</span><span class="sr">[</span><span class="nv">idx</span><span class="sr">]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span><span class="w"> </span><span class="s1">&#39;This seems to be a good solution&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 5 2 2 1 4 8
</span></div></div>
</div>
<p>The final step where we index into <code class="docutils literal notranslate"><span class="pre">spaces</span></code> to get “all but the last” and “all but the first” elements of <code class="docutils literal notranslate"><span class="pre">spaces</span></code> could have been done with your previous solutions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Lengths</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">spaces</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="w">    </span><span class="m">¯1</span><span class="o">+</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="nv">spaces</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="m">¯1</span><span class="o">+≢</span><span class="nv">spaces</span><span class="p">)</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="nv">spaces</span><span class="p">)</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span><span class="w"> </span><span class="s1">&#39;This seems to be a good solution&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 5 2 2 1 4 8
</span></div></div>
</div>
<p>Notice that doing <code class="docutils literal notranslate"><span class="pre">¯1+expr</span></code> is a little “trick” you can employ when you want to subtract 1 from <code class="docutils literal notranslate"><span class="pre">expr</span></code>, but <code class="docutils literal notranslate"><span class="pre">expr</span></code> would then need parenthesis if you were to have it on the left of the <code class="docutils literal notranslate"><span class="pre">-</span></code> sign. For example, to subtract 1 from <code class="docutils literal notranslate"><span class="pre">≢spaces</span></code> you would have to do <code class="docutils literal notranslate"><span class="pre">(≢spaces)-1</span></code> but instead you can do <code class="docutils literal notranslate"><span class="pre">¯1+≢spaces</span></code>.</p>
<p>Finally, can you improve your solution to handle multiple consecutive spaces?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span><span class="w"> </span><span class="s1">&#39;This only    has      five words   &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 4 0 0 0 3 0 0 0 0 0 4 5 0 0 0
</span></div></div>
</div>
<p>Probably seeing how your function works with multiple consecutive spaces gives the solution away: consecutive spaces will make a 0 appear in the final result, so we just have to remove those:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Lengths</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">spaces</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="o">+</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="nv">Ignore</span><span class="w"> </span><span class="nv">spaces</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="m">¯1</span><span class="o">+≢</span><span class="nv">spaces</span><span class="p">)</span><span class="w"> </span><span class="nv">Extract</span><span class="w"> </span><span class="nv">spaces</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="m">0</span><span class="o">≠</span><span class="nv">r</span><span class="p">)</span><span class="na">/</span><span class="nv">r</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span><span class="w"> </span><span class="s1">&#39;This only    has      five words   &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 4 3 4 5
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-22">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-to"> Exercise 5.6</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We have seen in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-basic-usage"><span class="std std-numref">Section 4.15.1</span></a> how to create any arithmetic sequence of integers. This is just a special case of the algorithm given, with <code class="docutils literal notranslate"><span class="pre">Step</span> <span class="pre">←</span> <span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">To</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍺</span><span class="o">+</span><span class="m">¯1</span><span class="o">+⍳</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="bp">⍵</span><span class="o">-</span><span class="bp">⍺</span><span class="p">)</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">17</span><span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="m">29</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17 18 19 20 21 22 23 24 25 26 27 28 29
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-23">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-frame"> Exercise 5.7</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>This exercise is easier than it might look because the primitives to catenate vertically and horizontally, <code class="docutils literal notranslate"><span class="pre">⍪</span></code> and <code class="docutils literal notranslate"><span class="pre">,</span></code>, know how to deal with a matrix and a single scalar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">towns</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">10</span><span class="o">⍴</span><span class="s1">&#39;Canberra  Paris     WashingtonMoscow    Martigues Mexico    &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  
Paris     
Washington
Moscow    
Martigues 
Mexico    
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">towns</span><span class="o">,</span><span class="s1">&#39;|&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  |
Paris     |
Washington|
Moscow    |
Martigues |
Mexico    |
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">towns</span><span class="o">⍪</span><span class="s1">&#39;-&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  
Paris     
Washington
Moscow    
Martigues 
Mexico    
----------
</span></div></div>
</div>
<p>So we just have to frame the four sides and <em>then</em> change the corners:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Frame</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="o">⍪</span><span class="nv">f</span><span class="o">⍪</span><span class="s1">&#39;-&#39;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">r</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="nv">f</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="nv">r</span><span class="sr">;</span><span class="m">1</span><span class="w"> </span><span class="nv">c</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;+&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="nv">towns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">+----------+
|Canberra  |
|Paris     |
|Washington|
|Moscow    |
|Martigues |
|Mexico    |
+----------+
</span></div></div>
</div>
<p>Here we used the very convenient indexing notation <code class="docutils literal notranslate"><span class="pre">f[1</span> <span class="pre">r;1</span> <span class="pre">c]</span></code> that allows us to access the positions <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">c</span></code> of the matrix <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
<p>Modifying this function to use the appropriate line-drawing symbols just means swapping the <code class="docutils literal notranslate"><span class="pre">'|-+'</span></code> in the original function. Care must be taken, however, when assigning the corners. With <code class="docutils literal notranslate"><span class="pre">f[1</span> <span class="pre">r;1</span> <span class="pre">c]</span> <span class="pre">←</span> <span class="pre">m</span></code> APL expects <code class="docutils literal notranslate"><span class="pre">m</span></code> to be a scalar <em>or</em> an array with the same shape as that of the left, and since <code class="docutils literal notranslate"><span class="pre">f[1</span> <span class="pre">r;1</span> <span class="pre">c]</span></code> is a 2 by 2 matrix, we will have to reshape the vector with the corners into a 2 by 2 matrix as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Frame</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9474</span><span class="p">)</span><span class="w"> </span><span class="o">,</span><span class="w"> </span><span class="bp">⍵</span><span class="w"> </span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9474</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9472</span><span class="p">)</span><span class="w"> </span><span class="o">⍪</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="o">⍪</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9472</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">r</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="nv">f</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="nv">r</span><span class="sr">;</span><span class="m">1</span><span class="w"> </span><span class="nv">c</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9484</span><span class="w"> </span><span class="m">9488</span><span class="w"> </span><span class="m">9492</span><span class="w"> </span><span class="m">9496</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="nv">towns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┐
│Canberra  │
│Paris     │
│Washington│
│Moscow    │
│Martigues │
│Mexico    │
└──────────┘
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-24">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-frame-vec"> Exercise 5.8</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Well, what if the solution we wrote actually works for vectors? Let’s give it a try:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="s1">&#39;We are not out of the wood&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR
Frame[4] f[1 r;1 c]←2 2⍴⎕UCS 9484 9488 9492 9496
          ∧
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">RANK</span> <span class="pre">ERROR</span></code>? That makes no sense, after I frame <code class="docutils literal notranslate"><span class="pre">⍵</span></code> with the horizontal and vertical bars I have a framed matrix, I just need to update the corners… right? Wrong! Here’s what happens if you use <code class="docutils literal notranslate"><span class="pre">,</span></code> and <code class="docutils literal notranslate"><span class="pre">⍪</span></code> on a vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;We are not out of the wood&#39;</span><span class="w"></span>
<span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9472</span><span class="p">)</span><span class="w"> </span><span class="o">⍪</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9474</span><span class="p">)</span><span class="w"> </span><span class="o">,</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9474</span><span class="p">)</span><span class="w"> </span><span class="o">⍪</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9472</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">─│We are not out of the wood│─
</span></div></div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">text</span></code> has shape</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">text</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26
</span></div></div>
</div>
<p>the primitives <code class="docutils literal notranslate"><span class="pre">,</span></code> and <code class="docutils literal notranslate"><span class="pre">⍪</span></code> work the same way. We need to turn input vectors into matrices with 1 row before we proceed with the framing process.</p>
<p>Let us define <code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">←</span> <span class="pre">⍴⍵</span></code> as the shape of the input <code class="docutils literal notranslate"><span class="pre">Frame</span></code> gets. If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a matrix, then <code class="docutils literal notranslate"><span class="pre">shape</span></code> is the appropriate shape, otherwise we need <code class="docutils literal notranslate"><span class="pre">⍵</span></code> to be reshaped into <code class="docutils literal notranslate"><span class="pre">1,shape</span></code>. In traditional programming languages we could use an <code class="docutils literal notranslate"><span class="pre">if-else</span></code> statement. However, dfns do not have support for such flow control structures and so we need to handle this matter in a different way.</p>
<p>A possibility is to create the vector <code class="docutils literal notranslate"><span class="pre">v←1,shape</span></code> and then index into it with care. If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a vector, <code class="docutils literal notranslate"><span class="pre">v</span></code> has 2 elements and we want both. If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a matrix, <code class="docutils literal notranslate"><span class="pre">v</span></code> has 3 elements and we want the elements in positions <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code>. A way of generating the indices <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span></code> if <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a vector and <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code> if <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a matrix is with the expression <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">1+≢⍴⍵</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p><code class="docutils literal notranslate"><span class="pre">⍵</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">≢⍴⍵</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">1+≢⍴⍵</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>vector</p></td>
<td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p>1 2</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>matrix</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>2 3</p></td>
</tr>
</tbody>
</table>
<p>When implementing the function we don’t need to actually create <code class="docutils literal notranslate"><span class="pre">v</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Frame</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">shape</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">,⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="sr">[</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="o">+≢⍴</span><span class="bp">⍵</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">shape</span><span class="o">⍴</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9474</span><span class="p">)</span><span class="w"> </span><span class="o">,</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9474</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9472</span><span class="p">)</span><span class="w"> </span><span class="o">⍪</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="o">⍪</span><span class="w"> </span><span class="p">(</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9472</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">r</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="nv">f</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="nv">r</span><span class="sr">;</span><span class="m">1</span><span class="w"> </span><span class="nv">c</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nf">⎕UCS</span><span class="w"> </span><span class="m">9484</span><span class="w"> </span><span class="m">9488</span><span class="w"> </span><span class="m">9492</span><span class="w"> </span><span class="m">9496</span><span class="w"></span>
<span class="w">    </span><span class="nv">f</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="nv">text</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────────────────────┐
│We are not out of the wood│
└──────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span><span class="w"> </span><span class="nv">towns</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┐
│Canberra  │
│Paris     │
│Washington│
│Moscow    │
│Martigues │
│Mexico    │
└──────────┘
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-25">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-switch"> Exercise 5.9</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The logic to solving this task resembles what we did in the first exercises. First we will find <em>Where</em> the first letter is, and then we will use indexing to put the second letter in those positions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Switch</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[</span><span class="o">⍸</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">=</span><span class="bp">⍵</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;tc&#39;</span><span class="w"> </span><span class="nv">Switch</span><span class="w"> </span><span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A bird in che hand is worch cwo in che bush
</span></div></div>
</div>
<p>We take the intermediate step of doing <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">⍵</span></code> because we can’t assign to <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and so <code class="docutils literal notranslate"><span class="pre">⍵[⍸⍺[1]=⍵]</span> <span class="pre">←</span> <span class="pre">⍺[2]</span></code> wouldn’t work.</p>
<div class="solution admonition" id="User-Defined-Functions-solution-26">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-swap"> Exercise 5.10</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>A very obvious modification of the function above is to write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Swap</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[</span><span class="o">⍸</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">=</span><span class="bp">⍵</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="sr">[</span><span class="o">⍸</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">=</span><span class="bp">⍵</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ei&#39;</span><span class="w"> </span><span class="nv">Swap</span><span class="w"> </span><span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A berd en thi hand es worth two en thi bush
</span></div></div>
</div>
<p>However, a really elegant solution becomes possible if we use the primitive <em>index of</em> and the concept of changing the frame of reference we discussed previously (cf. <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-changing-the-frame-of-reference"><span class="std std-numref">Section 4.13.2.1</span></a>). We used this concept to convert lower case letters into upper case letters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Swap</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">pos</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="bp">⍺</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍳</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="sr">[</span><span class="nv">pos</span><span class="sr">]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ei&#39;</span><span class="w"> </span><span class="nv">Swap</span><span class="w"> </span><span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A berd en thi hand es worth two en thi bush
</span></div></div>
</div>
<p>What exactly is happening? Well, we are basically establishing the initial and final sets (as seen in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-changing-the-frame-of-reference"><span class="std std-numref">Section 4.13.2.1</span></a>) as the sentence itself, but preceded by the two characters. For the initial set, we have them in their input order (the <code class="docutils literal notranslate"><span class="pre">(⍺,⍵)</span></code> above) but for the final set we swap them (the <code class="docutils literal notranslate"><span class="pre">⍺[2</span> <span class="pre">1],⍵</span></code> above).</p>
<p>This establishes the following “conversion”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eiA</span> <span class="n">bird</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">hand</span> <span class="ow">is</span> <span class="n">worth</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">bush</span>
<span class="n">ieA</span> <span class="n">bird</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">hand</span> <span class="ow">is</span> <span class="n">worth</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">bush</span>
</pre></div>
</div>
<p>For every character, we first look for it in the first line, stopping as soon as we find it (that is what <code class="docutils literal notranslate"><span class="pre">⍳</span></code> does) and then we swap it with the corresponding character in the line below.</p>
<p>We can thus re-implement <code class="docutils literal notranslate"><span class="pre">Swap</span></code> with more intermediate steps, to make this more obvious:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Swap</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">initialSet</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">pos</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">initialSet</span><span class="o">⍳</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">finalSet</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">finalSet</span><span class="sr">[</span><span class="nv">pos</span><span class="sr">]</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ei&#39;</span><span class="w"> </span><span class="nv">Swap</span><span class="w"> </span><span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">eiA bird in the hand is worth two in the bush
ieA bird in the hand is worth two in the bush
A berd en thi hand es worth two en thi bush
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-27">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-maxplace"> Exercise 5.11</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>If you are thinking about doing this exercise with a double <code class="docutils literal notranslate"><span class="pre">:For</span></code> loop then you are thinking it wrong, because APL has two primitives that are particularly well-suited for this job: the primitive <em>index of</em>, that you learned about in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-position-index-of"><span class="std std-numref">Section 4.13</span></a>, and the primitive <em>where</em>, that you learned about in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-where"><span class="std std-numref">Section 4.14</span></a>.</p>
<p>Just for reference, here is the double loop solution that you would probably have to write in other programming languages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">msg</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">MaxPlace</span><span class="w"> </span><span class="nv">matrix</span><span class="sr">;</span><span class="w"> </span><span class="nv">max</span><span class="sr">;</span><span class="w"> </span><span class="nv">row</span><span class="sr">;</span><span class="w"> </span><span class="nv">col</span><span class="sr">;</span><span class="w"> </span><span class="nv">r</span><span class="sr">;</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
<span class="w">    </span><span class="nv">max</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">matrix</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">1</span><span class="sr">]</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="nv">row</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="o">⍳</span><span class="p">(</span><span class="o">⍴</span><span class="nv">matrix</span><span class="p">)</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="o">⍳</span><span class="p">(</span><span class="o">⍴</span><span class="nv">matrix</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
<span class="w">            </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">matrix</span><span class="sr">[</span><span class="nv">r</span><span class="sr">;</span><span class="nv">c</span><span class="sr">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">max</span><span class="w"></span>
<span class="w">                </span><span class="nv">max</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">matrix</span><span class="sr">[</span><span class="nv">r</span><span class="sr">;</span><span class="nv">c</span><span class="sr">]</span><span class="w"></span>
<span class="w">                </span><span class="nv">row</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
<span class="w">            </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="w">    </span><span class="nv">msg</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;The greatest value: &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">max</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39; in row &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">row</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;, column &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">col</span><span class="p">)</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MaxPlace</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">The greatest value: 519 in row 4, column 4
</span></div></div>
</div>
<p>This implementation of <code class="docutils literal notranslate"><span class="pre">MaxPlace</span></code> has very poor APL style because it can be greatly simplified if one makes careful use of the available primitives.</p>
<p>For starters, using <em>reduce</em> makes it very easy to find the value of the maximum. After that, we just have to find its actual position.</p>
<p>If one is to use <em>index of</em> (<code class="docutils literal notranslate"><span class="pre">⍳</span></code>), we can easily find out where the maximum is in the flattened matrix, and then we use some basic arithmetic to compute its original position:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">msg</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">MaxPlace</span><span class="w"> </span><span class="nv">matrix</span><span class="sr">;</span><span class="w"> </span><span class="nv">max</span><span class="sr">;</span><span class="w"> </span><span class="nv">flat</span><span class="sr">;</span><span class="w"> </span><span class="nv">width</span><span class="sr">;</span><span class="w"> </span><span class="nv">pos</span><span class="sr">;</span><span class="w"> </span><span class="nv">row</span><span class="sr">;</span><span class="w"> </span><span class="nv">col</span><span class="w"></span>
<span class="w">    </span><span class="nv">max</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="na">/</span><span class="nv">flat</span><span class="kd">←</span><span class="o">,</span><span class="nv">matrix</span><span class="w"></span>
<span class="w">    </span><span class="nv">pos</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">flat</span><span class="o">⍳</span><span class="nv">max</span><span class="w"></span>
<span class="w">    </span><span class="nv">width</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">⍴</span><span class="nv">matrix</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">row</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="nv">pos</span><span class="o">÷</span><span class="nv">width</span><span class="w"></span>
<span class="w">    </span><span class="nv">col</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">pos</span><span class="o">-</span><span class="nv">width</span><span class="o">×</span><span class="nv">row</span><span class="o">-</span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="nv">msg</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;The greatest value: &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">max</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39; in row &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">row</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;, column &#39;</span><span class="o">,⍕</span><span class="nv">col</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MaxPlace</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">The greatest value: 519 in row 4, column 4
</span></div></div>
</div>
<p>The solution above looks much more like the code an APLer would write.</p>
<p>Finally, if you thought about using the <em>where</em> primitive you had the right instinct. However, you may find a difficulty:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="nv">actual</span><span class="o">=</span><span class="m">519</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┐
│4 4│
└───┘
</span></div></div>
</div>
<p>Looking at the result above, we can see the <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span></code> with the location of the maximum is enclosed, i.e. is a scalar, instead of the <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span></code> vector we’d like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="o">≡⍸</span><span class="nv">actual</span><span class="o">=</span><span class="m">519</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>When you learn about the primitive <em>first</em> (<code class="docutils literal notranslate"><span class="pre">⊃</span></code>, typed with <kbd>APL</kbd>+<kbd>x</kbd>) you will see the task becomes much more simple:</p>
<!-- (TODO) Remove the fast-forward; maybe revisit this exercise after ⊃ was taught. --><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃⍸</span><span class="nv">actual</span><span class="o">=</span><span class="m">519</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 4
</span></div></div>
</div>
<p>Using this we can implement the <code class="docutils literal notranslate"><span class="pre">MaxPlace</span></code> in a much more concise way. We do so below, also making use of a dfn for diversity sake:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">MaxPlace</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">max</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="na">/</span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">row</span><span class="w"> </span><span class="nv">col</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊃⍸</span><span class="nv">max</span><span class="o">=</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;The greatest value: &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">max</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39; in row &#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕</span><span class="nv">row</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;, column &#39;</span><span class="o">,⍕</span><span class="nv">col</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MaxPlace</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">The greatest value: 519 in row 4, column 4
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-28">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-convert"> Exercise 5.12</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>A straightforward solution to this exercise would involve a tradfn with an <code class="docutils literal notranslate"><span class="pre">:If</span></code> statement to select which formula to use:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">converted</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">temps</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="nv">conversion</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">conversion</span><span class="o">≡</span><span class="s1">&#39;F-C&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">converted</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="o">×</span><span class="p">(</span><span class="nv">temps</span><span class="o">-</span><span class="m">32</span><span class="p">)</span><span class="o">÷</span><span class="m">9</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">        </span><span class="nv">converted</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">32</span><span class="o">+</span><span class="m">9</span><span class="o">×</span><span class="nv">temps</span><span class="o">÷</span><span class="m">5</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">86</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">212</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;F-C&#39;</span><span class="w"> </span><span class="c1">⍝ 30 0 100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">30 0 100
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">25</span><span class="w">   </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;C-F&#39;</span><span class="w"> </span><span class="c1">⍝ 44.6 59 7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">44.6 59 77
</span></div></div>
</div>
<p>This solution is correct but below we include a couple of alternatives that do not make use of an <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:Else...</span> <span class="pre">:EndIf</span></code> control structure.</p>
<p>Another possibility would be to simply apply both formulas and select the correct final values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">converted</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">temps</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="nv">conversion</span><span class="sr">;</span><span class="w"> </span><span class="nv">values</span><span class="sr">;</span><span class="w"> </span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="nv">values</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">32</span><span class="o">+</span><span class="m">9</span><span class="o">×</span><span class="nv">temps</span><span class="o">÷</span><span class="m">5</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="m">5</span><span class="o">×</span><span class="p">(</span><span class="nv">temps</span><span class="o">-</span><span class="m">32</span><span class="p">)</span><span class="o">÷</span><span class="m">9</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">≢</span><span class="nv">temps</span><span class="w"></span>
<span class="w">    </span><span class="nv">converted</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">values</span><span class="sr">[</span><span class="p">(</span><span class="o">⍳</span><span class="nv">n</span><span class="p">)</span><span class="o">+</span><span class="nv">n</span><span class="o">×</span><span class="nv">conversion</span><span class="o">≡</span><span class="s1">&#39;F-C&#39;</span><span class="sr">]</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">86</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">212</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;F-C&#39;</span><span class="w"> </span><span class="c1">⍝ 30 0 100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">30 0 100
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">25</span><span class="w">   </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;C-F&#39;</span><span class="w"> </span><span class="c1">⍝ 44.6 59 7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">44.6 59 77
</span></div></div>
</div>
<p>An ingenious solution could also be written if one is to notice that both conversions work with the formula <code class="docutils literal notranslate"><span class="pre">a+b×T-c</span></code>, where <code class="docutils literal notranslate"><span class="pre">T</span></code> is the temperatures to be converted and <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> are parameters:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Conversion</p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">b</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">c</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>F to C</p></td>
<td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">5÷9</span></code></p></td>
<td class="text-align:center"><p>32</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>C to F</p></td>
<td class="text-align:center"><p>32</p></td>
<td class="text-align:center"><p>1.8</p></td>
<td class="text-align:center"><p>0</p></td>
</tr>
</tbody>
</table>
<p>Having noticed this, one only has to select the appropriate parameters and apply the general formula. We do so in a dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Convert</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">params</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">0</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="o">÷</span><span class="m">9</span><span class="p">)</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">1.8</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">params</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="bp">⍵</span><span class="o">≡</span><span class="s1">&#39;C-F&#39;</span><span class="sr">;]</span><span class="w"></span>
<span class="w">    </span><span class="nv">a</span><span class="o">+</span><span class="nv">b</span><span class="o">×</span><span class="bp">⍺</span><span class="o">-</span><span class="nv">c</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">86</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">212</span><span class="w"> </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;F-C&#39;</span><span class="w"> </span><span class="c1">⍝ 30 0 100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">30 0 100
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">25</span><span class="w">   </span><span class="nv">Convert</span><span class="w"> </span><span class="s1">&#39;C-F&#39;</span><span class="w"> </span><span class="c1">⍝ 44.6 59 7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">44.6 59 77
</span></div></div>
</div>
<div class="solution admonition" id="User-Defined-Functions-solution-29">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-loopsum"> Exercise 5.13</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Solving this exercise is a straightforward application of what you learned in the section about control structures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">sum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">LoopSum</span><span class="w"> </span><span class="nv">vec</span><span class="sr">;</span><span class="w"> </span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="nv">sum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="nv">vec</span><span class="w"></span>
<span class="w">        </span><span class="nv">sum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">sum</span><span class="o">+</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">LoopSum</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">42</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">260
</span></div></div>
</div>
<p>You will know you are a true APLer when your response to the prompt “Just for fun, can you program such a loop in APL?” is “This is hardly any fun…”.</p>
<div class="solution admonition" id="User-Defined-Functions-solution-30">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-reverloop"> Exercise 5.14</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>Once again, solving this exercise is a straightforward application of what you learned in the section on control structures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">reversed</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">ReverLoop</span><span class="w"> </span><span class="nv">vec</span><span class="sr">;</span><span class="w"> </span><span class="nv">item</span><span class="w"></span>
<span class="w">    </span><span class="nv">reversed</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="no">⍬</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="nv">vec</span><span class="w"></span>
<span class="w">        </span><span class="nv">reversed</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">item</span><span class="o">,</span><span class="nv">reversed</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ReverLoop</span><span class="w"> </span><span class="s1">&#39;The solution without loop was much better&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">retteb hcum saw pool tuohtiw noitulos ehT
</span></div></div>
</div>
<p>Neither this exercise nor exercise 13 can be solved with dfns because they explicitly ask for loops to be used.</p>
<div class="solution admonition" id="User-Defined-Functions-solution-31">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-subsum"> Exercise 5.15</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>This exercise has a very helpful hint that should greatly simplify it.</p>
<p>Following the steps provided, accomplishing 1. is a matter of obtaining the dimensions of the input matrix (with <code class="docutils literal notranslate"><span class="pre">(r</span> <span class="pre">c)←⍴mat</span></code>, for example) and then computing how many rows the reshaped matrix will have. If the matrix has <code class="docutils literal notranslate"><span class="pre">r×c</span></code> elements and the new matrix will have rows of length <code class="docutils literal notranslate"><span class="pre">g</span></code>, then we need <code class="docutils literal notranslate"><span class="pre">(r×c)÷g</span></code> rows in total.</p>
<p>Step 2. is self-explanatory and just requires the use of <em>catenate</em> and <em>plus-reduce</em>.</p>
<p>For step 3., we know the final result will have as many rows as the initial matrix, but some new columns. If the initial matrix had <code class="docutils literal notranslate"><span class="pre">c</span></code> columns and those were subdivided into subgroups of <code class="docutils literal notranslate"><span class="pre">g</span></code> columns, then we created <code class="docutils literal notranslate"><span class="pre">c÷g</span></code> subgroups. Each subgroup corresponds to a new column, so the final matrix should have <code class="docutils literal notranslate"><span class="pre">c+c÷g</span></code> columns.</p>
<p>With all this in mind, here is a reference implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">sub</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">g</span><span class="w"> </span><span class="nv">SubSum</span><span class="w"> </span><span class="nv">mat</span><span class="sr">;</span><span class="w"> </span><span class="nv">r</span><span class="sr">;</span><span class="w"> </span><span class="nv">c</span><span class="sr">;</span><span class="w"> </span><span class="nv">rows</span><span class="sr">;</span><span class="w"> </span><span class="nv">reshaped</span><span class="sr">;</span><span class="w"> </span><span class="nv">newc</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">r</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍴</span><span class="nv">mat</span><span class="w"></span>
<span class="w">    </span><span class="nv">rows</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">r</span><span class="o">×</span><span class="nv">c</span><span class="p">)</span><span class="o">÷</span><span class="nv">g</span><span class="w"></span>
<span class="w">    </span><span class="nv">reshaped</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">rows</span><span class="w"> </span><span class="nv">g</span><span class="o">⍴</span><span class="nv">mat</span><span class="w"></span>
<span class="w">    </span><span class="nv">reshaped</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">reshaped</span><span class="o">,+</span><span class="na">/</span><span class="nv">reshaped</span><span class="w"></span>
<span class="w">    </span><span class="nv">newc</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">c</span><span class="o">+</span><span class="nv">c</span><span class="o">÷</span><span class="nv">g</span><span class="w"></span>
<span class="w">    </span><span class="nv">sub</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="nv">newc</span><span class="o">⍴</span><span class="nv">reshaped</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">SubSum</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 89 166 420 675 508  12  23  543
111 453 177 741 365 284 352 1001
349 192 329 870 115 515 374 1004
160 467 234 861 519 485 283 1287
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">SubSum</span><span class="w"> </span><span class="nv">actual</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 89 166 255 420 508 928  12  23  35
111 453 564 177 365 542 284 352 636
349 192 541 329 115 444 515 374 889
160 467 627 234 519 753 485 283 768
</span></div></div>
</div>
<p>Refactoring this implementation into a dfn should be straightforward, as this tradfn has no control structures whatsoever.</p>
<div class="solution admonition" id="User-Defined-Functions-solution-32">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-sorry"> Exercise 5.16</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The main difficulty of this exercise is in managing the lengths of all the rows of the final character matrix. As we loop over the different “slices” of the input vector, we need to append them to the final character matrix while making sure all rows have the appropriate size, as dictated by the longest slice.</p>
<p>For concatenating matrices and vectors we will use <em>catenate</em> (<code class="docutils literal notranslate"><span class="pre">,</span></code>), but we will also use <em>catenate first</em> (<code class="docutils literal notranslate"><span class="pre">⍪</span></code>), which you learned about in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-special-cases-and-notations"><span class="std std-numref">Section 4.11.4</span></a>.</p>
<p>The first reference implementation we provide has <em>many</em> loops:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">sep</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="nv">string</span><span class="sr">;</span><span class="w"> </span><span class="nv">width</span><span class="sr">;</span><span class="w"> </span><span class="nv">slice</span><span class="sr">;</span><span class="w"> </span><span class="nv">char</span><span class="w"></span>
<span class="w">    </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">width</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="nv">slice</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="nv">string</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="nv">char</span><span class="o">=</span><span class="nv">sep</span><span class="w"></span>
<span class="w">            </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="nv">width</span><span class="o">&gt;≢</span><span class="nv">slice</span><span class="w"></span>
<span class="w">                </span><span class="nv">slice</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="w">            </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="w">            </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="nv">width</span><span class="o">&lt;≢</span><span class="nv">slice</span><span class="w"></span>
<span class="w">                </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="w">                </span><span class="nv">width</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">width</span><span class="o">+</span><span class="m">1</span><span class="w"></span>
<span class="w">            </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="w">            </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="o">⍪</span><span class="nv">slice</span><span class="w"></span>
<span class="w">            </span><span class="nv">slice</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">            </span><span class="nv">slice</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="nv">char</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="s1">&#39;You/will/need a/loop/to solve/this/exercise&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You     
will    
need a  
loop    
to solve
this    
</span></div></div>
</div>
<p>This solution works but uses <em>three</em> different loops and an <code class="docutils literal notranslate"><span class="pre">:If</span></code> statement. This solution does not make use of the fact that APL has very strong array-manipulation capabilities. We can eliminate many of the control structures if we compute in advance the widths of the various slices.</p>
<p>For that matter, we will</p>
<ol class="simple">
<li><p>start by computing the positions at which the separators occur;</p></li>
<li><p>then we’ll compute the maximum width a slice will ever have;</p></li>
<li><p>after that, we loop over those positions, backtracking the position of the previous separator, so that we can get the slice between two consecutive separators;</p></li>
<li><p>at this point, we can get the slice and pad it with the remaining spaces.</p></li>
</ol>
<p>Here is a tradfn implementing that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">sep</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="nv">string</span><span class="sr">;</span><span class="w"> </span><span class="nv">pos</span><span class="sr">;</span><span class="w"> </span><span class="nv">width</span><span class="sr">;</span><span class="w"> </span><span class="nv">idx</span><span class="sr">;</span><span class="w"> </span><span class="nv">start</span><span class="sr">;</span><span class="w"> </span><span class="nv">end</span><span class="sr">;</span><span class="w"> </span><span class="nv">length</span><span class="sr">;</span><span class="w"> </span><span class="nv">slice</span><span class="w"></span>
<span class="w">    </span><span class="nv">pos</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="nv">sep</span><span class="o">=</span><span class="nv">string</span><span class="o">,</span><span class="nv">sep</span><span class="w"></span>
<span class="w">    </span><span class="nv">idx</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="m">¯1</span><span class="o">+≢</span><span class="nv">pos</span><span class="w"></span>
<span class="w">    </span><span class="nv">width</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="na">/</span><span class="nv">pos</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="nv">pos</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="nv">idx</span><span class="sr">]</span><span class="o">-</span><span class="nv">pos</span><span class="sr">[</span><span class="nv">idx</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">width</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">start</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="nv">end</span><span class="w"> </span><span class="bp">:</span><span class="nv">In</span><span class="w"> </span><span class="nv">pos</span><span class="w"></span>
<span class="w">        </span><span class="nv">length</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="o">+</span><span class="nv">end</span><span class="o">-</span><span class="nv">start</span><span class="w"></span>
<span class="w">        </span><span class="nv">slice</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">string</span><span class="sr">[</span><span class="nv">start</span><span class="o">+⍳</span><span class="nv">length</span><span class="sr">]</span><span class="w"></span>
<span class="w">        </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="o">⍪</span><span class="nv">slice</span><span class="o">,</span><span class="p">(</span><span class="nv">width</span><span class="o">-</span><span class="nv">length</span><span class="p">)</span><span class="na">/</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="w">        </span><span class="nv">start</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">end</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="s1">&#39;You/will/need a/loop/to solve/this/exercise&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You      
will     
need a   
loop     
to solve 
this     
exercise 
</span></div></div>
</div>
<p>Another variation to the tradfn above would be to have a very long vector of spaces, for example <code class="docutils literal notranslate"><span class="pre">tail←(≢string)⍴'</span> <span class="pre">'</span></code>, and whenever we get a slice from the original string, we could do <code class="docutils literal notranslate"><span class="pre">mat</span> <span class="pre">←</span> <span class="pre">mat⍪(slice,tail)[⍳width]</span></code>.</p>
<p>Yet another variation of the above would be possible if you read about the <code class="docutils literal notranslate"><span class="pre">:For...</span> <span class="pre">:InEach...</span> <span class="pre">:EndFor</span></code> control structure in <a class="reference internal" href="#user-defined-functions-ineach"><span class="std std-numref">Section 5.16.8</span></a>. With that, we can iterate directly over the limits of each slice. A reference tradfn implementing that method is shown below, also incorporating the alternative way to pad the remainder spaces mentioned above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">sep</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="nv">string</span><span class="sr">;</span><span class="w"> </span><span class="nv">tai</span><span class="sr">;</span><span class="w"> </span><span class="nv">pos</span><span class="sr">;</span><span class="w"> </span><span class="nv">width</span><span class="sr">;</span><span class="w"> </span><span class="nv">idx</span><span class="sr">;</span><span class="w"> </span><span class="nv">starts</span><span class="sr">;</span><span class="w"> </span><span class="nv">ends</span><span class="sr">;</span><span class="w"> </span><span class="nv">s</span><span class="sr">;</span><span class="w"> </span><span class="nv">e</span><span class="sr">;</span><span class="w"> </span><span class="nv">l</span><span class="w"></span>
<span class="w">    </span><span class="nv">tail</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">≢</span><span class="nv">string</span><span class="p">)</span><span class="o">⍴</span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">string</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">sep</span><span class="o">,</span><span class="nv">string</span><span class="o">,</span><span class="nv">sep</span><span class="w"></span>
<span class="w">    </span><span class="nv">pos</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="nv">sep</span><span class="o">=</span><span class="nv">string</span><span class="w"></span>
<span class="w">    </span><span class="nv">idx</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="m">¯1</span><span class="o">+≢</span><span class="nv">pos</span><span class="w"></span>
<span class="w">    </span><span class="nv">starts</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">pos</span><span class="sr">[</span><span class="nv">idx</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">ends</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">pos</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="nv">idx</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="nv">width</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="na">/</span><span class="nv">ends</span><span class="o">-</span><span class="nv">starts</span><span class="w"></span>
<span class="w">    </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">width</span><span class="o">⍴</span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">For</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="w"> </span><span class="nv">e</span><span class="p">)</span><span class="w"> </span><span class="bp">:</span><span class="nv">InEach</span><span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="nv">ends</span><span class="w"></span>
<span class="w">        </span><span class="nv">l</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="o">+</span><span class="nv">e</span><span class="o">-</span><span class="nv">s</span><span class="w"></span>
<span class="w">        </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="o">⍪</span><span class="p">(</span><span class="nv">string</span><span class="sr">[</span><span class="nv">s</span><span class="o">+⍳</span><span class="nv">l</span><span class="sr">]</span><span class="o">,</span><span class="nv">tail</span><span class="p">)</span><span class="sr">[</span><span class="o">⍳</span><span class="nv">width</span><span class="sr">]</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndFor</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="s1">&#39;You/will/need a/loop/to solve/this/exercise&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You      
will     
need a   
loop     
to solve 
this     
exercise 
</span></div></div>
</div>
<p>Now that we have seen a couple of tradfn solutions with loops, we will go over a possible dfn solution that only makes use of the tools you were given so far:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Separate</span><span class="kd">←</span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">s</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="o">,</span><span class="bp">⍺</span><span class="w">           </span><span class="c1">⍝ Include separator in the end.</span><span class="w"></span>
<span class="w">    </span><span class="nv">pos</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="bp">⍺</span><span class="o">=</span><span class="nv">s</span><span class="w">        </span><span class="c1">⍝ Find where the separators are.</span><span class="w"></span>
<span class="w">    </span><span class="nv">idx</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="m">¯1</span><span class="o">+≢</span><span class="nv">pos</span><span class="w"></span>
<span class="w">    </span><span class="nv">ws</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">¯1</span><span class="o">+</span><span class="nv">pos</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="nv">pos</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="nv">idx</span><span class="sr">]</span><span class="o">-</span><span class="nv">pos</span><span class="sr">[</span><span class="nv">idx</span><span class="sr">]</span><span class="w">  </span><span class="c1">⍝ Find the width of each slice.</span><span class="w"></span>
<span class="w">    </span><span class="nv">w</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="na">/</span><span class="nv">ws</span><span class="w">          </span><span class="c1">⍝ Find the width of the final matrix.</span><span class="w"></span>
<span class="w">    </span><span class="nv">rep</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">s</span><span class="o">=</span><span class="nv">s</span><span class="w">         </span><span class="c1">⍝ Create a mask of 1s to later use with replicate.</span><span class="w"></span>
<span class="w">    </span><span class="nv">rep</span><span class="sr">[</span><span class="nv">pos</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">ws</span><span class="o">-</span><span class="nv">w</span><span class="w">   </span><span class="c1">⍝ Sep. will be replaced with as many spaces as needed.</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="o">≢</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="nv">w</span><span class="o">⍴</span><span class="nv">rep</span><span class="na">/</span><span class="nv">s</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="s1">&#39;You/will/need a/loop/to solve/this/exercise&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You     
will    
need a  
loop    
to solve
this    
exercise
</span></div></div>
</div>
<p><strong>Teaser</strong></p>
<p>Finally, the “<em>true</em>” APL solution, that you could not have written yet because you haven’t learned enough primitives, but that we included here to show that you are just scratching the surface of the power of APL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Separate</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">↑</span><span class="bp">⍵</span><span class="o">⊆</span><span class="na">⍨</span><span class="bp">⍺</span><span class="o">≠</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="s1">&#39;You/will/need a/loop/to solve/this/exercise&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You     
will    
need a  
loop    
to solve
this    
exercise
</span></div></div>
</div>
<p>In order to understand the dfn above, you will need to learn about the primitive functions <em>mix</em> <code class="docutils literal notranslate"><span class="pre">↑</span></code> and <em>partition</em> <code class="docutils literal notranslate"><span class="pre">⊆</span></code> in <a class="reference internal" href="Nested-Arrays-Continued.html"><span class="doc std std-doc">here</span></a>, and the primitive operator <em>switch</em> <code class="docutils literal notranslate"><span class="pre">⍨</span></code>, in <a class="reference internal" href="Operators.html"><span class="doc std std-doc">here</span></a>.</p>
<p>This could be made even shorter if you go tacit (cf. <a class="reference internal" href="Tacit-Programming.html"><span class="doc std std-doc">Tacit Programming</span></a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Separate</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↑≠⊆⊢</span><span class="w"></span>
<span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="nv">Separate</span><span class="w"> </span><span class="s1">&#39;You/will/need a/loop/to solve/this/exercise&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You     
will    
need a  
loop    
to solve
this    
exercise
</span></div></div>
</div>
<p>It is also relevant to conclude with a remark on the behaviour of all these possible solutions in edge cases. First of all, can you find input strings for which these functions behave differently?</p>
<p>You may have noticed that leading and trailing separators, as well as consecutive separators in the string, get treated differently in these different solutions. That is, strings like <code class="docutils literal notranslate"><span class="pre">'/Leading/separators'</span></code>, <code class="docutils literal notranslate"><span class="pre">trailing/sep/arators/'</span></code> and <code class="docutils literal notranslate"><span class="pre">'//consecutive/separators///in/some//places'</span></code> give different results if you use the different solutions above. In the real world, you would have to either make sure your implementation handles these edge cases appropriately (it is also up to you to define what “<em>appropriate</em>” means) or avoid them altogether.</p>
<div class="solution admonition" id="User-Defined-Functions-solution-33">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-collatzpath"> Exercise 5.17</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>This was already done when we introduced <code class="docutils literal notranslate"><span class="pre">:While</span></code> loops in <a class="reference internal" href="#user-defined-functions-top-controlled-loop-whileendwhile"><span class="std std-numref">Section 5.7.5.2</span></a>), and the implementation there did not make use of an <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:Else</span></code> statement to decide which of the two branching options we should choose:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">CollatzPath</span><span class="w"> </span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="nv">path</span><span class="sr">[</span><span class="o">≢</span><span class="nv">path</span><span class="sr">]</span><span class="o">≠</span><span class="m">1</span><span class="w"></span>
<span class="w">        </span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">path</span><span class="sr">[</span><span class="o">≢</span><span class="nv">path</span><span class="sr">]</span><span class="w"></span>
<span class="w">        </span><span class="nv">n</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">((</span><span class="nv">n</span><span class="o">÷</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="m">3</span><span class="o">×</span><span class="nv">n</span><span class="p">))</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">|</span><span class="nv">n</span><span class="sr">]</span><span class="w"></span>
<span class="w">        </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">path</span><span class="o">,</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37 112 56 28 14 7 22 11 34 17 52 26 13 40 20 10 5 16 8 4 2 1
</span></div></div>
</div>
<p>But of course you could use an <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:Else</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">CollatzPath</span><span class="w"> </span><span class="nv">n</span><span class="sr">;</span><span class="w"> </span><span class="nv">last</span><span class="w"></span>
<span class="w">    </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="nv">last</span><span class="kd">←</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="m">1</span><span class="o">≠</span><span class="nv">last</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">If</span><span class="w"> </span><span class="m">2</span><span class="o">|</span><span class="nv">last</span><span class="w"></span>
<span class="w">            </span><span class="nv">last</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">+</span><span class="m">3</span><span class="o">×</span><span class="nv">last</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">Else</span><span class="w"></span>
<span class="w">            </span><span class="nv">last</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">last</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
<span class="w">        </span><span class="bp">:</span><span class="nv">EndIf</span><span class="w"></span>
<span class="w">        </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">path</span><span class="o">,</span><span class="nv">last</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37 112 56 28 14 7 22 11 34 17 52 26 13 40 20 10 5 16 8 4 2 1
</span></div></div>
</div>
<p>Another possibility here is to use a similar approach to that used in exercise 12, realising that both branches involve a formula of the type <code class="docutils literal notranslate"><span class="pre">b+a×n</span></code> where <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are parameters that depend on the parity of <code class="docutils literal notranslate"><span class="pre">n</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p><code class="docutils literal notranslate"><span class="pre">2|n</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">b</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>0</p></td>
<td class="text-align:center"><p>0.5</p></td>
<td class="text-align:center"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>1</p></td>
<td class="text-align:center"><p>3</p></td>
<td class="text-align:center"><p>1</p></td>
</tr>
</tbody>
</table>
<p>This means we only need to pick the correct coefficients at each step:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">CollatzPath</span><span class="w"> </span><span class="nv">n</span><span class="sr">;</span><span class="w"> </span><span class="nv">last</span><span class="sr">;</span><span class="w"> </span><span class="nv">coefs</span><span class="sr">;</span><span class="w"> </span><span class="nv">a</span><span class="sr">;</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
<span class="w">    </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="o">⍴</span><span class="nv">last</span><span class="kd">←</span><span class="nv">n</span><span class="w"></span>
<span class="w">    </span><span class="nv">coefs</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">0.5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">While</span><span class="w"> </span><span class="m">1</span><span class="o">≠</span><span class="nv">last</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">coefs</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">|</span><span class="nv">last</span><span class="sr">;]</span><span class="w"></span>
<span class="w">        </span><span class="nv">path</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">path</span><span class="o">,</span><span class="nv">last</span><span class="kd">←</span><span class="nv">b</span><span class="o">+</span><span class="nv">a</span><span class="o">×</span><span class="nv">last</span><span class="w"></span>
<span class="w">    </span><span class="bp">:</span><span class="nv">EndWhile</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37 112 56 28 14 7 22 11 34 17 52 26 13 40 20 10 5 16 8 4 2 1
</span></div></div>
</div>
<p>Any of the methods employed to avoid an explicit <code class="docutils literal notranslate"><span class="pre">:If...</span> <span class="pre">:Else</span></code> control structure can be used in defining a recursive version of the <code class="docutils literal notranslate"><span class="pre">CollatzPath</span></code> function. For example, if we use the “coefficient-picking” method, we could write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">CollatzPath</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">=</span><span class="m">1</span><span class="bp">:</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">0.5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">|</span><span class="bp">⍵</span><span class="sr">;]</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">,</span><span class="bp">∇</span><span class="nv">b</span><span class="o">+</span><span class="nv">a</span><span class="o">×</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37 112 56 28 14 7 22 11 34 17 52 26 13 40 20 10 5 16 8 4 2 1
</span></div></div>
</div>
<p>Finally, a small rework can make this recursive version be <em>tail recursive</em>, as described in <a class="reference internal" href="#user-defined-functions-tail-recursion"><span class="std std-numref">Section 5.16.9</span></a>. If you skipped that, do not worry. In a nutshell, a tail recursive function is a recursive function that is less resource intensive. Such a possible implementation could be</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">CollatzPath</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="no">⍬</span><span class="w"></span>
<span class="w">    </span><span class="bp">⍵</span><span class="o">=</span><span class="m">1</span><span class="bp">:</span><span class="w"> </span><span class="bp">⍺</span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">0.5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">|</span><span class="bp">⍵</span><span class="sr">;]</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="bp">⍺</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="bp">∇</span><span class="nv">b</span><span class="o">+</span><span class="nv">a</span><span class="o">×</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CollatzPath</span><span class="w"> </span><span class="m">37</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37 112 56 28 14 7 22 11 34 17 52 26 13 40 20 10 5 16 8 4 2 1
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Some-Primitive-Functions.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">4. </span>Some Primitive Functions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="First-Aid-Kit.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6. </span>First-Aid Kit</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Bernard Legrand, reworked by Rodrigo Girão Serrão.<br/>
  
    <div class="extra_footer">
      <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
</a></p>
<p>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>