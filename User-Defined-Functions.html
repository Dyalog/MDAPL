

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>4. User Defined Functions &#8212; Mastering Dyalog APL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Appendices" href="Appendices.html" />
    <link rel="prev" title="3. Some Primitive Functions" href="Some-Primitive-Functions.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Mastering Dyalog APL</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction.html">
   Introduction - Will You Play APL With Me?
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Getting-Started.html">
   1. Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Data-and-Variables.html">
   2. Data and Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Some-Primitive-Functions.html">
   3. Some Primitive Functions
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   4. User Defined Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendices.html">
   5. Appendices
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/User-Defined-Functions.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/RojerGS/MDAPL"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#landmarks">
   4.1. Landmarks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-definitions">
     4.1.1. Some Definitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-your-environment">
     4.1.2. Configure Your Environment
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-do-you-need">
       4.1.2.1. What Do You Need?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-text-editor-what-for">
       4.1.2.2. A Text Editor; What For?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-dfns">
   4.2. Simple Dfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition">
     4.2.1. Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unnamed-dfns">
     4.2.2. Unnamed Dfns
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modifying-the-code">
     4.2.3. Modifying The Code
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-dfns">
   4.3. More on Dfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characteristics">
     4.3.1. Characteristics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-working-example">
     4.3.2. A Working Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#local-variables">
     4.3.3. Local Variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#default-left-argument">
     4.3.4. Default Left Argument
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#returning-the-result">
     4.3.5. Returning the Result
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preliminary-exercises">
   4.4. Preliminary exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dfns-in-depth">
   4.5. Dfns in Depth
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#guards">
     4.5.1. Guards
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shy-result">
     4.5.2. Shy Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lexical-scoping">
     4.5.3. Lexical Scoping
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#miscellaneous">
   4.6. Miscellaneous
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-of-variables-and-functions">
     4.6.1. List of Variables and Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-of-the-result">
     4.6.2. Use of the Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#vector-representation">
     4.6.3. Vector Representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#invoking-the-text-editor">
     4.6.4. Invoking the Text Editor
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tradfns">
   4.7. Tradfns
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-first-example">
     4.7.1. A First Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-default-isn-t-local">
     4.7.2. The Default Isn’t Local
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-sub-functions">
     4.7.3. Defining Sub-Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-second-example">
     4.7.4. A Second Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-scoping">
     4.7.5. Dynamic Scoping
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flow-control">
   4.8. Flow Control
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview">
     4.8.1. Overview
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-execution">
     4.8.2. Conditional Execution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-conditions-if-endif">
       4.8.2.1. Simple Conditions (
       <code class="docutils literal notranslate">
        <span class="pre">
         :If
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         :EndIf
        </span>
       </code>
       )
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   4.9. Solutions
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="user-defined-functions">
<span id="user-defined-functions-user-defined-functions"></span><h1><span class="section-number">4. </span>User Defined Functions<a class="headerlink" href="#user-defined-functions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="landmarks">
<span id="user-defined-functions-landmarks"></span><h2><span class="section-number">4.1. </span>Landmarks<a class="headerlink" href="#landmarks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="some-definitions">
<span id="user-defined-functions-some-definitions"></span><h3><span class="section-number">4.1.1. </span>Some Definitions<a class="headerlink" href="#some-definitions" title="Permalink to this headline">¶</a></h3>
<p>In previous chapters we made a distinction between the functions and operators which are part of APL, like <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">×</span></code>, <code class="docutils literal notranslate"><span class="pre">⌈</span></code> and <code class="docutils literal notranslate"><span class="pre">/</span></code> (we refer to them as <em>primitives</em>), and those functions and operators that are created by the user which are represented, not by a symbol, but by a name like <code class="docutils literal notranslate"><span class="pre">Average</span></code> (we say they are <em>user-defined</em>).</p>
<p>We also made an important distinction between <em>functions</em>, which apply to data and which return data, and <em>operators</em>, which apply to functions or data and produce <em>derived</em> functions (see <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-definition"><span class="std std-numref">Section 3.8.2</span></a>).</p>
<p>This means that we can distinguish between 4 major categories of processing tools:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Category</p></th>
<th class="text-align:left head"><p>Name</p></th>
<th class="text-align:center head"><p>Examples</p></th>
<th class="text-align:center head"><p>Refer to</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Built-in tools</p></td>
<td class="text-align:left"><p>Primitive functions</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">+</span></code> <code class="docutils literal notranslate"><span class="pre">×</span></code> <code class="docutils literal notranslate"><span class="pre">⌈</span></code> <code class="docutils literal notranslate"><span class="pre">⍴</span></code></p></td>
<td class="text-align:center"><p>Previous chapters</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p>Primitive operators</p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">/</span></code></p></td>
<td class="text-align:center"><p><span class="xref myst">Chapter on Operators</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>User-defined tools</p></td>
<td class="text-align:left"><p><strong>User-defined functions</strong></p></td>
<td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">Average</span></code></p></td>
<td class="text-align:center"><p>This chapter</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p>User-defined operators</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><code class="xref std std-numref docutils literal notranslate"><span class="pre">Operators-User-Defined-Operators</span></code></p></td>
</tr>
</tbody>
</table>
<p>This chapter is devoted to user-defined <em>functions</em>. The subject of user-defined <em>operators</em> will be covered later.</p>
<p>We can further categorise user-defined functions according to the way they process data. Firstly we can distinguish between <em><strong>Direct</strong></em> and <em><strong>Procedural</strong></em> <strong>functions</strong>.</p>
<ul class="simple">
<li><p><em><strong>Direct</strong></em> functions (commonly referred to as <em><strong>dfns</strong></em>) are defined in a very formal manner.</p>
<ul>
<li><p>They are usually designed for pure calculation, without any external or user interfaces. <em>Dfns</em> do not allow loops except by recursion and have limited options for conditional programming.</p></li>
</ul>
</li>
<li><p><em><strong>Procedural</strong></em> functions (commonly referred to as <em><strong>tradfns</strong></em>, short for <em>traditional functions</em>) are less formal and look much more like programs written in other languages.</p>
<ul>
<li><p>They provide greater flexibility for building major applications which involve user interfaces, access to files or databases and other external interfaces. <em>Tradfns</em> may take no arguments and behave like scripts.</p></li>
</ul>
</li>
</ul>
<p>Even though you may write entire systems with dfns, you might prefer to restrict their use to encapsulate statements that, together, perform some meaningful operation on the data given.</p>
<p>The second distinction we can make concerns the number of arguments a user-defined function can have.</p>
<ul class="simple">
<li><p><em><strong>Dyadic</strong></em> functions take two arguments which are placed on either side of the function (<code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">f</span> <span class="pre">Y</span></code>);</p></li>
<li><p><em><strong>Monadic</strong></em> functions take a single argument which is placed to the right of the function (<code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">Y</span></code>);</p></li>
<li><p><em><strong>Niladic</strong></em> functions take no argument at all;</p></li>
<li><p><em><strong>Ambivalent</strong></em> functions are dyadic functions whose left argument is optional.</p></li>
</ul>
</div>
<div class="section" id="configure-your-environment">
<span id="user-defined-functions-configure-your-environment"></span><h3><span class="section-number">4.1.2. </span>Configure Your Environment<a class="headerlink" href="#configure-your-environment" title="Permalink to this headline">¶</a></h3>
<p>Dyalog APL has a highly configurable development and debugging environment, designed to fit the requirements of very different kinds of programmers. This environment is controlled by configuration parameters; let us determine which context will suit you best.</p>
<div class="section" id="what-do-you-need">
<span id="user-defined-functions-what-do-you-need"></span><h4><span class="section-number">4.1.2.1. </span>What Do You Need?<a class="headerlink" href="#what-do-you-need" title="Permalink to this headline">¶</a></h4>
<p>All you need (except for love) is:</p>
<ul class="simple">
<li><p>a window in which to type expressions that you want to be executed (white Session window);</p></li>
<li><p>one or more windows in which to create/modify user-defined functions (grey Edit windows);</p></li>
<li><p>one or more windows to debug execution errors (black Trace window).</p></li>
</ul>
<p>The colours above refer to the positions of the windows in <a class="reference internal" href="#fig-ide-window-layout"><span class="std std-numref">Fig. 4.1</span></a>, <a class="reference internal" href="#fig-ide-window-horizontal-layout"><span class="std std-numref">Fig. 4.2</span></a> and <a class="reference internal" href="#fig-ide-floating-window-layout"><span class="std std-numref">Fig. 4.3</span></a>.</p>
<p>The default configuration is consistent with other software development tools and in it is possible to divide the session window into three parts which can be resized, as shown in <a class="reference internal" href="#fig-ide-window-layout"><span class="std std-numref">Fig. 4.1</span></a>:</p>
<div class="figure align-default" id="ide-window-layout">
<span id="fig-ide-window-layout"></span><img alt="_images/IDE_Window_Layout.png" src="_images/IDE_Window_Layout.png" />
<p class="caption"><span class="caption-number">Fig. 4.1 </span><span class="caption-text">The default window configuration</span><a class="headerlink" href="#ide-window-layout" title="Permalink to this image">¶</a></p>
</div>
<p>This configuration provides a single Edit window and a single Trace window, each of which is “docked” along one of the Session window borders. You can dock these windows along any of the Session window sides. For example, <a class="reference internal" href="#fig-ide-window-horizontal-layout"><span class="std std-numref">Fig. 4.2</span></a> shows a configuration with three horizontal panes, highly suitable for entering and editing very long statements.</p>
<div class="figure align-default" id="ide-window-horizontal-layout">
<span id="fig-ide-window-horizontal-layout"></span><img alt="_images/IDE_Window_Horizontal_Layout.png" src="_images/IDE_Window_Horizontal_Layout.png" />
<p class="caption"><span class="caption-number">Fig. 4.2 </span><span class="caption-text">The Edit and Trace windows in a horizontal layout</span><a class="headerlink" href="#ide-window-horizontal-layout" title="Permalink to this image">¶</a></p>
</div>
<p>The Edit window supports the <em>Multiple Document Interface</em> (MDI). This means that you can work on more than one function at a time.</p>
<ul class="simple">
<li><p>On the Windows interpreter you can use the “Window” menu to <em>Tile</em> and <em>Cascade</em>, or you can maximise any one of the functions to concentrate solely upon it.</p></li>
<li><p>If you are using RIDE the default behaviour is to open a tab per item you are editing.</p></li>
</ul>
<p>If you are working on a relatively small screen you may find that you prefer to work with “floating” windows in a layout similar to the one in <a class="reference internal" href="#fig-ide-floating-window-layout"><span class="std std-numref">Fig. 4.3</span></a>:</p>
<div class="figure align-default" id="ide-floating-window-layout">
<span id="fig-ide-floating-window-layout"></span><img alt="_images/IDE_Floating_Window_Layout.png" src="_images/IDE_Floating_Window_Layout.png" />
<p class="caption"><span class="caption-number">Fig. 4.3 </span><span class="caption-text">“floating” windows layout</span><a class="headerlink" href="#ide-floating-window-layout" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>On the Windows interpreter, you can either</p>
<ul>
<li><p>grab the border of a sub-window (Edit or Trace) and then drag and drop it in the middle of the session window, as an independent floating window,</p></li>
<li><p>or enable the “Classic Dyalog mode”, which can be set under “Options” ⇨ “Configure…” ⇨ “Trace/Edit” as shown in <a class="reference internal" href="#fig-ide-configure-classic-mode"><span class="std std-numref">Fig. 4.4</span></a>.</p></li>
</ul>
</li>
</ul>
<div class="figure align-default" id="ide-configure-classic-mode">
<span id="fig-ide-configure-classic-mode"></span><img alt="_images/IDE_Configure_Classic_Mode.png" src="_images/IDE_Configure_Classic_Mode.png" />
<p class="caption"><span class="caption-number">Fig. 4.4 </span><span class="caption-text">Option to set “Classic Dyalog mode”</span><a class="headerlink" href="#ide-configure-classic-mode" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>If you are using RIDE you can go to “Edit” ⇨ “Preferences” ⇨ “Windows” and enable “Floating windows” as shown in <a class="reference internal" href="#fig-ride-configure-floating-windows"><span class="std std-numref">Fig. 4.5</span></a>:</p></li>
</ul>
<div class="figure align-default" id="ride-configure-floating-windows">
<span id="fig-ride-configure-floating-windows"></span><img alt="_images/RIDE_Configure_Floating_Windows.png" src="_images/RIDE_Configure_Floating_Windows.png" />
<p class="caption"><span class="caption-number">Fig. 4.5 </span><span class="caption-text">Enable “floating” windows in RIDE</span><a class="headerlink" href="#ride-configure-floating-windows" title="Permalink to this image">¶</a></p>
</div>
<p>Working with floating windows has the added benefit of allowing you to have a stack of trace windows (as opposed to a single trace window), showing which functions call which other. This will be explored in <code class="xref std std-numref docutils literal notranslate"><span class="pre">First-Aid-Kit-Choose-Your-Configuration</span></code>.</p>
</div>
<div class="section" id="a-text-editor-what-for">
<span id="user-defined-functions-a-text-editor-what-for"></span><h4><span class="section-number">4.1.2.2. </span>A Text Editor; What For?<a class="headerlink" href="#a-text-editor-what-for" title="Permalink to this headline">¶</a></h4>
<p>Some dfns can be defined by a single expression and so are easy to define inside the session. We used this technique before to define a function named <code class="docutils literal notranslate"><span class="pre">Average</span></code> and here we do it again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Average</span> <span class="kd">←</span> <span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷≢</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>However, as one defines more complex functions, it can become more complicated to define dfns in the session window.</p>
<p>For one, the ability to define multi-line dfns in the session was only made available with Dyalog 18.0. In these notebooks you can see that multi-line dfns are defined in cells that start with <code class="docutils literal notranslate"><span class="pre">]dinput</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Average</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷≢</span><span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>In the Windows interpreter an expression like the one above might result in a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code>, as you type <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">←</span> <span class="pre">{</span></code>, then hit <kbd>Enter</kbd> to change line, and then the interpreter tries to execute the line you entered, instead of allowing you to continue the definition of <code class="docutils literal notranslate"><span class="pre">Average</span></code>. To change this behaviour and allow for multi-line dfns, you can go to “Options” ⇨ “Configure…” ⇨ “Session” and check the experimental multi-line input box at the bottom.</p>
<p>If you are using RIDE and this capability is not ON by default, you can turn it ON by setting the <code class="docutils literal notranslate"><span class="pre">DYALOG_LINEEDITOR_MODE</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">1</span></code> in the connection menu, like demonstrated in <a class="reference internal" href="#fig-ride-enable-multiline-input"><span class="std std-numref">Fig. 4.6</span></a>.</p>
<div class="figure align-default" id="ride-enable-multiline-input">
<span id="fig-ride-enable-multiline-input"></span><img alt="_images/RIDE_Enable_Multiline_Input.png" src="_images/RIDE_Enable_Multiline_Input.png" />
<p class="caption"><span class="caption-number">Fig. 4.6 </span><span class="caption-text">Configuring RIDE to allow for multi-line input</span><a class="headerlink" href="#ride-enable-multiline-input" title="Permalink to this image">¶</a></p>
</div>
<p>Secondly, even if multi-line input is enabled, you have to be very careful not to press <kbd>Enter</kbd> and <em><strong>fix</strong></em> the dfn by mistake. This is not a terrible blunder but it does lose some time and breaks your train of thought. In APL, to <em><strong>fix</strong></em> a file means to define the variables (data, functions and operators) in the file and to make them available in the session. Hence, to fix a function means assigning it to a name and making it available for use in the session window.</p>
<p>For these reasons, it is more appropriate to edit multi-line dfns and tradfns in a suitable text editor. The built-in editors for the Windows interpreter and for RIDE are likely to be suitable for you, but other alternatives exist. You can find an enumeration of most of the available alternatives over at <a class="reference external" href="https://aplwiki.com/wiki/Text_editors">the APL Wiki</a>. We will also cover this in more depth in <span class="xref myst">the chapter about source code management</span>.</p>
</div>
</div>
</div>
<div class="section" id="simple-dfns">
<span id="user-defined-functions-simple-dfns"></span><h2><span class="section-number">4.2. </span>Simple Dfns<a class="headerlink" href="#simple-dfns" title="Permalink to this headline">¶</a></h2>
<div class="section" id="definition">
<span id="user-defined-functions-definition"></span><h3><span class="section-number">4.2.1. </span>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">¶</a></h3>
<p>Dfns are a set of statements enclosed by curly braces <code class="docutils literal notranslate"><span class="pre">{}</span></code>, so a simple dfn is typically created with the syntax <code class="docutils literal notranslate"><span class="pre">Name</span> <span class="pre">←</span> <span class="pre">{</span> <span class="pre">definition</span> <span class="pre">}</span></code> where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Name</span></code> is the function name. It is followed by a definition, delimited by a pair of curly braces <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code>. This definition may make use of one or two variables named <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code>, which represent the values to be processed. <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code> are called <em><strong>arguments</strong></em> of the function;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍵</span></code> (<kbd>APL</kbd>+<kbd>w</kbd>) is a generic symbol which represents the right argument of the function;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍺</span></code> (<kbd>APL</kbd>+<kbd>a</kbd>) is a generic symbol which represents the left argument if the function is dyadic.</p></li>
</ul>
<p>Here is an example monadic dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Average</span> <span class="kd">←</span> <span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>And here are two more dyadic dfns, and an example showing how they can be used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Plus</span> <span class="kd">←</span> <span class="kt">{</span><span class="bp">⍺</span> <span class="o">+</span> <span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">Times</span> <span class="kd">←</span> <span class="kt">{</span><span class="bp">⍺</span> <span class="o">×</span> <span class="bp">⍵</span><span class="kt">}</span>
<span class="m">3</span> <span class="nv">Times</span> <span class="m">7</span> <span class="nv">Plus</span> <span class="m">9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">48
</span></div></div>
</div>
<p>Notice the final statement above is strictly equivalent to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span> <span class="o">×</span> <span class="m">7</span> <span class="o">+</span> <span class="m">9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">48
</span></div></div>
</div>
<p>as the order of evaluation is the same.</p>
<p>The arguments <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code> are read-only (they cannot be reassigned) and are limited in scope to only being visible within the function itself. The only exception to the “read-only rule” is when providing a default left argument to the dfn, which we’ll cover in <a class="reference internal" href="#user-defined-functions-default-left-argument"><span class="std std-numref">Section 4.3.4</span></a>.</p>
<p>The developer does not need to declare anything about the shape or internal representation of the arguments and the result. This information is automatically obtained from the arrays provided as its arguments. This is similar to the behaviour of dynamically typed programming languages, such as Python or Javascript. So, our functions can work on any arrays.</p>
<p>A scalar added to a matrix returns a matrix. No need to specify it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">12</span> <span class="nv">Plus</span> <span class="m">2</span> <span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 14 15
16 17 18
</span></div></div>
</div>
<p>And a vector of integer numbers multiplied by a scalar fractional number returns a vector of fractional numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7.3</span> <span class="nv">Times</span> <span class="m">10</span> <span class="m">34</span> <span class="m">52</span> <span class="m">16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">73 248.2 379.6 116.8
</span></div></div>
</div>
<p>These simple dfns are well suited for pure calculations of straightforward array manipulation. For example, here is how we can calculate the hypotenuse of a right-angled triangle from the lengths of the two other sides:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Hypo</span> <span class="kd">←</span> <span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="o">*</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="m">0.5</span><span class="kt">}</span>
<span class="nv">Hypo</span> <span class="m">3</span> <span class="m">4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Hypo</span> <span class="m">12</span> <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13
</span></div></div>
</div>
</div>
<div class="section" id="unnamed-dfns">
<span id="user-defined-functions-unnamed-dfns"></span><h3><span class="section-number">4.2.2. </span>Unnamed Dfns<a class="headerlink" href="#unnamed-dfns" title="Permalink to this headline">¶</a></h3>
<p>A dfn can be defined and then discarded immediately after it has been used, in which case it does not need a name. For example, the geometric mean of a set of <span class="math notranslate nohighlight">\(N\)</span> values is defined as the <span class="math notranslate nohighlight">\(N^\text{th}\)</span> root of their product. The function can be defined and used inline like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">*÷≢</span><span class="bp">⍵</span><span class="kt">}</span> <span class="m">6</span> <span class="m">8</span> <span class="m">4</span> <span class="m">11</span> <span class="m">9</span> <span class="m">14</span> <span class="m">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7.8657
</span></div></div>
</div>
<p>But because we didn’t assign it to a name, it was discarded after being used and can’t be used again. This kind of function is similar to <em>inline</em> or <em>lambda</em> functions in other languages.</p>
<p>A special case is <code class="docutils literal notranslate"><span class="pre">{}</span></code>. This function does nothing but placed at the left of an expression, it can be used to prevent the result of the expression from being displayed on the screen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span> <span class="nv">Plus</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{}</span> <span class="m">3</span> <span class="nv">Plus</span> <span class="m">3</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="modifying-the-code">
<span id="user-defined-functions-modifying-the-code"></span><h3><span class="section-number">4.2.3. </span>Modifying The Code<a class="headerlink" href="#modifying-the-code" title="Permalink to this headline">¶</a></h3>
<p>Single line dfns may be modified using the function editor, as will be explained in the next section. They can also be redefined entirely, as many times as necessary, as shown:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Magic</span> <span class="kd">←</span> <span class="kt">{</span><span class="bp">⍺</span><span class="o">+</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Magic</span> <span class="kd">←</span> <span class="kt">{</span><span class="bp">⍺</span><span class="o">÷+</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Magic</span> <span class="kd">←</span> <span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍺</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>We defined <code class="docutils literal notranslate"><span class="pre">Magic</span></code> and then changed it twice. Only the most recent definition will survive.</p>
<p>Now we will delve into how to define and use more complex dfns. For this we will explore the built-in editor that comes with your interpreter and you will also learn some more syntax to empower your dfns.</p>
</div>
</div>
<div class="section" id="more-on-dfns">
<span id="user-defined-functions-more-on-dfns"></span><h2><span class="section-number">4.3. </span>More on Dfns<a class="headerlink" href="#more-on-dfns" title="Permalink to this headline">¶</a></h2>
<p>The dfns we wrote in the previous section were very simple and consisted of a single statement. We will now use the text editor to define multi-line dfns.</p>
<div class="section" id="characteristics">
<span id="user-defined-functions-characteristics"></span><h3><span class="section-number">4.3.1. </span>Characteristics<a class="headerlink" href="#characteristics" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Generally, the opening and closing braces are placed alone on the first and last lines. This is not mandatory, it is just a convention;</p></li>
<li><p>dfns might be commented at will;</p></li>
<li><p>one can create as many variables as needed: they are automatically deemed to be local variables, which means they only exist while inside the dfn. Note that this is opposite to the default behaviour of tradfns, where all variables are global (cf. <a class="reference internal" href="#user-defined-functions-local-variables"><span class="std std-numref">Section 4.3.3</span></a> and <code class="xref std std-numref docutils literal notranslate"><span class="pre">User-Defined-Functions-Local-Names</span></code>);</p></li>
<li><p>the arguments <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and <code class="docutils literal notranslate"><span class="pre">⍺</span></code> retain the values passed to them as arguments and may not be changed. Any attempt to modify them causes a <code class="docutils literal notranslate"><span class="pre">SYNTAX</span> <span class="pre">ERROR</span></code> to be reported, except when <em>defaulting the left argument</em> (cf. <a class="reference internal" href="#user-defined-functions-default-left-argument"><span class="std std-numref">Section 4.3.4</span></a>);</p></li>
<li><p>as soon as an expression generates a result that is not assigned to a name or used in any other way, the function terminates, and the value of that expression is returned as the result of the function. If the function contains more lines they will not be executed (cf. <code class="xref std std-numref docutils literal notranslate"><span class="pre">User-Defined-Functions-Returning-a-Result</span></code>);</p></li>
<li><p>traditional <em>control structures</em> and <em>branching</em> cannot be used in dfns (cf. <a class="reference internal" href="#user-defined-functions-guards"><span class="std std-numref">Section 4.5.1</span></a>).</p></li>
</ul>
<p>We will explore these characteristics in the following sections.</p>
</div>
<div class="section" id="a-working-example">
<span id="user-defined-functions-a-working-example"></span><h3><span class="section-number">4.3.2. </span>A Working Example<a class="headerlink" href="#a-working-example" title="Permalink to this headline">¶</a></h3>
<p>As an example, let us see how we could define a function to calculate the <em>harmonic mean</em> of a vector of numbers. The harmonic mean of a vector is the inverse of the sum of the inverses of the numbers in the vector. This will become clearer when you see the code.</p>
<p>First of all, we must choose a name for our new function. We will choose to name it <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code>.</p>
<p>Among the multiple ways of invoking the text editor, let us use a very simple one: type the command <code class="docutils literal notranslate"><span class="pre">)ED</span></code> followed by a space and the name of the function to create: <code class="docutils literal notranslate"><span class="pre">)ED</span> <span class="pre">HarmonicMean</span></code>.</p>
<p>Unless you already redefined the defaults, a mostly empty window should open to the right of the session. We include an example screenshot of such a window from the Windows interpreter in <a class="reference internal" href="#fig-win-editor"><span class="std std-numref">Fig. 4.7</span></a>:</p>
<div class="figure align-default" id="win-editor">
<span id="fig-win-editor"></span><img alt="_images/Win_Editor.png" src="_images/Win_Editor.png" />
<p class="caption"><span class="caption-number">Fig. 4.7 </span><span class="caption-text">The edit window opened by the command <code class="docutils literal notranslate"><span class="pre">)ED</span> <span class="pre">HarmonicMean</span></code></span><a class="headerlink" href="#win-editor" title="Permalink to this image">¶</a></p>
</div>
<p>Now that we have a window in which to define our dfn, we can go ahead and implement the harmonic mean. We shall split the process into a series of simple steps, as shown in <a class="reference internal" href="#fig-win-editor-harmonic-mean"><span class="std std-numref">Fig. 4.8</span></a>: calculate the inverses, sum them, invert the sum.</p>
<div class="figure align-default" id="win-editor-harmonic-mean">
<span id="fig-win-editor-harmonic-mean"></span><img alt="_images/Win_Editor_Harmonic_Mean.png" src="_images/Win_Editor_Harmonic_Mean.png" />
<p class="caption"><span class="caption-number">Fig. 4.8 </span><span class="caption-text">The <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function defined in the edit window</span><a class="headerlink" href="#win-editor-harmonic-mean" title="Permalink to this image">¶</a></p>
</div>
<p>We also define it in this notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">HarmonicMean</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">inverses</span> <span class="kd">←</span> <span class="o">÷</span><span class="bp">⍵</span>
    <span class="nv">sum</span> <span class="kd">←</span> <span class="o">+</span><span class="na">/</span><span class="nv">inverses</span>
    <span class="o">÷</span><span class="nv">sum</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we know how to compute the harmonic mean of a vector of numbers, we just have to <em><strong>fix</strong></em> it so that we can use it in our session. <em><strong>Fixing</strong></em> a function is somewhat analogous to compilation in other programming languages, but can also be seen as a sort of “File save” followed by an “import” in interpreted languages. There are many ways to fix a function:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Interpreter</p></th>
<th class="text-align:left head"><p><em>Fix</em> method</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Windows interpreter</p></td>
<td class="text-align:left"><p>go to “File” ⇨ “Fix”</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>RIDE</p></td>
<td class="text-align:left"><p>right-click the edit window ⇨ “Fix”</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>both</p></td>
<td class="text-align:left"><p>press <kbd>Esc</kbd> (also closes the edit window)</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>both</p></td>
<td class="text-align:left"><p>define a custom keyboard shortcut</p></td>
</tr>
</tbody>
</table>
<p>Following one of the appropriate methods should make the <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function available for use in the session window. You can make sure it worked by simply typing in the name of the function and pressing <kbd>Enter</kbd> in the session:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">{                  
     inverses←÷⍵   
     sum←+/inverses
     ÷sum          
 }                 
</span></div></div>
</div>
<p>If instead of getting the source code of the function you get a <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code>, then the function wasn’t properly fixed.</p>
<p>Now that we can compute the harmonic mean of a vector of numbers, we can answer questions like the following:</p>
<p>“<em>If I take 6 hours to paint a wall and you take 2 hours, how much time will we need to paint the wall if we do it together?</em>”</p>
<p>This type of question can be answered by taking the harmonic mean of the individual times:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span> <span class="m">6</span> <span class="m">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.5
</span></div></div>
</div>
<p>So the two of us would take 1h30min to paint the whole wall.</p>
<p>Similarly, if we had further help from two people who could paint the whole wall in 4 and 5 hours, respectively, the four of us would need</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">times</span> <span class="kd">←</span> <span class="m">6</span> <span class="m">2</span> <span class="m">4</span> <span class="m">5</span>
<span class="o">⊢</span><span class="nv">hours</span> <span class="kd">←</span> <span class="nv">HarmonicMean</span> <span class="nv">times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
<p>hours, or approximately</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="m">60</span><span class="o">×</span><span class="nv">hours</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">53
</span></div></div>
</div>
<p>minutes.</p>
<p>After using your function for a bit you realise it is over-complicated, in the sense that it involves too many intermediate steps and you wish to get rid of those. If your edit window is still open, you can simply edit the function and fix it again. If the edit window was closed, you can type <code class="docutils literal notranslate"><span class="pre">)ED</span> <span class="pre">HarmonicMean</span></code> again or you can double-click the name <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> in the session. Both options will open the appropriate edit window.</p>
<p>After having done so, perhaps you rewrite your function to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">HarmonicMean</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">inverses</span> <span class="kd">←</span> <span class="o">÷</span><span class="bp">⍵</span>
    <span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Then you fix it and use it again a couple of times:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span> <span class="nv">times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span> <span class="m">4</span> <span class="m">3</span> <span class="m">2</span> <span class="m">1</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DOMAIN ERROR: Divide by zero
HarmonicMean[1] inverses←÷⍵
                         ∧
</pre></div>
</div>
</div>
</div>
<p>But now it resulted in an error, and the error messages says <code class="docutils literal notranslate"><span class="pre">HarmonicMean[1]</span> <span class="pre">inverses←÷⍵</span></code>. This <code class="docutils literal notranslate"><span class="pre">HarmonicMean[1]</span></code> means the error was in line 1 of the <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function. Right next to it, it also shows the part of the code that caused the error, but supposed you had a really long file, perhaps with multiple functions. How would you find the appropriate line in the first place?</p>
<p>Thankfully, both RIDE and the Windows interpreter have an option that can be set to display line numbers (cf. <a class="reference internal" href="#fig-editors-toggle-line-numbers"><span class="std std-numref">Fig. 4.9</span></a>).</p>
<div class="figure align-default" id="editors-toggle-line-numbers">
<span id="fig-editors-toggle-line-numbers"></span><img alt="_images/Editors_Toggle_Line_Numbers.png" src="_images/Editors_Toggle_Line_Numbers.png" />
<p class="caption"><span class="caption-number">Fig. 4.9 </span><span class="caption-text">Option to toggle line numbers in RIDE (to the right) and the Windows interpreter (to the left)</span><a class="headerlink" href="#editors-toggle-line-numbers" title="Permalink to this image">¶</a></p>
</div>
<p>Different people like to comment their code in different ways, and naturally dfns can be commented. For illustrative purposes, consider the dfn that follows, which has comments before any statement, inline with some statements, between the statements and at the end of the dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">HarmonicMean</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="c1">⍝ Monadic function to compute the harmonic mean of a vector</span>
    <span class="nv">inverses</span> <span class="kd">←</span> <span class="o">÷</span><span class="bp">⍵</span>   <span class="c1">⍝ This inverts the numbers in the argument</span>
    <span class="c1">⍝ and then</span>
    <span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span>     <span class="c1">⍝ we sum those inverses and return them.</span>
    <span class="c1">⍝ Of course this will give an error if 0 is in the input argument.</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>The comments do <em>not</em> affect the behaviour of the function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span> <span class="nv">times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
</div>
<div class="section" id="local-variables">
<span id="user-defined-functions-local-variables"></span><h3><span class="section-number">4.3.3. </span>Local Variables<a class="headerlink" href="#local-variables" title="Permalink to this headline">¶</a></h3>
<p>Notice that our <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> function makes use of an intermediate variable, <code class="docutils literal notranslate"><span class="pre">inverses</span></code>. Let us check its value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: inverses
      inverses
      ∧
</pre></div>
</div>
</div>
</div>
<p>We got a <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code> because <code class="docutils literal notranslate"><span class="pre">inverses</span></code> isn’t defined. It is a <em><strong>local variable</strong></em>, that is, a variable that lives within the dfn only while the dfn is being executed. As soon as we exit the dfn the variable stops existing.</p>
<p>The notion of <em>local</em> variable is opposed to the notion of <em><strong>global variable</strong></em>, which is a variable that lives in the session and thus can be accessed from anywhere. Useful global variables are functions themselves, because defining them globally means they can be used from within other functions.</p>
<p>As an example, we already defined the functions <code class="docutils literal notranslate"><span class="pre">Average</span></code> and <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> in the session. Let us now define a dfn named <code class="docutils literal notranslate"><span class="pre">AMHM</span></code> that checks empirically a mathematical theorem: that the arithmetic mean is always larger than or equal to the harmonic mean of a set of numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">AMHM</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">am</span> <span class="kd">←</span> <span class="nv">Average</span> <span class="bp">⍵</span>
    <span class="nv">hm</span> <span class="kd">←</span> <span class="nv">HarmonicMean</span> <span class="bp">⍵</span>
    <span class="nv">am</span> <span class="o">≥</span> <span class="nv">hm</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">AMHM</span> <span class="o">⍳</span><span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">AMHM</span> <span class="nv">times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Notice how the definition of <code class="docutils literal notranslate"><span class="pre">AMHM</span></code> uses both the <code class="docutils literal notranslate"><span class="pre">Average</span></code> and <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> dfns without defining them inside <code class="docutils literal notranslate"><span class="pre">AMHM</span></code>. This works because they were previously defined in the session.</p>
<p>For larger applications, proper source code management is needed and you should make sure the functions <code class="docutils literal notranslate"><span class="pre">Average</span></code> and <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> have been fixed when you use them inside <code class="docutils literal notranslate"><span class="pre">AMHM</span></code>, but for illustrative purposes this is absolutely fine.</p>
</div>
<div class="section" id="default-left-argument">
<span id="user-defined-functions-default-left-argument"></span><h3><span class="section-number">4.3.4. </span>Default Left Argument<a class="headerlink" href="#default-left-argument" title="Permalink to this headline">¶</a></h3>
<p>It was mentioned above that the values of <code class="docutils literal notranslate"><span class="pre">⍺</span></code> and <code class="docutils literal notranslate"><span class="pre">⍵</span></code>, the variables that represent the arguments to a dfn, cannot be assigned to. The only exception to this is when specifying a default left argument. This is relevant because a dyadic dfn can always be used monadically, as from the syntactic point of view its left argument <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is always optional. If the left argument is not present it is possible to assign a default value to <code class="docutils literal notranslate"><span class="pre">⍺</span></code> by means of a normal assignment. If <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is given a value because the dfn was called dyadically, such assignment is skipped.</p>
<p>Consider a function which calculates the <span class="math notranslate nohighlight">\(N^\text{th}\)</span> root of a number, but which is normally used to calculate square roots (<span class="math notranslate nohighlight">\(N = 2\)</span>). You can specify that the default value of the left argument (when omitted) is 2, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Root</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="bp">⍺</span> <span class="kd">←</span> <span class="m">2</span>
    <span class="bp">⍵</span><span class="o">*÷</span><span class="bp">⍺</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>If we don’t specify the left argument of <code class="docutils literal notranslate"><span class="pre">Root</span></code>, it computes the square root:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Root</span> <span class="m">625</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">25
</span></div></div>
</div>
<p>But if we specify <code class="docutils literal notranslate"><span class="pre">⍺</span></code>, then the <code class="docutils literal notranslate"><span class="pre">⍺</span> <span class="pre">←</span> <span class="pre">2</span></code> assignment is skipped:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span> <span class="nv">Root</span> <span class="m">625</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<p>Because the assignment with <code class="docutils literal notranslate"><span class="pre">⍺←</span></code> is skipped entirely if <code class="docutils literal notranslate"><span class="pre">⍺</span></code> was provided, you should be careful with any side effects the expression to the right of <code class="docutils literal notranslate"><span class="pre">⍺←</span></code> might produce. We illustrate this with the following (silly) example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Silly</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">a</span> <span class="kd">←</span> <span class="m">1</span>        <span class="c1">⍝ This assignment always happens</span>
    <span class="bp">⍺</span> <span class="kd">←</span> <span class="nv">a</span> <span class="kd">←</span> <span class="m">2</span>    <span class="c1">⍝ Not executed if ⍺ already has a value</span>
    <span class="nv">a</span>            <span class="c1">⍝ Return a</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Silly</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<p>Because we didn’t provide a left argument, the <code class="docutils literal notranslate"><span class="pre">⍺</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">←</span> <span class="pre">2</span></code> line is executed and <code class="docutils literal notranslate"><span class="pre">a</span></code> becomes 2.</p>
<p>On the other hand, if we provide a left argument the <code class="docutils literal notranslate"><span class="pre">⍺</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">←</span> <span class="pre">2</span></code> line is skipped and <code class="docutils literal notranslate"><span class="pre">a</span></code> remains 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span> <span class="nv">Silly</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>As for <code class="docutils literal notranslate"><span class="pre">⍵</span></code>, attempting to assign to <code class="docutils literal notranslate"><span class="pre">⍵</span></code> makes no sense: a dfn is always called monadically <em>or</em> dyadically, so the right argument is <em>always</em> present. Here’s a function that computes the square root of <code class="docutils literal notranslate"><span class="pre">⍵</span></code>, except that first it tries to assign 10 to <code class="docutils literal notranslate"><span class="pre">⍵</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">RootOf10</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="bp">⍵</span> <span class="kd">←</span> <span class="m">10</span>
    <span class="bp">⍵</span><span class="o">*</span><span class="m">0.5</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Simply typing the name of the function shows its code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RootOf10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">{         
     ⍵←10 
     ⍵*0.5
 }        
</span></div></div>
</div>
<p>And calling it monadically raises an error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RootOf10</span> <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SYNTAX ERROR
RootOf10[1] ⍵←10
             ∧
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="returning-the-result">
<span id="user-defined-functions-returning-the-result"></span><h3><span class="section-number">4.3.5. </span>Returning the Result<a class="headerlink" href="#returning-the-result" title="Permalink to this headline">¶</a></h3>
<p>We mentioned above that a dfn executes its statements until the first statement that does not assign its value. Here is a curious dfn with 4 statements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Count</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="m">1</span>
    <span class="m">2</span>
    <span class="m">3</span>
    <span class="m">10</span><span class="o">÷</span><span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that all four statements are simple. If we run <code class="docutils literal notranslate"><span class="pre">Count</span></code>, what will the result be?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Count</span> <span class="m">73</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The result we get is 1 because the first statement evaluates to 1 (obviously) and then we do nothing with it, so that is what the dfn returns. It doesn’t matter what we wrote afterwards and it doesn’t even matter that the very last statement would give a <code class="docutils literal notranslate"><span class="pre">DOMAIN</span> <span class="pre">ERROR</span></code>.</p>
<p>These superfluous statements should be avoided, as they will sooner or later cause unnecessary confusion.</p>
<p>As a basic debugging tool, it is possible to modify statements to display intermediate results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Count</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="vg">⎕</span><span class="kd">←</span><span class="m">1</span>
    <span class="vg">⎕</span><span class="kd">←</span><span class="m">2</span>
    <span class="vg">⎕</span><span class="kd">←</span><span class="m">3</span>
    <span class="m">10</span><span class="o">÷</span><span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Count</span> <span class="m">73</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
2
3
DOMAIN ERROR: Divide by zero
Count[4] 10÷0
           ∧
</pre></div>
</div>
</div>
</div>
<p>Be careful: by using <code class="docutils literal notranslate"><span class="pre">⎕←</span></code> to display intermediate results, suddenly we are doing <em>something</em> with the superfluous statements and they are all being executed (we even reached the error statement).</p>
<p>And even if we remove the statement that gives an error, the function will still return something other than the original 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Count</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="vg">⎕</span><span class="kd">←</span><span class="m">1</span>
    <span class="vg">⎕</span><span class="kd">←</span><span class="m">2</span>
    <span class="m">3</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Count</span> <span class="m">73</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
2
3
</span></div></div>
</div>
<p>Now the function returned 3 instead of 1! So always be careful with which statement is actually giving the final result and avoid any extraneous statements.</p>
</div>
</div>
<div class="section" id="preliminary-exercises">
<span id="user-defined-functions-preliminary-exercises"></span><h2><span class="section-number">4.4. </span>Preliminary exercises<a class="headerlink" href="#preliminary-exercises" title="Permalink to this headline">¶</a></h2>
<p>You are ready to solve simple problems. We <strong>strongly recommend</strong> that you try to solve all the following exercises before you continue further in this chapter.</p>
<p><strong>Exercise 1</strong>:</p>
<p>Write a dyadic function <code class="docutils literal notranslate"><span class="pre">Extract</span></code> which returns the first <code class="docutils literal notranslate"><span class="pre">⍺</span></code> items of any given vector <code class="docutils literal notranslate"><span class="pre">⍵</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Extract</span> <span class="kd">←</span> <span class="kt">{}</span>
<span class="m">3</span> <span class="nv">Extract</span> <span class="m">45</span> <span class="m">86</span> <span class="m">31</span> <span class="m">20</span> <span class="m">75</span> <span class="m">62</span> <span class="m">18</span>  <span class="c1">⍝ should give 45 86 31</span>
<span class="m">6</span> <span class="nv">Extract</span> <span class="s1">&#39;can you do it?&#39;</span>      <span class="c1">⍝ should give &#39;can yo&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 2</strong>:</p>
<p>Write a dyadic function which ignores the first <code class="docutils literal notranslate"><span class="pre">⍺</span></code> items of any given vector <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and only returns the remainder:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Ignore</span> <span class="kd">←</span> <span class="kt">{}</span>
<span class="m">3</span> <span class="nv">Ignore</span> <span class="m">45</span> <span class="m">86</span> <span class="m">31</span> <span class="m">20</span> <span class="m">75</span> <span class="m">62</span> <span class="m">18</span>   <span class="c1">⍝ should give 20 75 62 18</span>
<span class="m">6</span> <span class="nv">Ignore</span> <span class="s1">&#39;can you do it?&#39;</span>       <span class="c1">⍝ should give &#39;u do it?&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 3</strong>:</p>
<p>Write a monadic function which returns the items of a vector in reverse order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Reverse</span> <span class="kd">←</span> <span class="kt">{}</span>
<span class="nv">Reverse</span> <span class="s1">&#39;snoitalutargnoc&#39;</span>       <span class="c1">⍝ should give &#39;congratulations&#39;</span>
<span class="nv">Reverse</span> <span class="s1">&#39;!ti did uoY&#39;</span>           <span class="c1">⍝ should give &#39;You did it!&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 4</strong>:</p>
<p>Write a monadic function which appends row and column totals to a numeric matrix.</p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">mat</span></code> is the matrix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">mat</span> <span class="kd">←</span> <span class="m">3</span> <span class="m">4</span><span class="o">⍴</span><span class="m">75</span> <span class="m">14</span> <span class="m">86</span> <span class="m">20</span> <span class="m">31</span> <span class="m">16</span> <span class="m">40</span> <span class="m">51</span> <span class="m">22</span> <span class="m">64</span> <span class="m">31</span> <span class="m">28</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">75 14 86 20
31 16 40 51
22 64 31 28
</span></div></div>
</div>
<p>Then <code class="docutils literal notranslate"><span class="pre">Totalise</span> <span class="pre">mat</span></code> should give</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">totMat</span> <span class="kd">←</span> <span class="m">4</span> <span class="m">5</span><span class="o">⍴</span><span class="m">75</span> <span class="m">14</span> <span class="m">86</span> <span class="m">20</span> <span class="m">195</span> <span class="m">31</span> <span class="m">16</span> <span class="m">40</span> <span class="m">51</span> <span class="m">138</span> <span class="m">22</span> <span class="m">64</span> <span class="m">31</span> <span class="m">28</span> <span class="m">145</span> <span class="m">128</span> <span class="m">94</span> <span class="m">157</span> <span class="m">99</span> <span class="m">478</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 75 14  86 20 195
 31 16  40 51 138
 22 64  31 28 145
128 94 157 99 478
</span></div></div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">mat</span></code> occupies the upper left corner of <code class="docutils literal notranslate"><span class="pre">totMat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">totMat</span> <span class="o">∊</span> <span class="nv">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 0
1 1 1 1 0
1 1 1 1 0
0 0 0 0 0
</span></div></div>
</div>
<p><strong>Exercise 5</strong>:</p>
<p>Write a monadic function which returns the lengths of the words contained in a text vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span> <span class="kd">←</span> <span class="kt">{}</span>
<span class="nv">Lengths</span> <span class="s1">&#39;This seems to be a good solution&#39;</span>    <span class="c1">⍝ should give 4 5 2 2 1 4 8</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 6</strong>:</p>
<p>Write a dyadic function which produces the series of integer values between the limits given by its two arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">To</span> <span class="kd">←</span> <span class="kt">{}</span>
<span class="m">17</span> <span class="nv">To</span> <span class="m">29</span>    <span class="c1">⍝ should give 17 18 19 20 21 22 23 24 25 26 27 28 29</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 7</strong>:</p>
<p>Develop a monadic function which puts a frame around a text matrix. For the first version, just concatenate minus signs above and under the matrix, and vertical bars down both sides. Then, update the function to replace the four corners by four <code class="docutils literal notranslate"><span class="pre">+</span></code> signs. For example, with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">towns</span> <span class="kd">←</span> <span class="m">6</span> <span class="m">10</span><span class="o">⍴</span><span class="s1">&#39;Canberra  Paris     WashingtonMoscow    Martigues Mexico    &#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  
Paris     
Washington
Moscow    
Martigues 
Mexico    
</span></div></div>
</div>
<p>we want to have <code class="docutils literal notranslate"><span class="pre">Frame</span> <span class="pre">towns</span></code> return</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+</span>
<span class="o">|</span><span class="n">Canberra</span>  <span class="o">|</span>
<span class="o">|</span><span class="n">Paris</span>     <span class="o">|</span>
<span class="o">|</span><span class="n">Washington</span><span class="o">|</span>
<span class="o">|</span><span class="n">Moscow</span>    <span class="o">|</span>
<span class="o">|</span><span class="n">Martigues</span> <span class="o">|</span>
<span class="o">|</span><span class="n">Mexico</span>    <span class="o">|</span>
<span class="o">+----------+</span>
</pre></div>
</div>
<p>Finally, you can improve the appearance of the result by changing the function to use line-drawing symbols. You enter line-drawing symbols by using <code class="docutils literal notranslate"><span class="pre">⎕UCS</span></code>: the horizontal and vertical lines are</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕UCS</span> <span class="m">9472</span> <span class="m">9474</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">─│
</span></div></div>
</div>
<p>and the four corners are</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕UCS</span> <span class="m">9484</span> <span class="m">9488</span> <span class="m">9492</span> <span class="m">9496</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┐└┘
</span></div></div>
</div>
<p>The final result should look like</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ ┌──────────┐</span>
<span class="c1">⍝ │Canberra  │</span>
<span class="c1">⍝ │Paris     │</span>
<span class="c1">⍝ │Washington│</span>
<span class="c1">⍝ │Moscow    │</span>
<span class="c1">⍝ │Martigues │</span>
<span class="c1">⍝ │Mexico    │</span>
<span class="c1">⍝ └──────────┘</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 8</strong>:</p>
<p>It is very likely that the function you wrote for the previous exercise works on matrices but not on vectors. Can you make it work on both?</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">Frame</span> <span class="pre">'We</span> <span class="pre">are</span> <span class="pre">not</span> <span class="pre">out</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">wood'</span></code> should give</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ ┌──────────────────────────┐</span>
<span class="c1">⍝ │We are not out of the wood│</span>
<span class="c1">⍝ └──────────────────────────┘</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 9</strong>:</p>
<p>Write a function which replaces a given letter by another one in a text vector. The letter to replace is given first; the replacing letter is given second, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Switch1</span> <span class="kd">←</span> <span class="kt">{}</span>
<span class="s1">&#39;tc&#39;</span> <span class="nv">Switch1</span> <span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span>
<span class="c1">⍝ A bird in che hand is worch cwo in che bush</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise 10</strong>:</p>
<p>Modify the previous function so that it commutes the two letters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Switch2</span> <span class="kd">←</span> <span class="kt">{}</span>
<span class="s1">&#39;ei&#39;</span> <span class="nv">Switch2</span> <span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span>
<span class="c1">⍝ A berd en thi hand es worth two en thi bush</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dfns-in-depth">
<span id="user-defined-functions-dfns-in-depth"></span><h2><span class="section-number">4.5. </span>Dfns in Depth<a class="headerlink" href="#dfns-in-depth" title="Permalink to this headline">¶</a></h2>
<p>In this section we will cover a couple of more advanced subtleties about dfns, and then we will move on to learn about tradfns.</p>
<div class="section" id="guards">
<span id="user-defined-functions-guards"></span><h3><span class="section-number">4.5.1. </span>Guards<a class="headerlink" href="#guards" title="Permalink to this headline">¶</a></h3>
<p>Previously we said that control structures cannot be used in dfns. However, it is possible to have a dfn conditionally calculate a result, by using a <em><strong>Guard</strong></em>.</p>
<p>A <em>guard</em> is any expression which generates a one-item Boolean result, followed by a colon.</p>
<p>The expression placed to the right of a <em>guard</em> is executed only if the <em>guard</em> is true. In a dfn, this looks like <code class="docutils literal notranslate"><span class="pre">guard:</span> <span class="pre">expr</span></code> and is similar to a</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">guard</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">expr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>of some traditional programming languages.</p>
<p>For example, this function will give a result equal to <code class="docutils literal notranslate"><span class="pre">'Positive'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Zero'</span></code> or <code class="docutils literal notranslate"><span class="pre">'Negative'</span></code> if the argument <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is respectively greater than, equal to, or smaller than zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Sign</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="bp">⍵</span><span class="o">&gt;</span><span class="m">0</span><span class="bp">:</span> <span class="s1">&#39;Positive&#39;</span>
    <span class="bp">⍵</span><span class="o">=</span><span class="m">0</span><span class="bp">:</span> <span class="s1">&#39;Zero&#39;</span>
    <span class="s1">&#39;Negative&#39;</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Positive
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="m">¯3.6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Negative
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Zero
</span></div></div>
</div>
</div>
<div class="section" id="shy-result">
<span id="user-defined-functions-shy-result"></span><h3><span class="section-number">4.5.2. </span>Shy Result<a class="headerlink" href="#shy-result" title="Permalink to this headline">¶</a></h3>
<p>Dfns can be written in such a way that they return a <em><strong>Shy result</strong></em>. A <em>shy result</em> is a result which is returned, but not displayed by default.</p>
<p>Consider a function which deletes a file from disk and returns a result equal to 1 (file deleted) or 0 (file not found). Usually, one doesn’t care if the file did not exist, so the result is not needed. But sometimes it may be important to check whether the file really existed and has been removed. So, sometimes a result is useless and sometimes it is useful… this is the reason why shy results have been invented.</p>
<p>In a dfn, a shy result happens when the last expression that is evaluated is assigned to a (local) name, as opposed to just leaving the result of the expression unassigned. For this to happen, one has to be careful to leave the closing curly brace <code class="docutils literal notranslate"><span class="pre">}</span></code> next to that final statement, instead of having <code class="docutils literal notranslate"><span class="pre">}</span></code> alone in a new line.</p>
<p>Here is the function above, written without guards and with a shy result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="kd">←</span> <span class="kt">{</span> <span class="nv">s</span> <span class="kd">←</span> <span class="p">(</span><span class="m">3</span> <span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;NegativeZero    Positive&#39;</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="o">+×</span><span class="bp">⍵</span><span class="sr">;]</span> <span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="m">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="m">¯3.6</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span> <span class="nv">Sign</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Zero    
</span></div></div>
</div>
<p>Notice what happens if we were to format <code class="docutils literal notranslate"><span class="pre">Sign</span></code> as we have formatted previous dfns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Sign</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">s</span> <span class="kd">←</span> <span class="p">(</span><span class="m">3</span> <span class="m">8</span><span class="o">⍴</span><span class="s1">&#39;NegativeZero    Positive&#39;</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="o">+×</span><span class="bp">⍵</span><span class="sr">;]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="m">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sign</span> <span class="m">¯3.6</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span> <span class="nv">Sign</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: No result was provided when the context expected one
      ⎕←Sign 0
        ∧
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code> we get above is a very subtle error. Because the <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">←</span> <span class="pre">...</span></code> statement is an assignment, when executing the <code class="docutils literal notranslate"><span class="pre">Sign</span></code> dfn the interpreter goes on to execute the expression on the next line, but the next line has <em>no</em> expression and so the interpreter raises a <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code>. If we want to have a shy result on a multi-line dfn, we <em>must</em> have the final curly brace on the same line as the final statement.</p>
</div>
<div class="section" id="lexical-scoping">
<span id="user-defined-functions-lexical-scoping"></span><h3><span class="section-number">4.5.3. </span>Lexical Scoping<a class="headerlink" href="#lexical-scoping" title="Permalink to this headline">¶</a></h3>
<p><em><strong>Lexical scoping</strong></em> (also referred to as <em><strong>static scoping</strong></em>) is the mechanism that turns local and global variables into relative notions that depend on the context in which dfns were defined: dfns usually have access to global variables, but the variables that are “global” depend on where the dfn was written.</p>
<p>As a purely illustrative example, consider the function defined below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">MultiplyBy10</span><span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">v</span> <span class="kd">←</span> <span class="m">10</span>            <span class="c1">⍝ define some variable</span>
    <span class="nv">TimesV</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">v</span><span class="o">×</span><span class="bp">⍵</span><span class="kt">}</span>    <span class="c1">⍝ multiply something with v</span>
    <span class="nv">TimesV</span> <span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MultiplyBy10</span> <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">50
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MultiplyBy10</span> <span class="m">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">100
</span></div></div>
</div>
<p>Notice how the <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> function takes your input and gives it to the <code class="docutils literal notranslate"><span class="pre">TimesV</span></code> function, which is defined as a function that “<em>takes its input (<code class="docutils literal notranslate"><span class="pre">⍵</span></code>) and multiplies it with <code class="docutils literal notranslate"><span class="pre">v</span></code></em>”. But what is <code class="docutils literal notranslate"><span class="pre">v</span></code>? We do not give a value to <code class="docutils literal notranslate"><span class="pre">v</span></code> inside <code class="docutils literal notranslate"><span class="pre">TimesV</span></code>, so when APL encounters the expression <code class="docutils literal notranslate"><span class="pre">v×⍵</span></code> it looks at its surroundings for the meaning of <code class="docutils literal notranslate"><span class="pre">v</span></code>. Because <code class="docutils literal notranslate"><span class="pre">v</span></code> was defined in the enclosing dfn as <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">←</span> <span class="pre">10</span></code>, that is the value that is used.</p>
<p>Consider now a similar example, but with more occurrences of the variable <code class="docutils literal notranslate"><span class="pre">v</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span> <span class="kd">←</span> <span class="m">100</span>          <span class="c1">⍝ (1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">MultiplyBy10</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">GiveMeV</span> <span class="kd">←</span> <span class="kt">{</span>
        <span class="nv">v</span>
    <span class="kt">}</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">v</span>         <span class="c1">⍝ (3)</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">GiveMeV</span> <span class="m">1</span> <span class="c1">⍝ (4)</span>
    <span class="nv">v</span> <span class="kd">←</span> <span class="m">10</span>       <span class="c1">⍝ (5)</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">v</span>         <span class="c1">⍝ (6)</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">GiveMeV</span> <span class="m">1</span> <span class="c1">⍝ (7)</span>
    <span class="nv">v</span> <span class="kd">←</span> <span class="m">10</span><span class="o">×</span><span class="bp">⍵</span>     <span class="c1">⍝ (8)</span>
    <span class="nv">v</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span> <span class="nv">v</span>             <span class="c1">⍝ (2)</span>
<span class="nv">MultiplyBy10</span> <span class="m">3</span>
<span class="vg">⎕</span><span class="kd">←</span> <span class="nv">v</span>             <span class="c1">⍝ (9)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">100
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">100
100
10
10
30
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">100
</span></div></div>
</div>
<p>Let us go over the assignments and the outputs of the code above:</p>
<ul class="simple">
<li><p>we start by defining the variable <code class="docutils literal notranslate"><span class="pre">v</span></code> in our session and we set it to 100 (1);</p></li>
<li><p>we then define a function named <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> which happens to contain another dfn inside it;</p></li>
<li><p>then we print the value of the session variable <code class="docutils literal notranslate"><span class="pre">v</span></code> and we see its value is 100 (2);</p></li>
<li><p>then we call the dfn <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> with argument <code class="docutils literal notranslate"><span class="pre">3</span></code> and</p>
<ul>
<li><p>we define a new dfn named <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code>;</p></li>
<li><p>we print the value of <code class="docutils literal notranslate"><span class="pre">v</span></code> (3). <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> doesn’t know what <code class="docutils literal notranslate"><span class="pre">v</span></code> is and so it looks for it in the session and finds a <code class="docutils literal notranslate"><span class="pre">v</span></code> whose value is 100, because of (1);</p></li>
<li><p>we then call the function <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> which simply returns <code class="docutils literal notranslate"><span class="pre">v</span></code> and we print it (4). <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> doesn’t know what <code class="docutils literal notranslate"><span class="pre">v</span></code> is, so it asks <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code>, which in turns asks the session, which knows of a <code class="docutils literal notranslate"><span class="pre">v</span></code> whose value is 100, because of (1);</p></li>
<li><p>we then define <code class="docutils literal notranslate"><span class="pre">v</span></code> to be 10 inside of <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> (5), making <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> aware of a variable <code class="docutils literal notranslate"><span class="pre">v</span></code>;</p></li>
<li><p>then we print <code class="docutils literal notranslate"><span class="pre">v</span></code> inside <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> (6), which is 10 because we just defined it as such;</p></li>
<li><p>then we call <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> again and we print its result (7). <code class="docutils literal notranslate"><span class="pre">GiveMeV</span></code> doesn’t know what <code class="docutils literal notranslate"><span class="pre">v</span></code> is, so it asks <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code>, that <em>now knows</em> what <code class="docutils literal notranslate"><span class="pre">v</span></code> is: it is 10 because of (5);</p></li>
<li><p>and we finish executing the <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> dfn by assigning 30 to <code class="docutils literal notranslate"><span class="pre">v</span></code> (8), which we then return from the dfn;</p></li>
</ul>
</li>
<li><p>we leave the <code class="docutils literal notranslate"><span class="pre">MultiplyBy10</span></code> dfn call and 30 gets printed because that was the result of the dfn call;</p></li>
<li><p>finally we print <code class="docutils literal notranslate"><span class="pre">v</span></code> once more, and the session knows <code class="docutils literal notranslate"><span class="pre">v</span></code> is 100, so that is what we print (9).</p></li>
</ul>
<p>That might look confusing, but I assure you it makes a lot of sense. Just go through the code calmly and make sure you understand what each part does separately. Then, simulate the execution of the code with some pen and paper and write down what you think should get printed at each step. Then read the explanation above and compare it to what you thought was supposed to happen. You will get used to lexical scoping in no time.</p>
<p>Lexical scoping can reveal itself to be extremely useful in languages where functions can return other functions, which is <em>not</em> the case with APL. Even so, lexical scoping will prove to be helpful later down the road: imagine a large(r) function inside which we define a small utility dfn to use with an operator, but we want the dfn to make use of things we have already computed inside the outer function. Lexical scoping kicks in at that point, allowing the inner dfn to access everything the outer function already computed.</p>
<p>This concludes the more advanced topics on dfns. If you are used to programming in other programming languages that follow paradigms other than the array-oriented one, dfns may look very limited in their lack of conventional control structures and looping structures. As it turns out, in writing good array-oriented programs you can usually do away without these. What is more, the power of many of the built-in operators you will learn about in <span class="xref myst">a future chapter</span> will cover that gap in a very suitable way.</p>
</div>
</div>
<div class="section" id="miscellaneous">
<span id="user-defined-functions-miscellaneous"></span><h2><span class="section-number">4.6. </span>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<div class="section" id="list-of-variables-and-functions">
<span id="user-defined-functions-list-of-variables-and-functions"></span><h3><span class="section-number">4.6.1. </span>List of Variables and Functions<a class="headerlink" href="#list-of-variables-and-functions" title="Permalink to this headline">¶</a></h3>
<p>You can obtain a list of your variables by typing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">Vars</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">hours   mat     times   totMat  towns   v       
</span></div></div>
</div>
<p>and you can obtain a list of your functions by typing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">Fns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">AMHM    Average Count   Extract HarmonicMean    Hypo    Ignore  Lengths Magic   MultiplyBy10    Plus    Reverse Root    
RootOf10        Sign    Silly   Switch1 Switch2 Times   To      
</span></div></div>
</div>
</div>
<div class="section" id="use-of-the-result">
<span id="user-defined-functions-use-of-the-result"></span><h3><span class="section-number">4.6.2. </span>Use of the Result<a class="headerlink" href="#use-of-the-result" title="Permalink to this headline">¶</a></h3>
<p>To sum up what we have already seen, once a function has been written, its result can be:</p>
<ul class="simple">
<li><p>Immediately displayed and lost:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span> <span class="nv">times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.895522
</span></div></div>
</div>
<ul class="simple">
<li><p>Included in an expression:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">60</span><span class="o">×</span><span class="nv">HarmonicMean</span> <span class="nv">times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">53.7313
</span></div></div>
</div>
<ul class="simple">
<li><p>Assigned to a variable:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hours</span> <span class="kd">←</span> <span class="nv">HarmonicMean</span> <span class="nv">times</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="vector-representation">
<span id="user-defined-functions-vector-representation"></span><h3><span class="section-number">4.6.3. </span>Vector Representation<a class="headerlink" href="#vector-representation" title="Permalink to this headline">¶</a></h3>
<p>We saw that double-clicking on a function name invokes the editor, and allows the user to see the code. We can also type the name of the function and see its code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">HarmonicMean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">{                                                                     
    ⍝ Monadic function to compute the harmonic mean of a vector       
     inverses←÷⍵   ⍝ This inverts the numbers in the argument         
    ⍝ and then                                                        
     ÷+/inverses     ⍝ we sum those inverses and return them.         
    ⍝ Of course this will give an error if 0 is in the input argument.
 }                                                                    
</span></div></div>
</div>
<p>However, in a printed document, the conventional representation of a function is as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕VR</span> <span class="s1">&#39;HarmonicMean&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ HarmonicMean←{                                                       
[1]       ⍝ Monadic function to compute the harmonic mean of a vector       
[2]        inverses←÷⍵   ⍝ This inverts the numbers in the argument         
[3]       ⍝ and then                                                        
[4]        ÷+/inverses     ⍝ we sum those inverses and return them.         
[5]       ⍝ Of course this will give an error if 0 is in the input argument.
[6]    }                                                                    
     ∇                                                                      
</span></div></div>
</div>
<p>The function is delimited by a pair of <code class="docutils literal notranslate"><span class="pre">∇</span></code> symbols. This special symbol is named “<em><strong>Del</strong></em>” in English, or “<em><strong>Carrot</strong></em>” (because of its shape) in some French-speaking countries. You can type a <em>Del</em> with <kbd>APL</kbd>+<kbd>g</kbd>.</p>
<p>One can also obtain this representation (as a character array) using the built-in <em><strong>System function</strong></em> <code class="docutils literal notranslate"><span class="pre">⎕VR</span></code> (for “<em>Vector Representation</em>”) of Dyalog APL. <em>System functions</em> are a special kind of function, provided with the development environment. The first character of their name is a <em><strong>Quad</strong></em> (<code class="docutils literal notranslate"><span class="pre">⎕</span></code>) which guarantees that they cannot conflict with user-defined names, and their names are also case-insensitive:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕VR</span> <span class="s1">&#39;Average&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ Average←{(+/⍵)÷(≢⍵)}
     ∇                     
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕Vr</span> <span class="s1">&#39;Average&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ Average←{(+/⍵)÷(≢⍵)}
     ∇                     
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕vr</span> <span class="s1">&#39;Average&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ Average←{(+/⍵)÷(≢⍵)}
     ∇                     
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕vR</span> <span class="s1">&#39;Average&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">     ∇ Average←{(+/⍵)÷(≢⍵)}
     ∇                     
</span></div></div>
</div>
<p>Note that this is quite unusual in a programming language. The result of <code class="docutils literal notranslate"><span class="pre">⎕VR</span></code> is a character vector representing the source code of our function, which is now available for processing by other functions in the workspace!</p>
<p>System functions will be discussed in detail in <span class="xref myst">a later chapter</span>.</p>
</div>
<div class="section" id="invoking-the-text-editor">
<span id="user-defined-functions-invoking-the-text-editor"></span><h3><span class="section-number">4.6.4. </span>Invoking the Text Editor<a class="headerlink" href="#invoking-the-text-editor" title="Permalink to this headline">¶</a></h3>
<p>Double-clicking a name which represents an existing item invokes the editor and displays its contents, using the colour scheme appropriate for the type of the item (function, character matrix, nested array, etc) defined via “Options” ⇨ “Colors…” if you are using the Windows interpreter or via “Edit” ⇨ “Preferences” ⇨ “Colours” if you are using RIDE.</p>
<p>You can also invoke the editor by pressing <kbd>Shift</kbd>+<kbd>Enter</kbd> when the input cursor is inside or adjacent to the name. This is perhaps the most convenient way as, when working in an APL session, you tend to use the keyboard much more than the mouse.</p>
<p>Let us define a character matrix with the uppercase latin alphabet:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">charMat</span> <span class="kd">←</span> <span class="m">2</span> <span class="m">13</span><span class="o">⍴</span><span class="nf">⎕A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ABCDEFGHIJKLM
NOPQRSTUVWXYZ
</span></div></div>
</div>
<p>For some items (e.g. numeric matrices, some nested arrays) the editor is only good for viewing them, while for others such as functions, text vectors and text matrices, the editor can also be used to edit them. In <a class="reference internal" href="#fig-win-editor-edit-character-matrix"><span class="std std-numref">Fig. 4.10</span></a> we have invoked the editor, and changed the contents of our <code class="docutils literal notranslate"><span class="pre">charMat</span></code> variable:</p>
<div class="figure align-default" id="win-editor-edit-character-matrix">
<span id="fig-win-editor-edit-character-matrix"></span><img alt="_images/Win_Editor_Edit_Character_Matrix.png" src="_images/Win_Editor_Edit_Character_Matrix.png" />
<p class="caption"><span class="caption-number">Fig. 4.10 </span><span class="caption-text">Editing a character matrix with the built-in editor of the Windows interpreter</span><a class="headerlink" href="#win-editor-edit-character-matrix" title="Permalink to this image">¶</a></p>
</div>
<p>In <a class="reference internal" href="#fig-win-editor-edit-character-matrix"><span class="std std-numref">Fig. 4.10</span></a> the edit window tells us that we modified the character matrix. We must now fix it, like we did with dfns before, for the variable to reflect its new value. RIDE doesn’t tell you that the character matrix was modified, but you still need to fix it if you want the new changes to come into effect.</p>
<p>If we now fix the changes to <code class="docutils literal notranslate"><span class="pre">charMat</span></code>, it will become a matrix with 4 rows and 29 columns (the length of its longest row).</p>
<p>If, for some reason, you made a mistake, you can exit the edit window <em>without</em> fixing the changes by pressing <kbd>Shift</kbd>+<kbd>Esc</kbd>.</p>
<p>If a name is currently undefined (has no value), double-clicking or pressing <kbd>Shift</kbd>+<kbd>Enter</kbd> on that name invokes the editor on it as if it were a new function. This is one way to create a function.</p>
<p>You can also invoke the editor using the command <code class="docutils literal notranslate"><span class="pre">)ED</span></code> as we did before. By default, it opens a <strong>function</strong> definition, but you can explicitly specify the type of a new object by prefixing its name with a special character, as shown in the table below.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Prefix</p></th>
<th class="text-align:left head"><p>Example</p></th>
<th class="text-align:left head"><p>Object Created</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>none</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">new</span></code></p></td>
<td class="text-align:left"><p>Function</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">∇</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">∇</span> <span class="pre">borscht</span></code></p></td>
<td class="text-align:left"><p>Function</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">-</span> <span class="pre">papyrus</span></code></p></td>
<td class="text-align:left"><p>Simple character matrix</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">→</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">→</span> <span class="pre">crouton</span></code></p></td>
<td class="text-align:left"><p>Simple character vector</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><code class="docutils literal notranslate"><span class="pre">∊</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">∊</span> <span class="pre">grunt</span></code></p></td>
<td class="text-align:left"><p>Nested vector of character vectors, with one sub-vector per line</p></td>
</tr>
</tbody>
</table>
<p>See also <a class="reference internal" href="Appendices.html#appendices-invoking-the-editor"><span class="std std-numref">Section 5.2</span></a> for additional prefixes.</p>
<p>It is possible to open several edit windows using a single command. For example, <code class="docutils literal notranslate"><span class="pre">)ed</span> <span class="pre">Tyrex</span> <span class="pre">-Moose</span></code> will open two edit windows. The first to create or edit a function named <code class="docutils literal notranslate"><span class="pre">Tyrex</span></code> and the second to create a character matrix named <code class="docutils literal notranslate"><span class="pre">moose</span></code>.</p>
<p>If a prefix is specified for the name of an already existing object, the prefix is ignored and the editor is invoked according to the type of the existing object.</p>
<p>There are some other ways to invoke the editor:</p>
<ul class="simple">
<li><p>use <code class="docutils literal notranslate"><span class="pre">⎕ED</span></code> instead of the command <code class="docutils literal notranslate"><span class="pre">)ED</span></code>. For example: <code class="docutils literal notranslate"><span class="pre">⎕ED</span> <span class="pre">'Clown'</span></code>. <code class="docutils literal notranslate"><span class="pre">⎕ED</span></code> is a <em>System function</em>, a concept that will be discussed in <span class="xref myst">a future chapter</span>;</p></li>
<li><p>type a name, or put the input cursor on an existing name, and activate the menu “Action” ⇨ “Edit”;</p></li>
<li><p>for the Windows interpreter, type a name or put the input cursor on an existing name, and click the “Edit Object” available in the toolbar (cf. <a class="reference internal" href="#fig-win-toolbar-edit-object"><span class="std std-numref">Fig. 4.11</span></a>).</p></li>
</ul>
<div class="figure align-default" id="win-toolbar-edit-object">
<span id="fig-win-toolbar-edit-object"></span><img alt="_images/Win_Toolbar_Edit_Object.png" src="_images/Win_Toolbar_Edit_Object.png" />
<p class="caption"><span class="caption-number">Fig. 4.11 </span><span class="caption-text">The “Edit Object” button in the toolbar of the Windows interpreter</span><a class="headerlink" href="#win-toolbar-edit-object" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="tradfns">
<span id="user-defined-functions-tradfns"></span><h2><span class="section-number">4.7. </span>Tradfns<a class="headerlink" href="#tradfns" title="Permalink to this headline">¶</a></h2>
<p><em><strong>Tradfns</strong></em>, which were previously referred to as <em>procedural functions</em>, are mainly used for complex calculations involving many variables, interactions with a user, file input/output of data, etc. They look much like functions or programs in more traditional programming languages.</p>
<p>Tradfn is short for “<em>traditional function</em>”, because in the beginning APL did not have support for dfns. Hence, when dfns were a novelty, tradfns were the <em>traditional</em> functions that had been around for a while.</p>
<div class="section" id="a-first-example">
<span id="user-defined-functions-a-first-example"></span><h3><span class="section-number">4.7.1. </span>A First Example<a class="headerlink" href="#a-first-example" title="Permalink to this headline">¶</a></h3>
<p>Tradfns are composed of a <em>Header</em> and one or more <em>statements</em> (function lines), so invoking a text editor to enter these lines of text will make your life easier.</p>
<p>As an example, let us see how we could define the <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> from before as a tradfn. Let us call it <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code>, for <em>traditional harmonic mean</em>.</p>
<p>Let us open the editor with <code class="docutils literal notranslate"><span class="pre">)ED</span> <span class="pre">TradHarmonicMean</span></code> and outright define our function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">mean</span> <span class="kd">←</span> <span class="nv">TradHarmonicMean</span> <span class="nv">argVector</span>
    <span class="nv">inverses</span> <span class="kd">←</span> <span class="o">÷</span><span class="nv">argVector</span>
    <span class="nv">mean</span> <span class="kd">←</span> <span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<p>Now I will break it down for you:</p>
<ul class="simple">
<li><p>the usage of the two Del characters (<code class="docutils literal notranslate"><span class="pre">∇</span></code>, typed with <kbd>APL</kbd>+<kbd>g</kbd> in case you have forgotten) delimits the definition of a tradfn. In Jupyter notebooks and in the session, those are mandatory. If you define the tradfn in the text editor, you can omit them (cf. <a class="reference internal" href="#fig-editor-tradharmonicmean"><span class="std std-numref">Fig. 4.12</span></a>);</p></li>
<li><p>the first line is the header and tells APL that</p>
<ul>
<li><p>the tradfn is going to be called <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code>,</p></li>
<li><p>it expects a right argument which will be named <code class="docutils literal notranslate"><span class="pre">argVector</span></code> and</p></li>
<li><p>it will return the value we store in the variable named <code class="docutils literal notranslate"><span class="pre">mean</span></code>;</p></li>
</ul>
</li>
<li><p>the subsequent lines have the statements of the function itself and, in particular,</p></li>
<li><p>the final line in which we perform the <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">←</span> <span class="pre">...</span></code> assignment is where we establish the result that will be returned by the tradfn.</p></li>
</ul>
<div class="figure align-default" id="editor-tradharmonicmean">
<span id="fig-editor-tradharmonicmean"></span><img alt="_images/Editor_TradHarmonicMean.png" src="_images/Editor_TradHarmonicMean.png" />
<p class="caption"><span class="caption-number">Fig. 4.12 </span><span class="caption-text">A tradfn defined in the editor and without delimiting Del characters</span><a class="headerlink" href="#editor-tradharmonicmean" title="Permalink to this image">¶</a></p>
</div>
<p>The function is now available for use:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TradHarmonicMean</span> <span class="m">2</span> <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.5
</span></div></div>
</div>
</div>
<div class="section" id="the-default-isn-t-local">
<span id="user-defined-functions-the-default-isnt-local"></span><h3><span class="section-number">4.7.2. </span>The Default Isn’t Local<a class="headerlink" href="#the-default-isn-t-local" title="Permalink to this headline">¶</a></h3>
<p>Just like when we defined <code class="docutils literal notranslate"><span class="pre">HarmonicMean</span></code> as our first dfn, our tradfn uses a temporary variable called <code class="docutils literal notranslate"><span class="pre">inverses</span></code>. Let us check its value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.5 0.166667
</span></div></div>
</div>
<p>When we did the same check in <a class="reference internal" href="#user-defined-functions-local-variables"><span class="std std-numref">Section 4.3.3</span></a> we couldn’t access the value of <code class="docutils literal notranslate"><span class="pre">inverses</span></code> because it was not defined in the session, it was a variable that was local to the dfn. Clearly, this works differently in tradfns.</p>
<p>If you were paying attention, you will have noticed that in <a class="reference internal" href="#fig-editor-tradharmonicmean"><span class="std std-numref">Fig. 4.12</span></a> there’s two colours being used (the actual colours might differ between the Windows IDE and RIDE, and you might also have changed your colour scheme to something else):</p>
<ul class="simple">
<li><p>black for the names <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code> and <code class="docutils literal notranslate"><span class="pre">inverses</span></code>;</p></li>
<li><p>grey for the names <code class="docutils literal notranslate"><span class="pre">argVector</span></code> and <code class="docutils literal notranslate"><span class="pre">mean</span></code>.</p></li>
</ul>
<p>So what do the colours mean?</p>
<p>The names in black are the variables that are global, variables that remain in the workspace after they have been assigned values during execution of the function. These names can refer to existing variables - intentionally or not - and may produce undesirable side effects.</p>
<p>The names in grey are temporary variable names used during function execution. Once execution is complete, these temporary variables are destroyed. Right before that, the tradfn returns the <em>value</em> of the return variable - <code class="docutils literal notranslate"><span class="pre">mean</span></code> in our example - and then discards its <em>name</em>.</p>
<p>That means neither <code class="docutils literal notranslate"><span class="pre">argVector</span></code> nor <code class="docutils literal notranslate"><span class="pre">mean</span></code> should be available after execution of the tradfn ends:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: mean
      mean
      ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">argVector</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: argVector
      argVector
      ∧
</pre></div>
</div>
</div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">inverses</span></code> is coloured in black, we can see it can interfere with the variables in our workspace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span> <span class="kd">←</span> <span class="s1">&#39;The inverses are calculated by use of monadic ÷&#39;</span>
<span class="nv">TradHarmonicMean</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.48
</span></div></div>
</div>
<p>And suddenly <code class="docutils literal notranslate"><span class="pre">inverses</span></code> is no longer what you defined:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0.5 0.333333 0.25
</span></div></div>
</div>
<p>All the variables created during execution of the tradfn that are not referenced in the header are considered to be global variables. To avoid any unpredictable side effects, it is recommended that you declare as local all the variables used by a function. This is done by specifying their names in the header each prefixed by a <em><strong>semi-colon</strong></em>, as shown in this new definition of <code class="docutils literal notranslate"><span class="pre">TradHarmonicMean</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">mean</span> <span class="kd">←</span> <span class="nv">TradHarmonicMean</span> <span class="nv">argVector</span><span class="sr">;</span> <span class="nv">inverses</span>
    <span class="nv">inverses</span> <span class="kd">←</span> <span class="o">÷</span><span class="nv">argVector</span>
    <span class="nv">mean</span> <span class="kd">←</span> <span class="o">÷+</span><span class="na">/</span><span class="nv">inverses</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span> <span class="kd">←</span> <span class="s1">&#39;The inverses are calculated by use of monadic ÷&#39;</span>
<span class="nv">TradHarmonicMean</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.48
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inverses</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">The inverses are calculated by use of monadic ÷
</span></div></div>
</div>
<p>As we can see, <code class="docutils literal notranslate"><span class="pre">inverses</span></code> is now treated as a local variable.</p>
<!--begin rules-->
<p><em><strong>Rules</strong></em>:</p>
<blockquote>
<div><ul class="simple">
<li><p>All the names referenced in the header of a function (including its result and arguments) are <em><strong>local</strong></em> to the function. They will exist only during the execution of the function.</p></li>
<li><p>Operations made on local variables do not affect <em><strong>global</strong></em> variables having the same names.</p></li>
<li><p><em>Global</em> and <em>Local</em> are relative notions: when a tradfn calls another sub function, variables local to the calling function are global for the called function. This will be further explored in <a class="reference internal" href="#user-defined-functions-dynamic-scoping"><span class="std std-numref">Section 4.7.5</span></a>.</p></li>
<li><p>All the variables used in a tradfn should preferably be declared local, unless you specifically intend otherwise.</p></li>
</ul>
</div></blockquote>
<!--end--></div>
<div class="section" id="defining-sub-functions">
<span id="user-defined-functions-defining-sub-functions"></span><h3><span class="section-number">4.7.3. </span>Defining Sub-Functions<a class="headerlink" href="#defining-sub-functions" title="Permalink to this headline">¶</a></h3>
<p>As we have seen, dfns can be defined inside other dfns. Similarly, dfns can be defined inside tradfns and used right away. The precautions mentioned above, that need to be taken with respect to <em>global</em> versus <em>local</em> variables, still apply. In short, do not forget to localise the name of a temporary dfn unless you really mean for it to become global.</p>
</div>
<div class="section" id="a-second-example">
<span id="user-defined-functions-a-second-example"></span><h3><span class="section-number">4.7.4. </span>A Second Example<a class="headerlink" href="#a-second-example" title="Permalink to this headline">¶</a></h3>
<p>You may remember from previous chapters our two matrices <code class="docutils literal notranslate"><span class="pre">forecast</span></code> and <code class="docutils literal notranslate"><span class="pre">actual</span></code>, representing sales of 4 products over 6 months:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span> <span class="kd">←</span> <span class="m">73</span>
<span class="o">⊢</span><span class="nv">forecast</span> <span class="kd">←</span> <span class="m">10</span><span class="o">×?</span><span class="m">4</span> <span class="m">6</span><span class="o">⍴</span><span class="m">55</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90 160 420 500  20  30
110 450 170 370 290 360
340 190 320 120 510 370
150 460 240 520 490 280
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span> <span class="kd">←</span> <span class="m">73</span>
<span class="o">⊢</span><span class="nv">actual</span> <span class="kd">←</span> <span class="nv">forecast</span> <span class="o">+</span> <span class="m">¯10</span><span class="o">+?</span><span class="m">4</span> <span class="m">6</span><span class="o">⍴</span><span class="m">20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 89 166 420 508  12  23
111 453 177 365 284 352
349 192 329 115 515 374
160 467 234 519 485 283
</span></div></div>
</div>
<p>It would be nice to interlace the columns of those two matrices to make it easier to compare forecast and actual sales for the same month. Furthermore, because this might be useful for other pairs of matrices, let’s create a general function to do the job; let’s call it <code class="docutils literal notranslate"><span class="pre">Interlace</span></code>.</p>
<p>The result we would like to obtain is schematised in the table below, with <code class="docutils literal notranslate"><span class="pre">f</span></code> being shorthand for <code class="docutils literal notranslate"><span class="pre">forecast</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code> being shorthand for <code class="docutils literal notranslate"><span class="pre">actual</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;1]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;1]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;2]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;2]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;3]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;3]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;4]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;4]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;5]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;5]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">f[;6]</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">a[;6]</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>90</p></td>
<td class="text-align:center"><p>89</p></td>
<td class="text-align:center"><p>160</p></td>
<td class="text-align:center"><p>166</p></td>
<td class="text-align:center"><p>420</p></td>
<td class="text-align:center"><p>420</p></td>
<td class="text-align:center"><p>500</p></td>
<td class="text-align:center"><p>508</p></td>
<td class="text-align:center"><p>20</p></td>
<td class="text-align:center"><p>12</p></td>
<td class="text-align:center"><p>30</p></td>
<td class="text-align:center"><p>23</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>110</p></td>
<td class="text-align:center"><p>111</p></td>
<td class="text-align:center"><p>450</p></td>
<td class="text-align:center"><p>453</p></td>
<td class="text-align:center"><p>170</p></td>
<td class="text-align:center"><p>177</p></td>
<td class="text-align:center"><p>370</p></td>
<td class="text-align:center"><p>365</p></td>
<td class="text-align:center"><p>290</p></td>
<td class="text-align:center"><p>284</p></td>
<td class="text-align:center"><p>360</p></td>
<td class="text-align:center"><p>352</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>340</p></td>
<td class="text-align:center"><p>349</p></td>
<td class="text-align:center"><p>190</p></td>
<td class="text-align:center"><p>192</p></td>
<td class="text-align:center"><p>320</p></td>
<td class="text-align:center"><p>329</p></td>
<td class="text-align:center"><p>120</p></td>
<td class="text-align:center"><p>115</p></td>
<td class="text-align:center"><p>510</p></td>
<td class="text-align:center"><p>515</p></td>
<td class="text-align:center"><p>370</p></td>
<td class="text-align:center"><p>374</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>150</p></td>
<td class="text-align:center"><p>160</p></td>
<td class="text-align:center"><p>460</p></td>
<td class="text-align:center"><p>467</p></td>
<td class="text-align:center"><p>240</p></td>
<td class="text-align:center"><p>234</p></td>
<td class="text-align:center"><p>520</p></td>
<td class="text-align:center"><p>519</p></td>
<td class="text-align:center"><p>490</p></td>
<td class="text-align:center"><p>485</p></td>
<td class="text-align:center"><p>280</p></td>
<td class="text-align:center"><p>283</p></td>
</tr>
</tbody>
</table>
<p>The first thing you must decide is how this function will be used:</p>
<ul class="simple">
<li><p>will you pass both matrices on right: <code class="docutils literal notranslate"><span class="pre">Interlace</span> <span class="pre">forecast</span> <span class="pre">actual</span></code></p></li>
<li><p>or one on the left and one on the right: <code class="docutils literal notranslate"><span class="pre">forecast</span> <span class="pre">Interlace</span> <span class="pre">actual</span></code></p></li>
</ul>
<p>Both solutions are valid; it is only a question of personal taste and ease of use. Our first tradfn was monadic so let us make this one dyadic.</p>
<p>Having decided on the calling syntax, we just have to know how the header of a dyadic tradfn looks like. If we call <code class="docutils literal notranslate"><span class="pre">r</span></code> to the result and <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> to the left and right arguments, respectively, then the tradfn header is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">x</span> <span class="nv">Interlace</span> <span class="nv">y</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<p>which may then be updated to include local variables.</p>
<p>The names <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span></code> do not matter to the APL system. Replacing <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> with <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> or <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> would be perfectly valid and obviously easier to recall than if we replaced them with <code class="docutils literal notranslate"><span class="pre">potatoes</span></code> and <code class="docutils literal notranslate"><span class="pre">ocarina</span></code>. However, you should pick names which help you remember what the function is doing. For example, in a general-purpose function like this, you should probably avoid using too specific names like <code class="docutils literal notranslate"><span class="pre">forecast</span></code> and <code class="docutils literal notranslate"><span class="pre">actual</span></code>: that would imply that this function only works on arrays containing forecast and actual data. Such names might also confuse the distinction between local and global names.</p>
<p>Now that the header is set, how shall we interlace our two matrices? Have a go at it, if you fancy.</p>
<p>We suggest the following steps:</p>
<ul class="simple">
<li><p>calculate the size of the result <code class="docutils literal notranslate"><span class="pre">r</span></code>. It will be a matrix with as many rows as <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>, but twice as many columns;</p></li>
<li><p>create <code class="docutils literal notranslate"><span class="pre">r</span></code> filled with zeroes;</p></li>
<li><p>calculate the indices of its even columns;</p></li>
<li><p>fill the even columns with <code class="docutils literal notranslate"><span class="pre">y</span></code>;</p></li>
<li><p>calculate the indices of its odd columns and fill them with <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
</ul>
<p>The final function could be written as follows. Do not forget to localise your variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">x</span> <span class="nv">Interlace</span> <span class="nv">y</span><span class="sr">;</span> <span class="nv">size</span><span class="sr">;</span> <span class="nv">even</span>
    <span class="nv">size</span> <span class="kd">←</span> <span class="m">1</span> <span class="m">2</span><span class="o">×⍴</span><span class="nv">x</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="nv">size</span><span class="o">⍴</span><span class="m">0</span>
    <span class="nv">even</span> <span class="kd">←</span> <span class="m">2</span><span class="o">×⍳</span><span class="p">(</span><span class="o">⍴</span><span class="nv">x</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span>
    <span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="sr">]</span> <span class="kd">←</span> <span class="nv">y</span>
    <span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="o">-</span><span class="m">1</span><span class="sr">]</span> <span class="kd">←</span> <span class="nv">x</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<p>We can now apply the function to any pair of variables, provided they have the same size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">forecast</span> <span class="nv">Interlace</span> <span class="nv">actual</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90  89 160 166 420 420 500 508  20  12  30  23
110 111 450 453 170 177 370 365 290 284 360 352
340 349 190 192 320 329 120 115 510 515 370 374
150 160 460 467 240 234 520 519 490 485 280 283
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span> <span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="p">)</span> <span class="nv">Interlace</span> <span class="p">(</span><span class="m">2</span> <span class="m">3</span><span class="o">⍴</span><span class="m">5</span> <span class="m">7</span> <span class="m">0</span> <span class="m">2</span> <span class="m">8</span> <span class="m">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 5 2 7 3 0
4 2 5 8 6 9
</span></div></div>
</div>
<p><strong>Another possible syntax</strong></p>
<p>If you had decided instead to make the function monadic, it could look very similar to the one above. We just changed the header a bit and added a new statement at the beginning:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">Interlace</span> <span class="nv">couple</span><span class="sr">;</span> <span class="nv">x</span><span class="sr">;</span> <span class="nv">y</span><span class="sr">;</span> <span class="nv">size</span><span class="sr">;</span> <span class="nv">even</span>
    <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="kd">←</span> <span class="nv">couple</span>
    <span class="nv">size</span> <span class="kd">←</span> <span class="m">1</span> <span class="m">2</span><span class="o">×⍴</span><span class="nv">x</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="nv">size</span><span class="o">⍴</span><span class="m">0</span>
    <span class="nv">even</span> <span class="kd">←</span> <span class="m">2</span><span class="o">×⍳</span><span class="p">(</span><span class="o">⍴</span><span class="nv">x</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span>
    <span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="sr">]</span> <span class="kd">←</span> <span class="nv">y</span>
    <span class="nv">r</span><span class="sr">[;</span><span class="nv">even</span><span class="o">-</span><span class="m">1</span><span class="sr">]</span> <span class="kd">←</span> <span class="nv">x</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Interlace</span> <span class="nv">forecast</span> <span class="nv">actual</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90  89 160 166 420 420 500 508  20  12  30  23
110 111 450 453 170 177 370 365 290 284 360 352
340 349 190 192 320 329 120 115 510 515 370 374
150 160 460 467 240 234 520 519 490 485 280 283
</span></div></div>
</div>
</div>
<div class="section" id="dynamic-scoping">
<span id="user-defined-functions-dynamic-scoping"></span><h3><span class="section-number">4.7.5. </span>Dynamic Scoping<a class="headerlink" href="#dynamic-scoping" title="Permalink to this headline">¶</a></h3>
<p><em><strong>Dynamic scoping</strong></em> (as opposed to <em>static</em> scoping, as seen in <a class="reference internal" href="#user-defined-functions-lexical-scoping"><span class="std std-numref">Section 4.5.3</span></a>) is the mechanism that turns local and global variables into relative notions that depend on the chain of function calls that are currently being interpreted: when a tradfn calls another function, variables local to the calling function are global for the called function.</p>
<p>To explore what this means, consider the following tradfns. Do not worry about their arguments and return values as they are not meaningful. What matters are the assignments to <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> and the prints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">PrintAB</span> <span class="nv">y</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">a</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">b</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="m">0</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">SetAThenPrint</span> <span class="nv">y</span><span class="sr">;</span> <span class="nv">a</span>
    <span class="nv">a</span> <span class="kd">←</span> <span class="m">1</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="nv">PrintAB</span> <span class="nv">y</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">SetBThenPrint</span> <span class="nv">y</span><span class="sr">;</span> <span class="nv">b</span>
    <span class="nv">b</span> <span class="kd">←</span> <span class="m">2</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="nv">PrintAB</span> <span class="nv">y</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<p>and let us define <em>global</em> variables <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> with character values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span> <span class="kd">←</span> <span class="s1">&#39;a&#39;</span>
<span class="nv">b</span> <span class="kd">←</span> <span class="s1">&#39;b&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us call <code class="docutils literal notranslate"><span class="pre">SetAThenPrint</span></code>. What do you expect to be printed?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetAThenPrint</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
b
0
</span></div></div>
</div>
<p>Did it match your expectations? Can you now guess what will happen if we execute <code class="docutils literal notranslate"><span class="pre">SetBThenPrint</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetBThenPrint</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">a
2
0
</span></div></div>
</div>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code> was defined as a standalone tradfn which prints two variables. Because <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are never defined inside <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code>, surely <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code> will be printing global values. Then, depending on what function called <code class="docutils literal notranslate"><span class="pre">PrintAB</span></code>, either <code class="docutils literal notranslate"><span class="pre">a</span></code> or <code class="docutils literal notranslate"><span class="pre">b</span></code> are taken from the context of the enclosing <em>calling</em> function.</p>
<p>Let us try to define the same functions but with dfns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">PrintCD</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">c</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">d</span>
    <span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">SetCThenPrint</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">c</span> <span class="kd">←</span> <span class="m">3</span>
    <span class="nv">PrintCD</span> <span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">SetDThenPrint</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">d</span> <span class="kd">←</span> <span class="m">4</span>
    <span class="nv">PrintCD</span> <span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">c</span> <span class="kd">←</span> <span class="s1">&#39;c&#39;</span>
<span class="nv">d</span> <span class="kd">←</span> <span class="s1">&#39;d&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>What will happen if we call <code class="docutils literal notranslate"><span class="pre">SetCThenPrint</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetCThenPrint</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">c
d
0
</span></div></div>
</div>
<p>Even though <code class="docutils literal notranslate"><span class="pre">SetCThenPrint</span></code> modified the value of <code class="docutils literal notranslate"><span class="pre">c</span></code> to be 3, the <code class="docutils literal notranslate"><span class="pre">PrintCD</span></code> function was defined in the workspace, and hence its lexical scoping tells it to look for <code class="docutils literal notranslate"><span class="pre">c</span></code> among its own variables, and among the global variables in the workspace. <code class="docutils literal notranslate"><span class="pre">PrintCD</span></code> does not have access to the local variables of the function that called it.</p>
<p>That is why, if we call <code class="docutils literal notranslate"><span class="pre">SetDThenPrint</span></code>, we get the exact same output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetDThenPrint</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">c
d
0
</span></div></div>
</div>
<p>Perhaps the difference between dynamic and lexical scoping becomes even more clear if we consider yet another family of tradfns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">PrintE</span> <span class="nv">y</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">e</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="m">0</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that if you call <code class="docutils literal notranslate"><span class="pre">PrintE</span></code> right now it will cause an error, because there is no variable <code class="docutils literal notranslate"><span class="pre">e</span></code> defined anywhere:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">e</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: e
      e
      ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">PrintE</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: e
PrintE[1] ⎕←e
            ∧
</pre></div>
</div>
</div>
</div>
<p>Now let us define a tradfn that makes use of a <em>local</em> variable <code class="docutils literal notranslate"><span class="pre">e</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span> <span class="nv">r</span> <span class="kd">←</span> <span class="nv">SetLocalE</span> <span class="nv">y</span><span class="sr">;</span> <span class="nv">e</span>
    <span class="nv">e</span> <span class="kd">←</span> <span class="m">5</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="nv">PrintE</span> <span class="nv">y</span>
<span class="bp">∇</span>
</pre></div>
</div>
</div>
</div>
<p>If we call <code class="docutils literal notranslate"><span class="pre">SetLocalE</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code> will be defined inside <code class="docutils literal notranslate"><span class="pre">SetLocalE</span></code> and then, when <code class="docutils literal notranslate"><span class="pre">PrintE</span></code> gets called, the dynamic scoping will make <code class="docutils literal notranslate"><span class="pre">e</span></code> visible as a global variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SetLocalE</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
0
</span></div></div>
</div>
<p>After <code class="docutils literal notranslate"><span class="pre">SetLocalE</span></code> is executed, our workspace still has no variable <code class="docutils literal notranslate"><span class="pre">e</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">e</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: e
      e
      ∧
</pre></div>
</div>
</div>
</div>
<p>We now summarise the scoping rules used when a function <code class="docutils literal notranslate"><span class="pre">F</span></code> calls another function <code class="docutils literal notranslate"><span class="pre">G</span></code>.</p>
<!--begin scoping rules style=tip-->
<p><em><strong>Scoping rules</strong></em>:</p>
<blockquote>
<div><ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">F</span></code> is a tradfn, then all of <code class="docutils literal notranslate"><span class="pre">F</span></code>’s local variables will be visible to <code class="docutils literal notranslate"><span class="pre">G</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">F</span></code> is a dfn and you want its local variables to be visible to <code class="docutils literal notranslate"><span class="pre">G</span></code>, then either define <code class="docutils literal notranslate"><span class="pre">G</span></code> as a tradfn or define <code class="docutils literal notranslate"><span class="pre">G</span></code> as a dfn <em>inside</em> <code class="docutils literal notranslate"><span class="pre">F</span></code>.</p></li>
</ul>
</div></blockquote>
<!--end--></div>
</div>
<div class="section" id="flow-control">
<span id="user-defined-functions-flow-control"></span><h2><span class="section-number">4.8. </span>Flow Control<a class="headerlink" href="#flow-control" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<span id="user-defined-functions-overview"></span><h3><span class="section-number">4.8.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Apart from extremely simple calculations, most programs rely on certain statements being executed only if a given condition is satisfied (conditional execution) or on a set of statements being executed again and again, until a given limit is reached (looping). The APL language offers a special set of syntactic elements to control the flow of statements inside tradfns.</p>
<p>In the very first versions of APL, the only way to implement conditional execution and looping was to use the symbol <code class="docutils literal notranslate"><span class="pre">→</span></code> (the <em>branch arrow</em>, typed with <kbd>APL</kbd>+<kbd>]</kbd>). This was used to jump from one statement to another, skipping over other statements (conditional execution) or jumping back to repeat a set of statements again (looping). The branch arrow is equivalent to the GOTO statement in other languages. Contemporary versions of APL include a special set of keywords which offer a much more flexible, easy to use and easy to read way to control the flow of execution. They are also very similar to those used in most other languages. These are known as <em><strong>Control structures</strong></em>.</p>
<p>We shall begin by using control structures and then introduce you later to the old way of programming, only because you may come across it in some existing programs, and because it sometimes offers shorter or more convenient ways of doing things.</p>
<p>Control structures are blocks of statements which begin and end with special keywords. These keywords are all <strong>prefixed</strong> with a <em><strong>colon</strong></em>, like <code class="docutils literal notranslate"><span class="pre">:If</span></code> or <code class="docutils literal notranslate"><span class="pre">:Repeat</span></code>. This prevents the names of your variables to clash with these keywords.</p>
<p>The keywords can be typed in lower or upper case, but Dyalog APL will always store and display them using a fixed spelling convention commonly known as CamelCase or, more specifically, PascalCase. Following this convention, a keyword has an upper case first letter and the following letters in lower case. Composite keywords like “<code class="docutils literal notranslate"><span class="pre">EndIf</span></code>” and “<code class="docutils literal notranslate"><span class="pre">GoTo</span></code>” capitalise the first letter of each word.</p>
<p>Opening keywords are used to begin the conditional execution or repeated execution of a block of statements. Usually (but not always), the block is ended by a corresponding keyword that starts with <code class="docutils literal notranslate"><span class="pre">:End</span></code>.</p>
<p>The sets of opening/closing keywords are shown below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Opening</p></th>
<th class="text-align:left head"><p>Closing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:If</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndIf</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:For</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndFor</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Select</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndSelect</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Repeat</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Until</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndRepeat</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:While</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndWhile</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Until</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Trap</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndTrap</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:With</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndWith</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:Hold</span></code></p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">:EndHold</span></code></p></td>
</tr>
</tbody>
</table>
<p>The primary keywords shown above can be complemented by additional keywords which qualify more precisely what is to be done:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:Else</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:ElseIf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:AndIf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:OrIf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:Case</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:CaseList</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:Until</span></code></p></li>
</ul>
<p>And finally, some keywords may be used to conditionally alter the flow of execution within a control structure.</p>
<p>The following keywords will not be studied in this chapter:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:Trap...</span> <span class="pre">:EndTrap</span></code> concerns event processing and will be seen in <span class="xref myst">the chapter “Event Handling”</span>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:With...</span> <span class="pre">:EndWith</span></code> concerns the GUI interface and namespaces and will be covered in <span class="xref myst">the chapter on GUIs</span> and in <span class="xref myst">the chapter on namespaces</span>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:Hold...</span> <span class="pre">:EndHold</span></code> concerns <em>multi threading</em>.</p></li>
</ul>
</div>
<div class="section" id="conditional-execution">
<span id="user-defined-functions-conditional-execution"></span><h3><span class="section-number">4.8.2. </span>Conditional Execution<a class="headerlink" href="#conditional-execution" title="Permalink to this headline">¶</a></h3>
<div class="section" id="simple-conditions-if-endif">
<h4><span class="section-number">4.8.2.1. </span>Simple Conditions (<code class="docutils literal notranslate"><span class="pre">:If</span></code>/<code class="docutils literal notranslate"><span class="pre">:EndIf</span></code>)<a class="headerlink" href="#simple-conditions-if-endif" title="Permalink to this headline">¶</a></h4>
</div>
</div>
</div>
<div class="section" id="solutions">
<span id="user-defined-functions-solutions"></span><h2><span class="section-number">4.9. </span>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline">¶</a></h2>
<p><strong>Exercise 1</strong>:</p>
<p>If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is the vector argument, we can use <code class="docutils literal notranslate"><span class="pre">⍵[...]</span></code> to index into <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and then we can use the <em>Index Generator</em> primitive to generate the indices we need, which should be the integers from <code class="docutils literal notranslate"><span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">⍺</span></code>… Except that if <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is too big, we cannot generate indices larger than the length of the vector, so we also find the minimum between <code class="docutils literal notranslate"><span class="pre">⍺</span></code> and <code class="docutils literal notranslate"><span class="pre">≢⍵</span></code>. If we don’t, we get a <code class="docutils literal notranslate"><span class="pre">INDEX</span> <span class="pre">ERROR</span></code> when indexing. Here is a possible implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Extract</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="bp">⍵</span><span class="sr">[</span><span class="o">⍳</span><span class="bp">⍺</span><span class="o">⌊≢</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span> <span class="nv">Extract</span> <span class="m">45</span> <span class="m">86</span> <span class="m">31</span> <span class="m">20</span> <span class="m">75</span> <span class="m">62</span> <span class="m">18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">45 86 31
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span> <span class="nv">Extract</span> <span class="s1">&#39;can you do it?&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">can yo
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">20</span> <span class="nv">Extract</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
</span></div></div>
</div>
<p><strong>Exercise 2</strong>:</p>
<p>We can use a similar logic as that of the first exercise, except now we want to start the indices at <code class="docutils literal notranslate"><span class="pre">⍺+1</span></code> and go up until <code class="docutils literal notranslate"><span class="pre">≢⍵</span></code>. For this to happen, we first need to find out how many numbers we need. If a vector has <code class="docutils literal notranslate"><span class="pre">≢⍵</span></code> elements and we are going to drop <code class="docutils literal notranslate"><span class="pre">⍺</span></code> of them, we are going to be left with <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code>. This means <code class="docutils literal notranslate"><span class="pre">⍳(≢⍵)-⍺</span></code> will generate the correct amount of indices, but they will be starting at <code class="docutils literal notranslate"><span class="pre">1</span></code> and should start at <code class="docutils literal notranslate"><span class="pre">⍺+1</span></code>, so we just need to add <code class="docutils literal notranslate"><span class="pre">⍺</span></code> to that.</p>
<p>Finally, we just need to worry about what happens if <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is too large, i.e. if we want to ignore too many elements. The reverse of that concern is, what happens if <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code> is too small? Recall that <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code> tells you how many elements you will want to keep. But that number must be at least <code class="docutils literal notranslate"><span class="pre">0</span></code> elements (i.e. “keep no elements”) because it makes no sense to keep a negative number of elements. So we can just use <code class="docutils literal notranslate"><span class="pre">⌈</span></code> to find the maximum between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">(≢⍵)-⍺</span></code>. If <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is too large, <code class="docutils literal notranslate"><span class="pre">0⌈(≢⍵)-⍺</span></code> gives <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">⍳0</span></code> is the empty vector <code class="docutils literal notranslate"><span class="pre">⍬</span></code>, so the indexing will work just fine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Ignore</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="bp">⍵</span><span class="sr">[</span><span class="bp">⍺</span><span class="o">+⍳</span><span class="m">0</span><span class="o">⌈</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">-</span><span class="bp">⍺</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span> <span class="nv">Ignore</span> <span class="m">45</span> <span class="m">86</span> <span class="m">31</span> <span class="m">20</span> <span class="m">75</span> <span class="m">62</span> <span class="m">18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20 75 62 18
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span> <span class="nv">Ignore</span> <span class="s1">&#39;can you do it?&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">u do it?
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">20</span> <span class="nv">Ignore</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">
</span></div></div>
</div>
<p><strong>Exercise 3</strong>:</p>
<p>Here is another exercise on index arithmetic. Here is what we want to happen with a vector argument of length 10:</p>
<ul class="simple">
<li><p>generate the indices <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6</span> <span class="pre">7</span> <span class="pre">8</span> <span class="pre">9</span> <span class="pre">10</span></code></p></li>
<li><p>transform them into  <code class="docutils literal notranslate"><span class="pre">10</span> <span class="pre">9</span> <span class="pre">8</span> <span class="pre">7</span> <span class="pre">6</span> <span class="pre">5</span> <span class="pre">4</span> <span class="pre">3</span> <span class="pre">2</span> <span class="pre">1</span></code></p></li>
</ul>
<p>We can do this if we do the correct subtraction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">11</span> <span class="o">-</span> <span class="o">⍳</span><span class="m">10</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 9 8 7 6 5 4 3 2 1
</span></div></div>
</div>
<p>But here <code class="docutils literal notranslate"><span class="pre">11</span></code> was a special number: it was <code class="docutils literal notranslate"><span class="pre">1+≢⍵</span></code>. So that is the general tactic we must employ:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Reverse</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="bp">⍵</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">-⍳≢</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Reverse</span> <span class="s1">&#39;snoitalutargnoc&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">congratulations
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Reverse</span> <span class="s1">&#39;!ti did uoY&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">You did it!
</span></div></div>
</div>
<p><strong>Exercise 4</strong>:</p>
<p>This exercise can be solved by using the <em>Reduce</em> operator to sum: <code class="docutils literal notranslate"><span class="pre">+/</span></code>. Then we need to specify the axis we care about with <code class="docutils literal notranslate"><span class="pre">[1]</span></code> and <code class="docutils literal notranslate"><span class="pre">[2]</span></code>.</p>
<p>If we do <code class="docutils literal notranslate"><span class="pre">+/[1]</span></code> then we are reducing across the first axis, which means we get the sums along the columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">mat</span> <span class="kd">←</span> <span class="m">3</span> <span class="m">4</span><span class="o">⍴</span><span class="m">75</span> <span class="m">14</span> <span class="m">86</span> <span class="m">20</span> <span class="m">31</span> <span class="m">16</span> <span class="m">40</span> <span class="m">51</span> <span class="m">22</span> <span class="m">64</span> <span class="m">31</span> <span class="m">28</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">75 14 86 20
31 16 40 51
22 64 31 28
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="nv">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">128 94 157 99
</span></div></div>
</div>
<p>We can then catenate the original matrix to these column sums vertically (by using <code class="docutils literal notranslate"><span class="pre">⍪</span></code>), and then use <code class="docutils literal notranslate"><span class="pre">+/[2]</span></code> to find the row sums and catenate them with <code class="docutils literal notranslate"><span class="pre">,</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Totalise</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">colSums</span> <span class="kd">←</span> <span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="bp">⍵</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="bp">⍵</span><span class="o">⍪</span><span class="nv">colSums</span>
    <span class="nv">rowSums</span> <span class="kd">←</span> <span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">r</span>
    <span class="nv">r</span><span class="o">,</span><span class="nv">rowSums</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Totalise</span> <span class="nv">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 75 14  86 20 195
 31 16  40 51 138
 22 64  31 28 145
128 94 157 99 478
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">totMat</span> <span class="kd">←</span> <span class="m">4</span> <span class="m">5</span><span class="o">⍴</span><span class="m">75</span> <span class="m">14</span> <span class="m">86</span> <span class="m">20</span> <span class="m">195</span> <span class="m">31</span> <span class="m">16</span> <span class="m">40</span> <span class="m">51</span> <span class="m">138</span> <span class="m">22</span> <span class="m">64</span> <span class="m">31</span> <span class="m">28</span> <span class="m">145</span> <span class="m">128</span> <span class="m">94</span> <span class="m">157</span> <span class="m">99</span> <span class="m">478</span>
<span class="nv">totMat</span> <span class="o">≡</span> <span class="nv">Totalise</span> <span class="nv">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p><strong>Exercise 5</strong>:</p>
<p>When reading this exercise, one should immediately realise that one is going to need to find <em>Where</em> the blank spaces are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span> <span class="kd">←</span> <span class="s1">&#39;This seems to be a good solution&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="nv">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 11 14 17 19 24
</span></div></div>
</div>
<p>These indices tell where the blank spaces were in the character vector, and in between those indices are the indices that correspond to word characters:</p>
<ul class="simple">
<li><p>the first word has indices <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span></code></p>
<ul>
<li><p>then there is a space at position <code class="docutils literal notranslate"><span class="pre">5</span></code></p></li>
</ul>
</li>
<li><p>the second word has indices <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">7</span> <span class="pre">8</span> <span class="pre">9</span> <span class="pre">10</span></code></p>
<ul>
<li><p>then there is a space at position <code class="docutils literal notranslate"><span class="pre">11</span></code></p></li>
</ul>
</li>
<li><p>…</p>
<ul>
<li><p>then there is a space at position <code class="docutils literal notranslate"><span class="pre">24</span></code></p></li>
</ul>
</li>
<li><p>the last word has indices <code class="docutils literal notranslate"><span class="pre">25</span> <span class="pre">26</span> <span class="pre">27</span> <span class="pre">28</span> <span class="pre">29</span> <span class="pre">30</span> <span class="pre">31</span> <span class="pre">32</span></code></p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">32</span></code> above is <code class="docutils literal notranslate"><span class="pre">≢text</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≢</span><span class="nv">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">32
</span></div></div>
</div>
<p>From the list above we can see that most words are <em>between</em> spaces, but the first and last words may not be between spaces. We can fix this by <em>forcing</em> the first and last words to be <em>between</em> spaces if we had a single <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> to the beginning and to the end of our variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">text</span><span class="o">,</span><span class="s1">&#39; &#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 6 12 15 18 20 25 34
</span></div></div>
</div>
<p>Now we have</p>
<ul class="simple">
<li><p>the first space at position <code class="docutils literal notranslate"><span class="pre">1</span></code></p>
<ul>
<li><p>the first word in positions <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">5</span></code></p></li>
</ul>
</li>
<li><p>a space at position <code class="docutils literal notranslate"><span class="pre">6</span></code></p>
<ul>
<li><p>a word in positions <code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">8</span> <span class="pre">9</span> <span class="pre">10</span> <span class="pre">11</span></code></p></li>
</ul>
</li>
<li><p>…</p></li>
<li><p>a space at position <code class="docutils literal notranslate"><span class="pre">25</span></code></p>
<ul>
<li><p>the last word in positions <code class="docutils literal notranslate"><span class="pre">26</span> <span class="pre">27</span> <span class="pre">28</span> <span class="pre">29</span> <span class="pre">30</span> <span class="pre">31</span> <span class="pre">32</span> <span class="pre">33</span></code></p></li>
</ul>
</li>
<li><p>the final space at position <code class="docutils literal notranslate"><span class="pre">34</span></code></p></li>
</ul>
<p>So we can find the lengths of those runs of non-spaces by subtracting positions of consecutive spaces and then subtracting 1 from those, because <code class="docutils literal notranslate"><span class="pre">6-1</span></code> gives 5, but between 1 and 6 there’s only 4 integers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Lengths</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">spaces</span> <span class="kd">←</span> <span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39; &#39;</span>
    <span class="nv">idx</span> <span class="kd">←</span> <span class="o">⍳</span><span class="p">(</span><span class="o">≢</span><span class="nv">spaces</span><span class="p">)</span><span class="o">-</span><span class="m">1</span>
    <span class="m">¯1</span><span class="o">+</span><span class="nv">spaces</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="nv">idx</span><span class="sr">]</span><span class="o">-</span><span class="nv">spaces</span><span class="sr">[</span><span class="nv">idx</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span> <span class="s1">&#39;This seems to be a good solution&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 5 2 2 1 4 8
</span></div></div>
</div>
<p>The final step where we index into <code class="docutils literal notranslate"><span class="pre">spaces</span></code> to get “all but the last” and “all but the first” elements of <code class="docutils literal notranslate"><span class="pre">spaces</span></code> could have been done with your previous solutions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Lengths</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">spaces</span> <span class="kd">←</span> <span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39; &#39;</span>
    <span class="m">¯1</span><span class="o">+</span><span class="p">(</span><span class="m">1</span> <span class="nv">Ignore</span> <span class="nv">spaces</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="m">¯1</span><span class="o">+≢</span><span class="nv">spaces</span><span class="p">)</span> <span class="nv">Extract</span> <span class="nv">spaces</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span> <span class="s1">&#39;This seems to be a good solution&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 5 2 2 1 4 8
</span></div></div>
</div>
<p>Notice that doing <code class="docutils literal notranslate"><span class="pre">¯1+expr</span></code> is a little “trick” you can employ when you want to subtract 1 from <code class="docutils literal notranslate"><span class="pre">expr</span></code>, but <code class="docutils literal notranslate"><span class="pre">expr</span></code> would then need parenthesis if you were to have it on the left of the <code class="docutils literal notranslate"><span class="pre">-</span></code> sign. For example, to subtract 1 from <code class="docutils literal notranslate"><span class="pre">≢spaces</span></code> you would have to do <code class="docutils literal notranslate"><span class="pre">(≢spaces)-1</span></code> but instead you can do <code class="docutils literal notranslate"><span class="pre">¯1+≢spaces</span></code>.</p>
<p>Finally, can you improve your solution to handle multiple consecutive spaces?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span> <span class="s1">&#39;This only    has      five words   &#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 4 0 0 0 3 0 0 0 0 0 4 5 0 0 0
</span></div></div>
</div>
<p>Probably seeing how your function works with multiple consecutive spaces gives the solution away: consecutive spaces will make a 0 appear in the final result, so we just have to remove those:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Lengths</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">spaces</span> <span class="kd">←</span> <span class="o">⍸</span><span class="s1">&#39; &#39;</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39; &#39;</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="m">¯1</span><span class="o">+</span><span class="p">(</span><span class="m">1</span> <span class="nv">Ignore</span> <span class="nv">spaces</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="m">¯1</span><span class="o">+≢</span><span class="nv">spaces</span><span class="p">)</span> <span class="nv">Extract</span> <span class="nv">spaces</span><span class="p">)</span>
    <span class="p">(</span><span class="m">0</span><span class="o">≠</span><span class="nv">r</span><span class="p">)</span><span class="na">/</span><span class="nv">r</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lengths</span> <span class="s1">&#39;This only    has      five words   &#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 4 3 4 5
</span></div></div>
</div>
<p><strong>Exercise 6</strong>:</p>
<p>We have seen in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-basic-usage"><span class="std std-numref">Section 3.15.1</span></a> how to create any arithmetic sequence of integers. This is just a special case of the algorithm give, with <code class="docutils literal notranslate"><span class="pre">Step</span> <span class="pre">←</span> <span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">To</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="bp">⍺</span><span class="o">+</span><span class="m">¯1</span><span class="o">+⍳</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="bp">⍵</span><span class="o">-</span><span class="bp">⍺</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">17</span> <span class="nv">To</span> <span class="m">29</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17 18 19 20 21 22 23 24 25 26 27 28 29
</span></div></div>
</div>
<p><strong>Exercise 7</strong>:</p>
<p>This exercise is easier than it might look because the primitives to catenate vertically and horizontally, <code class="docutils literal notranslate"><span class="pre">⍪</span></code> and <code class="docutils literal notranslate"><span class="pre">,</span></code>, know how to deal with a matrix and a single scalar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">towns</span> <span class="kd">←</span> <span class="m">6</span> <span class="m">10</span><span class="o">⍴</span><span class="s1">&#39;Canberra  Paris     WashingtonMoscow    Martigues Mexico    &#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  
Paris     
Washington
Moscow    
Martigues 
Mexico    
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">towns</span><span class="o">,</span><span class="s1">&#39;|&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  |
Paris     |
Washington|
Moscow    |
Martigues |
Mexico    |
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">towns</span><span class="o">⍪</span><span class="s1">&#39;-&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Canberra  
Paris     
Washington
Moscow    
Martigues 
Mexico    
----------
</span></div></div>
</div>
<p>So we just have to frame the four sides and <em>then</em> change the corners:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Frame</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">f</span> <span class="kd">←</span> <span class="s1">&#39;|&#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39;|&#39;</span>
    <span class="nv">f</span> <span class="kd">←</span> <span class="s1">&#39;-&#39;</span><span class="o">⍪</span><span class="nv">f</span><span class="o">⍪</span><span class="s1">&#39;-&#39;</span>
    <span class="p">(</span><span class="nv">r</span> <span class="nv">c</span><span class="p">)</span> <span class="kd">←</span> <span class="o">⍴</span><span class="nv">f</span>
    <span class="nv">f</span><span class="sr">[</span><span class="m">1</span> <span class="nv">r</span><span class="sr">;</span><span class="m">1</span> <span class="nv">c</span><span class="sr">]</span> <span class="kd">←</span> <span class="s1">&#39;+&#39;</span>
    <span class="nv">f</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span> <span class="nv">towns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">+----------+
|Canberra  |
|Paris     |
|Washington|
|Moscow    |
|Martigues |
|Mexico    |
+----------+
</span></div></div>
</div>
<p>Here we used the very convenient indexing notation <code class="docutils literal notranslate"><span class="pre">f[1</span> <span class="pre">r;1</span> <span class="pre">c]</span></code> that allows us to access the positions <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">c</span></code> of the matrix <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
<p>Modifying this function to use the appropriate line-drawing symbols just means swapping the <code class="docutils literal notranslate"><span class="pre">'|-+'</span></code> in the original function. Care must be taken, however, when assigning the corners. With <code class="docutils literal notranslate"><span class="pre">f[1</span> <span class="pre">r;1</span> <span class="pre">c]</span> <span class="pre">←</span> <span class="pre">m</span></code> APL expects <code class="docutils literal notranslate"><span class="pre">m</span></code> to be a scalar <em>or</em> an array with the same shape as that of the left, and since <code class="docutils literal notranslate"><span class="pre">f[1</span> <span class="pre">r;1</span> <span class="pre">c]</span></code> is a 2 by 2 matrix, we will have to reshape the vector with the corners into a 2 by 2 matrix as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Frame</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">f</span> <span class="kd">←</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9474</span><span class="p">)</span> <span class="o">,</span> <span class="bp">⍵</span> <span class="o">,</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9474</span><span class="p">)</span>
    <span class="nv">f</span> <span class="kd">←</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9472</span><span class="p">)</span> <span class="o">⍪</span> <span class="nv">f</span> <span class="o">⍪</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9472</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">r</span> <span class="nv">c</span><span class="p">)</span> <span class="kd">←</span> <span class="o">⍴</span><span class="nv">f</span>
    <span class="nv">f</span><span class="sr">[</span><span class="m">1</span> <span class="nv">r</span><span class="sr">;</span><span class="m">1</span> <span class="nv">c</span><span class="sr">]</span> <span class="kd">←</span> <span class="m">2</span> <span class="m">2</span><span class="o">⍴</span><span class="nf">⎕UCS</span> <span class="m">9484</span> <span class="m">9488</span> <span class="m">9492</span> <span class="m">9496</span>
    <span class="nv">f</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span> <span class="nv">towns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┐
│Canberra  │
│Paris     │
│Washington│
│Moscow    │
│Martigues │
│Mexico    │
└──────────┘
</span></div></div>
</div>
<p><strong>Exercise 8</strong>:</p>
<p>Well, what if what we wrote actually works for vectors? Let’s give it a try:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span> <span class="s1">&#39;We are not out of the wood&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR
Frame[4] f[1 r;1 c]←2 2⍴⎕UCS 9484 9488 9492 9496
          ∧
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">RANK</span> <span class="pre">ERROR</span></code>? That makes no sense, after I frame <code class="docutils literal notranslate"><span class="pre">⍵</span></code> with the horizontal and vertical bars I have a framed matrix, I just need to update the corners… right? Wrong! Here’s what happens if you use <code class="docutils literal notranslate"><span class="pre">,</span></code> and <code class="docutils literal notranslate"><span class="pre">⍪</span></code> on a vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">text</span> <span class="kd">←</span> <span class="s1">&#39;We are not out of the wood&#39;</span>
<span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9472</span><span class="p">)</span> <span class="o">⍪</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9474</span><span class="p">)</span> <span class="o">,</span> <span class="nv">text</span> <span class="o">,</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9474</span><span class="p">)</span> <span class="o">⍪</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9472</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">─│We are not out of the wood│─
</span></div></div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">text</span></code> has shape</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26
</span></div></div>
</div>
<p>the primitives <code class="docutils literal notranslate"><span class="pre">,</span></code> and <code class="docutils literal notranslate"><span class="pre">⍪</span></code> work the same way. We need to turn input vectors into matrices with 1 row before we proceed with the framing process.</p>
<p>Let us define <code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">←</span> <span class="pre">⍴⍵</span></code> as the shape of the input <code class="docutils literal notranslate"><span class="pre">Frame</span></code> gets. If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a matrix, then <code class="docutils literal notranslate"><span class="pre">shape</span></code> is the appropriate shape, otherwise we need <code class="docutils literal notranslate"><span class="pre">⍵</span></code> to be reshaped into <code class="docutils literal notranslate"><span class="pre">1,shape</span></code>. In traditional programming languages we could use an <code class="docutils literal notranslate"><span class="pre">if-else</span></code> statement. However, dfns do not have support for such flow control structures and so we need to handle this matter in a different way.</p>
<p>A possibility is to create the vector <code class="docutils literal notranslate"><span class="pre">v←1,shape</span></code> and then index into it with care. If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a vector, <code class="docutils literal notranslate"><span class="pre">v</span></code> has 2 elements and we want both. If <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a matrix, <code class="docutils literal notranslate"><span class="pre">v</span></code> has 3 elements and we want the elements in positions <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code>. A way of generating the indices <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span></code> if <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a vector and <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code> if <code class="docutils literal notranslate"><span class="pre">⍵</span></code> is a matrix is with the expression <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">1+≢⍴⍵</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p><code class="docutils literal notranslate"><span class="pre">⍵</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">≢⍴⍵</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">1+≢⍴⍵</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>vector</p></td>
<td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p>1 2</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>matrix</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>2 3</p></td>
</tr>
</tbody>
</table>
<p>When implementing the function we don’t need to actually create <code class="docutils literal notranslate"><span class="pre">v</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Frame</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">shape</span> <span class="kd">←</span> <span class="p">(</span><span class="m">1</span><span class="o">,⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="sr">[</span><span class="m">0</span> <span class="m">1</span><span class="o">+≢⍴</span><span class="bp">⍵</span><span class="sr">]</span>
    <span class="nv">f</span> <span class="kd">←</span> <span class="nv">shape</span><span class="o">⍴</span><span class="bp">⍵</span>
    <span class="nv">f</span> <span class="kd">←</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9474</span><span class="p">)</span> <span class="o">,</span> <span class="nv">f</span> <span class="o">,</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9474</span><span class="p">)</span>
    <span class="nv">f</span> <span class="kd">←</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9472</span><span class="p">)</span> <span class="o">⍪</span> <span class="nv">f</span> <span class="o">⍪</span> <span class="p">(</span><span class="nf">⎕UCS</span> <span class="m">9472</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">r</span> <span class="nv">c</span><span class="p">)</span> <span class="kd">←</span> <span class="o">⍴</span><span class="nv">f</span>
    <span class="nv">f</span><span class="sr">[</span><span class="m">1</span> <span class="nv">r</span><span class="sr">;</span><span class="m">1</span> <span class="nv">c</span><span class="sr">]</span> <span class="kd">←</span> <span class="m">2</span> <span class="m">2</span><span class="o">⍴</span><span class="nf">⎕UCS</span> <span class="m">9484</span> <span class="m">9488</span> <span class="m">9492</span> <span class="m">9496</span>
    <span class="nv">f</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span> <span class="nv">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────────────────────┐
│We are not out of the wood│
└──────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Frame</span> <span class="nv">towns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┐
│Canberra  │
│Paris     │
│Washington│
│Moscow    │
│Martigues │
│Mexico    │
└──────────┘
</span></div></div>
</div>
<p><strong>Exercise 9</strong>:</p>
<p>The logic to solving this task resembles what we did in the first exercises. First we will find <em>Where</em> the first letter is, and then we will use indexing to put the second letter in those positions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Switch1</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="bp">⍵</span>
    <span class="nv">r</span><span class="sr">[</span><span class="o">⍸</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">=</span><span class="bp">⍵</span><span class="sr">]</span> <span class="kd">←</span> <span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span>
    <span class="nv">r</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;tc&#39;</span> <span class="nv">Switch1</span> <span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A bird in che hand is worch cwo in che bush
</span></div></div>
</div>
<p>We take the intermediate step of doing <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">⍵</span></code> because we can’t assign to <code class="docutils literal notranslate"><span class="pre">⍵</span></code> and so <code class="docutils literal notranslate"><span class="pre">⍵[⍸⍺[1]=⍵]</span> <span class="pre">←</span> <span class="pre">⍺[2]</span></code> wouldn’t work.</p>
<p><strong>Exercise 10</strong>:</p>
<p>A very obvious modification of the function above is to write</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Switch2</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">r</span> <span class="kd">←</span> <span class="bp">⍵</span>
    <span class="nv">r</span><span class="sr">[</span><span class="o">⍸</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">=</span><span class="bp">⍵</span><span class="sr">]</span> <span class="kd">←</span> <span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span>
    <span class="nv">r</span><span class="sr">[</span><span class="o">⍸</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">=</span><span class="bp">⍵</span><span class="sr">]</span> <span class="kd">←</span> <span class="bp">⍺</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span>
    <span class="nv">r</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ei&#39;</span> <span class="nv">Switch2</span> <span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A berd en thi hand es worth two en thi bush
</span></div></div>
</div>
<p>However, a really elegant solution becomes possible if we use the <em>Index Of</em> primitive and the concept of changing the frame of reference we discussed previously (cf. <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-changing-the-frame-of-reference"><span class="std std-numref">Section 3.13.2.1</span></a>). We used this concept to convert lower case letters into upper case letters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Switch2</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="nv">pos</span> <span class="kd">←</span> <span class="p">(</span><span class="bp">⍺</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍳</span><span class="bp">⍵</span>
    <span class="p">(</span><span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span> <span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="sr">[</span><span class="nv">pos</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ei&#39;</span> <span class="nv">Switch2</span> <span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">A berd en thi hand es worth two en thi bush
</span></div></div>
</div>
<p>What exactly is happening? Well, we are basically establishing the initial and final sets (as seen in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-changing-the-frame-of-reference"><span class="std std-numref">Section 3.13.2.1</span></a>) as the sentence itself, but preceded by the two characters. For the initial set, we have them in their input order (the <code class="docutils literal notranslate"><span class="pre">(⍺,⍵)</span></code> above) but for the final set we swap them (the <code class="docutils literal notranslate"><span class="pre">⍺[2</span> <span class="pre">1],⍵</span></code> above).</p>
<p>This establishes the following “conversion”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eiA</span> <span class="n">bird</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">hand</span> <span class="ow">is</span> <span class="n">worth</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">bush</span>
<span class="n">ieA</span> <span class="n">bird</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">hand</span> <span class="ow">is</span> <span class="n">worth</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">bush</span>
</pre></div>
</div>
<p>Whenever I have a character, I look for it in the first line, stopping as soon as I find it (that is what <code class="docutils literal notranslate"><span class="pre">⍳</span></code> does) and then I swap it with the corresponding character in the line below.</p>
<p>We can thus re-implement <code class="docutils literal notranslate"><span class="pre">Switch2</span></code> with more intermediate steps, to make this more obvious:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Switch2</span> <span class="kd">←</span> <span class="kt">{</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">initialSet</span> <span class="kd">←</span> <span class="bp">⍺</span><span class="o">,</span><span class="bp">⍵</span>
    <span class="nv">pos</span> <span class="kd">←</span> <span class="nv">initialSet</span><span class="o">⍳</span><span class="bp">⍵</span>
    <span class="vg">⎕</span><span class="kd">←</span> <span class="nv">finalSet</span> <span class="kd">←</span> <span class="bp">⍺</span><span class="sr">[</span><span class="m">2</span> <span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="bp">⍵</span>
    <span class="nv">finalSet</span><span class="sr">[</span><span class="nv">pos</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;ei&#39;</span> <span class="nv">Switch2</span> <span class="s1">&#39;A bird in the hand is worth two in the bush&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">eiA bird in the hand is worth two in the bush
ieA bird in the hand is worth two in the bush
A berd en thi hand es worth two en thi bush
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Some-Primitive-Functions.html" title="previous page"><span class="section-number">3. </span>Some Primitive Functions</a>
    <a class='right-next' id="next-link" href="Appendices.html" title="next page"><span class="section-number">5. </span>Appendices</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Bernard Legrand<br/>
        
            &copy; Copyright 1982-2020 by Dyalog Ltd.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>