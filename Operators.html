
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>11. Operators &#8212; Mastering Dyalog APL</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="12. Tacit Programming" href="Tacit-Programming.html" />
    <link rel="prev" title="10. Nested Arrays (Continued)" href="Nested-Arrays-Continued.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Mastering Dyalog APL</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction.html">
   1. Introduction - Will You Play APL With Me?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Getting-Started.html">
   2. Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Data-and-Variables.html">
   3. Data and Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Some-Primitive-Functions.html">
   4. Some Primitive Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="User-Defined-Functions.html">
   5. User-Defined Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="First-Aid-Kit.html">
   6. First-Aid Kit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Execute-and-Format-Control.html">
   7. Execute &amp; Format Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Working-on-Data-Shape.html">
   8. Working on Data Shape
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Special-Syntax.html">
   9. Special Syntax
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Nested-Arrays-Continued.html">
   10. Nested Arrays (Continued)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   11. Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Tacit-Programming.html">
   12. Tacit Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Appendices.html">
   13. Appendices
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Dyalog/MDAPL"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Dyalog/MDAPL/edit/master/docs/Operators.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/Operators.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#definitions">
   11.1. Definitions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operators-derived-functions">
     11.1.1. Operators &amp; Derived Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequences-of-operators">
     11.1.2. Sequences of Operators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-of-built-in-operators">
     11.1.3. List of Built-in Operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-about-some-operators-you-already-know">
   11.2. More About Some Operators You Already Know
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduce">
     11.2.1. Reduce
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#n-wise-reduce">
     11.2.2. n-Wise Reduce
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#elementary-definition">
       11.2.2.1. Elementary Definition
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#full-definition">
       11.2.2.2. Full Definition
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#axis">
     11.2.3. Axis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scan">
   11.3. Scan
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scan-with-binary-values">
     11.3.1. Scan with Binary Values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications">
     11.3.2. Applications
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inflate-values">
       11.3.2.1. Inflate Values
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#remove-leading-trailing-blanks">
       11.3.2.2. Remove Leading/Trailing Blanks
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outer-product">
   11.4. Outer Product
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extensions">
     11.4.1. Extensions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#other-functions">
       11.4.1.1. Other Functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#other-shapes-and-types-of-data">
       11.4.1.2. Other Shapes and Types of Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications-of-outer-product">
     11.4.2. Applications of Outer Product
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exhaustive-search">
       11.4.2.1. Exhaustive Search
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#draw-a-bar-chart">
       11.4.2.2. Draw a Bar Chart
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decreasing-refunding">
       11.4.2.3. Decreasing Refunding
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#outer-product-exercise">
     11.4.3. Outer Product Exercise
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inner-product">
   11.5. Inner Product
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-concrete-situation">
     11.5.1. A Concrete Situation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition-of-inner-product">
     11.5.2. Definition of Inner Product
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#typical-uses-of-inner-products">
     11.5.3. Typical Uses of Inner Products
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#two-simple-problems">
       11.5.3.1. Two Simple Problems
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-useful-family">
       11.5.3.2. A Useful Family
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-special-case-of-a-comparison-inner-product">
       11.5.3.3. A Special Case of a Comparison Inner Product
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#similar-applications">
       11.5.3.4. Similar Applications
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shortest-routes-in-a-graph">
       11.5.3.5. Shortest Routes in a Graph
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#is-a-graph-connected">
       11.5.3.6. Is a Graph Connected?
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-uses-of-inner-product">
     11.5.4. Other Uses of Inner Product
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application">
     11.5.5. Application
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intermission-exercises">
   11.6. Intermission Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#at">
   11.7. At
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-function-at-indices">
     11.7.1. Apply Function At Indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-dyadic-function-at-indices">
     11.7.2. Apply Dyadic Function At Indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#replace-values-at-indices">
     11.7.3. Replace Values At Indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#right-operand-as-selector">
     11.7.4. Right Operand as Selector
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#at-with-high-rank-arguments">
     11.7.5. At with High-Rank Arguments
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-operand-array">
       11.7.5.1. Right Operand Array
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-operand-function">
       11.7.5.2. Right Operand Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shape-of-the-left-operand">
       11.7.5.3. Shape of the Left Operand
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rank-operator">
   11.8. Rank Operator
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-arrays-in-the-monadic-case">
     11.8.1. Sub-Arrays in the Monadic Case
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-arrays-in-the-dyadic-case">
     11.8.2. Sub-Arrays in the Dyadic Case
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cells">
     11.8.3. Cells
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#negative-k">
       11.8.3.1. Negative
       <code class="docutils literal notranslate">
        <span class="pre">
         k
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#major-cells">
       11.8.3.2. Major Cells
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specifying-cells">
     11.8.4. Specifying Cells
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key">
   11.9. Key
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#key-with-high-rank-arguments">
     11.9.1. Key with High-Rank Arguments
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#order-of-the-result">
     11.9.2. Order of the Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications-of-key">
     11.9.3. Applications of Key
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#counting-unique-values">
       11.9.3.1. Counting Unique Values
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summarising-data-by-category">
       11.9.3.2. Summarising Data by Category
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stencil">
   11.10. Stencil
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#your-first-stencil">
     11.10.1. Your First Stencil
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#padding-and-window-size">
     11.10.2. Padding and Window Size
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-left-operand-function">
     11.10.3. The Left Operand Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stencil-for-any-rank">
     11.10.4. Stencil For Any Rank
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-size">
     11.10.5. Step Size
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#image-processing-with-stencil">
     11.10.6. Image Processing with Stencil
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power">
   11.11. Power
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#power-n-times">
     11.11.1. Power
     <code class="docutils literal notranslate">
      <span class="pre">
       n
      </span>
     </code>
     Times
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-execution">
     11.11.2. Conditional Execution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#left-argument">
     11.11.3. Left Argument
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverse-function">
     11.11.4. Inverse Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fixed-point-and-user-defined-operators">
     11.11.5. Fixed Point and User-Defined Operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spawn">
   11.12. Spawn
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#main-features">
     11.12.1. Main Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#special-syntax">
     11.12.2. Special Syntax
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#user-defined-operators">
   11.13. User-Defined Operators
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dops">
     11.13.1. Dops
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#traditional-operators">
     11.13.2. Traditional Operators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-basic-user-defined-operators">
     11.13.3. Some Basic User-Defined Operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-exercises">
   11.14. More Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   11.15. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduction-applied-to-empty-vectors">
     11.15.1. Reduction Applied to Empty Vectors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#operators-identities">
       11.15.1.1. Identities
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rule">
       11.15.1.2. Rule
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examples">
       11.15.1.3. Examples
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#non-commutative-functions">
       11.15.1.4. Non-Commutative Functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#application-to-n-wise-reduction">
       11.15.1.5. Application to n-Wise Reduction
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#index-origin-and-axis-operator">
     11.15.2. Index Origin and Axis Operator
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rank-outer-products">
     11.15.3. Rank Outer Products
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-full-rank-specification">
     11.15.4. The Full Rank Specification
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimised-left-operands-for-stencil">
     11.15.5. Optimised Left Operands for Stencil
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverting-functions-with-the-operator-power">
     11.15.6. Inverting Functions with the Operator Power
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#under">
     11.15.7. Under
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-result-of-an-inverse-function">
     11.15.8. The Result of an Inverse Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advanced-uses-of-the-operator-power">
     11.15.9. Advanced Uses of the Operator Power
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   11.16. Solutions
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Operators</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#definitions">
   11.1. Definitions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operators-derived-functions">
     11.1.1. Operators &amp; Derived Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequences-of-operators">
     11.1.2. Sequences of Operators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-of-built-in-operators">
     11.1.3. List of Built-in Operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-about-some-operators-you-already-know">
   11.2. More About Some Operators You Already Know
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduce">
     11.2.1. Reduce
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#n-wise-reduce">
     11.2.2. n-Wise Reduce
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#elementary-definition">
       11.2.2.1. Elementary Definition
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#full-definition">
       11.2.2.2. Full Definition
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#axis">
     11.2.3. Axis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scan">
   11.3. Scan
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scan-with-binary-values">
     11.3.1. Scan with Binary Values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications">
     11.3.2. Applications
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inflate-values">
       11.3.2.1. Inflate Values
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#remove-leading-trailing-blanks">
       11.3.2.2. Remove Leading/Trailing Blanks
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outer-product">
   11.4. Outer Product
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extensions">
     11.4.1. Extensions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#other-functions">
       11.4.1.1. Other Functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#other-shapes-and-types-of-data">
       11.4.1.2. Other Shapes and Types of Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications-of-outer-product">
     11.4.2. Applications of Outer Product
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exhaustive-search">
       11.4.2.1. Exhaustive Search
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#draw-a-bar-chart">
       11.4.2.2. Draw a Bar Chart
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decreasing-refunding">
       11.4.2.3. Decreasing Refunding
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#outer-product-exercise">
     11.4.3. Outer Product Exercise
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inner-product">
   11.5. Inner Product
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-concrete-situation">
     11.5.1. A Concrete Situation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition-of-inner-product">
     11.5.2. Definition of Inner Product
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#typical-uses-of-inner-products">
     11.5.3. Typical Uses of Inner Products
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#two-simple-problems">
       11.5.3.1. Two Simple Problems
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-useful-family">
       11.5.3.2. A Useful Family
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-special-case-of-a-comparison-inner-product">
       11.5.3.3. A Special Case of a Comparison Inner Product
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#similar-applications">
       11.5.3.4. Similar Applications
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shortest-routes-in-a-graph">
       11.5.3.5. Shortest Routes in a Graph
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#is-a-graph-connected">
       11.5.3.6. Is a Graph Connected?
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-uses-of-inner-product">
     11.5.4. Other Uses of Inner Product
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application">
     11.5.5. Application
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intermission-exercises">
   11.6. Intermission Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#at">
   11.7. At
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-function-at-indices">
     11.7.1. Apply Function At Indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-dyadic-function-at-indices">
     11.7.2. Apply Dyadic Function At Indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#replace-values-at-indices">
     11.7.3. Replace Values At Indices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#right-operand-as-selector">
     11.7.4. Right Operand as Selector
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#at-with-high-rank-arguments">
     11.7.5. At with High-Rank Arguments
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-operand-array">
       11.7.5.1. Right Operand Array
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#right-operand-function">
       11.7.5.2. Right Operand Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shape-of-the-left-operand">
       11.7.5.3. Shape of the Left Operand
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rank-operator">
   11.8. Rank Operator
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-arrays-in-the-monadic-case">
     11.8.1. Sub-Arrays in the Monadic Case
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-arrays-in-the-dyadic-case">
     11.8.2. Sub-Arrays in the Dyadic Case
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cells">
     11.8.3. Cells
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#negative-k">
       11.8.3.1. Negative
       <code class="docutils literal notranslate">
        <span class="pre">
         k
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#major-cells">
       11.8.3.2. Major Cells
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specifying-cells">
     11.8.4. Specifying Cells
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key">
   11.9. Key
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#key-with-high-rank-arguments">
     11.9.1. Key with High-Rank Arguments
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#order-of-the-result">
     11.9.2. Order of the Result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications-of-key">
     11.9.3. Applications of Key
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#counting-unique-values">
       11.9.3.1. Counting Unique Values
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summarising-data-by-category">
       11.9.3.2. Summarising Data by Category
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stencil">
   11.10. Stencil
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#your-first-stencil">
     11.10.1. Your First Stencil
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#padding-and-window-size">
     11.10.2. Padding and Window Size
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-left-operand-function">
     11.10.3. The Left Operand Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stencil-for-any-rank">
     11.10.4. Stencil For Any Rank
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-size">
     11.10.5. Step Size
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#image-processing-with-stencil">
     11.10.6. Image Processing with Stencil
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power">
   11.11. Power
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#power-n-times">
     11.11.1. Power
     <code class="docutils literal notranslate">
      <span class="pre">
       n
      </span>
     </code>
     Times
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-execution">
     11.11.2. Conditional Execution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#left-argument">
     11.11.3. Left Argument
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverse-function">
     11.11.4. Inverse Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fixed-point-and-user-defined-operators">
     11.11.5. Fixed Point and User-Defined Operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spawn">
   11.12. Spawn
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#main-features">
     11.12.1. Main Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#special-syntax">
     11.12.2. Special Syntax
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#user-defined-operators">
   11.13. User-Defined Operators
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dops">
     11.13.1. Dops
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#traditional-operators">
     11.13.2. Traditional Operators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-basic-user-defined-operators">
     11.13.3. Some Basic User-Defined Operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-exercises">
   11.14. More Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specialist-s-section">
   11.15. The Specialist’s Section
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduction-applied-to-empty-vectors">
     11.15.1. Reduction Applied to Empty Vectors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#operators-identities">
       11.15.1.1. Identities
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rule">
       11.15.1.2. Rule
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examples">
       11.15.1.3. Examples
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#non-commutative-functions">
       11.15.1.4. Non-Commutative Functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#application-to-n-wise-reduction">
       11.15.1.5. Application to n-Wise Reduction
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#index-origin-and-axis-operator">
     11.15.2. Index Origin and Axis Operator
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rank-outer-products">
     11.15.3. Rank Outer Products
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-full-rank-specification">
     11.15.4. The Full Rank Specification
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimised-left-operands-for-stencil">
     11.15.5. Optimised Left Operands for Stencil
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverting-functions-with-the-operator-power">
     11.15.6. Inverting Functions with the Operator Power
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#under">
     11.15.7. Under
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-result-of-an-inverse-function">
     11.15.8. The Result of an Inverse Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advanced-uses-of-the-operator-power">
     11.15.9. Advanced Uses of the Operator Power
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   11.16. Solutions
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="operators">
<span id="operators-operators"></span><h1><span class="section-number">11. </span>Operators<a class="headerlink" href="#operators" title="Permalink to this headline">#</a></h1>
<div class="section" id="definitions">
<span id="operators-definitions"></span><h2><span class="section-number">11.1. </span>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">#</a></h2>
<div class="section" id="operators-derived-functions">
<span id="operators-operators-derived-functions"></span><h3><span class="section-number">11.1.1. </span>Operators &amp; Derived Functions<a class="headerlink" href="#operators-derived-functions" title="Permalink to this headline">#</a></h3>
<p>We have already seen some operators: <em>reduce</em> (described in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-reduce"><span class="std std-numref">Section 4.8</span></a>), <em>axis</em> (described in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-axis-specification"><span class="std std-numref">Section 4.9</span></a>), and <em>each</em> (described in <a class="reference internal" href="Nested-Arrays-Continued.html#nested-arrays-continued-each"><span class="std std-numref">Section 10.5</span></a>.
Let us define precisely what they are:</p>
<ul class="simple">
<li><p>there are built-in (<em>primitive</em>) operators and user-defined operators;</p></li>
<li><p>an <em>operator</em> is similar to a function, but rather than working on arrays to produce a result which is also an array, an operator works on functions (and sometimes, arrays) to produce a new function;</p></li>
<li><p>the new function generated by the operator and its argument(s) is called a <em>derived function</em>. The derived function can be applied to arrays in the same way as any other function;</p></li>
<li><p>the arguments passed to the operator are often referred to as <em>operands</em>, to distinguish them from the arguments to the derived function;</p></li>
<li><p>monadic operators take a single operand on their <strong>left</strong>. This is in contrast to monadic functions, which take their argument on the right;</p></li>
<li><p>dyadic operators have two operands, one on each side. The operands to an operator are usually functions, but it is not uncommon for user-defined operators to take on function and one array operand;</p></li>
<li><p>the derived function, in turn, can be monadic, dyadic, or ambivalent; and</p></li>
<li><p>neither of the functions supplied as arguments to an operator, nor the resultant derived function, can be niladic.</p></li>
</ul>
<p>For example, in the expression below, the operator <em>reduce</em> (<code class="docutils literal notranslate"><span class="pre">/</span></code>) <em>operates on</em> the function <em>plus</em> to produce the derived function <em>plus reduce</em>.
This derived function is then applied to <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">5</span> <span class="pre">6</span></code> to produce the result <code class="docutils literal notranslate"><span class="pre">14</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">14
</span></div></div>
</div>
<div class="warning admonition">
<p class="admonition-title">Beware</p>
<p>You must not be confused by the fact that some symbols are used to represent both a function and an operator, such as <code class="docutils literal notranslate"><span class="pre">/</span></code> and <code class="docutils literal notranslate"><span class="pre">\</span></code>, for example.</p>
</div>
<p>Let us compare two expressions:</p>
<ol class="simple">
<li><p>using <code class="docutils literal notranslate"><span class="pre">/</span></code> as the function <em>compress</em>, which takes two array arguments:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="na">/</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6 2 4
</span></div></div>
</div>
<ol class="simple">
<li><p>using <code class="docutils literal notranslate"><span class="pre">/</span></code> as the operator <em>reduce</em>, which takes a function as a left operand:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26
</span></div></div>
</div>
<p>The association of <code class="docutils literal notranslate"><span class="pre">+</span></code> with <code class="docutils literal notranslate"><span class="pre">/</span></code> creates a <em>derived function</em> which could be parenthesised as <code class="docutils literal notranslate"><span class="pre">(+/)</span></code>, even though it is not necessary to do so.</p>
<p>For clarification, we can define a synonym for the derived function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Until now, we have only considered <code class="docutils literal notranslate"><span class="pre">+/</span></code> (or <code class="docutils literal notranslate"><span class="pre">Sum</span></code>) as a monadic derived function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sum</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26
</span></div></div>
</div>
<p>But we shall soon see that it may also be used as a dyadic function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">Sum</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8 11 13 9
</span></div></div>
</div>
<p>So, we can say that this <em>derived function</em> is <em>ambivalent</em>.</p>
</div>
<div class="section" id="sequences-of-operators">
<span id="operators-sequences-of-operators"></span><h3><span class="section-number">11.1.2. </span>Sequences of Operators<a class="headerlink" href="#sequences-of-operators" title="Permalink to this headline">#</a></h3>
<p><em>Derived functions</em> behave exactly like plain primitive functions.
So, they can be the argument of a second (and a third, …) operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/¨</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 21 4
</span></div></div>
</div>
<p>The left argument of the operator <em>each</em> <code class="docutils literal notranslate"><span class="pre">¨</span></code> is the derived function <code class="docutils literal notranslate"><span class="pre">+/</span></code>, so we could have written:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Sum</span><span class="na">¨</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 21 4
</span></div></div>
</div>
<p>Now, suppose that we no longer want to add up vectors, but three small matrices instead:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
4 5 6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0
0 1
0 1
1 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">8</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8 3 4 2 0
0 3 5 1 7
3 6 2 1 7
</span></div></div>
</div>
<p>Because they are matrices, we must specify the axis along which we add them up.
Of course, we could use the two symbols <code class="docutils literal notranslate"><span class="pre">/</span></code> and <code class="docutils literal notranslate"><span class="pre">⌿</span></code>, but if the arrays had been of a higher rank, an explicit axis specification might have been necessary.
It could also be that we just prefer to use the explicit axis specification.
If so, a third level of operator⁽*⁾ can be added:</p>
<div class="note admonition">
<p class="admonition-title">Footnote</p>
<p>Although the <em>axis specification</em> shares some properties with operators, it is a special syntactical element and not really an operator. See <a class="reference internal" href="#operators-axis"><span class="std std-numref">Section 11.2.3</span></a> for more information.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="na">¨</span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">C</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───────┬────────┐
│6 15│1 1 1 1│17 16 19│
└────┴───────┴────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="na">¨</span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">C</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬───┬─────────────┐
│5 7 9│2 2│11 12 11 4 14│
└─────┴───┴─────────────┘
</span></div></div>
</div>
<p>When in doubt regarding what is the function operand to which operator, try parenthesising everything successively, to make it clearer what derived functions come from where.</p>
<p>In the two examples above, the first operator is <code class="docutils literal notranslate"><span class="pre">/</span></code>, then the second “operator” is <code class="docutils literal notranslate"><span class="pre">[]</span></code>, and the third operator is <code class="docutils literal notranslate"><span class="pre">¨</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(((</span><span class="o">+</span><span class="na">/</span><span class="p">)</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">)</span><span class="na">¨</span><span class="p">)</span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">C</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───────┬────────┐
│6 15│1 1 1 1│17 16 19│
└────┴───────┴────────┘
</span></div></div>
</div>
</div>
<div class="section" id="list-of-built-in-operators">
<span id="operators-list-of-built-in-operators"></span><h3><span class="section-number">11.1.3. </span>List of Built-in Operators<a class="headerlink" href="#list-of-built-in-operators" title="Permalink to this headline">#</a></h3>
<p>Dyalog APL has a rich set of built-in operators.
You will find a full list with detailed syntax and examples in <a class="reference internal" href="Appendices.html#appendices-dyalog-apl-operators"><span class="std std-numref">Section 13.4</span></a>.</p>
</div>
</div>
<div class="section" id="more-about-some-operators-you-already-know">
<span id="operators-more-about-some-operators-you-already-know"></span><h2><span class="section-number">11.2. </span>More About Some Operators You Already Know<a class="headerlink" href="#more-about-some-operators-you-already-know" title="Permalink to this headline">#</a></h2>
<div class="section" id="reduce">
<span id="operators-reduce"></span><h3><span class="section-number">11.2.1. </span>Reduce<a class="headerlink" href="#reduce" title="Permalink to this headline">#</a></h3>
<p>Up to now, we have used the operator <em>reduce</em> with rather basic functions (<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">×</span></code>, <code class="docutils literal notranslate"><span class="pre">⌈</span></code>, <code class="docutils literal notranslate"><span class="pre">∧</span></code>), but it can also be used, less obviously, with functions like <em>reshape</em>, <em>compress</em>, and <em>replicate</em>.
In these cases, the derived function typically takes a 2-item nested vector as its argument, and the effect is to insert the function (the operand to the operator) between the two items of this vector.</p>
<p>Just remember that, since <code class="docutils literal notranslate"><span class="pre">+/</span> <span class="pre">(2</span> <span class="pre">4</span> <span class="pre">3)(7</span> <span class="pre">1</span> <span class="pre">5)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">⊂(2</span> <span class="pre">4</span> <span class="pre">3)</span> <span class="pre">+</span> <span class="pre">(7</span> <span class="pre">1</span> <span class="pre">5)</span></code>, then <code class="docutils literal notranslate"><span class="pre">⍴/</span> <span class="pre">(2</span> <span class="pre">4</span> <span class="pre">3)(7</span> <span class="pre">1</span> <span class="pre">5)</span></code> is also equivalent to <code class="docutils literal notranslate"><span class="pre">⊂(2</span> <span class="pre">4</span> <span class="pre">3)</span> <span class="pre">⍴</span> <span class="pre">(7</span> <span class="pre">1</span> <span class="pre">5)</span></code>.</p>
<p>Here is an example of a <em>reduction by reshape</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">/</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="p">)(</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│3 1 9 4 1│
│0 7 3 1 9│
└─────────┘
</span></div></div>
</div>
<p>This <em>looks</em> very similar to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 1 9 4 1
0 7 3 1 9
</span></div></div>
</div>
<p>But we can see the results are different.
The result of the <em>reduction by reshape</em> is not a matrix, but a scalar containing a <em>nested</em> matrix, for the reason already seen in <a class="reference internal" href="Nested-Arrays-Continued.html#nested-arrays-continued-reduction"><span class="std std-numref">Section 10.6.4.1</span></a>: the reduction of a vector always gives a scalar.</p>
<p>Now, here is a <em>reduction by compression</em>, another by <em>replication</em>, and one by <em>index of</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="na">//</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="s1">&#39;Strange&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┐
│Stage│
└─────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="na">//</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="s1">&#39;Strange&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│Staaaagee│
└─────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍳</span><span class="na">/</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">7</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┐
│5 4 5 5│
│1 5 2 5│
└───────┘
</span></div></div>
</div>
</div>
<div class="section" id="n-wise-reduce">
<span id="operators-n-wise-reduce"></span><h3><span class="section-number">11.2.2. </span>n-Wise Reduce<a class="headerlink" href="#n-wise-reduce" title="Permalink to this headline">#</a></h3>
<div class="section" id="elementary-definition">
<span id="operators-elementary-definition"></span><h4><span class="section-number">11.2.2.1. </span>Elementary Definition<a class="headerlink" href="#elementary-definition" title="Permalink to this headline">#</a></h4>
<p>The derived functions of <em>reduce</em> can be used with two arguments.
When the second argument is present, the form is called <em>n-wise reduce</em>.</p>
<p>When applied to vectors, <em>n-wise reduce</em> has the syntax <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">n</span> <span class="pre">F/</span> <span class="pre">vector</span></code>, where <code class="docutils literal notranslate"><span class="pre">F</span></code> denotes a dyadic function.</p>
<p>This special kind of <em>reduce</em> splits the vector into overlapping slices of length equal to <code class="docutils literal notranslate"><span class="pre">n</span></code>, reduces each slice using the specified function <code class="docutils literal notranslate"><span class="pre">F</span></code>, and then catenates the results together.</p>
<p>So, for example, <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">×/</span> <span class="pre">8</span> <span class="pre">10</span> <span class="pre">7</span> <span class="pre">2</span> <span class="pre">6</span> <span class="pre">11</span></code> starts by creating overlapping slices of length <code class="docutils literal notranslate"><span class="pre">2</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="p">)(</span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="p">)(</span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬────┬───┬───┬────┐
│8 10│10 7│7 2│2 6│6 11│
└────┴────┴───┴───┴────┘
</span></div></div>
</div>
<p>Then, we apply the reduction <code class="docutils literal notranslate"><span class="pre">×/</span></code> on each slice and catenate everything:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">×</span><span class="na">/</span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">80 70 14 12 66
</span></div></div>
</div>
<p>You can verify that this is, indeed, the result we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">×</span><span class="na">/</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">80 70 14 12 66
</span></div></div>
</div>
<p>As another example, we can explain the result of</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">25 19 15 19
</span></div></div>
</div>
<p>because we create overlapping slices of length <code class="docutils literal notranslate"><span class="pre">3</span></code>, apply <em>plus-reduce</em> on each slice, and then catenate everything together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">25 19 15 19
</span></div></div>
</div>
<p>The length of the result vector is <code class="docutils literal notranslate"><span class="pre">(1+≢vector)-n</span></code>.</p>
<p>In the two examples above, we did not really need to do the catenation explicitly, because the results of applying <code class="docutils literal notranslate"><span class="pre">×/</span></code> and <code class="docutils literal notranslate"><span class="pre">+/</span></code> on each slice were simple scalars.
However, if we try an example where the reduction gives a nested result, we will see that we <em>do</em> need to catenate everything together.</p>
<p>Here is an example of an <em>n-wise catenate reduction</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">,</span><span class="na">/</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬────┬───┬───┬────┐
│8 10│10 7│7 2│2 6│6 11│
└────┴────┴───┴───┴────┘
</span></div></div>
</div>
<p>If we create the overlapping slices by hand and do not catenate the results together, we get a result that is nested too deep:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">,</span><span class="na">/</span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="p">)(</span><span class="o">,</span><span class="na">/</span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="p">)(</span><span class="o">,</span><span class="na">/</span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="o">,</span><span class="na">/</span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="p">)(</span><span class="o">,</span><span class="na">/</span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┬─────┬─────┬──────┐
│┌────┐│┌────┐│┌───┐│┌───┐│┌────┐│
││8 10│││10 7│││7 2│││2 6│││6 11││
│└────┘│└────┘│└───┘│└───┘│└────┘│
└──────┴──────┴─────┴─────┴──────┘
</span></div></div>
</div>
<p>Thus, we do have to catenate the results after applying the reduction to each slice:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">,</span><span class="na">/</span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">,</span><span class="na">/</span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">,</span><span class="na">/</span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">,</span><span class="na">/</span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">,</span><span class="na">/</span><span class="m">6</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬────┬───┬───┬────┐
│8 10│10 7│7 2│2 6│6 11│
└────┴────┴───┴───┴────┘
</span></div></div>
</div>
</div>
<div class="section" id="full-definition">
<span id="operators-full-definition"></span><h4><span class="section-number">11.2.2.2. </span>Full Definition<a class="headerlink" href="#full-definition" title="Permalink to this headline">#</a></h4>
<p>The general syntax is <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">n</span> <span class="pre">F/[axis]</span> <span class="pre">array</span></code>, where <code class="docutils literal notranslate"><span class="pre">F</span></code> stands for any dyadic function.</p>
<ul class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">array</span></code> is split into slices along the specified <code class="docutils literal notranslate"><span class="pre">axis</span></code>;</p></li>
<li><p>the left argument <code class="docutils literal notranslate"><span class="pre">n</span></code> can be positive (as in the examples above), zero, or negative;</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">n</span></code> is positive, <em>reduce</em> is applied to slices of length equal to <code class="docutils literal notranslate"><span class="pre">n</span></code>;</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">n</span></code> is zero, the result is an array with the same shape as <em>array</em>, except that its length along the axis selected by <code class="docutils literal notranslate"><span class="pre">axis</span></code> is incremented by 1 and filled with the <em>identity item</em> for the function <code class="docutils literal notranslate"><span class="pre">F</span></code>. This is explained in <a class="reference internal" href="#operators-application-to-n-wise-reduction"><span class="std std-numref">Section 11.15.1.5</span></a>; and</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">n</span></code> is negative, each slice is reversed before <em>reduce</em> is applied.</p></li>
</ul>
<p>Here are some examples which use the matrix below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tam</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Find the largest items of 2 adjacent columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">⌈</span><span class="na">/</span><span class="w"> </span><span class="nv">tam</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5 8 8
6 6 5 9
4 9 9 8
</span></div></div>
</div>
<p>Add up pairs of adjacent rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="na">⌿</span><span class="w"> </span><span class="nv">tam</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6  9  7 13 17
5 10 11 12 17
</span></div></div>
</div>
<p>Return a matrix with one more column, filled with zeroes (identity item of addition):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="nv">tam</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0
0 0 0 0 0 0
0 0 0 0 0 0
</span></div></div>
</div>
<p>Return a matrix with one more row, filled with ones (identity item of multiplication):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="o">×</span><span class="na">/</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="nv">tam</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1
1 1 1 1 1
1 1 1 1 1
1 1 1 1 1
</span></div></div>
</div>
<p>Obtain the differences between adjacent values <code class="docutils literal notranslate"><span class="pre">(14-11)(15-14)...</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯2</span><span class="w"> </span><span class="o">-</span><span class="na">/</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">34</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 1 6 2 7 ¯2 6
</span></div></div>
</div>
</div>
</div>
<div class="section" id="axis">
<span id="operators-axis"></span><h3><span class="section-number">11.2.3. </span>Axis<a class="headerlink" href="#axis" title="Permalink to this headline">#</a></h3>
<p>Strictly speaking, <em>axis</em> is not an operator.
It has different syntax (consisting of two brackets enclosing a numeric value to the right of a function) and applies in different ways depending on the function that it modifies (its operand).
However, applying a function “with <em>axis</em>” does apply a transformation and produces a derived function, and it is common to think of <em>axis</em> as an operator.</p>
<p>It is possible to use <em>axis</em> with any of the scalar dyadic functions.
This can be useful, for example, to add the items of a vector to each of the rows of a matrix, or multiply the columns of a matrix by different values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tam</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 3 5 8 8
4 6 2 5 9
1 4 9 7 8
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tam</span><span class="w"> </span><span class="o">+</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 11 13 16 16
10 12  8 11 15
10 13 18 16 17
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tam</span><span class="w"> </span><span class="o">×</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 15 0 16 8
8 30 0 10 9
2 20 0 14 8
</span></div></div>
</div>
<p>The list of all scalar dyadic functions is given in <a class="reference internal" href="Appendices.html#appendices-scalar-functions"><span class="std std-numref">Section 13.1</span></a>.</p>
<p>The following functions can also use <em>axis</em>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Monadic Function</p></th>
<th class="text-align:left head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">↑</span></code> and <code class="docutils literal notranslate"><span class="pre">↓</span></code></p></td>
<td class="text-align:left"><p><em>mix</em> and <em>split</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⌽</span></code> <code class="docutils literal notranslate"><span class="pre">⊖</span></code></p></td>
<td class="text-align:left"><p><em>reverse</em></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">,</span></code></p></td>
<td class="text-align:left"><p><em>ravel with axis</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⊂</span></code></p></td>
<td class="text-align:left"><p><em>enclose with axis</em>, <em>partitioned enclose</em></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⊂</span></code> and <code class="docutils literal notranslate"><span class="pre">⊃</span></code></p></td>
<td class="text-align:left"><p>if <code class="docutils literal notranslate"><span class="pre">⎕ML&gt;1</span></code>, APL2-like <em>split</em> and <em>mix</em>, c.f. <a class="reference internal" href="Nested-Arrays-Continued.html#nested-arrays-continued-compatibility-and-migration-level"><span class="std std-numref">Section 10.16.1</span></a></p></td>
</tr>
</tbody>
</table>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Dyadic Function</p></th>
<th class="text-align:left head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">+</span></code> <code class="docutils literal notranslate"><span class="pre">×</span></code> <code class="docutils literal notranslate"><span class="pre">⌈</span></code> <code class="docutils literal notranslate"><span class="pre">∧</span></code> <code class="docutils literal notranslate"><span class="pre">≤</span></code> etc…</p></td>
<td class="text-align:left"><p>all scalar dyadic functions</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">↑</span></code> and <code class="docutils literal notranslate"><span class="pre">↓</span></code></p></td>
<td class="text-align:left"><p><em>take</em> and <em>drop</em></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">/</span></code> and <code class="docutils literal notranslate"><span class="pre">⌿</span></code></p></td>
<td class="text-align:left"><p><em>compress</em> and <em>replicate</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">\</span></code> and <code class="docutils literal notranslate"><span class="pre">⍀</span></code></p></td>
<td class="text-align:left"><p><em>expand</em> and <em>scan</em> (see next section)</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⌽</span></code> <code class="docutils literal notranslate"><span class="pre">⊖</span></code></p></td>
<td class="text-align:left"><p><em>rotate</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">,</span></code> <code class="docutils literal notranslate"><span class="pre">⍪</span></code></p></td>
<td class="text-align:left"><p><em>catenate</em></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">,</span></code> <code class="docutils literal notranslate"><span class="pre">⍪</span></code></p></td>
<td class="text-align:left"><p><em>laminate</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">⊂</span></code></p></td>
<td class="text-align:left"><p><em>partitioned enclose</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="scan">
<span id="operators-scan"></span><h2><span class="section-number">11.3. </span>Scan<a class="headerlink" href="#scan" title="Permalink to this headline">#</a></h2>
<p><em>Scan</em> is represented by the symbol <code class="docutils literal notranslate"><span class="pre">\</span></code> or <code class="docutils literal notranslate"><span class="pre">⍀</span></code>.
Its most general syntax is <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">F\[axis]</span> <span class="pre">array</span></code>, where <code class="docutils literal notranslate"><span class="pre">F</span></code> stands for any appropriate dyadic function.</p>
<p>To understand how it works, let us apply it to a vector.</p>
<p>The nth item of <code class="docutils literal notranslate"><span class="pre">F\vector</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">F/n↑vector</span></code>. A worked example follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 9 10 18 23
</span></div></div>
</div>
<ol class="simple">
<li><p>the 1st item is equal to <code class="docutils literal notranslate"><span class="pre">+/3</span></code>, which is <code class="docutils literal notranslate"><span class="pre">3</span></code>;</p></li>
<li><p>the 2nd item is equal to <code class="docutils literal notranslate"><span class="pre">+/3</span> <span class="pre">6</span></code>, which is <code class="docutils literal notranslate"><span class="pre">9</span></code>;</p></li>
<li><p>the 3rd item is equal to <code class="docutils literal notranslate"><span class="pre">+/3</span> <span class="pre">6</span> <span class="pre">1</span></code>, which is <code class="docutils literal notranslate"><span class="pre">10</span></code>;</p></li>
<li><p>the 4th item is equal to <code class="docutils literal notranslate"><span class="pre">+/3</span> <span class="pre">6</span> <span class="pre">1</span> <span class="pre">8</span></code>, which is <code class="docutils literal notranslate"><span class="pre">18</span></code>; and</p></li>
<li><p>the 5th item is equal to <code class="docutils literal notranslate"><span class="pre">+/3</span> <span class="pre">6</span> <span class="pre">1</span> <span class="pre">8</span> <span class="pre">5</span></code>, which is <code class="docutils literal notranslate"><span class="pre">23</span></code>.</p></li>
</ol>
<p>Try to use a reasoning similar to the one above to understand the result of the <em>times scan</em> shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">\</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 18 18 144 720
</span></div></div>
</div>
<p>Warning!
It would be a mistake to always try to deduce the value of each item in the result from its immediate left neighbour.
While it is possible to do this for commutative functions like addition and multiplication, it is not appropriate for non-commutative functions like subtraction.</p>
<p>In fact, the result of <code class="docutils literal notranslate"><span class="pre">-\</span> <span class="pre">3</span> <span class="pre">6</span> <span class="pre">1</span> <span class="pre">8</span> <span class="pre">5</span></code> is <strong>not</strong> <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">¯3</span> <span class="pre">¯4</span> <span class="pre">¯12</span> <span class="pre">¯17</span></code>, but something else entirely:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">\</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 ¯3 ¯2 ¯10 ¯5
</span></div></div>
</div>
<ol class="simple">
<li><p>the 1st item is equal to <code class="docutils literal notranslate"><span class="pre">-/3</span></code>, which is <code class="docutils literal notranslate"><span class="pre">3</span></code>;</p></li>
<li><p>the 2nd item is equal to <code class="docutils literal notranslate"><span class="pre">-/3</span> <span class="pre">6</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯3</span></code>;</p></li>
<li><p>the 3rd item is equal to <code class="docutils literal notranslate"><span class="pre">-/3</span> <span class="pre">6</span> <span class="pre">1</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯2</span></code>, the result of <code class="docutils literal notranslate"><span class="pre">3-6-1</span></code> and <strong>not</strong> <code class="docutils literal notranslate"><span class="pre">(3-6)-1</span></code>;</p></li>
<li><p>the 4th item is equal to <code class="docutils literal notranslate"><span class="pre">-/3</span> <span class="pre">6</span> <span class="pre">1</span> <span class="pre">8</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯10</span></code>; and</p></li>
<li><p>the 5th item is equal to <code class="docutils literal notranslate"><span class="pre">-/3</span> <span class="pre">6</span> <span class="pre">1</span> <span class="pre">8</span> <span class="pre">5</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯5</span></code>.</p></li>
</ol>
<p>So, be careful when using <em>scan</em> with non-commutative functions.</p>
<p>When applied to matrices or higher-rank arrays, <em>scan</em> works along the specified axis.
If the axis specification is omitted, <code class="docutils literal notranslate"><span class="pre">\</span></code> works along the <em>last</em> axis and <code class="docutils literal notranslate"><span class="pre">⍀</span></code> works along the <em>first</em> axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">tam</span><span class="w">  </span><span class="c1">⍝ same as +\tam</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2  5 10 18 26
4 10 12 17 26
1  5 14 21 29
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="nv">tam</span><span class="w">  </span><span class="c1">⍝ same as +⍀tam</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2  3  5  8  8
6  9  7 13 17
7 13 16 20 25
</span></div></div>
</div>
<div class="section" id="scan-with-binary-values">
<span id="operators-scan-with-binary-values"></span><h3><span class="section-number">11.3.1. </span>Scan with Binary Values<a class="headerlink" href="#scan-with-binary-values" title="Permalink to this headline">#</a></h3>
<p><em>Scan</em> is very useful when applied to binary values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">\</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 1 1 1 1 1 1 1
</span></div></div>
</div>
<p>Because the function <em>or</em> gives the result <code class="docutils literal notranslate"><span class="pre">1</span></code> as soon as one of its arguments is <code class="docutils literal notranslate"><span class="pre">1</span></code>, <em>or-scan</em> repeats the first <code class="docutils literal notranslate"><span class="pre">1</span></code> up to the end of the vector.
In a way, you can see <code class="docutils literal notranslate"><span class="pre">∨\</span></code> as a knife spreading butter from left to right, and the <code class="docutils literal notranslate"><span class="pre">1</span></code> is the butter.</p>
<p>Other interesting patterns can be obtained by changing the function used.
For example, you can get the effect of “a knife spreading butter”, where the <code class="docutils literal notranslate"><span class="pre">0</span></code> is the butter, if you use <code class="docutils literal notranslate"><span class="pre">∧\</span></code> instead of <code class="docutils literal notranslate"><span class="pre">∨\</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∧</span><span class="na">\</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 0 0 0 0 0 0 0 0
</span></div></div>
</div>
<p>In the example above, as soon as <em>and-scan</em> finds a <code class="docutils literal notranslate"><span class="pre">0</span></code>, everything else turns into a <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>The <em>less-than-scan</em> marks the position of the first <code class="docutils literal notranslate"><span class="pre">1</span></code> and the <em>less-than-or-equal-scan</em> marks the position of the first <code class="docutils literal notranslate"><span class="pre">0</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="na">\</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 0 0 0 0 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≤</span><span class="na">\</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 0 1 1 1 1 1 1 1
</span></div></div>
</div>
</div>
<div class="section" id="applications">
<span id="operators-applications"></span><h3><span class="section-number">11.3.2. </span>Applications<a class="headerlink" href="#applications" title="Permalink to this headline">#</a></h3>
<p><em>Scan</em> can be used to solve common problems in a very simple way:</p>
<div class="section" id="inflate-values">
<span id="operators-inflate-values"></span><h4><span class="section-number">11.3.2.1. </span>Inflate Values<a class="headerlink" href="#inflate-values" title="Permalink to this headline">#</a></h4>
<p>Someone forecasts investments in a foreign country for the next five years:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inv</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2000</span><span class="w"> </span><span class="m">5000</span><span class="w"> </span><span class="m">6000</span><span class="w"> </span><span class="m">4000</span><span class="w"> </span><span class="m">2000</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>But the country in question suffers from inflation, and the inflation rates are forecasted as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inf</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2.6</span><span class="w"> </span><span class="m">2.9</span><span class="w"> </span><span class="m">3.4</span><span class="w"> </span><span class="m">3.1</span><span class="w"> </span><span class="m">2.7</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The cumulative sequence of these inflation rates can be calculated by multiplying them all with a <em>multiply-scan</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="w"> </span><span class="m">3</span><span class="o">⍕</span><span class="w"> </span><span class="o">×</span><span class="na">\</span><span class="w"> </span><span class="m">1</span><span class="o">+</span><span class="nv">inf</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  1.026  1.056  1.092  1.125  1.156
</span></div></div>
</div>
<p>Now, the investments expressed in “future values” would be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">9</span><span class="w"> </span><span class="m">2</span><span class="o">⍕</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="o">×</span><span class="na">\</span><span class="m">1</span><span class="o">+</span><span class="nv">inf</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  2052.00  5278.77  6549.90  4501.96  2311.76
</span></div></div>
</div>
<p>Finally, the year after year cumulative investment may be obtained by a <em>plus-scan</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">9</span><span class="w"> </span><span class="m">2</span><span class="o">⍕</span><span class="w"> </span><span class="o">+</span><span class="na">\</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="o">×</span><span class="na">\</span><span class="m">1</span><span class="o">+</span><span class="nv">inf</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  2052.00  7330.77 13880.67 18382.63 20694.39
</span></div></div>
</div>
<p>As you can see, we employed two <em>scans</em> in the same expression.</p>
</div>
<div class="section" id="remove-leading-trailing-blanks">
<span id="operators-remove-leadingtrailing-blanks"></span><h4><span class="section-number">11.3.2.2. </span>Remove Leading/Trailing Blanks<a class="headerlink" href="#remove-leading-trailing-blanks" title="Permalink to this headline">#</a></h4>
<p>One often has to remove leading (or trailing) blanks from a character vector.
We can use the <em>or-scan</em> to do it.
The details of the method are shown here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">lb</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;    Remove my 4 leading blanks.&#39;</span><span class="w"></span>
<span class="nv">lb</span><span class="o">≠</span><span class="s1">&#39; &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 1 1 1 1 1 0 1 1 0 1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">\</span><span class="w"> </span><span class="nv">lb</span><span class="o">≠</span><span class="s1">&#39; &#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">∨</span><span class="na">\</span><span class="w"> </span><span class="nv">lb</span><span class="o">≠</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="na">/</span><span class="nv">lb</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Remove my 4 leading blanks.
</span></div></div>
</div>
<p>This can be coded into a small utility function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CutBlanks</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">∨</span><span class="na">\</span><span class="s1">&#39; &#39;</span><span class="o">≠</span><span class="bp">⍵</span><span class="p">)</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>This expression is recognised by Dyalog APL as an <em>idiom</em> and is thus very fast.</p>
<p>To remove trailing blanks, it would suffice to reverse the vector, remove leading blanks as above, and then reverse it back again.</p>
</div>
</div>
</div>
<div class="section" id="outer-product">
<span id="operators-outer-product"></span><h2><span class="section-number">11.4. </span>Outer Product<a class="headerlink" href="#outer-product" title="Permalink to this headline">#</a></h2>
<p>Imagine that you have calculated the multiplication table for the integers 1 to 9; you could present it like this:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{|c|rrrrrrrrr|}
\hline
\color{red}\times &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 &amp; \color{red} 7 &amp; 8 &amp; 9 \\
\hline
1 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 &amp; 7 &amp; 8 &amp; 9 \\
2 &amp; 2 &amp; 4 &amp; 6 &amp; 8 &amp; 10 &amp; 12 &amp; 14 &amp; 16 &amp; 18 \\
\color{red} 3 &amp; 3 &amp; 6 &amp; 9 &amp; 12 &amp; 15 &amp; 18 &amp; \color{red} {21} &amp; 24 &amp; 27 \\
4 &amp; 4 &amp; 8 &amp; 12 &amp; 16 &amp; 20 &amp; 24 &amp; 28 &amp; 32 &amp; 36 \\
\text{etc.} &amp; \text{etc.} &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \\
9 &amp; 9 &amp; 18 &amp; 27 &amp; 36 &amp; 45 &amp; 54 &amp; 63 &amp; 72 &amp; 81 \\
\hline
\end{array}\end{split}\]</div>
<p>The task of calculating this table consists of taking pairs of items of two vectors (the column and row headings) and combining them with the function at the top left.
For example, <code class="docutils literal notranslate"><span class="pre">3</span></code> times <code class="docutils literal notranslate"><span class="pre">7</span></code> gives <code class="docutils literal notranslate"><span class="pre">21</span></code> (highlighted in red above).
Once the operation has been repeated for all the possible pairs, one obtains what is called, in APL, the <em>outer product</em>.</p>
<p>We can change the values and replace the multiplications with additions:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{|c|rrrrrr|}
\hline
\color{red}+ &amp; 8 &amp; 5 &amp; 15 &amp; \color{red} 9 &amp; 11 &amp; 40\\
\hline
5 &amp; 13 &amp; 10 &amp; 20 &amp; 14 &amp; 16 &amp; 45 \\
\color{red} 4 &amp; 12 &amp; 9 &amp; 19 &amp; \color{red} 13 &amp; 15 &amp; 44 \\
10 &amp; 18 &amp; 15 &amp; 25 &amp; 19 &amp; 22 &amp; 50 \\
3 &amp; 11 &amp; 8 &amp; 18 &amp; 12 &amp; 14 &amp; 43 \\
\hline
\end{array}\end{split}\]</div>
<p>The <em>outer product</em> operator looks like <code class="docutils literal notranslate"><span class="pre">∘.F</span></code>, where <code class="docutils literal notranslate"><span class="pre">F</span></code> is an appropriate dyadic function.
The symbol <code class="docutils literal notranslate"><span class="pre">∘</span></code> is a <em>jot</em> and you can type it with <kbd>APL</kbd>+<kbd>j</kbd>.</p>
<p>For example, for the multiplication table you can use <code class="docutils literal notranslate"><span class="pre">∘.×</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳</span><span class="m">9</span><span class="p">)</span><span class="w"> </span><span class="na">∘.</span><span class="o">×</span><span class="w"> </span><span class="o">⍳</span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1  2  3  4  5  6  7  8  9
2  4  6  8 10 12 14 16 18
3  6  9 12 15 18 21 24 27
4  8 12 16 20 24 28 32 36
5 10 15 20 25 30 35 40 45
6 12 18 24 30 36 42 48 54
7 14 21 28 35 42 49 56 63
8 16 24 32 40 48 56 64 72
9 18 27 36 45 54 63 72 81
</span></div></div>
</div>
<p>And for the addition table above, you can use <code class="docutils literal notranslate"><span class="pre">∘.+</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="na">∘.</span><span class="o">+</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">40</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13 10 20 14 16 45
12  9 19 13 15 44
18 15 25 19 21 50
11  8 18 12 14 43
</span></div></div>
</div>
<p>As you can see, the <em>outer product</em> is also slightly special, in that the operand function <code class="docutils literal notranslate"><span class="pre">F</span></code> goes on the right of <code class="docutils literal notranslate"><span class="pre">∘.</span></code>, and not on the left.</p>
<p>Also, notice that the left column of the table is the left argument vector to the function derived from the <em>outer product</em> and the top row is the right argument vector.
In fact, in the expression <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">left</span> <span class="pre">∘.F</span> <span class="pre">right</span></code>, the shape of the result <code class="docutils literal notranslate"><span class="pre">r</span></code> is <code class="docutils literal notranslate"><span class="pre">(⍴r)</span> <span class="pre">≡</span> <span class="pre">(⍴left),⍴right</span></code>.</p>
<div class="section" id="extensions">
<span id="operators-extensions"></span><h3><span class="section-number">11.4.1. </span>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">#</a></h3>
<div class="section" id="other-functions">
<span id="operators-other-functions"></span><h4><span class="section-number">11.4.1.1. </span>Other Functions<a class="headerlink" href="#other-functions" title="Permalink to this headline">#</a></h4>
<p>The function used in an <em>outer product</em> can be any primitive or user-defined dyadic function, so <em>outer product</em> is an operator of amazing power.</p>
<p>Imagine you have written a little function to calculate the length of the hypotenuse of a right-angled triangle from the lengths of the other 2 sides given as the left and right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Hypo</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">((</span><span class="bp">⍺</span><span class="o">*</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="bp">⍵</span><span class="o">*</span><span class="m">2</span><span class="p">))</span><span class="o">*</span><span class="m">0.5</span><span class="kt">}</span><span class="w"></span>
<span class="m">3</span><span class="w"> </span><span class="nv">Hypo</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<p>You can test it on a number of combinations of lengths in one expression like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">8</span><span class="w"> </span><span class="m">3</span><span class="o">⍕</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="na">∘.</span><span class="nv">Hypo</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   5.000   3.162   8.544   7.616   5.831
   7.211   6.083  10.000   9.220   7.810
  12.649  12.042  14.422  13.892  13.000
</span></div></div>
</div>
<p>Now, let us have some fun with relational functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 0 0
0 1 0 0 0
0 0 1 0 0
0 0 0 1 0
0 0 0 0 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="na">∘.</span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 1 1 1
0 0 1 1 1
0 0 0 1 1
0 0 0 0 1
0 0 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="na">∘.</span><span class="o">≥</span><span class="w"> </span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 0 0
1 1 0 0 0
1 1 1 0 0
1 1 1 1 0
1 1 1 1 1
</span></div></div>
</div>
<p>We shall study some applications of <em>outer product</em> like <code class="docutils literal notranslate"><span class="pre">∘.&lt;</span></code> or <code class="docutils literal notranslate"><span class="pre">∘.⌊</span></code> in <a class="reference internal" href="#operators-applications-of-outer-product"><span class="std std-numref">Section 11.4.2</span></a>.</p>
<p>Whenever the function <code class="docutils literal notranslate"><span class="pre">F</span></code> does not produce a scalar, the <em>outer product</em> <code class="docutils literal notranslate"><span class="pre">∘.F</span></code> produces a nested array. This is the case with <em>outer products</em> like <code class="docutils literal notranslate"><span class="pre">∘.⍴</span></code>, <code class="docutils literal notranslate"><span class="pre">∘.,</span></code>, or <code class="docutils literal notranslate"><span class="pre">∘./</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="na">∘.</span><span class="o">⍴</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬───────┬───────┐
│6 6 6  │3 3 3  │7 7 7  │
├───────┼───────┼───────┤
│6 6 6 6│3 3 3 3│7 7 7 7│
├───────┼───────┼───────┤
│6 6    │3 3    │7 7    │
└───────┴───────┴───────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="na">∘./</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│5 5 5│1 1 1│7 7 7│
├─────┼─────┼─────┤
│     │     │     │
├─────┼─────┼─────┤
│5 5  │1 1  │7 7  │
└─────┴─────┴─────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="na">∘.</span><span class="o">,</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┐
│3 6│3 3│3 0│3 7│
├───┼───┼───┼───┤
│1 6│1 3│1 0│1 7│
├───┼───┼───┼───┤
│2 6│2 3│2 0│2 7│
└───┴───┴───┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="na">∘.</span><span class="o">↑</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬───────┬───────┐
│5 0 0  │8 0 0  │4 0 0  │
├───────┼───────┼───────┤
│5 0    │8 0    │4 0    │
├───────┼───────┼───────┤
│5 0 0 0│8 0 0 0│4 0 0 0│
└───────┴───────┴───────┘
</span></div></div>
</div>
</div>
<div class="section" id="other-shapes-and-types-of-data">
<span id="operators-other-shapes-and-types-of-data"></span><h4><span class="section-number">11.4.1.2. </span>Other Shapes and Types of Data<a class="headerlink" href="#other-shapes-and-types-of-data" title="Permalink to this headline">#</a></h4>
<p>So far, we have applied <em>outer product</em> to numeric vectors; it can, of course, also be used with character data and higher-rank arrays.
When applied to higher rank arrays, the result becomes very big quickly, because each item of the left array has to be combined with each item of the right one.</p>
<p>Remember, in the expression <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">left</span> <span class="pre">∘.F</span> <span class="pre">right</span></code>, the shape of <code class="docutils literal notranslate"><span class="pre">r</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">(⍴left),(⍴right)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↑</span><span class="s1">&#39;DIMITRI&#39;</span><span class="w"> </span><span class="s1">&#39;GUNTHER&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">DIMITRI
GUNTHER
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">right</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;VERONICA&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, we wish to study the result of <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">∘.=</span> <span class="pre">right</span></code>.
To help you visualise the comparisons being made, we catenate the left argument matrix on the left of the result and catenate the right argument vector on top:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">9</span><span class="o">⍴</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">right</span><span class="p">)</span><span class="o">⍪</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">left</span><span class="o">,</span><span class="nv">left</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="nv">right</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  V E R O N I C A
D 0 0 0 0 0 0 0 0
I 0 0 0 0 0 1 0 0
M 0 0 0 0 0 0 0 0
I 0 0 0 0 0 1 0 0
T 0 0 0 0 0 0 0 0
R 0 0 1 0 0 0 0 0
I 0 0 0 0 0 1 0 0

  V E R O N I C A
G 0 0 0 0 0 0 0 0
U 0 0 0 0 0 0 0 0
N 0 0 0 0 1 0 0 0
T 0 0 0 0 0 0 0 0
H 0 0 0 0 0 0 0 0
E 0 1 0 0 0 0 0 0
R 0 0 1 0 0 0 0 0
</span></div></div>
</div>
<p>The left argument is a matrix with shape <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">7</span></code> and the right argument is a vector with shape <code class="docutils literal notranslate"><span class="pre">8</span></code>, so the result is a 3D array with shape <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">7</span> <span class="pre">8</span></code>.
Each of the two major cells corresponds to comparing one of the names in the left argument to the name <code class="docutils literal notranslate"><span class="pre">'VERONICA'</span></code>.</p>
</div>
</div>
<div class="section" id="applications-of-outer-product">
<span id="operators-applications-of-outer-product"></span><h3><span class="section-number">11.4.2. </span>Applications of Outer Product<a class="headerlink" href="#applications-of-outer-product" title="Permalink to this headline">#</a></h3>
<div class="section" id="exhaustive-search">
<span id="operators-exhaustive-search"></span><h4><span class="section-number">11.4.2.1. </span>Exhaustive Search<a class="headerlink" href="#exhaustive-search" title="Permalink to this headline">#</a></h4>
<p>Because <em>outer product</em> uses a dyadic function to combine <strong>all</strong> items of the left argument with <strong>all</strong> items of the right argument, <em>outer product</em> is often used when some kind of exhaustive computation needs to be done.
One such example is that of exhaustive search.</p>
<p>As an example, suppose you want to figure out if there is a way to add one number from the vector <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">1</span> <span class="pre">16</span> <span class="pre">42</span> <span class="pre">63</span> <span class="pre">7</span> <span class="pre">10</span></code> to another number from the vector <code class="docutils literal notranslate"><span class="pre">24</span> <span class="pre">45</span> <span class="pre">18</span> <span class="pre">31</span> <span class="pre">29</span> <span class="pre">43</span> <span class="pre">67</span></code> to get <code class="docutils literal notranslate"><span class="pre">73</span></code>.</p>
<p>With <em>outer product</em>, this is quite an easy question to answer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">42</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="na">∘.</span><span class="o">+</span><span class="m">24</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">43</span><span class="w"> </span><span class="m">67</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">29  50 23 36 34  48  72
25  46 19 32 30  44  68
40  61 34 47 45  59  83
66  87 60 73 71  85 109
87 108 81 94 92 106 130
31  52 25 38 36  50  74
34  55 28 41 39  53  77
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">73</span><span class="o">∊</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">42</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="na">∘.</span><span class="o">+</span><span class="m">24</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">43</span><span class="w"> </span><span class="m">67</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>If you flip the arguments to <em>membership</em> and use <em>where</em>, you can find the position(s) where <code class="docutils literal notranslate"><span class="pre">73</span></code> is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">42</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="na">∘.</span><span class="o">+</span><span class="m">24</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">43</span><span class="w"> </span><span class="m">67</span><span class="p">)</span><span class="o">∊</span><span class="m">73</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┐
│4 4│
└───┘
</span></div></div>
</div>
<p>This pattern of exhaustive computations is fairly common, and although it generally is not the most computationally efficient way of solving a problem, it is generally fast enough to prototype as a first approach.</p>
</div>
<div class="section" id="draw-a-bar-chart">
<span id="operators-draw-a-bar-chart"></span><h4><span class="section-number">11.4.2.2. </span>Draw a Bar Chart<a class="headerlink" href="#draw-a-bar-chart" title="Permalink to this headline">#</a></h4>
<p>Imagine that you have to represent a list of values with a bar chart.
Perhaps you will use dedicated graphical software, and you’d be right, but just have a look at this elegant solution, which again uses an <em>outer product</em>.</p>
<p>Here is the list of values that we want to chart:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nums</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Let us first calculate the vertical scale.
It is made of the integers from 9 to 1 in reverse order and can be obtained by:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌽⍳⌈</span><span class="na">/</span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9 8 7 6 5 4 3 2 1
</span></div></div>
</div>
<p>Then, let us compare this scale to the values; an <em>outer product</em> will build columns of <code class="docutils literal notranslate"><span class="pre">1</span></code>s up to the correct height:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⌽⍳⌈</span><span class="na">/</span><span class="nv">nums</span><span class="p">)</span><span class="w"> </span><span class="na">∘.</span><span class="o">≤</span><span class="w"> </span><span class="nv">nums</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 0 0 0 0 0 0
0 0 0 0 1 1 0 0 0 0 0
0 0 0 1 1 1 0 0 0 0 0
0 0 0 1 1 1 0 0 0 0 0
0 0 0 1 1 1 1 0 0 0 0
0 0 0 1 1 1 1 1 0 0 0
0 1 0 1 1 1 1 1 0 1 0
0 1 0 1 1 1 1 1 1 1 0
1 1 0 1 1 1 1 1 1 1 1
</span></div></div>
</div>
<p>Finally, to draw the graph, we can index a two-character vector, exactly as we did in <a class="reference internal" href="Data-and-Variables.html#data-and-variables-the-shape-of-the-result"><span class="std std-numref">Section 3.5.2</span></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39; ⎕&#39;</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="p">(</span><span class="o">⌽⍳⌈</span><span class="na">/</span><span class="nv">nums</span><span class="p">)</span><span class="na">∘.</span><span class="o">≤</span><span class="nv">nums</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">    ⎕      
    ⎕⎕     
   ⎕⎕⎕     
   ⎕⎕⎕     
   ⎕⎕⎕⎕    
   ⎕⎕⎕⎕⎕   
 ⎕ ⎕⎕⎕⎕⎕ ⎕ 
 ⎕ ⎕⎕⎕⎕⎕⎕⎕ 
⎕⎕ ⎕⎕⎕⎕⎕⎕⎕⎕
</span></div></div>
</div>
</div>
<div class="section" id="decreasing-refunding">
<span id="operators-decreasing-refunding"></span><h4><span class="section-number">11.4.2.3. </span>Decreasing Refunding<a class="headerlink" href="#decreasing-refunding" title="Permalink to this headline">#</a></h4>
<p>Some students have spent money to buy expensive books for their studies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">exp</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">740</span><span class="w"> </span><span class="m">310</span><span class="w"> </span><span class="m">1240</span><span class="w"> </span><span class="m">620</span><span class="w"> </span><span class="m">800</span><span class="w"> </span><span class="m">460</span><span class="w"> </span><span class="m">1060</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Their university agrees to refund them, but places the following limits on the refunding rates:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Expense range</p></th>
<th class="text-align:left head"><p>Refund rate</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>0 - 500</p></td>
<td class="text-align:left"><p>80%</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>500 - 900</p></td>
<td class="text-align:left"><p>50%</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>900+</p></td>
<td class="text-align:left"><p>0%</p></td>
</tr>
</tbody>
</table>
<p>We could say exactly the same thing in a somewhat different way:</p>
<p>Expenses from 0 to 900 have a refund rate of 50% and expenses up to 500 get an <strong>additional</strong> 30%.</p>
<p>Even if this rule may seem strange, both methods give the same result.
For example, a student who spent 740€ would get:</p>
<ul class="simple">
<li><p>using the initial table, 80% of 500 plus 50% of 240:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0.8</span><span class="o">×</span><span class="m">500</span><span class="p">)</span><span class="o">+</span><span class="m">0.5</span><span class="o">×</span><span class="m">240</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">520
</span></div></div>
</div>
<ul class="simple">
<li><p>using the reworded rule, 50% of 740 plus 30% of 500:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">0.5</span><span class="o">×</span><span class="m">740</span><span class="p">)</span><span class="o">+</span><span class="m">0.3</span><span class="o">×</span><span class="m">500</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">520
</span></div></div>
</div>
<p>Now, let us limit the expenses to the given maxima:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">exp</span><span class="w"> </span><span class="na">∘.</span><span class="o">⌊</span><span class="w"> </span><span class="m">900</span><span class="w"> </span><span class="m">500</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">740 500
310 310
900 500
620 500
800 500
460 460
900 500
</span></div></div>
</div>
<p>The first column of the result above contains the expenses capped at 900 (which get a refund of 50%) and the second column contains the expenses capped at 500 (which get an additional 30%).</p>
<p>So, according to our modified rule, we must pay 50% of the first column plus 30% of the second, which we can do by multiplying the columns with <code class="docutils literal notranslate"><span class="pre">0.5</span> <span class="pre">0.3</span></code> (using an <em>axis</em> operator) and then adding them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="p">(</span><span class="nv">exp</span><span class="na">∘.</span><span class="o">⌊</span><span class="m">900</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="w"> </span><span class="o">×</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="m">0.5</span><span class="w"> </span><span class="m">0.3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">520 248 600 460 550 368 600
</span></div></div>
</div>
<p>And the total refund is, of course:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">exp</span><span class="na">∘.</span><span class="o">⌊</span><span class="m">900</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="o">×</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="m">0.5</span><span class="w"> </span><span class="m">0.3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3346
</span></div></div>
</div>
<p>If we laminate the original vector, we can see the expenses and the refunding:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">exp</span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">exp</span><span class="na">∘.</span><span class="o">⌊</span><span class="m">900</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="o">×</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="m">0.5</span><span class="w"> </span><span class="m">0.3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">740 310 1240 620 800 460 1060
520 248  600 460 550 368  600
</span></div></div>
</div>
<div class="figure align-default" id="id1">
<span id="fig-outer-product"></span><img alt="_images/Outer_Product.png" src="_images/Outer_Product.png" />
<p class="caption"><span class="caption-number">Fig. 11.1 </span><span class="caption-text">“APLer applying sunscreen outside.”</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</div>
</div>
</div>
<div class="section" id="outer-product-exercise">
<span id="operators-outer-product-exercise"></span><h3><span class="section-number">11.4.3. </span>Outer Product Exercise<a class="headerlink" href="#outer-product-exercise" title="Permalink to this headline">#</a></h3>
<div class="exercise admonition" id="ex-complex-refunding">

<p class="admonition-title"><span class="caption-number">Exercise 11.1 </span></p>
<div class="section" id="exercise-content">
<p>Let us try to generalise the method used above to compute refunds.</p>
<p>In our example, we had chosen a very simple case, because we had only two slices, and all students used the same scale.
Let us now imagine a slightly more complex case:</p>
<ul class="simple">
<li><p>the students are classified in three categories, which have different refunding rates; and</p></li>
<li><p>we now have four different expense ranges.</p></li>
</ul>
<p>The new conditions are expressed with the traditional notation in the table below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Category \ Range</p></th>
<th class="text-align:left head"><p>0 to 600</p></th>
<th class="text-align:left head"><p>600 to 1.100</p></th>
<th class="text-align:left head"><p>1.100 to 1.500</p></th>
<th class="text-align:left head"><p>1.500 to 2.000</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Category 1</p></td>
<td class="text-align:left"><p>100%</p></td>
<td class="text-align:left"><p>100%</p></td>
<td class="text-align:left"><p>80%</p></td>
<td class="text-align:left"><p>50%</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Category 2</p></td>
<td class="text-align:left"><p>100%</p></td>
<td class="text-align:left"><p>70%</p></td>
<td class="text-align:left"><p>30%</p></td>
<td class="text-align:left"><p>10%</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Category 3</p></td>
<td class="text-align:left"><p>80%</p></td>
<td class="text-align:left"><p>60%</p></td>
<td class="text-align:left"><p>20%</p></td>
<td class="text-align:left"><p>5%</p></td>
</tr>
</tbody>
</table>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">limits</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">600</span><span class="w"> </span><span class="m">1100</span><span class="w"> </span><span class="m">1500</span><span class="w"> </span><span class="m">2000</span><span class="w"></span>
<span class="nv">rates</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
<p>Define a function <code class="docutils literal notranslate"><span class="pre">Refund</span></code> to solve this problem.
The function should take the limits vector, the rates matrix, the expenses vector, and the categories vector, as right arguments.
The return value should be a vector with the refunded amount to each student.</p>
<p>Using loops is strictly prohibited and may be punished with high severity!</p>
<p>Make use of the variables <code class="docutils literal notranslate"><span class="pre">expenses</span></code> and <code class="docutils literal notranslate"><span class="pre">categories</span></code> defined below and verify your solution by comparing it to the values shown below.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">expenses</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">350</span><span class="o">⍴</span><span class="m">2500</span><span class="w"></span>
<span class="nv">categories</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">350</span><span class="o">⍴</span><span class="m">3</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">10</span><span class="o">↑</span><span class="nv">categories</span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="nv">expenses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   1    2   2   3    2    3    2   3    1   2
2121 1936 682 818 1922 1419 1389 465 1829 221
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">↑</span><span class="nv">Refund</span><span class="w"> </span><span class="nv">limits</span><span class="w"> </span><span class="nv">rates</span><span class="w"> </span><span class="nv">categories</span><span class="w"> </span><span class="nv">expenses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: rates
      10↑Refund limits rates categories expenses
                       ∧
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">Refund</span><span class="w"> </span><span class="nv">limits</span><span class="w"> </span><span class="nv">rates</span><span class="w"> </span><span class="nv">categories</span><span class="w"> </span><span class="nv">expenses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: rates
      +/Refund limits rates categories expenses
                      ∧
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="inner-product">
<span id="operators-inner-product"></span><h2><span class="section-number">11.5. </span>Inner Product<a class="headerlink" href="#inner-product" title="Permalink to this headline">#</a></h2>
<p><em>Inner product</em> is a generalisation of what mathematicians call <em>matrix product</em>, a tool considered by most students as extremely abstract, full of bizarre notations, like <span class="math notranslate nohighlight">\(\sum a_{ij}b_{jk}\)</span>, and obviously far removed from everyday problems.
You will discover that:</p>
<ul class="simple">
<li><p>the concept is really simple, nearly obvious; and</p></li>
<li><p>it can be applied to many real life problems.</p></li>
</ul>
<p>A simple example will help us.</p>
<div class="section" id="a-concrete-situation">
<span id="operators-a-concrete-situation"></span><h3><span class="section-number">11.5.1. </span>A Concrete Situation<a class="headerlink" href="#a-concrete-situation" title="Permalink to this headline">#</a></h3>
<p>A company intends to open a series of hotels and resorts in four countries.
This requires serious investments over a period of five years.
The following table shows these investments (in millions of dollars, of course!):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Country vs Year</p></th>
<th class="text-align:right head"><p>Year 1</p></th>
<th class="text-align:right head"><p>Year 2</p></th>
<th class="text-align:right head"><p>Year 3</p></th>
<th class="text-align:right head"><p>Year 4</p></th>
<th class="text-align:right head"><p>Year 5</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Greece</p></td>
<td class="text-align:right"><p>120</p></td>
<td class="text-align:right"><p>100</p></td>
<td class="text-align:right"><p>40</p></td>
<td class="text-align:right"><p>20</p></td>
<td class="text-align:right"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Brazil</p></td>
<td class="text-align:right"><p>200</p></td>
<td class="text-align:right"><p>150</p></td>
<td class="text-align:right"><p>100</p></td>
<td class="text-align:right"><p>120</p></td>
<td class="text-align:right"><p>200</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Egypt</p></td>
<td class="text-align:right"><p>50</p></td>
<td class="text-align:right"><p>120</p></td>
<td class="text-align:right"><p>220</p></td>
<td class="text-align:right"><p>350</p></td>
<td class="text-align:right"><p>600</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Argentina</p></td>
<td class="text-align:right"><p>0</p></td>
<td class="text-align:right"><p>80</p></td>
<td class="text-align:right"><p>100</p></td>
<td class="text-align:right"><p>110</p></td>
<td class="text-align:right"><p>120</p></td>
</tr>
</tbody>
</table>
<p>These figures are contained in a matrix called <code class="docutils literal notranslate"><span class="pre">invest</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">invest</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">150</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">120</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">invest</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="nv">invest</span><span class="o">,</span><span class="m">220</span><span class="w"> </span><span class="m">350</span><span class="w"> </span><span class="m">600</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">110</span><span class="w"> </span><span class="m">120</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">120 100  40  20   0
200 150 100 120 200
 50 120 220 350 600
  0  80 100 110 120
</span></div></div>
</div>
<p>These investments will be supported by the company itself plus two banks, each taking a certain percentage of the total, depending on the evaluation of each project.
The following table shows how the risks are shared:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Entity vs Country</p></th>
<th class="text-align:right head"><p>Greece</p></th>
<th class="text-align:right head"><p>Brazil</p></th>
<th class="text-align:right head"><p>Egypt</p></th>
<th class="text-align:right head"><p>Argentina</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Bank 1</p></td>
<td class="text-align:right"><p>50</p></td>
<td class="text-align:right"><p>10</p></td>
<td class="text-align:right"><p>20</p></td>
<td class="text-align:right"><p>30</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Bank 2</p></td>
<td class="text-align:right"><p>20</p></td>
<td class="text-align:right"><p>60</p></td>
<td class="text-align:right"><p>40</p></td>
<td class="text-align:right"><p>30</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Company</p></td>
<td class="text-align:right"><p>30</p></td>
<td class="text-align:right"><p>30</p></td>
<td class="text-align:right"><p>40</p></td>
<td class="text-align:right"><p>40</p></td>
</tr>
</tbody>
</table>
<p>Those percentages are contained in a matrix named <code class="docutils literal notranslate"><span class="pre">percent</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">percent</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">50</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">50 10 20 30
20 60 40 30
30 30 40 40
</span></div></div>
</div>
<p>We would like to calculate, year by year, how much each of the 3 partners is engaged in this project.
For example, let us try to evaluate the contribution of Bank 2 during Year 3:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Country</p></th>
<th class="text-align:right head"><p>Project valuation</p></th>
<th class="text-align:right head"><p>Stake</p></th>
<th class="text-align:right head"><p>Total invested</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Greece</p></td>
<td class="text-align:right"><p>40</p></td>
<td class="text-align:right"><p>20%</p></td>
<td class="text-align:right"><p>8</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Brazil</p></td>
<td class="text-align:right"><p>100</p></td>
<td class="text-align:right"><p>60%</p></td>
<td class="text-align:right"><p>60</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Egypt</p></td>
<td class="text-align:right"><p>220</p></td>
<td class="text-align:right"><p>40%</p></td>
<td class="text-align:right"><p>88</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Argentina</p></td>
<td class="text-align:right"><p>100</p></td>
<td class="text-align:right"><p>30%</p></td>
<td class="text-align:right"><p>30</p></td>
</tr>
</tbody>
</table>
<p>The total invested is, thus, 186.</p>
<p>This could have been obtained by the sum of four products:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="nv">percent</span><span class="sr">[</span><span class="m">2</span><span class="sr">;]</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="nv">invest</span><span class="sr">[;</span><span class="m">3</span><span class="sr">]</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">186
</span></div></div>
</div>
<p>In order to calculate the total invested for each partner and each year, we should repeat that algorithm for all the rows of <code class="docutils literal notranslate"><span class="pre">percent</span></code>, and all the columns of <code class="docutils literal notranslate"><span class="pre">invest</span></code>: this is precisely what an <em>inner product</em> does.</p>
<p>And because it <em>adds</em> a series of <em>products</em>, it will be expresseed by a dot (the operator) between a plus and a multiply sign, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">percent</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="w"> </span><span class="nv">invest</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 90 113 104 125 176
164 182 186 249 396
116 155 170 226 348
</span></div></div>
</div>
<p>In <a class="reference internal" href="#fig-inner-product"><span class="std std-numref">Fig. 11.2</span></a>, we have detailed the elementary products which lead to the calculation for bank 2 in year 3:</p>
<div class="figure align-default" id="id2">
<span id="fig-inner-product"></span><img alt="_images/Inner_Product.png" src="_images/Inner_Product.png" />
<p class="caption"><span class="caption-number">Fig. 11.2 </span><span class="caption-text">Diagram representing the <em>inner product</em> operation.</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</div>
<p><a class="reference internal" href="#fig-inner-product"><span class="std std-numref">Fig. 11.2</span></a> has a great advantage: it clearly shows the relations that exist between the 3 matrices:</p>
<ul class="simple">
<li><p>the left argument has as many columns as the right one has rows; and</p></li>
<li><p>the result has as many rows as the left argument and as many columns as the right one.</p></li>
</ul>
<p>As you can see, the item <code class="docutils literal notranslate"><span class="pre">result[x;y]</span></code> is calculated from row <code class="docutils literal notranslate"><span class="pre">x</span></code> of the left argument (<code class="docutils literal notranslate"><span class="pre">⍺[x;]</span></code> in dfn notation) and column <code class="docutils literal notranslate"><span class="pre">y</span></code> of the right argument (<code class="docutils literal notranslate"><span class="pre">⍵[;y]</span></code> in dfn notation).</p>
<p>These rules will be generalised in the next section.</p>
</div>
<div class="section" id="definition-of-inner-product">
<span id="operators-definition-of-inner-product"></span><h3><span class="section-number">11.5.2. </span>Definition of Inner Product<a class="headerlink" href="#definition-of-inner-product" title="Permalink to this headline">#</a></h3>
<p>The syntax of <em>inner product</em> is <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">x</span> <span class="pre">f.g</span> <span class="pre">y</span></code>, where the <em>inner product</em> is represented by a dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>) and <code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code> represent two appropriate dyadic functions (either primitive or user-defined).</p>
<p>The arguments may be arrays of any rank: scalars, vectors, matrices, or higher-rank arrays.
The shape of the arguments and the shape of the result follow very simple rules:</p>
<ul class="simple">
<li><p>the length of the last dimension of the left argument must be equal to the length of the first dimension of the right argument (in other words, <code class="docutils literal notranslate"><span class="pre">(¯1↑⍴x)≡1↑⍴y</span></code>); and</p></li>
<li><p>the shape of the result is the catenation of the argugments’ shapes, in which the common dimension has disappeared (in other words, <code class="docutils literal notranslate"><span class="pre">(⍴r)≡(¯1↓⍴x),1↓⍴y</span></code>).</p></li>
</ul>
<p>Of course, as usual, scalars are repeated to fit the appropriate size.</p>
<p>Let us represent scalars by <code class="docutils literal notranslate"><span class="pre">s</span></code>, vectors by <code class="docutils literal notranslate"><span class="pre">v</span></code>, matrices by <code class="docutils literal notranslate"><span class="pre">m</span></code>, and higher-rank arrays by <code class="docutils literal notranslate"><span class="pre">a</span></code>.
The table below shows the same of the result of some <em>inner products</em>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p><code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">←</span> <span class="pre">x</span> <span class="pre">f.g</span> <span class="pre">y</span></code></p></th>
<th class="text-align:right head"><p><code class="docutils literal notranslate"><span class="pre">⍴x</span></code></p></th>
<th class="text-align:right head"><p><code class="docutils literal notranslate"><span class="pre">⍴y</span></code></p></th>
<th class="text-align:right head"><p><code class="docutils literal notranslate"><span class="pre">⍴r</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">f.g</span> <span class="pre">a</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">8</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">5</span> <span class="pre">4</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">5</span> <span class="pre">4</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">←</span> <span class="pre">a</span> <span class="pre">f.g</span> <span class="pre">a</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">8</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">3</span> <span class="pre">2</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">3</span> <span class="pre">2</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">←</span> <span class="pre">m</span> <span class="pre">f.g</span> <span class="pre">m</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">5</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">8</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">8</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">←</span> <span class="pre">m</span> <span class="pre">f.g</span> <span class="pre">v</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">7</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">7</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">←</span> <span class="pre">v</span> <span class="pre">f.g</span> <span class="pre">m</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">7</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">7</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">←</span> <span class="pre">v</span> <span class="pre">f.g</span> <span class="pre">v</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td class="text-align:right"><p><code class="docutils literal notranslate"><span class="pre">⍬</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="typical-uses-of-inner-products">
<span id="operators-typical-uses-of-inner-products"></span><h3><span class="section-number">11.5.3. </span>Typical Uses of Inner Products<a class="headerlink" href="#typical-uses-of-inner-products" title="Permalink to this headline">#</a></h3>
<div class="section" id="two-simple-problems">
<span id="operators-two-simple-problems"></span><h4><span class="section-number">11.5.3.1. </span>Two Simple Problems<a class="headerlink" href="#two-simple-problems" title="Permalink to this headline">#</a></h4>
<p>Many students imagine that matrix products are complex things, reserved for mathematicians, and far removed from everyday life.
This opinion should be reconsidered: very simple problems can be solved using inner product.</p>
<p><code class="docutils literal notranslate"><span class="pre">hms</span></code> is a variable which contains a time interval in hours, minutes, and seconds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hms</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">29</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We would like to convert it into seconds.
We shall see three methods just now, and a fourth method will be given in another chapter.</p>
<p>A horrible solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">3600</span><span class="o">×</span><span class="nv">hms</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">60</span><span class="o">×</span><span class="nv">hms</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">hms</span><span class="sr">[</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13469
</span></div></div>
</div>
<p>A good APL solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="m">3600</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="nv">hms</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13469
</span></div></div>
</div>
<p>An excellent solution with inner product:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3600</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="w"> </span><span class="nv">hms</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13469
</span></div></div>
</div>
<p>The second and third solutions are equivalent in terms of number of characters typed and similar in performance.
However, <strong>it is recommended</strong> that you use the third one: it will help you become familiar with <em>inner product</em> so that after a certain period, it will become part of your toolkit as an APL programmer.</p>
<p>Here is a very similar example.
Two vectors represent the prices of a certain number of goods and the quantities we bought:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">price</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">4.2</span><span class="w"> </span><span class="m">1.5</span><span class="w"> </span><span class="m">8.9</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">18</span><span class="w"></span>
<span class="nv">qty</span><span class="w">   </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w">   </span><span class="m">3</span><span class="w">   </span><span class="m">5</span><span class="w">   </span><span class="m">1</span><span class="w">  </span><span class="m">0.5</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>To calculate how much we paid, we can use the beginner’s solution, or a solution with a simple <em>inner product</em>; they give the same result, of course:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">126.2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">price</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="w"> </span><span class="nv">qty</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">126.2
</span></div></div>
</div>
<p>Just to show how it works, <a class="reference internal" href="#fig-inner-product-2"><span class="std std-numref">Fig. 11.3</span></a> contains an explanatory diagram similar to the one we used for our Banks/Investments example.</p>
<div class="figure align-default" id="inner-product-2">
<span id="fig-inner-product-2"></span><img alt="_images/Inner_Product_2.png" src="_images/Inner_Product_2.png" />
<p class="caption"><span class="caption-number">Fig. 11.3 </span><span class="caption-text">Diagram explaining the behaviour of an <em>inner product</em> between two vectors</span><a class="headerlink" href="#inner-product-2" title="Permalink to this image">#</a></p>
</div>
</div>
<div class="section" id="a-useful-family">
<span id="operators-a-useful-family"></span><h4><span class="section-number">11.5.3.2. </span>A Useful Family<a class="headerlink" href="#a-useful-family" title="Permalink to this headline">#</a></h4>
<p>Used with comparison functions, <em>inner product</em> offers 18 extremely useful derived functions.</p>
<p>Here is a vector <code class="docutils literal notranslate"><span class="pre">ages</span></code> containing the ages of 400 persons:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">20</span><span class="o">↑</span><span class="nv">ages</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">400</span><span class="o">⍴</span><span class="m">100</span><span class="w">  </span><span class="c1">⍝ We display the first 20 ages only.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">73 16 42 50 2 67 11 81 37 93 100 98 83 32 76 51 37 15 46 88
</span></div></div>
</div>
<p>In the same way as we did in <a class="reference internal" href="Some-Primitive-Functions.html#some-primitive-functions-reduction-of-binary-data"><span class="std std-numref">Section 4.8.3</span></a>, we can answer some elementary questions:</p>
<p>Are all these people younger than 65?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∧</span><span class="na">/</span><span class="w"> </span><span class="nv">ages</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">65</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Is there at least one person younger than 20?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">/</span><span class="w"> </span><span class="nv">ages</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>How many people are younger than 20?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="nv">ages</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">81
</span></div></div>
</div>
<p>We can now replace <em>reduce</em> in the previous examples by <em>inner product</em>, like this:</p>
<p>Are all these people younger than 65?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ages</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">&lt;</span><span class="w"> </span><span class="m">65</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Is there at least one person younger than 20?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ages</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">&lt;</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>How many people are younger than 20?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ages</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">&lt;</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">81
</span></div></div>
</div>
<p>Clever, isn’t it?</p>
<p>These expressions can be read as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">∧.&lt;</span></code> means “all smaller” – are the ages <strong>all smaller</strong> than 65?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∨.&lt;</span></code> means “at least one is smaller” – is there <strong>at least</strong> one age <strong>smaller</strong> than 20?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+.&lt;</span></code> means “how many are smaller” – <strong>how many</strong> ages are <strong>smaller</strong> than 20?</p></li>
</ul>
<p>In those three expressions, we have combined <code class="docutils literal notranslate"><span class="pre">∧</span></code>, <code class="docutils literal notranslate"><span class="pre">∨</span></code>, and <code class="docutils literal notranslate"><span class="pre">+</span></code> with <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>.
We could just as well combine them with all the comparison symbols, giving 18 different <em>inner products</em>, as shown in this table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;∧∨+&#39;</span><span class="w"> </span><span class="na">∘.</span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="s1">&#39;.&#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"> </span><span class="s1">&#39;&lt;≤=≥&gt;≠&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┬───┐
│∧.&lt;│∧.≤│∧.=│∧.≥│∧.&gt;│∧.≠│
├───┼───┼───┼───┼───┼───┤
│∨.&lt;│∨.≤│∨.=│∨.≥│∨.&gt;│∨.≠│
├───┼───┼───┼───┼───┼───┤
│+.&lt;│+.≤│+.=│+.≥│+.&gt;│+.≠│
└───┴───┴───┴───┴───┴───┘
</span></div></div>
</div>
</div>
<div class="section" id="a-special-case-of-a-comparison-inner-product">
<span id="operators-a-special-case-of-a-comparison-inner-product"></span><h4><span class="section-number">11.5.3.3. </span>A Special Case of a Comparison Inner Product<a class="headerlink" href="#a-special-case-of-a-comparison-inner-product" title="Permalink to this headline">#</a></h4>
<p>In this family of <em>inner products</em>, <code class="docutils literal notranslate"><span class="pre">∧.=</span></code> is particularly interesting, because it answers the question “are all those values equal?”.
For example, applied to vectors of the same length:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;customer&#39;</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;customer&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;customer&#39;</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;cucumber&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Let us use this property to search for a word in a matrix of words:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">words</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="o">⍴</span><span class="s1">&#39;CONTACTCOLUMNSFORTUNEPRODUCTCOLONELPROVIDEMACHINETYPICAL&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">CONTACT
COLUMNS
FORTUNE
PRODUCT
COLONEL
PROVIDE
MACHINE
TYPICAL
</span></div></div>
</div>
<p>If we combine this 8 by 7 matrix with a 7-item vector, compatibility rules are obeyed, and the result will be a 8-item vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">words</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PRODUCT&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 1 0 0 0 0
</span></div></div>
</div>
<p>The shape of <code class="docutils literal notranslate"><span class="pre">words</span></code> is <code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">7</span></code> and the shape of <code class="docutils literal notranslate"><span class="pre">'PRODUCT'</span></code> is <code class="docutils literal notranslate"><span class="pre">7</span></code>, so the common dimension disappears, and the result has shape <code class="docutils literal notranslate"><span class="pre">8</span></code>.</p>
<p>Now, let us search for three words:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">three</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="o">⍴</span><span class="s1">&#39;MACHINECOMFORTPRODUCT&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">MACHINE
COMFORT
PRODUCT
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">words</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="w"> </span><span class="o">⍉</span><span class="nv">three</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0
0 0 0
0 0 0
0 0 1
0 0 0
0 0 0
1 0 0
0 0 0
</span></div></div>
</div>
<p>We must transpose the matrix to be compliant with the compatibility rules, and the result shows what word was found in what row of <code class="docutils literal notranslate"><span class="pre">words</span></code>.</p>
<p>If we wanted to know which words were found, we could add an <em>or-reduction</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">⌿</span><span class="w"> </span><span class="nv">words</span><span class="o">∧</span><span class="na">.</span><span class="o">=⍉</span><span class="nv">three</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1
</span></div></div>
</div>
<p>If we wanted to know which of the rows in <code class="docutils literal notranslate"><span class="pre">words</span></code> contain words in <code class="docutils literal notranslate"><span class="pre">three</span></code>, we could have used another <em>or-reduction</em>, but along the other axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">/</span><span class="w"> </span><span class="nv">words</span><span class="o">∧</span><span class="na">.</span><span class="o">=⍉</span><span class="nv">three</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 1 0 0 1 0
</span></div></div>
</div>
<p>It may also be useful to search for the positions of said matches, but we can use <em>index of</em> for that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">words</span><span class="w"> </span><span class="o">⍳</span><span class="w"> </span><span class="nv">three</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 9 4
</span></div></div>
</div>
<p>The converse to the expression <code class="docutils literal notranslate"><span class="pre">∧.=</span></code> is <code class="docutils literal notranslate"><span class="pre">∨.≠</span></code>.
(That means that <code class="docutils literal notranslate"><span class="pre">∧.=</span></code> and <code class="docutils literal notranslate"><span class="pre">∨.≠</span></code> always return opposite Boolean values.)
It looks for <em>different</em> values instead of looking for <em>equal</em> values.
Let us look at one simple example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">words</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">≠</span><span class="w"> </span><span class="o">⍉</span><span class="nv">three</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1
1 1 1
1 1 1
1 1 0
1 1 1
1 1 1
0 1 1
1 1 1
</span></div></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">1</span></code> means that this word in <code class="docutils literal notranslate"><span class="pre">three</span></code> does not match the word in this row of <code class="docutils literal notranslate"><span class="pre">words</span></code>.
So, if a row contains all <code class="docutils literal notranslate"><span class="pre">1</span></code>s, the word in that row does not match any of the words in <code class="docutils literal notranslate"><span class="pre">three</span></code>.
Using <em>and-reduce</em> along the second axis pinpoints the rows of <code class="docutils literal notranslate"><span class="pre">words</span></code> for which this is true:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∧</span><span class="na">/</span><span class="w"> </span><span class="nv">words</span><span class="o">∨</span><span class="na">.</span><span class="o">≠⍉</span><span class="nv">three</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 0 1 1 0 1
</span></div></div>
</div>
<p>With a compression, we can see the words that are not found in <code class="docutils literal notranslate"><span class="pre">three</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">∧</span><span class="na">/</span><span class="nv">words</span><span class="o">∨</span><span class="na">.</span><span class="o">≠⍉</span><span class="nv">three</span><span class="p">)</span><span class="w"> </span><span class="na">⌿</span><span class="w"> </span><span class="nv">words</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">CONTACT
COLUMNS
FORTUNE
COLONEL
PROVIDE
TYPICAL
</span></div></div>
</div>
</div>
<div class="section" id="similar-applications">
<span id="operators-similar-applications"></span><h4><span class="section-number">11.5.3.4. </span>Similar Applications<a class="headerlink" href="#similar-applications" title="Permalink to this headline">#</a></h4>
<p>Very often it is desirable to find out whether any rows (or columns) of a matrix contain all blanks or all zeroes; or, alternatively, whether any rows or columns contain at least one non-zero number or a non-blank character.</p>
<p>To solve the first task we can use the same <em>inner product</em> as we used in most of the previous section (<code class="docutils literal notranslate"><span class="pre">∧.=</span></code>) and, to solve the second one, we can use the converse, which we introduced at the end of the previous section (<code class="docutils literal notranslate"><span class="pre">∨.≠</span></code>).</p>
<p>Suppose we have a matrix of characters <code class="docutils literal notranslate"><span class="pre">mc</span></code> and a matrix of numbers <code class="docutils literal notranslate"><span class="pre">mn</span></code>. Then,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mc</span> <span class="pre">∧.=</span> <span class="pre">'</span> <span class="pre">'</span></code> says which rows contain all blanks;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mn</span> <span class="pre">∧.=</span> <span class="pre">0</span></code> says which rows contain all zeroes;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span> <span class="pre">∧.=</span> <span class="pre">mc</span></code> says which columns contain all blanks;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mc</span> <span class="pre">∨.≠</span> <span class="pre">'</span> <span class="pre">'</span></code> says which rows contain at least one non-blank character;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">∨.≠</span> <span class="pre">mn</span></code> says which columns contain at least one non-zero number; and so on…</p></li>
</ul>
</div>
<div class="section" id="shortest-routes-in-a-graph">
<span id="operators-shortest-routes-in-a-graph"></span><h4><span class="section-number">11.5.3.5. </span>Shortest Routes in a Graph<a class="headerlink" href="#shortest-routes-in-a-graph" title="Permalink to this headline">#</a></h4>
<p>Finding the shortest routes in a graph is a classical problem to which <em>inner product</em> offers an elegant solution.
Imagine 6 points in a town.
They can be joined via a certain number of paths, according to <a class="reference internal" href="#fig-town-diagram"><span class="std std-numref">Fig. 11.4</span></a>.</p>
<div class="figure align-default" id="town-diagram">
<span id="fig-town-diagram"></span><img alt="_images/Town_Diagram.png" src="_images/Town_Diagram.png" />
<p class="caption"><span class="caption-number">Fig. 11.4 </span><span class="caption-text">A diagram with connections between 6 points in a town.</span><a class="headerlink" href="#town-diagram" title="Permalink to this image">#</a></p>
</div>
<p>We can create a matrix with the distances between the points.
The missing paths will be represented by a very high value (<code class="docutils literal notranslate"><span class="pre">1000</span></code> in this case) to dissuade anyone from using them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ to            A    B    C    D    E    F </span><span class="w"></span>
<span class="nv">distances</span><span class="w"> </span><span class="kd">←</span><span class="o">,</span><span class="w">    </span><span class="m">0</span><span class="w">   </span><span class="m">21</span><span class="w"> </span><span class="m">1000</span><span class="w">   </span><span class="m">35</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">1000</span><span class="w">  </span><span class="c1">⍝ from A to ...</span><span class="w"></span>
<span class="nv">distances</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w">   </span><span class="m">32</span><span class="w">    </span><span class="m">0</span><span class="w">   </span><span class="m">34</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">1000</span><span class="w">  </span><span class="c1">⍝ from B to ...</span><span class="w"></span>
<span class="nv">distances</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">1000</span><span class="w">   </span><span class="m">34</span><span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">1000</span><span class="w">   </span><span class="m">25</span><span class="w">  </span><span class="c1">⍝ from C to ...</span><span class="w"></span>
<span class="nv">distances</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">1000</span><span class="w">   </span><span class="m">44</span><span class="w"> </span><span class="m">1000</span><span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">1000</span><span class="w">  </span><span class="c1">⍝ from D to ...</span><span class="w"></span>
<span class="nv">distances</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">1000</span><span class="w">   </span><span class="m">51</span><span class="w">   </span><span class="m">17</span><span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">1000</span><span class="w">  </span><span class="c1">⍝ from E to ...</span><span class="w"></span>
<span class="nv">distances</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">1000</span><span class="w">   </span><span class="m">31</span><span class="w"> </span><span class="m">1000</span><span class="w">   </span><span class="m">24</span><span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="c1">⍝ from F to ...</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">distances</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="nv">distances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   0   21 1000   35 1000 1000
  32    0   34 1000 1000 1000
1000   34    0 1000 1000   25
1000   44 1000    0 1000 1000
1000 1000   51   17    0 1000
1000 1000   31 1000   24    0
</span></div></div>
</div>
<p>The matrix <code class="docutils literal notranslate"><span class="pre">distances</span></code> contains distances from one point to another one, assuming we follow a single path.
The values <code class="docutils literal notranslate"><span class="pre">1000</span></code> indicate connections that cannot be made directly.
For example, there is no direct route from <code class="docutils literal notranslate"><span class="pre">E</span></code> to <code class="docutils literal notranslate"><span class="pre">B</span></code>; can we get there in two steps?</p>
<p>Let us consider all the possible pairs of routes from <code class="docutils literal notranslate"><span class="pre">E</span></code> to <code class="docutils literal notranslate"><span class="pre">B</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Routes</p></th>
<th class="text-align:right head"><p>Distances</p></th>
<th class="text-align:right head"><p>Total distance</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">→</span> <span class="pre">A</span></code> + <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">→</span> <span class="pre">B</span></code></p></td>
<td class="text-align:right"><p>1000 + 21</p></td>
<td class="text-align:right"><p>1021</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">→</span> <span class="pre">B</span></code> + <code class="docutils literal notranslate"><span class="pre">B</span> <span class="pre">→</span> <span class="pre">B</span></code></p></td>
<td class="text-align:right"><p>1000 + 0</p></td>
<td class="text-align:right"><p>1000</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">→</span> <span class="pre">C</span></code> + <code class="docutils literal notranslate"><span class="pre">C</span> <span class="pre">→</span> <span class="pre">B</span></code></p></td>
<td class="text-align:right"><p>51 + 34</p></td>
<td class="text-align:right"><p>85</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">→</span> <span class="pre">D</span></code> + <code class="docutils literal notranslate"><span class="pre">D</span> <span class="pre">→</span> <span class="pre">B</span></code></p></td>
<td class="text-align:right"><p>17 + 44</p></td>
<td class="text-align:right"><p>61</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">→</span> <span class="pre">E</span></code> + <code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">→</span> <span class="pre">B</span></code></p></td>
<td class="text-align:right"><p>0 + 1000</p></td>
<td class="text-align:right"><p>1000</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">→</span> <span class="pre">F</span></code> + <code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">→</span> <span class="pre">B</span></code></p></td>
<td class="text-align:right"><p>1000 + 1000</p></td>
<td class="text-align:right"><p>2000</p></td>
</tr>
</tbody>
</table>
<p>These computations could have been performed by APL.
The first set of distances considered refer to routes that start at <code class="docutils literal notranslate"><span class="pre">E</span></code>, which are the values of the fifth row of the matrix <code class="docutils literal notranslate"><span class="pre">distances</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">distances</span><span class="sr">[</span><span class="m">5</span><span class="sr">;]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000 1000 51 17 0 1000
</span></div></div>
</div>
<p>Similarly, the second set of distances considered refer to routes that end at <code class="docutils literal notranslate"><span class="pre">B</span></code>, which are the values of the second column of the matrix <code class="docutils literal notranslate"><span class="pre">distances</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">distances</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">21 0 34 44 1000 1000
</span></div></div>
</div>
<p>Therefore, all we have to do is sum the fifth row “from <code class="docutils literal notranslate"><span class="pre">E</span></code>” to the second column “to <code class="docutils literal notranslate"><span class="pre">B</span></code>” and we get distances of paths from <code class="docutils literal notranslate"><span class="pre">E</span></code>, with a possible intermediate stop, that end at <code class="docutils literal notranslate"><span class="pre">B</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">distances</span><span class="sr">[</span><span class="m">5</span><span class="sr">;]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">distances</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1021 1000 85 61 1000 2000
</span></div></div>
</div>
<p>Only two routes really exist, because they are smaller than <code class="docutils literal notranslate"><span class="pre">1000</span></code>, which are the ones of length <code class="docutils literal notranslate"><span class="pre">85</span></code> and <code class="docutils literal notranslate"><span class="pre">61</span></code>.
Of course, we shall choose the shortest one:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="na">/</span><span class="w"> </span><span class="nv">distances</span><span class="sr">[</span><span class="m">5</span><span class="sr">;]</span><span class="o">+</span><span class="nv">distances</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">61
</span></div></div>
</div>
<p>To obtain all the minimum routes that have one or two steps, we just have to repeat this calculation for all rows and columns:
an <em>inner product</em> by the <em>minimum of sums</em> will do that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">distances</span><span class="w"> </span><span class="o">⌊</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">distances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   0 21 55   35 1000 1000
  32  0 34   67 1000   59
  66 34  0 1000   49   25
  76 44 78    0 1000 1000
1000 61 51   17    0   76
1000 65 31   41   24    0
</span></div></div>
</div>
<p>This result shows new routes, for example from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">C</span></code>, from <code class="docutils literal notranslate"><span class="pre">B</span></code> to <code class="docutils literal notranslate"><span class="pre">F</span></code>, and others.</p>
<p>The matrix <code class="docutils literal notranslate"><span class="pre">distances</span></code> contains zeroes in the diagonal, because the distance from a point to itself is zero.
That means that the <em>inner product</em> computed above shows a matrix that displays the length of the shortest route between two points that makes use of one or two roads.
That is why the matrix was called <code class="docutils literal notranslate"><span class="pre">L2</span></code>.</p>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">L2</span></code> and <code class="docutils literal notranslate"><span class="pre">distances</span></code> have some common values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">L2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">distances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0 1 1 1
1 1 1 0 1 0
0 1 1 1 0 1
0 1 0 1 1 1
1 0 1 1 1 0
1 0 1 0 1 1
</span></div></div>
</div>
<p>That is because the matrix <code class="docutils literal notranslate"><span class="pre">distances</span></code> already tells us what are the shortest routes between two points that make use of a <strong>single</strong> road.
Typically, going directly from a starting point to your final destination is faster than going through an intermediate stop, and that is why many values in <code class="docutils literal notranslate"><span class="pre">L2</span></code> match <code class="docutils literal notranslate"><span class="pre">distances</span></code>.</p>
<p>If we compute yet another <em>inner product</em>, we determine the lengths of the shortest routes between two points that make use of one, two, or three roads:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">L3</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">L2</span><span class="w"> </span><span class="o">⌊</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">distances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 0 21 55 35 1000  80
32  0 34 67   83  59
66 34  0 66   49  25
76 44 78  0 1000 103
93 61 51 17    0  76
97 65 31 41   24   0
</span></div></div>
</div>
<p>Again, <code class="docutils literal notranslate"><span class="pre">L3</span></code> and <code class="docutils literal notranslate"><span class="pre">L2</span></code> have some values in common:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">L3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">L2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1 0
1 1 1 1 0 1
1 1 1 0 1 1
1 1 1 1 1 0
0 1 1 1 1 1
0 1 1 1 1 1
</span></div></div>
</div>
<p>The values in common refer to connections for which considering a third road doesn’t help.
For example, you couldn’t go from <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">→</span> <span class="pre">C</span></code> directly, but if you go through <code class="docutils literal notranslate"><span class="pre">B</span></code>, then you can go from <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">→</span> <span class="pre">B</span> <span class="pre">→</span> <span class="pre">C</span></code>, and the length of that path is 55.
When computing <code class="docutils literal notranslate"><span class="pre">L3</span></code>, we try to see if there is a path <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">→</span> <span class="pre">C</span></code>, using three roads, that is faster than the path we already know.
For example, is the path <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">→</span> <span class="pre">D</span> <span class="pre">→</span> <span class="pre">B</span> <span class="pre">→</span> <span class="pre">C</span></code> faster?
In this case, it isn’t, and that is why <code class="docutils literal notranslate"><span class="pre">L3[1;3]</span></code> and <code class="docutils literal notranslate"><span class="pre">L2[1;3]</span></code> are the same:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">L3</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">L2</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Imagine, however, that better roads are built in the directions <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">→</span> <span class="pre">D</span></code> and <code class="docutils literal notranslate"><span class="pre">D</span> <span class="pre">→</span> <span class="pre">B</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">newDists</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">distances</span><span class="w"></span>
<span class="nv">newDists</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="sr">]</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">newDists</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   0   21 1000    5 1000 1000
  32    0   34 1000 1000 1000
1000   34    0 1000 1000   25
1000    5 1000    0 1000 1000
1000 1000   51   17    0 1000
1000 1000   31 1000   24    0
</span></div></div>
</div>
<p>Now, using one or two roads, you can go from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">C</span></code> in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">newDists</span><span class="w"> </span><span class="o">⌊</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">newDists</span><span class="p">)</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">55
</span></div></div>
</div>
<p>However, if we consider routes that use one, two, or three roads, we can make use of the new better roads and go from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">C</span></code> faster:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">newDists</span><span class="w"> </span><span class="o">⌊</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">newDists</span><span class="w"> </span><span class="o">⌊</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">newDists</span><span class="p">)</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="m">3</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">44
</span></div></div>
</div>
<p>If we ignore these new roads and continue using the distances we saw before, we can do one final <em>inner product</em> between <code class="docutils literal notranslate"><span class="pre">L3</span></code> and <code class="docutils literal notranslate"><span class="pre">distances</span></code> to figure out how to connect all points:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">L4</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">L3</span><span class="w"> </span><span class="o">⌊</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">distances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 0 21 55 35 104  80
32  0 34 67  83  59
66 34  0 66  49  25
76 44 78  0 127 103
93 61 51 17   0  76
97 65 31 41  24   0
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">L4</span></code> does not contain the value <code class="docutils literal notranslate"><span class="pre">1000</span></code>, so we see it is possible to go from any point to any point using four roads or less.
If we tried doing an additional <em>inner product</em>, we would see that all values would stay the same, which means we already know the shortest routes possible:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">L4</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">L4</span><span class="w"> </span><span class="o">⌊</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">distances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Here is a representation of all the connections:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39; ABCDEF&#39;</span><span class="o">,</span><span class="s1">&#39;ABCDEF&#39;</span><span class="o">⍪</span><span class="nv">L4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   A  B  C  D   E   F
A  0 21 55 35 104  80
B 32  0 34 67  83  59
C 66 34  0 66  49  25
D 76 44 78  0 127 103
E 93 61 51 17   0  76
F 97 65 31 41  24   0
</span></div></div>
</div>
<p>These computations using <em>inner product</em> are elegant, but they have a shortcoming:
we found, for example, that the shortest path from <code class="docutils literal notranslate"><span class="pre">D</span></code> to <code class="docutils literal notranslate"><span class="pre">E</span></code> has length 127, and that it requires four steps, but we do not know which ones those four steps are.</p>
</div>
<div class="section" id="is-a-graph-connected">
<span id="operators-is-a-graph-connected"></span><h4><span class="section-number">11.5.3.6. </span>Is a Graph Connected?<a class="headerlink" href="#is-a-graph-connected" title="Permalink to this headline">#</a></h4>
<p>In some development projects involving large graphs, it is sometimes necessary to check whether all points can be reached from any other point.
In our town analogy from before, this would amount to checking whether we could go from any location to any other location, regardless of the length of the route.</p>
<p>We already know the answer for the diagram in <a class="reference internal" href="#fig-town-diagram"><span class="std std-numref">Fig. 11.4</span></a>, so let us consider a modified version in <a class="reference internal" href="#fig-town-diagram-not-connected"><span class="std std-numref">Fig. 11.5</span></a>:</p>
<div class="figure align-default" id="town-diagram-not-connected">
<span id="fig-town-diagram-not-connected"></span><img alt="_images/Town_Diagram_Not_Connected.png" src="_images/Town_Diagram_Not_Connected.png" />
<p class="caption"><span class="caption-number">Fig. 11.5 </span><span class="caption-text">A modified diagram with connections between 6 points.</span><a class="headerlink" href="#town-diagram-not-connected" title="Permalink to this image">#</a></p>
</div>
<p>To check if the graph is connected (to check if you can go from any point to any other point), we can represent connections with a <code class="docutils literal notranslate"><span class="pre">1</span></code> and absence of connections with a <code class="docutils literal notranslate"><span class="pre">0</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">connections</span><span class="w"> </span><span class="kd">←</span><span class="o">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="nv">connections</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="nv">connections</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="nv">connections</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="nv">connections</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="nv">connections</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="nv">connections</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="nv">connections</span><span class="w"></span>
<span class="s1">&#39; ABCDEF&#39;</span><span class="o">,</span><span class="s1">&#39;ABCDEF&#39;</span><span class="o">⍪</span><span class="nv">connections</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  A B C D E F
A 1 1 0 1 0 0
B 1 1 0 0 0 0
C 0 0 1 0 0 1
D 0 1 0 1 0 0
E 0 0 1 1 1 0
F 0 0 1 0 1 1
</span></div></div>
</div>
<p>In the matrix <code class="docutils literal notranslate"><span class="pre">distances</span></code>, the diagonal was set to <code class="docutils literal notranslate"><span class="pre">0</span></code> because the distance from a point to itself was <code class="docutils literal notranslate"><span class="pre">0</span></code>.
In the matrix <code class="docutils literal notranslate"><span class="pre">connections</span></code>, the diagonal is set to <code class="docutils literal notranslate"><span class="pre">1</span></code> because each point is (obviously!) connected to itself.</p>
<p>The matrix <code class="docutils literal notranslate"><span class="pre">connections</span></code> determines the direct connections between points, and we can see there is no direct connection from <code class="docutils literal notranslate"><span class="pre">C</span></code> to <code class="docutils literal notranslate"><span class="pre">E</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">connections</span><span class="sr">[</span><span class="m">3</span><span class="sr">;</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Is there a connection in two steps?
This connection will exist if we can go from <code class="docutils literal notranslate"><span class="pre">C</span></code> to <code class="docutils literal notranslate"><span class="pre">A</span></code> <strong>and</strong> from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">E</span></code>, <strong>or</strong> from <code class="docutils literal notranslate"><span class="pre">C</span></code> to <code class="docutils literal notranslate"><span class="pre">B</span></code> <strong>and</strong> from <code class="docutils literal notranslate"><span class="pre">B</span></code> to <code class="docutils literal notranslate"><span class="pre">E</span></code>, <strong>or</strong> … and so on.</p>
<p>Repeated for all points, this connectivity matrix in two steps can be obtained using an <em>inner product</em> by <em>or</em> and <em>and</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">C2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">connections</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">∧</span><span class="w"> </span><span class="nv">connections</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0 1 0 0
1 1 0 1 0 0
0 0 1 0 1 1
1 1 0 1 0 0
0 1 1 1 1 1
0 0 1 1 1 1
</span></div></div>
</div>
<p>Now, we can see that <code class="docutils literal notranslate"><span class="pre">C</span></code> is connected to <code class="docutils literal notranslate"><span class="pre">E</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">C2</span><span class="sr">[</span><span class="m">3</span><span class="sr">;</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>We can keep computing these <em>inner products</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">C3</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">C2</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">∧</span><span class="w"> </span><span class="nv">connections</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0 1 0 0
1 1 0 1 0 0
0 0 1 1 1 1
1 1 0 1 0 0
1 1 1 1 1 1
0 1 1 1 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">C4</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">C3</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">∧</span><span class="w"> </span><span class="nv">connections</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0 1 0 0
1 1 0 1 0 0
0 1 1 1 1 1
1 1 0 1 0 0
1 1 1 1 1 1
1 1 1 1 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">C5</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">C4</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">∧</span><span class="w"> </span><span class="nv">connections</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0 1 0 0
1 1 0 1 0 0
1 1 1 1 1 1
1 1 0 1 0 0
1 1 1 1 1 1
1 1 1 1 1 1
</span></div></div>
</div>
<p>The matrix <code class="docutils literal notranslate"><span class="pre">C5</span></code> tells what points are connected by routes with 5 steps or less.
Do we need to compute another <em>inner product</em>?</p>
<p>Our town has 6 different points of interest.
If you cannot go from one place to another in 5 steps, there is no point in trying 6 steps:
routes with 6 steps will mean we are repeating intermediate stops, which does not help in trying to reach a specific destination.</p>
<p>So, our final connectivity matrix is <code class="docutils literal notranslate"><span class="pre">C5</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">C5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 0 1 0 0
1 1 0 1 0 0
1 1 1 1 1 1
1 1 0 1 0 0
1 1 1 1 1 1
1 1 1 1 1 1
</span></div></div>
</div>
<p>Because it contains <code class="docutils literal notranslate"><span class="pre">0</span></code>s, it shows that we cannot go from <code class="docutils literal notranslate"><span class="pre">D</span></code> to <code class="docutils literal notranslate"><span class="pre">C</span></code>, for example.
You can confirm this by looking at <a class="reference internal" href="#fig-town-diagram-not-connected"><span class="std std-numref">Fig. 11.5</span></a> and realising there is, indeed, no roads that take us from <code class="docutils literal notranslate"><span class="pre">D</span></code> to <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p>
</div>
</div>
<div class="section" id="other-uses-of-inner-product">
<span id="operators-other-uses-of-inner-product"></span><h3><span class="section-number">11.5.4. </span>Other Uses of Inner Product<a class="headerlink" href="#other-uses-of-inner-product" title="Permalink to this headline">#</a></h3>
<p>We saw above some common uses of <em>inner product</em>, but there are many other useful <em>inner products</em> using primitives or even user-defined functions.
Learning to recognise patterns where an <em>inner product</em> is applicable is just a matter of practice.</p>
<p>As for <em>outer product</em>, some applications of <em>inner product</em> produce nested arrays, as you can see with the following examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 4 1
1 3 5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 0 2 5
1 7 7 2
6 0 4 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="o">,</span><span class="na">.</span><span class="o">+</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┬──────┬─────┐
│5 5 7 │2 11 1│4 11 5│7 6 3│
├──────┼──────┼──────┼─────┤
│4 4 11│1 10 5│3 10 9│6 5 7│
└──────┴──────┴──────┴─────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">,</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───┬────┬───┐
│7 10│7 7│7 13│7 9│
├────┼───┼────┼───┤
│9 10│9 7│9 13│9 9│
└────┴───┴────┴───┘
</span></div></div>
</div>
</div>
<div class="section" id="application">
<span id="operators-application"></span><h3><span class="section-number">11.5.5. </span>Application<a class="headerlink" href="#application" title="Permalink to this headline">#</a></h3>
<p>We have a certain number of two-dimensional points, the coordinates of which are given by a nested vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ points:    A     B     C     D      E     F     G    H</span><span class="w"></span>
<span class="nv">coords</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">¯1</span><span class="w"> </span><span class="m">2</span><span class="p">)(</span><span class="m">¯2</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">¯1</span><span class="w"> </span><span class="m">0</span><span class="p">)(</span><span class="m">¯1</span><span class="w"> </span><span class="m">¯1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">¯3</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">¯2</span><span class="p">)(</span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, we take those coordinates and then split them into vectors with the x and y coordinates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↓</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">↑</span><span class="nv">coords</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────────────┬──────────────────┐
│0 ¯1 ¯2 ¯1 ¯1 1 2 2│2 2 1 0 ¯1 ¯3 ¯2 0│
└───────────────────┴──────────────────┘
</span></div></div>
</div>
<p><a class="reference internal" href="#fig-vertices-polygon"><span class="std std-numref">Fig. 11.6</span></a> shows where those points are located in a coordinate system, and the polygon we get when we connect those points:</p>
<div class="figure align-default" id="vertices-polygon">
<span id="fig-vertices-polygon"></span><img alt="_images/Vertices_Polygon.png" src="_images/Vertices_Polygon.png" />
<p class="caption"><span class="caption-number">Fig. 11.6 </span><span class="caption-text">A polygon with eight vertices.</span><a class="headerlink" href="#vertices-polygon" title="Permalink to this image">#</a></p>
</div>
<p>The area of the polygon can be calculated by adding the areas of the trapeziums delimited by the polygon and the horizontal axis, like the grey trapezium <span class="math notranslate nohighlight">\([FGHK]\)</span>.
For each of those trapeziums, their base lengths are calculated by subtracting adjacent values in <code class="docutils literal notranslate"><span class="pre">x</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="o">⌽</span><span class="nv">x</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 ¯1 0 ¯2 ¯1 0 2
</span></div></div>
</div>
<p>Then, the base lengths have to be multiplied by half of the sums of adjacent values in <code class="docutils literal notranslate"><span class="pre">y</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">⌽</span><span class="nv">y</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 1.5 0.5 ¯0.5 ¯2 ¯2.5 ¯1 1
</span></div></div>
</div>
<p>In other words, we must <em>add</em> the <em>products</em> of bases by heights, which can be written as an <em>inner product</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">x</span><span class="o">-</span><span class="m">1</span><span class="o">⌽</span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="w"> </span><span class="p">(</span><span class="nv">y</span><span class="o">+</span><span class="m">1</span><span class="o">⌽</span><span class="nv">y</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">11.5
</span></div></div>
</div>
<p>What about the perimeter now?
We must add all the individual segment lengths.
The length of a segment <span class="math notranslate nohighlight">\([BC]\)</span> or <span class="math notranslate nohighlight">\([FG]\)</span> can be calculated using the Pythagorean theorem: <span class="math notranslate nohighlight">\(a^2 + b^2 = c^2\)</span>.</p>
<p>We shall calculate the length of horizontal and vertical sides by subtracting adjacent values in <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>, as we did for <code class="docutils literal notranslate"><span class="pre">x</span></code> in the previous example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">segs</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">x</span><span class="o">-</span><span class="m">1</span><span class="o">⌽</span><span class="nv">x</span><span class="p">)</span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="p">(</span><span class="nv">y</span><span class="o">-</span><span class="m">1</span><span class="o">⌽</span><span class="nv">y</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  0
 1  1
¯1  1
 0  1
¯2  2
¯1 ¯1
 0 ¯2
 2 ¯2
</span></div></div>
</div>
<p>Now, in each small right-angled triangle, we must add the squares of both sides to obtain the square of each hypotenuse: <em>add</em> the <em>squares</em> will be our first <em>inner product</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">segs</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 2 1 8 2 4 8
</span></div></div>
</div>
<p>Then, we have to add the square roots of these hypotenuses.
<em>Add</em> the <em>square roots</em> will be our second <em>inner product</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">segs</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">*</span><span class="w"> </span><span class="m">0.5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13.8995
</span></div></div>
</div>
<div class="figure align-default" id="inner-product-drawing">
<span id="fig-inner-product-drawing"></span><img alt="_images/Inner_Product_Drawing.png" src="_images/Inner_Product_Drawing.png" />
</div>
</div>
</div>
<div class="section" id="intermission-exercises">
<span id="operators-intermission-exercises"></span><h2><span class="section-number">11.6. </span>Intermission Exercises<a class="headerlink" href="#intermission-exercises" title="Permalink to this headline">#</a></h2>
<div class="exercise admonition" id="reductions">

<p class="admonition-title"><span class="caption-number">Exercise 11.2 </span></p>
<div class="section" id="exercise-content">
<p>You are given the matrix <code class="docutils literal notranslate"><span class="pre">mat</span></code> shown below.</p>
<p>Calculate the result of the following expressions and then check your answers on the computer:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⌈/</span> <span class="pre">mat</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⌊/</span> <span class="pre">+/</span> <span class="pre">mat</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">×/</span> <span class="pre">⌊/[1]</span> <span class="pre">mat</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">×/</span> <span class="pre">⍴mat</span></code></p></li>
</ol>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="scans">

<p class="admonition-title"><span class="caption-number">Exercise 11.3 </span></p>
<div class="section" id="exercise-content">
<p>Calculate:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-\</span> <span class="pre">6⍴1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-\</span> <span class="pre">⌽⍳5</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">×/</span> <span class="pre">+\</span> <span class="pre">6⍴1</span></code></p></li>
</ol>
</div>
</div>
<div class="exercise admonition" id="Boolean-scans-and-reductions">

<p class="admonition-title"><span class="caption-number">Exercise 11.4 </span></p>
<div class="section" id="exercise-content">
<p>Calculate:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">∧/</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">∧\</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">=/</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">=\</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">1</span></code></p></li>
</ol>
</div>
</div>
<div class="exercise admonition" id="reverse-engineer-scan">

<p class="admonition-title"><span class="caption-number">Exercise 11.5 </span></p>
<div class="section" id="exercise-content">
<p>When we execute <code class="docutils literal notranslate"><span class="pre">×\vec</span></code>, we get the result <code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">14</span> <span class="pre">70</span> <span class="pre">210</span> <span class="pre">840</span></code>.
What is the value of <code class="docutils literal notranslate"><span class="pre">vec</span></code>?</p>
</div>
</div>
<div class="exercise admonition" id="broken-keyboard-iota">

<p class="admonition-title"><span class="caption-number">Exercise 11.6 </span></p>
<div class="section" id="exercise-content">
<p>Broken keyboard!
The iota (<code class="docutils literal notranslate"><span class="pre">⍳</span></code>) key of your keyboard does not work.
How could you create the list of the first <code class="docutils literal notranslate"><span class="pre">n</span></code> integers?</p>
</div>
</div>
<div class="exercise admonition" id="triangle-area">

<p class="admonition-title"><span class="caption-number">Exercise 11.7 </span></p>
<div class="section" id="exercise-content">
<p>Let <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span>, be the three sides of a triangle, and <span class="math notranslate nohighlight">\(s\)</span> be its semi-perimeter (half of its perimeter, <span class="math notranslate nohighlight">\(s = \frac{a + b + c}2\)</span>).
Believe it or not, the area of that triangle is equal to the following expression (called “Heron’s formula”):</p>
<div class="math notranslate nohighlight">
\[\sqrt{s \times (s - a) \times (s - b) \times (s - c)}\]</div>
<p>Can you write a function to calculate the area of a triangle given the lengths of its sides?
Use the two examples below to validate your solution.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Area</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: Area
      Area 3 4 5
      ∧
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Area</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: Area
      Area 10 6 8
      ∧
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="all-different">

<p class="admonition-title"><span class="caption-number">Exercise 11.8 </span></p>
<div class="section" id="exercise-content">
<p>We would like to know whether all the items of a vector are different.
Among the many possible solutions, could you find one using <em>outer product</em> and another one using <em>inner product</em>?
The result must, of course, be a Boolean <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</div>
</div>
<div class="exercise admonition" id="pairwise-reduction">

<p class="admonition-title"><span class="caption-number">Exercise 11.9 </span></p>
<div class="section" id="exercise-content">
<p>What would be the result of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">=/</span> <span class="pre">'MASSACHUSSETTS'</span></code>?</p>
</div>
</div>
<div class="exercise admonition" id="word-in-vector">

<p class="admonition-title"><span class="caption-number">Exercise 11.10 </span></p>
<div class="section" id="exercise-content">
<p>Try to find a word in a vector of characters.
Your function should give the positions of the first letter of the word in the vector.</p>
<p>After solving this exercise once, try to <em>also</em> implement this function <code class="docutils literal notranslate"><span class="pre">In</span></code> using an <em>inner product</em>.
Solving the next two exercises first might help.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;CAN&#39;</span><span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="s1">&#39;CAN YOU CANCEL MY FLIGHT ON AIR CANADA?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: In
      &#39;CAN&#39;In&#39;CAN YOU CANCEL MY FLIGHT ON AIR CANADA?&#39;
           ∧
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="find-row-in-matrix">

<p class="admonition-title"><span class="caption-number">Exercise 11.11 </span></p>
<div class="section" id="exercise-content">
<p>Broken keyboard!
Try to find a row in a matrix without using dyadic iota <code class="docutils literal notranslate"><span class="pre">⍳</span></code>.
Your function <code class="docutils literal notranslate"><span class="pre">InMat</span></code> should expect a matrix on the left and a vector on the right, and it should return a Boolean value indicating whether the left argument matrix contains a row equal to the right argument vector.
You can assume the matrix has as many columns as the vector has elements.</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: InMat
      (4 3⍴&#39;BANCANDANDIG&#39;)InMat&#39;CAN&#39;
                          ∧
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: InMat
      (4 3⍴⍳12)InMat 0 1 2
               ∧
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="in-mat-find-better">

<p class="admonition-title"><span class="caption-number">Exercise 11.12 </span></p>
<div class="section" id="exercise-content">
<p>Modify the previous exercise so that the right argument can either be a vector or a matrix.
Your function should return a vector with as many elements as there are rows on the right argument (or with one element, if the right argument is a vector), where each element is a Boolean value indicating whether the corresponding row of the right argument matches any of the rows of the left argument matrix.</p>
<p>Can you use <em>inner product</em> in this exercise and/or in the previous one?</p>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat2</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: InMat2
      (4 3⍴&#39;BANCANDANDIG&#39;)InMat2&#39;CAN&#39;
                          ∧
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">9</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: InMat2
      (3 3⍴9 8 7 4 5 6 3 2 1)InMat2 2 3⍴⍳6
                             ∧
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="cross-count">

<p class="admonition-title"><span class="caption-number">Exercise 11.13 </span></p>
<div class="section" id="exercise-content">
<p>For a certain number of people, you are given two vectors:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code> – a character vector specifying the person’s marital status (Single, Married, Divorced, Widow, Unknown); and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">graduated</span></code> – a character vector specifying if the person has graduated or not (Yes/No).</p></li>
</ol>
<p>Write a function to count how many people are in each category.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">CrossCount</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">binx</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">∪</span><span class="bp">⍺</span><span class="p">)</span><span class="na">∘.</span><span class="o">=</span><span class="bp">⍺</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">biny</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="na">∘.</span><span class="o">=</span><span class="p">(</span><span class="o">∪</span><span class="bp">⍵</span><span class="p">)</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">binx</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">∧</span><span class="w"> </span><span class="nv">biny</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="p">((</span><span class="o">⊂</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">,</span><span class="na">⍨</span><span class="o">∪</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍪</span><span class="p">((</span><span class="o">⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">,</span><span class="na">⍨</span><span class="o">∪</span><span class="bp">⍺</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊢⍪+</span><span class="na">⌿</span><span class="p">)(</span><span class="o">⊢,+</span><span class="na">/</span><span class="p">)</span><span class="nv">r</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">↑</span><span class="nv">status</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;SMDWU&#39;</span><span class="sr">[</span><span class="o">?</span><span class="m">300</span><span class="o">⍴</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">SMMMDDUSUU
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">↑</span><span class="nv">graduated</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;YN&#39;</span><span class="sr">[</span><span class="o">?</span><span class="m">300</span><span class="o">⍴</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">YNNNNNYYYY
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="nv">CrossCount</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬──┬──┬──┬──┬──┬─────┐
│     │S │M │D │U │W │Total│
├─────┼──┼──┼──┼──┼──┼─────┤
│Y    │31│28│31│36│32│158  │
├─────┼──┼──┼──┼──┼──┼─────┤
│N    │26│27│37│28│24│142  │
├─────┼──┼──┼──┼──┼──┼─────┤
│Total│57│55│68│64│56│300  │
└─────┴──┴──┴──┴──┴──┴─────┘
</span></div></div>
</div>
</div>
<div class="section" id="at">
<span id="operators-at"></span><h2><span class="section-number">11.7. </span>At<a class="headerlink" href="#at" title="Permalink to this headline">#</a></h2>
<p>The operator <em>at</em> can be used to work with values at specified positions, and there are multiple ways in which we can do this.
In its most general form, the operator <em>at</em> can work with right arguments of arbitrary rank, but for the sake of simplicity we will start by explaining how the operator works with vectors as right arguments.</p>
<div class="section" id="apply-function-at-indices">
<span id="operators-apply-function-at-indices"></span><h3><span class="section-number">11.7.1. </span>Apply Function At Indices<a class="headerlink" href="#apply-function-at-indices" title="Permalink to this headline">#</a></h3>
<p>In one of its forms, the operator <em>at</em> can be used to apply a function at the specified indices of the argument vector.
The function to be applied is the left operand and the indices are the right operand.</p>
<p>This is the first time we learn about an operator that takes an array as the right operand.
In the example below, notice how we use parentheses to separate the right operand array from the right argument array.</p>
<p>Let us <em>negate</em> the values <em>at</em> indices <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">3</span></code>, and <code class="docutils literal notranslate"><span class="pre">9</span></code>, of <code class="docutils literal notranslate"><span class="pre">vector</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vector</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">×⍳</span><span class="m">10</span><span class="w"></span>
<span class="nv">idx</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">9</span><span class="w"></span>
<span class="p">(</span><span class="o">-</span><span class="na">@</span><span class="nv">idx</span><span class="p">)</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯10 20 ¯30 40 50 60 70 80 ¯90 100
</span></div></div>
</div>
<p>Notice that the operator <em>at</em> returns the whole array after modifying the specified values, in opposition to returning just the values that were modified.</p>
<p>The parentheses around <code class="docutils literal notranslate"><span class="pre">-&#64;idx</span></code> are necessary.
If they were not there, APL would not complain, but it would produce some interesting output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">@</span><span class="nv">idx</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> @
┌┴┐
- (1 3 9) (10+10×⎕io-⍨⍳10)
</span></div></div>
</div>
<p>What is happening is that APL is looking at <code class="docutils literal notranslate"><span class="pre">idx</span> <span class="pre">vector</span></code> as a vector of length two defined by strand notation.
We can verify that <code class="docutils literal notranslate"><span class="pre">idx</span> <span class="pre">vector</span></code> is being interpreted as a single array.
We do that by parenthesising <code class="docutils literal notranslate"><span class="pre">idx</span> <span class="pre">vector</span></code> and noticing that the interesting output does not change:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">@</span><span class="p">(</span><span class="nv">idx</span><span class="w"> </span><span class="nv">vector</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> @
┌┴┐
- (1 3 9) (10+10×⎕io-⍨⍳10)
</span></div></div>
</div>
<p>The exact meaning of this output will be explained in <a class="reference internal" href="Tacit-Programming.html#tacit-programming-inspecting-tacit-functions"><span class="std std-numref">Section 12.2</span></a>.
For now, it suffices to understand that it does <em>not</em> the output of <code class="docutils literal notranslate"><span class="pre">(-&#64;idx)</span> <span class="pre">vector</span></code>.</p>
<p>In order for APL to know that <code class="docutils literal notranslate"><span class="pre">idx</span></code> is the right <em>operand</em> and <code class="docutils literal notranslate"><span class="pre">vector</span></code> is the right <em>argument</em>, we must separate them in some way.
Parenthesising the operator and its operand is one option, but another common option is to just use a <em>right tack</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">@</span><span class="nv">idx</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯10 20 ¯30 40 50 60 70 80 ¯90 100
</span></div></div>
</div>
<p>The <em>right tack</em> works because it effectively breaks the strand, which lets the operator <em>at</em> understand that its right operand is just <code class="docutils literal notranslate"><span class="pre">idx</span></code>.</p>
<p>Below, you can find another example usage of the operator <em>at</em>, in which we double values <em>at</em> the indices <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">10</span></code> with a dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍵</span><span class="o">×</span><span class="m">2</span><span class="kt">}</span><span class="na">@</span><span class="m">1</span><span class="w"> </span><span class="m">10</span><span class="o">⊢</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20 20 30 40 50 60 70 80 90 200
</span></div></div>
</div>
<p>The example above also shows that the operator <em>at</em> works with user-defined functions.</p>
<p>It is important to understand how the operator <em>at</em> passes the elements of the indices specified into the left operand function.
Take a look at the definition of the nested vector below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">nested</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="na">¨</span><span class="o">⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬───────┬─────────┐
│1│1 2│1 2 3│1 2 3 4│1 2 3 4 5│
└─┴───┴─────┴───────┴─────────┘
</span></div></div>
</div>
<p>What is the output you expect from running the expression <code class="docutils literal notranslate"><span class="pre">(⍴&#64;4</span> <span class="pre">5)nested</span></code>?
Give it some thought…
Because the actual result might surprise you:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">@</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⊢</span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬─┬─┐
│1│1 2│1 2 3│2│2│
└─┴───┴─────┴─┴─┘
</span></div></div>
</div>
<p>The operator <em>at</em> collects all the elements at the indices specified and then passes them, as a whole vector, to the left operand function.
We can see this by using, as the left operand, a dfn that prints its right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="vg">⎕</span><span class="kd">←</span><span class="s1">&#39;called with ⍵: &#39;</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="vg">⎕</span><span class="kd">←</span><span class="bp">⍵</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">@</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⊢</span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">called with ⍵: 
┌───────┬─────────┐
│1 2 3 4│1 2 3 4 5│
└───────┴─────────┘
</span></div></div>
</div>
<p>This is different from passing each element to the left operand function separately when the left operand function is <strong>not</strong> a <em>scalar function</em>, like <code class="docutils literal notranslate"><span class="pre">⍴</span></code>.</p>
<p>Then, after all the values are collected and passed in to the left operand function, the result should be a single scalar (that gets placed in all the indices specified) or a vector with as many elements as there were indices.
In that case, the elements of the result vector are distributed across the positions specified by the indices.</p>
<p>The example above with <em>shape at</em> and the nested vector shows that a scalar result gets placed in all the positions that were specified.
The example below shows that the result vector must have as many elements as there were indices, otherwise the operator <em>at</em> will not know how to place the results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">matrices</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="w"> </span><span class="bp">⍵</span><span class="o">⍴⍳</span><span class="bp">⍵</span><span class="o">*</span><span class="m">2</span><span class="kt">}</span><span class="na">¨</span><span class="o">⍳</span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┐
│1│1 2│1 2 3│
│ │3 4│4 5 6│
│ │   │7 8 9│
└─┴───┴─────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="na">@</span><span class="m">3</span><span class="o">⊢</span><span class="nv">matrices</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      ⍴@3⊢matrices
      ∧
</pre></div>
</div>
</div>
</div>
<p>The reason we get a <code class="docutils literal notranslate"><span class="pre">LENGTH</span> <span class="pre">ERROR</span></code> above is that the <em>shape at index <code class="docutils literal notranslate"><span class="pre">3</span></code></em> returns <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">3</span></code>, which is a vector of length <code class="docutils literal notranslate"><span class="pre">2</span></code>, which does not match the length <code class="docutils literal notranslate"><span class="pre">1</span></code> of the vector of indices.</p>
</div>
<div class="section" id="apply-dyadic-function-at-indices">
<span id="operators-apply-dyadic-function-at-indices"></span><h3><span class="section-number">11.7.2. </span>Apply Dyadic Function At Indices<a class="headerlink" href="#apply-dyadic-function-at-indices" title="Permalink to this headline">#</a></h3>
<p>When the function in <code class="docutils literal notranslate"><span class="pre">(F&#64;idx)vector</span></code> is dyadic, the left argument of <code class="docutils literal notranslate"><span class="pre">F</span></code> can be written on the left of the operator <em>at</em>, as <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">(F&#64;idx)</span> <span class="pre">vector</span></code>.
In this case, the operator <em>at</em> does not do any sort of selection or indexing into the left argument.
The left argument is passed directly to the function <code class="docutils literal notranslate"><span class="pre">F</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">×</span><span class="na">@</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 20 300 40 5000 60 70 80 90 100
</span></div></div>
</div>
<p>Thus, if the function <code class="docutils literal notranslate"><span class="pre">F</span></code> is a scalar function, the left argument must be a scalar or have the same length as the vector of indices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="o">×</span><span class="na">@</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR: Mismatched left and right argument shapes
      10 100 1000×@3 5⊢vector
                 ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">100</span><span class="w"> </span><span class="o">×</span><span class="na">@</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000 20 3000 40 5000 60 70 80 90 100
</span></div></div>
</div>
</div>
<div class="section" id="replace-values-at-indices">
<span id="operators-replace-values-at-indices"></span><h3><span class="section-number">11.7.3. </span>Replace Values At Indices<a class="headerlink" href="#replace-values-at-indices" title="Permalink to this headline">#</a></h3>
<p>Here is the nested vector from before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬───────┬─────────┐
│1│1 2│1 2 3│1 2 3 4│1 2 3 4 5│
└─┴───┴─────┴───────┴─────────┘
</span></div></div>
</div>
<p>Can you use a dfn to replace the elements of <code class="docutils literal notranslate"><span class="pre">nested</span></code> at indices <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code> with the vectors <code class="docutils literal notranslate"><span class="pre">'CAT'</span></code> and <code class="docutils literal notranslate"><span class="pre">'DOG'</span></code>, respectively?</p>
<p>There are a couple of ways to do this.
For example, we can set the left operand to be a function that returns the left argument, and pass the new values as the left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;CAT&#39;</span><span class="w"> </span><span class="s1">&#39;DOG&#39;</span><span class="kt">{</span><span class="bp">⍺</span><span class="kt">}</span><span class="na">@</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⊢</span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬───┬───────┬───┐
│1│1 2│CAT│1 2 3 4│DOG│
└─┴───┴───┴───────┴───┘
</span></div></div>
</div>
<p>This is equivalent to just enclosing the new values in a dfn in the left operand:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="s1">&#39;CAT&#39;</span><span class="w"> </span><span class="s1">&#39;DOG&#39;</span><span class="kt">}</span><span class="na">@</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⊢</span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬───┬───────┬───┐
│1│1 2│CAT│1 2 3 4│DOG│
└─┴───┴───┴───────┴───┘
</span></div></div>
</div>
<p>The operator <em>at</em> can, indeed, be used to replace values at the specified indices.
We used a couple of different functions to do that, but the operator <em>at</em> provides a special form, in which the left operand is an array instead of a function.</p>
<p>Suppose we have a vector <code class="docutils literal notranslate"><span class="pre">vec</span></code> and a vector with some indices, <code class="docutils literal notranslate"><span class="pre">idx</span></code>.
If the vector <code class="docutils literal notranslate"><span class="pre">new</span></code> has the same length as <code class="docutils literal notranslate"><span class="pre">idx</span></code>, then we have seen that <code class="docutils literal notranslate"><span class="pre">({new}&#64;idx)vec</span></code> puts the elements of the vector <code class="docutils literal notranslate"><span class="pre">new</span></code> in the positions specified by the indices <code class="docutils literal notranslate"><span class="pre">idx</span></code>, but we can actually do this more directly by writing <code class="docutils literal notranslate"><span class="pre">(new&#64;idx)vec</span></code>.
That is, the operator <em>at</em> can take a vector on the left, instead of a function, and it will put those values in the positions specified:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;CAT&#39;</span><span class="w"> </span><span class="s1">&#39;DOG&#39;</span><span class="na">@</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="o">⊢</span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬───┬───────┬───┐
│1│1 2│CAT│1 2 3 4│DOG│
└─┴───┴───┴───────┴───┘
</span></div></div>
</div>
<p>The operator <em>at</em> has another form that we discuss next.</p>
</div>
<div class="section" id="right-operand-as-selector">
<span id="operators-right-operand-as-selector"></span><h3><span class="section-number">11.7.4. </span>Right Operand as Selector<a class="headerlink" href="#right-operand-as-selector" title="Permalink to this headline">#</a></h3>
<p>So far, the forms we have seen with the operator <em>at</em> had an array right operand (more specifically, a vector).
The operator <em>at</em> can also take a right operand selector function.
This function must return a Boolean mask that determines to which values the left operand is applied.</p>
<p>For example, the code below replaces all values larger than 5 with the value 0:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">vector</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">?</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 7 6 5 4 8 2 3 1 9
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">IsLarger5</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="o">&gt;</span><span class="m">5</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="na">@</span><span class="nv">IsLarger5</span><span class="o">⊢</span><span class="w"> </span><span class="nv">vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 5 4 0 2 3 1 0
</span></div></div>
</div>
<p>When the right operand is a function, that function must be prepared to receive the whole right argument array at once.
In other words, the selector function is not applied individually to each element of the right argument.</p>
<p>So, if we define <code class="docutils literal notranslate"><span class="pre">LongerThan3</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">LongerThan3</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">3</span><span class="o">&lt;≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>And if we recall the vector <code class="docutils literal notranslate"><span class="pre">nested</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬───────┬─────────┐
│1│1 2│1 2 3│1 2 3 4│1 2 3 4 5│
└─┴───┴─────┴───────┴─────────┘
</span></div></div>
</div>
<p>We might have expected <code class="docutils literal notranslate"><span class="pre">({3↑⍵}&#64;LongerThan3)</span> <span class="pre">nested</span></code> to trim the two last vectors.
Instead, it raises an error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="m">3</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">@</span><span class="nv">LongerThan3</span><span class="o">⊢</span><span class="w"> </span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR: Right operand and argument ranks differ
      {3↑⍵}@LongerThan3⊢nested
           ∧
</pre></div>
</div>
</div>
</div>
<p>The error happens because <code class="docutils literal notranslate"><span class="pre">LongerThan3</span></code> takes the whole vector <code class="docutils literal notranslate"><span class="pre">nested</span></code> as its argument and produces a scalar result, the Boolean value <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">LongerThan3</span><span class="w"> </span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Then, the operator <em>at</em> sees that result as the Boolean mask that will determine what values get passed in to the left operand function.
However, the Boolean mask is just a scalar <code class="docutils literal notranslate"><span class="pre">1</span></code> and the right argument is a vector, so there is a rank mismatch and the operator <em>at</em> cannot do its magic.
If we modify the function <code class="docutils literal notranslate"><span class="pre">LongerThan3</span></code> to return its result as a vector, we would still have an error, but this time a <code class="docutils literal notranslate"><span class="pre">LENGTH</span> <span class="pre">ERROR</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">LongerThan3</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">,</span><span class="m">3</span><span class="o">&lt;≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="kt">{</span><span class="m">3</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">@</span><span class="nv">LongerThan3</span><span class="o">⊢</span><span class="w"> </span><span class="nv">nested</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR: Right operand and argument lengths differ
      {3↑⍵}@LongerThan3⊢nested
           ∧
</pre></div>
</div>
</div>
</div>
<p>This time, the error is a <code class="docutils literal notranslate"><span class="pre">LENGTH</span> <span class="pre">ERROR</span></code> because the Boolean mask is the vector <code class="docutils literal notranslate"><span class="pre">,1</span></code> which has length <code class="docutils literal notranslate"><span class="pre">1</span></code>, whereas the argument vector <code class="docutils literal notranslate"><span class="pre">nested</span></code> has length <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p>
<p>As we have seen, the operator <em>at</em> is very versatile.
As a right operand, you can have:</p>
<ul class="simple">
<li><p>the set of indices where you want to do some work; or</p></li>
<li><p>a selector function that produces a Boolean mask indicating the positions where you will do some work.</p></li>
</ul>
<p>As a left operand, you can have:</p>
<ul class="simple">
<li><p>a function to be applied to the subarray that was selected; or</p></li>
<li><p>new values to replace the subarray that was selected.</p></li>
</ul>
<p>The left operand acts on the selection of the right operand.</p>
</div>
<div class="section" id="at-with-high-rank-arguments">
<span id="operators-at-with-high-rank-arguments"></span><h3><span class="section-number">11.7.5. </span>At with High-Rank Arguments<a class="headerlink" href="#at-with-high-rank-arguments" title="Permalink to this headline">#</a></h3>
<p>So far, all of our examples with the operator <em>at</em> were with vectors.
However, the operator <em>at</em> can handle right arguments of arbitrary rank.
We just need to understand how those high-rank arrays are handled by the operands of the operator <em>at</em>.</p>
<div class="section" id="right-operand-array">
<span id="operators-right-operand-array"></span><h4><span class="section-number">11.7.5.1. </span>Right Operand Array<a class="headerlink" href="#right-operand-array" title="Permalink to this headline">#</a></h4>
<p>The right operand array can be a simple integer vector or a nested integer vector.
If it is a simple integer vector (or a simple integer scalar), then the integers are the indices of major cells of the argument.</p>
<p>For example, we can easily increment the second and fourth rows of a matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">16</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  6  7  8
 9 10 11 12
13 14 15 16
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1000</span><span class="w"> </span><span class="o">+</span><span class="na">@</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⊢</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   1    2    3    4
1005 1006 1007 1008
   9   10   11   12
1013 1014 1015 1016
</span></div></div>
</div>
<p>If the right operand is nested, it specifies indices for <em>reach</em> or <em>choose</em> indexing.</p>
<p>For example, below we negate the four corners of our matrix <code class="docutils literal notranslate"><span class="pre">mat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">@</span><span class="p">((</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> ¯1  2  3  ¯4
  5  6  7   8
  9 10 11  12
¯13 14 15 ¯16
</span></div></div>
</div>
</div>
<div class="section" id="right-operand-function">
<span id="operators-right-operand-function"></span><h4><span class="section-number">11.7.5.2. </span>Right Operand Function<a class="headerlink" href="#right-operand-function" title="Permalink to this headline">#</a></h4>
<p>When the right operand is a function, it must still compute a Boolean mask that determines what values will be modified or replaced.</p>
<p>For example, we can easily add one to the odd values in the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">@</span><span class="kt">{</span><span class="m">2</span><span class="o">|</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 2  2  4  4
 6  6  8  8
10 10 12 12
14 14 16 16
</span></div></div>
</div>
</div>
<div class="section" id="shape-of-the-left-operand">
<span id="operators-shape-of-the-left-operand"></span><h4><span class="section-number">11.7.5.3. </span>Shape of the Left Operand<a class="headerlink" href="#shape-of-the-left-operand" title="Permalink to this headline">#</a></h4>
<p>So far, all the examples that we saw and that involved high-rank arrays avoided the issue of shapes:</p>
<ul class="simple">
<li><p>If the left operand is a function, what will be the shape of its argument?</p></li>
<li><p>If the left operand is an array, what should its shape be for <em>at</em> to know how to replace the values?</p></li>
</ul>
<p>Before you proceed and read this section, try to do some experiments to see if you can deduce these rules on your own.</p>
<p>Ready?</p>
<ol class="simple">
<li><p>If the right operand is an array that specifies indices and the left operand is an array of replacement values, then the shape of the left operand must conform to the shape induced by the right operand.</p></li>
</ol>
<p>If the right operand is an integer vector specifying major cells, the left operand must be of the same rank as the right argument, and it must have as many major cells as the length of the right operand:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">100</span><span class="o">+</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="na">@</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⊢</span><span class="nv">mat</span><span class="w">  </span><span class="c1">⍝ 3 indices, left operand has 3 rows.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  1   2   3   4
101 102 103 104
101 102 103 104
101 102 103 104
</span></div></div>
</div>
<p>If the right operand is a nested array that uses <em>reach</em> or <em>choose indexing</em> to select which values will be replaced, then the left operand must have the same shape as the array of indices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">corners</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="p">)(</span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳</span><span class="m">4</span><span class="p">)</span><span class="na">@</span><span class="nv">corners</span><span class="o">⊢</span><span class="nv">mat</span><span class="w">  </span><span class="c1">⍝ vector ←→ vector</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1  2  3  2
5  6  7  8
9 10 11 12
3 14 15  4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nv">corners</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span><span class="w">  </span><span class="c1">⍝ 2 1 2 cuboid ←→ 2 1 2 cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1  2  3  2
5  6  7  8
9 10 11 12
3 14 15  4
</span></div></div>
</div>
<ol class="simple">
<li><p>If the right operand is an array that specifies indices and the left operand is a function, then the right argument of the function will have the shape induced by the right operand (as seen in the previous case) and it must return an array of the same shape.</p></li>
</ol>
<p>If we use <em>choose indexing</em> with a two by two matrix to select the corners of our matrix <code class="docutils literal notranslate"><span class="pre">mat</span></code>, then the right argument of the left operand will be a two by two matrix and so must be the return value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="vg">⎕</span><span class="kd">←</span><span class="s1">&#39;right arg:&#39;</span><span class="bp">⍵</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">4</span><span class="kt">}</span><span class="na">@</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nv">corners</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┬─────┐
│right arg:│ 1  4│
│          │13 16│
└──────────┴─────┘
1  2  3  2
5  6  7  8
9 10 11 12
3 14 15  4
</span></div></div>
</div>
<p>Similarly, if we use a simple integer vector <code class="docutils literal notranslate"><span class="pre">vec</span></code> to select major cells of <code class="docutils literal notranslate"><span class="pre">array</span></code>, the right argument of the left operand will have shape equal to <code class="docutils literal notranslate"><span class="pre">(⍴vec),1↓⍴array</span></code> and the return value should have the same shape:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="vg">⎕</span><span class="kd">←</span><span class="s1">&#39;shape:&#39;</span><span class="p">(</span><span class="o">⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">4</span><span class="kt">}</span><span class="na">@</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬───┐
│shape:│2 4│
└──────┴───┘
 1  2  3  4
 1  2  3  4
 1  2  3  4
13 14 15 16
</span></div></div>
</div>
<ol class="simple">
<li><p>If the right operand is a function that computes a Boolean mask, the values that are selected will be ravelled into a vector.</p>
<ol class="simple">
<li><p>If the left operand is a replacement array, such an array must be a vector with the same length as the ravel of the selected values.</p></li>
<li><p>If the left operand is a function, its right argument will be the ravel of the values selected and it must return a vector with the same length.</p></li>
</ol>
</li>
</ol>
<p>The only exception to these two bullet points is if the left operand array is a scalar or if the left operand function returns a scalar.
In that case, all the values selected will be replaced by that scalar.</p>
<p>Let us demonstrate these rules by using the operator <em>at</em> on the matrix <code class="docutils literal notranslate"><span class="pre">mat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  6  7  8
 9 10 11 12
13 14 15 16
</span></div></div>
</div>
<p>We will be working on the central two by two region of the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"> </span><span class="o">∊</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0
0 1 1 0
0 1 1 0
0 0 0 0
</span></div></div>
</div>
<p>We can replace those four values with four other values, if those are in a vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">100</span><span class="o">×⍳</span><span class="m">4</span><span class="p">)</span><span class="na">@</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">∊</span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">11</span><span class="kt">}</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1   2   3  4
 5 100 200  8
 9 300 400 12
13  14  15 16
</span></div></div>
</div>
<p>We can transform those four values, as long as the left operand returns a vector of length four:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="m">1</span><span class="o">⌽</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">@</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">∊</span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">11</span><span class="kt">}</span><span class="nv">mat</span><span class="w">  </span><span class="c1">⍝ transform those 4 values</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  7 10  8
 9 11  6 12
13 14 15 16
</span></div></div>
</div>
<p>The left operand can also be, or return, a scalar.
In that case, the scalar will replace all the selected values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="na">@</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">∊</span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">11</span><span class="kt">}</span><span class="nv">mat</span><span class="w">  </span><span class="c1">⍝ replace all with 0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  0  0  8
 9  0  0 12
13 14 15 16
</span></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="rank-operator">
<span id="operators-rank-operator"></span><h2><span class="section-number">11.8. </span>Rank Operator<a class="headerlink" href="#rank-operator" title="Permalink to this headline">#</a></h2>
<p>The operator <em>rank</em> is represented by the character jot diaeresis <code class="docutils literal notranslate"><span class="pre">⍤</span></code>, and you can type it with the keys <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>J</kbd>.
A good mnemonic is that it is the jot (<kbd>APL</kbd>+<kbd>j</kbd>) with something on top (<kbd>Shift</kbd>).</p>
<p>The operator <em>rank</em> is a powerful operator that allows you to apply functions to sub-arrays of your argument arrays.
The function to be applied is the left operand <code class="docutils literal notranslate"><span class="pre">F</span></code> and the sub-arrays to which <code class="docutils literal notranslate"><span class="pre">F</span></code> is applied are defined by the right operand <code class="docutils literal notranslate"><span class="pre">spec</span></code>.</p>
<div class="section" id="sub-arrays-in-the-monadic-case">
<span id="operators-sub-arrays-in-the-monadic-case"></span><h3><span class="section-number">11.8.1. </span>Sub-Arrays in the Monadic Case<a class="headerlink" href="#sub-arrays-in-the-monadic-case" title="Permalink to this headline">#</a></h3>
<p>Typically, the best way of helping new learners grasp how the operator <em>rank</em> works is by exploring the result of <code class="docutils literal notranslate"><span class="pre">⊂⍤spec</span></code> for various integer scalars <code class="docutils literal notranslate"><span class="pre">spec</span></code> and for the case where <code class="docutils literal notranslate"><span class="pre">⊂⍤spec</span></code> is used monadically.</p>
<p>With that in mind, we define a cuboid below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">24</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  6  7  8
 9 10 11 12

13 14 15 16
17 18 19 20
21 22 23 24
</span></div></div>
</div>
<p>The operator <em>rank</em> in <code class="docutils literal notranslate"><span class="pre">⊂⍤spec</span> <span class="pre">⊢</span> <span class="pre">cuboid</span></code> will apply the function <em>enclose</em> to the cells of <code class="docutils literal notranslate"><span class="pre">cuboid</span></code> that have rank specified by <code class="docutils literal notranslate"><span class="pre">spec</span></code>:</p>
<ul class="simple">
<li><p>if <code class="docutils literal notranslate"><span class="pre">spec</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code>, the operator <em>rank</em> will enclose all the scalars in the cuboid because scalars have rank <code class="docutils literal notranslate"><span class="pre">0</span></code>;</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">spec</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code>, the operator <em>rank</em> will enclose all the rows of the cuboid because rows have rank <code class="docutils literal notranslate"><span class="pre">1</span></code>;</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">spec</span></code> is <code class="docutils literal notranslate"><span class="pre">2</span></code>, the operator <em>rank</em> will enclose all the planes / sub-matrices in the cuboid because planes have rank <code class="docutils literal notranslate"><span class="pre">2</span></code>; and</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">spec</span></code> is <code class="docutils literal notranslate"><span class="pre">3</span></code> or more, the operator <em>rank</em> will enclose the whole cuboid because the cuboid has rank <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">3</span><span class="o">⊢</span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────┐
│ 1  2  3  4│
│ 5  6  7  8│
│ 9 10 11 12│
│           │
│13 14 15 16│
│17 18 19 20│
│21 22 23 24│
└───────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">2</span><span class="o">⊢</span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┬───────────┐
│1  2  3  4│13 14 15 16│
│5  6  7  8│17 18 19 20│
│9 10 11 12│21 22 23 24│
└──────────┴───────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">1</span><span class="o">⊢</span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────┬───────────┬───────────┐
│1 2 3 4    │5 6 7 8    │9 10 11 12 │
├───────────┼───────────┼───────────┤
│13 14 15 16│17 18 19 20│21 22 23 24│
└───────────┴───────────┴───────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">0</span><span class="o">⊢</span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  6  7  8
 9 10 11 12

13 14 15 16
17 18 19 20
21 22 23 24
</span></div></div>
</div>
<p>As these examples show, the operator <em>rank</em> led the function <em>enclose</em> (its left operand) to the sub-arrays that had the rank that was chosen by the right operand.</p>
<p>Suppose that we wanted to transpose each of the two sub-matrices of the cuboid.
One can achieve that effect with dyadic transpose, but we can also look at that as <em>transpose rank 2</em>, which means we transpose the cells that have rank 2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍉</span><span class="na">⍤</span><span class="m">2</span><span class="o">⊢</span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  5  9
 2  6 10
 3  7 11
 4  8 12

13 17 21
14 18 22
15 19 23
16 20 24
</span></div></div>
</div>
</div>
<div class="section" id="sub-arrays-in-the-dyadic-case">
<span id="operators-sub-arrays-in-the-dyadic-case"></span><h3><span class="section-number">11.8.2. </span>Sub-Arrays in the Dyadic Case<a class="headerlink" href="#sub-arrays-in-the-dyadic-case" title="Permalink to this headline">#</a></h3>
<p>The derived function of the operator <em>rank</em> can also be used dyadically.
In that case, the operator <em>rank</em> will pair up sub-arrays of the left argument with sub-arrays of the right argument.
The sub-arrays of both sides do <strong>not</strong> have to be of the same rank.</p>
<p>In general, the dyadic case looks like <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">(F⍤i</span> <span class="pre">j)</span> <span class="pre">right</span></code>.
The integer scalar <code class="docutils literal notranslate"><span class="pre">i</span></code> determines the rank of the sub-arrays of the left argument <code class="docutils literal notranslate"><span class="pre">left</span></code> and the integer scalar <code class="docutils literal notranslate"><span class="pre">j</span></code> determines the rank of the sub-arrays of the right argument <code class="docutils literal notranslate"><span class="pre">right</span></code>.</p>
<p>In order for the operator <em>rank</em> to be able to pair up sub-arrays of the left argument with sub-arrays of the right argument, there has to be some shape compatibility:
the <em>frames</em> of the left and right argument must be the same.
The <em>frames</em> are composed of the leading axes of the arguments that are not included in the sub-arrays:</p>
<ul class="simple">
<li><p>the <em>frame</em> of the left argument is <code class="docutils literal notranslate"><span class="pre">fl</span> <span class="pre">←</span> <span class="pre">(-i)↓⍴left</span></code>; and</p></li>
<li><p>the <em>frame</em> of the right argument is <code class="docutils literal notranslate"><span class="pre">fr</span> <span class="pre">←</span> <span class="pre">(-j)↓⍴right</span></code>.</p></li>
</ul>
<p>So, <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍤i</span> <span class="pre">j</span> <span class="pre">⊢</span> <span class="pre">right</span></code> only works if <code class="docutils literal notranslate"><span class="pre">fl</span> <span class="pre">≡ fr</span></code>, that is, if <code class="docutils literal notranslate"><span class="pre">((-i)↓⍴left)≡((-j)↓⍴right)</span></code>.</p>
<p>For example, suppose <code class="docutils literal notranslate"><span class="pre">left</span></code> has rank <code class="docutils literal notranslate"><span class="pre">5</span></code> and shape <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span> <span class="pre">5</span> <span class="pre">6</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> has rank <code class="docutils literal notranslate"><span class="pre">4</span></code> and shape <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">4</span> <span class="pre">3</span> <span class="pre">8</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">left</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="nv">right</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">8</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>the expression <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍤4</span> <span class="pre">3</span> <span class="pre">⊢</span> <span class="pre">right</span></code> is a valid usage of the operator <em>rank</em> because:</p>
<ul>
<li><p>the <em>frame</em> of <code class="docutils literal notranslate"><span class="pre">left</span></code> is <code class="docutils literal notranslate"><span class="pre">2</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯4↓⍴left</span></code>; and</p></li>
<li><p>the <em>frame</em> of <code class="docutils literal notranslate"><span class="pre">right</span></code> is also <code class="docutils literal notranslate"><span class="pre">2</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯3↓⍴right</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works without error</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>the expression <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍤4</span> <span class="pre">2</span> <span class="pre">⊢</span> <span class="pre">right</span></code> does not work and gives a <code class="docutils literal notranslate"><span class="pre">RANK</span> <span class="pre">ERROR</span></code> because the <em>frames</em> of the left and right arguments do not have the same rank:</p>
<ul>
<li><p>the <em>frame</em> of <code class="docutils literal notranslate"><span class="pre">left</span></code> is <code class="docutils literal notranslate"><span class="pre">2</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯4↓⍴left</span></code>; and</p></li>
<li><p>the <em>frame</em> of <code class="docutils literal notranslate"><span class="pre">right</span></code> is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">4</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯3↓⍴right</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ RANK ERROR</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR
      _←left{⍺ ⍵}⍤4 2⊢right  ⍝ RANK ERROR
                 ∧
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>the expression <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍤3</span> <span class="pre">2</span> <span class="pre">⊢</span> <span class="pre">right</span></code> does not work and gives a <code class="docutils literal notranslate"><span class="pre">LENGTH</span> <span class="pre">ERROR</span></code> because the <em>frames</em> of the left and right arguments do not have the same axes lengths:</p>
<ul>
<li><p>the <em>frame</em> of <code class="docutils literal notranslate"><span class="pre">left</span></code> is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯3↓⍴left</span></code>; and</p></li>
<li><p>the <em>frame</em> of <code class="docutils literal notranslate"><span class="pre">right</span></code> is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">4</span></code>, which is <code class="docutils literal notranslate"><span class="pre">¯2↓⍴right</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ LENGTH ERROR</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR: It must be that either the left and right frames match or one of them has length 0
      _←left{⍺ ⍵}⍤3 2⊢right  ⍝ LENGTH ERROR
                 ∧
</pre></div>
</div>
</div>
</div>
<p>The error message above shows one more situation in which the operator <em>rank</em> works.
If the sub-arrays of the left argument match the whole left argument or if the sub-arrays of the right argument match the whole right argument, then the operator <em>rank</em> will pair that argument with all the sub-arrays of the other argument.</p>
<ul class="simple">
<li><p>the expression <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍤5</span> <span class="pre">j</span> <span class="pre">⊢</span> <span class="pre">right</span></code> works for any value of <code class="docutils literal notranslate"><span class="pre">j</span></code> because the frame of <code class="docutils literal notranslate"><span class="pre">left</span></code> is <code class="docutils literal notranslate"><span class="pre">⍬</span></code> and therefore has length zero.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!</span><span class="w"></span>
<span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!!</span><span class="w"></span>
<span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!!!</span><span class="w"></span>
<span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!!!!</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Similarly,</p>
<ul class="simple">
<li><p>the expression <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍤i</span> <span class="pre">4</span> <span class="pre">⊢</span> <span class="pre">right</span></code> works for any value of <code class="docutils literal notranslate"><span class="pre">i</span></code> because the frame of <code class="docutils literal notranslate"><span class="pre">right</span></code> is <code class="docutils literal notranslate"><span class="pre">⍬</span></code> and therefore has length zero.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">0</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!</span><span class="w"></span>
<span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!!</span><span class="w"></span>
<span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!!!</span><span class="w"></span>
<span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!!!!</span><span class="w"></span>
<span class="nv">_</span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">right</span><span class="w">  </span><span class="c1">⍝ works!!!!!</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>To illustrate better how the pairing of the operator <em>rank</em> works, we can consider the dfn <code class="docutils literal notranslate"><span class="pre">{⍺</span> <span class="pre">⍵}</span></code> that will strand the left and right sub-arrays.</p>
<p>First, we will pair all sub-matrices on the left with all scalars on the right.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="p">)</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="o">⍳</span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─┐
│ABCDE│1│
│FGHIJ│ │
│KLMNO│ │
│PQRST│ │
├─────┼─┤
│UVWXY│2│
│ZABCD│ │
│EFGHI│ │
│JKLMN│ │
├─────┼─┤
│OPQRS│3│
│TUVWX│ │
│YZABC│ │
│DEFGH│ │
└─────┴─┘
</span></div></div>
</div>
<p>Now, we will pair all rows on the left with the right argument vector.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="p">)</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="o">⍳</span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┐
│ABCDE│1 2 3│
├─────┼─────┤
│FGHIJ│1 2 3│
├─────┼─────┤
│KLMNO│1 2 3│
├─────┼─────┤
│PQRST│1 2 3│
└─────┴─────┘
┌─────┬─────┐
│UVWXY│1 2 3│
├─────┼─────┤
│ZABCD│1 2 3│
├─────┼─────┤
│EFGHI│1 2 3│
├─────┼─────┤
│JKLMN│1 2 3│
└─────┴─────┘
┌─────┬─────┐
│OPQRS│1 2 3│
├─────┼─────┤
│TUVWX│1 2 3│
├─────┼─────┤
│YZABC│1 2 3│
├─────┼─────┤
│DEFGH│1 2 3│
└─────┴─────┘
</span></div></div>
</div>
<p>Notice how, in the example above, the right argument vector was repeated 12 times, one for each of the sub-arrays of the left argument.</p>
</div>
<div class="section" id="cells">
<span id="operators-cells"></span><h3><span class="section-number">11.8.3. </span>Cells<a class="headerlink" href="#cells" title="Permalink to this headline">#</a></h3>
<p>The sub-arrays of rank <code class="docutils literal notranslate"><span class="pre">r</span></code> of an array are typically referred to as <code class="docutils literal notranslate"><span class="pre">r</span></code>-cells of that array.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code>-cells are scalars;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code>-cells are vectors and sometimes referred to as rows;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code>-cells are matrices and sometimes referred to as planes or tables;</p></li>
<li><p>…</p></li>
</ul>
<p>So, the expression <code class="docutils literal notranslate"><span class="pre">F⍤k</span> <span class="pre">⊢</span> <span class="pre">array</span></code> can be said to apply <code class="docutils literal notranslate"><span class="pre">F</span></code> to the <code class="docutils literal notranslate"><span class="pre">k</span></code>-cells of <code class="docutils literal notranslate"><span class="pre">array</span></code>.
We can say the same thing the other way around: the <code class="docutils literal notranslate"><span class="pre">k</span></code>-cells of <code class="docutils literal notranslate"><span class="pre">array</span></code> are its sub-arrays on the last <code class="docutils literal notranslate"><span class="pre">k</span></code> axes.</p>
<div class="section" id="negative-k">
<span id="operators-negative-k"></span><h4><span class="section-number">11.8.3.1. </span>Negative <code class="docutils literal notranslate"><span class="pre">k</span></code><a class="headerlink" href="#negative-k" title="Permalink to this headline">#</a></h4>
<p>If <code class="docutils literal notranslate"><span class="pre">k</span></code> is negative, a <code class="docutils literal notranslate"><span class="pre">k</span></code>-cell of an array of rank <code class="docutils literal notranslate"><span class="pre">r</span></code> is the same as a <code class="docutils literal notranslate"><span class="pre">r+k</span></code>-cell.
Using negative values of <code class="docutils literal notranslate"><span class="pre">k</span></code> can be advantageous because this makes it so that the actual rank of the cell depends on the rank of the original array.
For example, a <code class="docutils literal notranslate"><span class="pre">¯2</span></code>-cell on a matrix is actually a <code class="docutils literal notranslate"><span class="pre">(2+¯2)</span></code>-cell (a scalar), and a <code class="docutils literal notranslate"><span class="pre">¯2</span></code>-cell on a cuboid is actually a <code class="docutils literal notranslate"><span class="pre">(3+¯1)</span></code>-cell (a vector).</p>
</div>
<div class="section" id="major-cells">
<span id="operators-major-cells"></span><h4><span class="section-number">11.8.3.2. </span>Major Cells<a class="headerlink" href="#major-cells" title="Permalink to this headline">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">¯1</span></code>-cells are commonly referred to as <em>major cells</em> because they are the largest cells of an array, as far as rank is considered.
Below, you can find a table with common arrays and the corresponding major cells.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Array</p></th>
<th class="text-align:left head"><p>Major cells are…</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>vector</p></td>
<td class="text-align:left"><p>scalars</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>matrix</p></td>
<td class="text-align:left"><p>vectors</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>cuboid</p></td>
<td class="text-align:left"><p>matrices</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>4D array</p></td>
<td class="text-align:left"><p>cuboids</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="specifying-cells">
<span id="operators-specifying-cells"></span><h3><span class="section-number">11.8.4. </span>Specifying Cells<a class="headerlink" href="#specifying-cells" title="Permalink to this headline">#</a></h3>
<p>Now that we are aware of what <em>cells</em> are, the operator <em>rank</em> can actually be defined in terms of <em>cells</em> of the left and right arguments.</p>
<p>The expression <code class="docutils literal notranslate"><span class="pre">F⍤k</span> <span class="pre">⊢</span> <span class="pre">right</span></code> will apply the function <code class="docutils literal notranslate"><span class="pre">F</span></code> monadically to the <code class="docutils literal notranslate"><span class="pre">k</span></code>-cells of <code class="docutils literal notranslate"><span class="pre">right</span></code> and the expression <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍤i</span> <span class="pre">j</span> <span class="pre">⊢</span> <span class="pre">right</span></code> will apply the function <code class="docutils literal notranslate"><span class="pre">F</span></code> dyadically between the <code class="docutils literal notranslate"><span class="pre">i</span></code>-cells of <code class="docutils literal notranslate"><span class="pre">left</span></code> and the <code class="docutils literal notranslate"><span class="pre">j</span></code>-cells of <code class="docutils literal notranslate"><span class="pre">right</span></code>.
In particular, the operator <em>rank</em> can deal with <em>cell</em> specifications that have negative numbers.</p>
<p>For example, the expression <code class="docutils literal notranslate"><span class="pre">⊂⍤¯1</span></code> turns any array into a vector of its <em>major cells</em>.</p>
<p>If we have a matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
4 5 6
7 8 9
</span></div></div>
</div>
<p>we get a vector of its rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">¯1</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│1 2 3│4 5 6│7 8 9│
└─────┴─────┴─────┘
</span></div></div>
</div>
<p>And if we have a cuboid:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">24</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  6  7  8
 9 10 11 12

13 14 15 16
17 18 19 20
21 22 23 24
</span></div></div>
</div>
<p>we get a vector of its sub-matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">¯1</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">24</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┬───────────┐
│1  2  3  4│13 14 15 16│
│5  6  7  8│17 18 19 20│
│9 10 11 12│21 22 23 24│
└──────────┴───────────┘
</span></div></div>
</div>
<p>The operator <em>rank</em> has another form that contemplates the monadic and dyadic uses of the derived function in one single <em>cell</em> specification, but we will only cover it in <a class="reference internal" href="#operators-the-full-rank-specification"><span class="std std-numref">Section 11.15.4</span></a>.</p>
</div>
</div>
<div class="section" id="key">
<span id="operators-key"></span><h2><span class="section-number">11.9. </span>Key<a class="headerlink" href="#key" title="Permalink to this headline">#</a></h2>
<p>The operator <em>key</em> is represented by the glyph <code class="docutils literal notranslate"><span class="pre">⌸</span></code> and you can type it with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>K</kbd>.
It is easy to remember the keyboard shortcut for <em>key</em> because <em>key</em> is in the letter K.</p>
<p>The operator <em>key</em> is monadic and its left operand must always be a dyadic function that returns a result.
The derived function can be used monadically or dyadically.
In both cases, the idea is that the operator <em>key</em> provides a way to group your values before applying <code class="docutils literal notranslate"><span class="pre">F</span></code> to each of those groups.</p>
<p>The expression <code class="docutils literal notranslate"><span class="pre">groups</span> <span class="pre">F⌸</span> <span class="pre">values</span></code> will apply <code class="docutils literal notranslate"><span class="pre">F</span></code> to subsets of the <em>major cells</em> of <code class="docutils literal notranslate"><span class="pre">values</span></code> as defined by the <em>major cells</em> of <code class="docutils literal notranslate"><span class="pre">groups</span></code>.</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">←</span> <span class="pre">{⍺</span> <span class="pre">⍵}</span></code> and defining simple vectors for <code class="docutils literal notranslate"><span class="pre">groups</span></code> and <code class="docutils literal notranslate"><span class="pre">values</span></code> should bring some clarity to the way <em>key</em> works.</p>
<p>Let us define two vectors that contain the suits and values of some playing cards:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">values</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;4&#39;</span><span class="w"> </span><span class="s1">&#39;Jack&#39;</span><span class="w"> </span><span class="s1">&#39;6&#39;</span><span class="w"> </span><span class="s1">&#39;Ace&#39;</span><span class="w"> </span><span class="s1">&#39;10&#39;</span><span class="w"></span>
<span class="nv">suits</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Spades&#39;</span><span class="w"> </span><span class="s1">&#39;Hearts&#39;</span><span class="w"> </span><span class="s1">&#39;Spades&#39;</span><span class="w"> </span><span class="s1">&#39;Clubs&#39;</span><span class="w"> </span><span class="s1">&#39;Spades&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can group the cards by their suits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">suits</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">values</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬────────┐
│┌──────┐│┌─┬─┬──┐│
││Spades│││4│6│10││
│└──────┘│└─┴─┴──┘│
├────────┼────────┤
│┌──────┐│┌────┐  │
││Hearts│││Jack│  │
│└──────┘│└────┘  │
├────────┼────────┤
│┌─────┐ │┌───┐   │
││Clubs│ ││Ace│   │
│└─────┘ │└───┘   │
└────────┴────────┘
</span></div></div>
</div>
<p>As we can see, the function <code class="docutils literal notranslate"><span class="pre">{⍺</span> <span class="pre">⍵}</span></code> received, as left argument, each of the unique groups, also referred to as keys.
Its right argument was a vector with all the values that were associated with each key.</p>
<p>The monadic case <code class="docutils literal notranslate"><span class="pre">F⌸</span> <span class="pre">array</span></code> is equivalent to the dyadic case <code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">F⌸</span> <span class="pre">⍳≢array</span></code>.
In other words, in the monadic case, the operator <em>key</em> uses the <em>major cells</em> of the argument as keys and then groups together the indices where each key appears:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="s1">&#39;MISSISSIPPI&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬────────┐
│M│1       │
├─┼────────┤
│I│2 5 8 11│
├─┼────────┤
│S│3 4 6 7 │
├─┼────────┤
│P│9 10    │
└─┴────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;MISSISSIPPI&#39;</span><span class="o">,</span><span class="sr">[</span><span class="m">0.5</span><span class="sr">]</span><span class="o">⍳</span><span class="m">11</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">M I S S I S S I P  P  I
1 2 3 4 5 6 7 8 9 10 11
</span></div></div>
</div>
<div class="section" id="key-with-high-rank-arguments">
<span id="operators-key-with-high-rank-arguments"></span><h3><span class="section-number">11.9.1. </span>Key with High-Rank Arguments<a class="headerlink" href="#key-with-high-rank-arguments" title="Permalink to this headline">#</a></h3>
<p>The explanation above mentioned <em>major cells</em> and <em>arrays</em> in general because the operator <em>key</em> <strong>can</strong> be used with arrays of arbitrary rank as both arguments.</p>
<p>To showcase this ability, consider a matrix with names of some employees and the respective days they showed up for work:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">employees</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↑</span><span class="s1">&#39;ALICE&#39;</span><span class="w"> </span><span class="s1">&#39;BOB&#39;</span><span class="w"> </span><span class="s1">&#39;ALICE&#39;</span><span class="w"> </span><span class="s1">&#39;BOB&#39;</span><span class="w"> </span><span class="s1">&#39;CHARLES&#39;</span><span class="w"> </span><span class="s1">&#39;ALICE&#39;</span><span class="w"> </span><span class="s1">&#39;CHARLES&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ALICE  
BOB    
ALICE  
BOB    
CHARLES
ALICE  
CHARLES
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">dates</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;27/6&#39;</span><span class="w"> </span><span class="s1">&#39;27/6&#39;</span><span class="w"> </span><span class="s1">&#39;28/6&#39;</span><span class="w"> </span><span class="s1">&#39;29/6&#39;</span><span class="w"> </span><span class="s1">&#39;29/6&#39;</span><span class="w"> </span><span class="s1">&#39;30/6&#39;</span><span class="w"> </span><span class="s1">&#39;30/6&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We can group the employees by workday with the operator <em>key</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">dates</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">employees</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬───────┐
│┌────┐│ALICE  │
││27/6││BOB    │
│└────┘│       │
├──────┼───────┤
│┌────┐│ALICE  │
││28/6││       │
│└────┘│       │
├──────┼───────┤
│┌────┐│BOB    │
││29/6││CHARLES│
│└────┘│       │
├──────┼───────┤
│┌────┐│ALICE  │
││30/6││CHARLES│
│└────┘│       │
└──────┴───────┘
</span></div></div>
</div>
<p>We can see that using a matrix as the right argument was not a problem.
What is more, we can see that because the right argument of <code class="docutils literal notranslate"><span class="pre">{⍺</span> <span class="pre">⍵}⌸</span></code> had rank two, the right argument of the operand of <em>key</em> also receives arguments of rank two.</p>
<p>If the dates had been a 2-column matrix with day and month, <em>key</em> would still know how to group the employees:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">datesMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="m">27</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">27 6
27 6
28 6
29 6
29 6
30 6
30 6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">datesMat</span><span class="o">,</span><span class="nv">employees</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">27 6 ALICE  
27 6 BOB    
28 6 ALICE  
29 6 BOB    
29 6 CHARLES
30 6 ALICE  
30 6 CHARLES
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">datesMat</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">employees</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───────┐
│27 6│ALICE  │
│    │BOB    │
├────┼───────┤
│28 6│ALICE  │
├────┼───────┤
│29 6│BOB    │
│    │CHARLES│
├────┼───────┤
│30 6│ALICE  │
│    │CHARLES│
└────┴───────┘
</span></div></div>
</div>
<p>In the example above, the operator <em>key</em> used the <em>major cells</em> of the left argument (its rows) to determine which keys to use.
The left argument of the operand is always the key itself, so the left argument of the operand in the example above was the 2-element vector with the day and the month.</p>
<p>If we want to keep only the day of employment, since all records are relative to the month of June, we can extract it with <code class="docutils literal notranslate"><span class="pre">⊃⍺</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">datesMat</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍺</span><span class="p">)</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">employees</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬───────┐
│27│ALICE  │
│  │BOB    │
├──┼───────┤
│28│ALICE  │
├──┼───────┤
│29│BOB    │
│  │CHARLES│
├──┼───────┤
│30│ALICE  │
│  │CHARLES│
└──┴───────┘
</span></div></div>
</div>
</div>
<div class="section" id="order-of-the-result">
<span id="operators-order-of-the-result"></span><h3><span class="section-number">11.9.2. </span>Order of the Result<a class="headerlink" href="#order-of-the-result" title="Permalink to this headline">#</a></h3>
<p>The elements of the result of <em>key</em> appear in the same order as they appear in the argument vectors.
This means that if the arguments are reordered, the result of applying <em>key</em> might also come in a different order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="s1">&#39;MISSISSIPPI&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬────────┐
│M│1       │
├─┼────────┤
│I│2 5 8 11│
├─┼────────┤
│S│3 4 6 7 │
├─┼────────┤
│P│9 10    │
└─┴────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="m">2</span><span class="o">⌽</span><span class="s1">&#39;MISSISSIPPI&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬────────┐
│S│1 2 4 5 │
├─┼────────┤
│I│3 6 9 11│
├─┼────────┤
│P│7 8     │
├─┼────────┤
│M│10      │
└─┴────────┘
</span></div></div>
</div>
<p>The sub-sections that follow will cover a couple of common use-cases for the operator <em>key</em>.</p>
</div>
<div class="section" id="applications-of-key">
<span id="operators-applications-of-key"></span><h3><span class="section-number">11.9.3. </span>Applications of Key<a class="headerlink" href="#applications-of-key" title="Permalink to this headline">#</a></h3>
<div class="section" id="counting-unique-values">
<span id="operators-counting-unique-values"></span><h4><span class="section-number">11.9.3.1. </span>Counting Unique Values<a class="headerlink" href="#counting-unique-values" title="Permalink to this headline">#</a></h4>
<p>One of the simplest and most common use cases for <em>key</em> is to count unique values in a vector, or unique <em>major cells</em> in any arbitrary array.</p>
<p>For example, we can quickly compute how many of each letter a word or sentence has:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="s1">&#39;MISSISSIPPI&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">M 1
I 4
S 4
P 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="s1">&#39;HOW ARE YOU DOING TODAY&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">H 1
O 4
W 1
  4
A 2
R 1
E 1
Y 2
U 1
D 2
I 1
N 1
G 1
T 1
</span></div></div>
</div>
<p>If you are counting occurrences of values of a predetermined number of categories, bear in mind that categories that are not represented will not show up with a zero in its count.</p>
<p>For example, we had some playing cards before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">values</span><span class="o">,⍪</span><span class="nv">suits</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──────┐
│4   │Spades│
├────┼──────┤
│Jack│Hearts│
├────┼──────┤
│6   │Spades│
├────┼──────┤
│Ace │Clubs │
├────┼──────┤
│10  │Spades│
└────┴──────┘
</span></div></div>
</div>
<p>None of the cards is of the suit diamonds, so when we count how many cards of each suit, we will not have a <code class="docutils literal notranslate"><span class="pre">'Diamonds'</span> <span class="pre">0</span></code> in the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍺</span><span class="p">)(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">suits</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬─┐
│Spades│3│
├──────┼─┤
│Hearts│1│
├──────┼─┤
│Clubs │1│
└──────┴─┘
</span></div></div>
</div>
<p>After all, the operator <em>key</em> cannot guess that the key <code class="docutils literal notranslate"><span class="pre">'Diamonds'</span></code> was missing.
If you want all possible keys to show up, catenate them once to the argument array and then subtract one from the count.
If you catenate all the possible keys in the beginning, you can even force the order of the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">allSuits</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Clubs&#39;</span><span class="w"> </span><span class="s1">&#39;Diamonds&#39;</span><span class="w"> </span><span class="s1">&#39;Hearts&#39;</span><span class="w"> </span><span class="s1">&#39;Spades&#39;</span><span class="w"></span>
<span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍺</span><span class="p">)(</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">allSuits</span><span class="o">,</span><span class="nv">suits</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬─┐
│Clubs   │1│
├────────┼─┤
│Diamonds│0│
├────────┼─┤
│Hearts  │1│
├────────┼─┤
│Spades  │3│
└────────┴─┘
</span></div></div>
</div>
<p>Notice how the order of the vector <code class="docutils literal notranslate"><span class="pre">allSuits</span></code> was preserved in the rows of the result.</p>
</div>
<div class="section" id="summarising-data-by-category">
<span id="operators-summarising-data-by-category"></span><h4><span class="section-number">11.9.3.2. </span>Summarising Data by Category<a class="headerlink" href="#summarising-data-by-category" title="Permalink to this headline">#</a></h4>
<p>The operator <em>key</em> can also be used to aggregate and summarise data by one or more keys.
For example, suppose you have a log of purchases and sales of shares of different companies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">companies</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↑</span><span class="s1">&#39;GOOG&#39;</span><span class="w"> </span><span class="s1">&#39;MSFT&#39;</span><span class="w"> </span><span class="s1">&#39;TSLA&#39;</span><span class="w"> </span><span class="s1">&#39;MSFT&#39;</span><span class="w"> </span><span class="s1">&#39;GOOG&#39;</span><span class="w"> </span><span class="s1">&#39;GOOG&#39;</span><span class="w"> </span><span class="s1">&#39;TSLA&#39;</span><span class="w"> </span><span class="s1">&#39;GOOG&#39;</span><span class="w"> </span><span class="s1">&#39;TSLA&#39;</span><span class="w"></span>
<span class="nv">trades</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">¯30</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">¯100</span><span class="w"> </span><span class="m">¯80</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">100</span><span class="w"></span>
<span class="nv">companies</span><span class="o">,</span><span class="nv">trades</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">GOOG  100
MSFT  120
TSLA   80
MSFT  ¯30
GOOG   50
GOOG ¯100
TSLA  ¯80
GOOG   50
TSLA  100
</span></div></div>
</div>
<p>By using the operator <em>key</em>, we can easily aggregate the trades by company and then determine how many shares of each company we have:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">companies</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">trades</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───┐
│GOOG│100│
├────┼───┤
│MSFT│90 │
├────┼───┤
│TSLA│100│
└────┴───┘
</span></div></div>
</div>
<p>In this particular example, we used <code class="docutils literal notranslate"><span class="pre">+/</span></code> to sum all of the trades that pertained to a single company.
This pattern of aggregating data and then summarising it works with every other summarising function you can think of.</p>
<p>For instance, if instead of trades we had data about the prices of the stock, we could easily determine what was the highest price each company attained:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">companies</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">↑</span><span class="s1">&#39;TSLA&#39;</span><span class="w"> </span><span class="s1">&#39;MSFT&#39;</span><span class="w"> </span><span class="s1">&#39;GOOG&#39;</span><span class="w"> </span><span class="s1">&#39;GOOG&#39;</span><span class="w"> </span><span class="s1">&#39;GOOG&#39;</span><span class="w"> </span><span class="s1">&#39;MSFT&#39;</span><span class="w"> </span><span class="s1">&#39;TSLA&#39;</span><span class="w"> </span><span class="s1">&#39;MSFT&#39;</span><span class="w"> </span><span class="s1">&#39;TSLA&#39;</span><span class="w"></span>
<span class="nv">prices</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">209.39</span><span class="w"> </span><span class="m">329.37</span><span class="w"> </span><span class="m">143.77</span><span class="w"> </span><span class="m">137.88</span><span class="w"> </span><span class="m">134.17</span><span class="w"> </span><span class="m">294.95</span><span class="w"> </span><span class="m">288.12</span><span class="w"> </span><span class="m">259.58</span><span class="w"> </span><span class="m">271.71</span><span class="w"></span>
<span class="nv">companies</span><span class="o">,</span><span class="nv">prices</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">TSLA 209.39
MSFT 329.37
GOOG 143.77
GOOG 137.88
GOOG 134.17
MSFT 294.95
TSLA 288.12
MSFT 259.58
TSLA 271.71
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">companies</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="p">(</span><span class="o">⌈</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">prices</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──────┐
│TSLA│288.12│
├────┼──────┤
│MSFT│329.37│
├────┼──────┤
│GOOG│143.77│
└────┴──────┘
</span></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="stencil">
<span id="operators-stencil"></span><h2><span class="section-number">11.10. </span>Stencil<a class="headerlink" href="#stencil" title="Permalink to this headline">#</a></h2>
<div class="section" id="your-first-stencil">
<span id="operators-your-first-stencil"></span><h3><span class="section-number">11.10.1. </span>Your First Stencil<a class="headerlink" href="#your-first-stencil" title="Permalink to this headline">#</a></h3>
<p>The operator <em>stencil</em> is represented by the glyph <code class="docutils literal notranslate"><span class="pre">⌺</span></code> and it is typed with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>`</kbd>.
<em>Stencil</em> <code class="docutils literal notranslate"><span class="pre">⌺</span></code> and the <em>diamond</em> <code class="docutils literal notranslate"><span class="pre">⋄</span></code> are in the same key, so use the fact that the <em>stencil</em> looks like a <em>quad</em> <code class="docutils literal notranslate"><span class="pre">⎕</span></code> around the <em>diamond</em> <code class="docutils literal notranslate"><span class="pre">⋄</span></code> as a mnemonic to know where <em>stencil</em> is.</p>
<p>The operator <em>stencil</em> is used to apply a function operand to rectangular sections of the argument array.
The size and positioning of these rectangular sections is determined by the right operand of <em>stencil</em> and the left operand is the function that is applied to each section.</p>
<p>For example, we can have a 4 by 4 matrix and we can use the operator <em>stencil</em> to apply any given function to all its 3 by 3 sub-matrices.
Before doing any computations with the sub-matrices, we can study how the operator <em>stencil</em> works and visualise what sub-matrices are created.
To do that, we need to:</p>
<ul class="simple">
<li><p>use the dfn <code class="docutils literal notranslate"><span class="pre">{⊂⍵}</span></code> as the left operand, which will <em>enclose</em> each sub-matrix and allow us to visualise all of them;</p></li>
<li><p>use the vector <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">3</span></code> as the right operand, which will tell the operator <em>stencil</em> that we want sub-matrices that have shape <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">3</span></code>; and</p></li>
<li><p>use a matrix as the right argument to the derived function.</p></li>
</ul>
<p>Here is an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="o">⍴⍳</span><span class="m">16</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4
 5  6  7  8
 9 10 11 12
13 14 15 16
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬────────┬────────┬───────┐
│0 0 0  │0 0 0   │0 0 0   │0 0 0  │
│0 1 2  │1 2 3   │2 3 4   │3 4 0  │
│0 5 6  │5 6 7   │6 7 8   │7 8 0  │
├───────┼────────┼────────┼───────┤
│0 1  2 │1  2  3 │ 2  3  4│ 3  4 0│
│0 5  6 │5  6  7 │ 6  7  8│ 7  8 0│
│0 9 10 │9 10 11 │10 11 12│11 12 0│
├───────┼────────┼────────┼───────┤
│0  5  6│ 5  6  7│ 6  7  8│ 7  8 0│
│0  9 10│ 9 10 11│10 11 12│11 12 0│
│0 13 14│13 14 15│14 15 16│15 16 0│
├───────┼────────┼────────┼───────┤
│0  9 10│ 9 10 11│10 11 12│11 12 0│
│0 13 14│13 14 15│14 15 16│15 16 0│
│0  0  0│ 0  0  0│ 0  0  0│ 0  0 0│
└───────┴────────┴────────┴───────┘
</span></div></div>
</div>
<p>Notice that some sub-matrices in the result above contain zeroes that were not present in the original matrix.
These rows and columns of zeroes are padding.
Padding is needed because the operator <em>stencil</em> creates sub-matrices centred on successive elements of the matrix <code class="docutils literal notranslate"><span class="pre">mat</span></code>.
However, you can only create a 3 by 3 matrix centred around <code class="docutils literal notranslate"><span class="pre">1</span></code> (the top-left number in <code class="docutils literal notranslate"><span class="pre">mat</span></code>) if you add a column of zeroes on the left of <code class="docutils literal notranslate"><span class="pre">mat</span></code> and a row of zeroes on the top of <code class="docutils literal notranslate"><span class="pre">mat</span></code>.</p>
<p>The result of using the operator <em>stencil</em> with the left operand <code class="docutils literal notranslate"><span class="pre">{⊂⍵}</span></code> can be intuitively described as the effect you get by placing a window of size <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">3</span></code> over the matrix <code class="docutils literal notranslate"><span class="pre">mat</span></code>, and then sliding that window over the matrix.
The padding is what you “see” when the window is slightly off the matrix.</p>
</div>
<div class="section" id="padding-and-window-size">
<span id="operators-padding-and-window-size"></span><h3><span class="section-number">11.10.2. </span>Padding and Window Size<a class="headerlink" href="#padding-and-window-size" title="Permalink to this headline">#</a></h3>
<p>As we have seen, the operator <em>stencil</em> sometimes adds padding to allow for the creation of sub-arrays centred on the successive elements of the argument array.
However, the padding that is added depends on the size of the sub-arrays that are created, sometimes referred to as the size of the sliding window.
If the sliding window is very big, the padding increases.
If the sliding window is very small, the padding decreases.</p>
<p>The total padding added does not depend on the size of the argument array.
Below, we stick to the window size of <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">3</span></code> and use a larger matrix, and we see the padding remains the same:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="o">⍴⍳</span><span class="m">36</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬────────┬────────┬────────┬────────┬───────┐
│0 0 0  │0 0 0   │0 0  0  │0  0  0 │ 0  0  0│ 0  0 0│
│0 1 2  │1 2 3   │2 3  4  │3  4  5 │ 4  5  6│ 5  6 0│
│0 7 8  │7 8 9   │8 9 10  │9 10 11 │10 11 12│11 12 0│
├───────┼────────┼────────┼────────┼────────┼───────┤
│0  1  2│ 1  2  3│ 2  3  4│ 3  4  5│ 4  5  6│ 5  6 0│
│0  7  8│ 7  8  9│ 8  9 10│ 9 10 11│10 11 12│11 12 0│
│0 13 14│13 14 15│14 15 16│15 16 17│16 17 18│17 18 0│
├───────┼────────┼────────┼────────┼────────┼───────┤
│0  7  8│ 7  8  9│ 8  9 10│ 9 10 11│10 11 12│11 12 0│
│0 13 14│13 14 15│14 15 16│15 16 17│16 17 18│17 18 0│
│0 19 20│19 20 21│20 21 22│21 22 23│22 23 24│23 24 0│
├───────┼────────┼────────┼────────┼────────┼───────┤
│0 13 14│13 14 15│14 15 16│15 16 17│16 17 18│17 18 0│
│0 19 20│19 20 21│20 21 22│21 22 23│22 23 24│23 24 0│
│0 25 26│25 26 27│26 27 28│27 28 29│28 29 30│29 30 0│
├───────┼────────┼────────┼────────┼────────┼───────┤
│0 19 20│19 20 21│20 21 22│21 22 23│22 23 24│23 24 0│
│0 25 26│25 26 27│26 27 28│27 28 29│28 29 30│29 30 0│
│0 31 32│31 32 33│32 33 34│33 34 35│34 35 36│35 36 0│
├───────┼────────┼────────┼────────┼────────┼───────┤
│0 25 26│25 26 27│26 27 28│27 28 29│28 29 30│29 30 0│
│0 31 32│31 32 33│32 33 34│33 34 35│34 35 36│35 36 0│
│0  0  0│ 0  0  0│ 0  0  0│ 0  0  0│ 0  0  0│ 0  0 0│
└───────┴────────┴────────┴────────┴────────┴───────┘
</span></div></div>
</div>
<p>With a window size of <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">3</span></code>, the padding we get is still one row and one column around the matrix argument.</p>
<p>If we make the window size smaller, we get less padding.
With a unit length window (the smallest window possible), we actually get absolutely no padding:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="o">⊢</span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="o">⍴⍳</span><span class="m">36</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬──┬──┬──┬──┬──┐
│1 │2 │3 │4 │5 │6 │
├──┼──┼──┼──┼──┼──┤
│7 │8 │9 │10│11│12│
├──┼──┼──┼──┼──┼──┤
│13│14│15│16│17│18│
├──┼──┼──┼──┼──┼──┤
│19│20│21│22│23│24│
├──┼──┼──┼──┼──┼──┤
│25│26│27│28│29│30│
├──┼──┼──┼──┼──┼──┤
│31│32│33│34│35│36│
└──┴──┴──┴──┴──┴──┘
</span></div></div>
</div>
<p>If we make the window larger, we get more padding:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="o">⊢</span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="o">⍴⍳</span><span class="m">36</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────────┬─────────────┬──────────────┬──────────────┬─────────────┬────────────┐
│0 0  0  0  0│0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0 0│ 0  0  0 0 0│
│0 0  0  0  0│0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0 0│ 0  0  0 0 0│
│0 0  1  2  3│0  1  2  3  4│ 1  2  3  4  5│ 2  3  4  5  6│ 3  4  5  6 0│ 4  5  6 0 0│
│0 0  7  8  9│0  7  8  9 10│ 7  8  9 10 11│ 8  9 10 11 12│ 9 10 11 12 0│10 11 12 0 0│
│0 0 13 14 15│0 13 14 15 16│13 14 15 16 17│14 15 16 17 18│15 16 17 18 0│16 17 18 0 0│
├────────────┼─────────────┼──────────────┼──────────────┼─────────────┼────────────┤
│0 0  0  0  0│0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0 0│ 0  0  0 0 0│
│0 0  1  2  3│0  1  2  3  4│ 1  2  3  4  5│ 2  3  4  5  6│ 3  4  5  6 0│ 4  5  6 0 0│
│0 0  7  8  9│0  7  8  9 10│ 7  8  9 10 11│ 8  9 10 11 12│ 9 10 11 12 0│10 11 12 0 0│
│0 0 13 14 15│0 13 14 15 16│13 14 15 16 17│14 15 16 17 18│15 16 17 18 0│16 17 18 0 0│
│0 0 19 20 21│0 19 20 21 22│19 20 21 22 23│20 21 22 23 24│21 22 23 24 0│22 23 24 0 0│
├────────────┼─────────────┼──────────────┼──────────────┼─────────────┼────────────┤
│0 0  1  2  3│0  1  2  3  4│ 1  2  3  4  5│ 2  3  4  5  6│ 3  4  5  6 0│ 4  5  6 0 0│
│0 0  7  8  9│0  7  8  9 10│ 7  8  9 10 11│ 8  9 10 11 12│ 9 10 11 12 0│10 11 12 0 0│
│0 0 13 14 15│0 13 14 15 16│13 14 15 16 17│14 15 16 17 18│15 16 17 18 0│16 17 18 0 0│
│0 0 19 20 21│0 19 20 21 22│19 20 21 22 23│20 21 22 23 24│21 22 23 24 0│22 23 24 0 0│
│0 0 25 26 27│0 25 26 27 28│25 26 27 28 29│26 27 28 29 30│27 28 29 30 0│28 29 30 0 0│
├────────────┼─────────────┼──────────────┼──────────────┼─────────────┼────────────┤
│0 0  7  8  9│0  7  8  9 10│ 7  8  9 10 11│ 8  9 10 11 12│ 9 10 11 12 0│10 11 12 0 0│
│0 0 13 14 15│0 13 14 15 16│13 14 15 16 17│14 15 16 17 18│15 16 17 18 0│16 17 18 0 0│
│0 0 19 20 21│0 19 20 21 22│19 20 21 22 23│20 21 22 23 24│21 22 23 24 0│22 23 24 0 0│
│0 0 25 26 27│0 25 26 27 28│25 26 27 28 29│26 27 28 29 30│27 28 29 30 0│28 29 30 0 0│
│0 0 31 32 33│0 31 32 33 34│31 32 33 34 35│32 33 34 35 36│33 34 35 36 0│34 35 36 0 0│
├────────────┼─────────────┼──────────────┼──────────────┼─────────────┼────────────┤
│0 0 13 14 15│0 13 14 15 16│13 14 15 16 17│14 15 16 17 18│15 16 17 18 0│16 17 18 0 0│
│0 0 19 20 21│0 19 20 21 22│19 20 21 22 23│20 21 22 23 24│21 22 23 24 0│22 23 24 0 0│
│0 0 25 26 27│0 25 26 27 28│25 26 27 28 29│26 27 28 29 30│27 28 29 30 0│28 29 30 0 0│
│0 0 31 32 33│0 31 32 33 34│31 32 33 34 35│32 33 34 35 36│33 34 35 36 0│34 35 36 0 0│
│0 0  0  0  0│0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0 0│ 0  0  0 0 0│
├────────────┼─────────────┼──────────────┼──────────────┼─────────────┼────────────┤
│0 0 19 20 21│0 19 20 21 22│19 20 21 22 23│20 21 22 23 24│21 22 23 24 0│22 23 24 0 0│
│0 0 25 26 27│0 25 26 27 28│25 26 27 28 29│26 27 28 29 30│27 28 29 30 0│28 29 30 0 0│
│0 0 31 32 33│0 31 32 33 34│31 32 33 34 35│32 33 34 35 36│33 34 35 36 0│34 35 36 0 0│
│0 0  0  0  0│0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0 0│ 0  0  0 0 0│
│0 0  0  0  0│0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0  0│ 0  0  0  0 0│ 0  0  0 0 0│
└────────────┴─────────────┴──────────────┴──────────────┴─────────────┴────────────┘
</span></div></div>
</div>
<p>The examples before all had an odd window size, but window sizes can also be even.
When the window size is odd, it is easier to see which number a window is centred on.
If the window size <code class="docutils literal notranslate"><span class="pre">s</span></code> is even, the central element is at the index <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">÷</span> <span class="pre">2</span></code>.</p>
<p>Let us use a window size of 4 and look at the very first sub-matrix of <code class="docutils literal notranslate"><span class="pre">mat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0  0  0
0 1  2  3
0 5  6  7
0 9 10 11
</span></div></div>
</div>
<p>The window size is <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span></code> and the first window is centred around <code class="docutils literal notranslate"><span class="pre">1</span></code>, which is at index <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">2</span></code> of the sub-matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">⊃</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Let us look at all the sub-matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────┬───────────┬──────────┐
│0 0  0  0 │0  0  0  0 │ 0  0  0 0│
│0 1  2  3 │1  2  3  4 │ 2  3  4 0│
│0 5  6  7 │5  6  7  8 │ 6  7  8 0│
│0 9 10 11 │9 10 11 12 │10 11 12 0│
├──────────┼───────────┼──────────┤
│0  1  2  3│ 1  2  3  4│ 2  3  4 0│
│0  5  6  7│ 5  6  7  8│ 6  7  8 0│
│0  9 10 11│ 9 10 11 12│10 11 12 0│
│0 13 14 15│13 14 15 16│14 15 16 0│
├──────────┼───────────┼──────────┤
│0  5  6  7│ 5  6  7  8│ 6  7  8 0│
│0  9 10 11│ 9 10 11 12│10 11 12 0│
│0 13 14 15│13 14 15 16│14 15 16 0│
│0  0  0  0│ 0  0  0  0│ 0  0  0 0│
└──────────┴───────────┴──────────┘
</span></div></div>
</div>
<p>When the window size is even, the padding we get seems to be the same as if the window size had been odd, and one less.
In this particular example, a window size <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span></code> used the same padding as a window size <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">3</span></code>.</p>
<p>In general, when the window size is even, the maximum amount of padding we see is one row/column less than half of the window size.
In the example above, the window size is <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span></code>, so the maximum padding we get is one less than half of that: half of that is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">2</span></code> and one less is <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">1</span></code>, so the maximum padding we get is one row and one column.</p>
<p>If we go back to the larger matrix, we can try having a window size of <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">6</span></code>, to see that the maximum padding we get is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">2</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="o">⊢</span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="o">⍴⍳</span><span class="m">36</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0  0  0  0  0
0 0  0  0  0  0
0 0  1  2  3  4
0 0  7  8  9 10
0 0 13 14 15 16
0 0 19 20 21 22
</span></div></div>
</div>
<p>The window does not have to be a square, so we can even pick different lengths for the number of rows and columns of each sub-matrix.
As a result, the padding is also done independently for rows and columns.</p>
<p>We can split a matrix into sub-matrices that contain a single row and three columns, in which case there will be no padding added on top or on the bottom, but there will be padding on the left and on the right:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬────────┬────────┬───────┐
│0 1 2  │1 2 3   │2 3 4   │3 4 0  │
├───────┼────────┼────────┼───────┤
│0 5 6  │5 6 7   │6 7 8   │7 8 0  │
├───────┼────────┼────────┼───────┤
│0 9 10 │9 10 11 │10 11 12│11 12 0│
├───────┼────────┼────────┼───────┤
│0 13 14│13 14 15│14 15 16│15 16 0│
└───────┴────────┴────────┴───────┘
</span></div></div>
</div>
<p>In its general form, if the window size is <code class="docutils literal notranslate"><span class="pre">ws</span></code>, then the padding you will get is <code class="docutils literal notranslate"><span class="pre">⌊(ws-1)÷2</span></code>.</p>
<p>If we set <code class="docutils literal notranslate"><span class="pre">ws</span></code> to the example above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ws</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>We get a confirmation that the padding was <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="p">(</span><span class="nv">ws</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1
</span></div></div>
</div>
</div>
<div class="section" id="the-left-operand-function">
<span id="operators-the-left-operand-function"></span><h3><span class="section-number">11.10.3. </span>The Left Operand Function<a class="headerlink" href="#the-left-operand-function" title="Permalink to this headline">#</a></h3>
<p>The operator <em>stencil</em> takes a left operand function.
So far, we only used <code class="docutils literal notranslate"><span class="pre">{⊂⍵}</span></code> but that can be any dyadic function that returns a result.
The right argument of that function is the sub-array that the operator <em>stencil</em> computed and the left argument gives you padding information.
In fact, the left argument <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is such that <code class="docutils literal notranslate"><span class="pre">⍺↓⍵</span></code> is a sub-array without padding.
In other words, the left argument of the left operand is the value you would need if you wanted to <em>drop</em> the padding from all sub-arrays.</p>
<p>Here are all the 3 by 3 sub-matrices of <code class="docutils literal notranslate"><span class="pre">mat</span></code>, with and without the padding that the operator <em>stencil</em> adds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="nv">mat</span><span class="p">)(</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍺</span><span class="o">↓</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="nv">mat</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────────────────────────────┬───────────────────────────────┐
│┌───────┬────────┬────────┬───────┐│┌─────┬────────┬────────┬─────┐│
││0 0 0  │0 0 0   │0 0 0   │0 0 0  │││1 2  │1 2 3   │2 3 4   │3 4  ││
││0 1 2  │1 2 3   │2 3 4   │3 4 0  │││5 6  │5 6 7   │6 7 8   │7 8  ││
││0 5 6  │5 6 7   │6 7 8   │7 8 0  ││├─────┼────────┼────────┼─────┤│
│├───────┼────────┼────────┼───────┤││1  2 │1  2  3 │ 2  3  4│ 3  4││
││0 1  2 │1  2  3 │ 2  3  4│ 3  4 0│││5  6 │5  6  7 │ 6  7  8│ 7  8││
││0 5  6 │5  6  7 │ 6  7  8│ 7  8 0│││9 10 │9 10 11 │10 11 12│11 12││
││0 9 10 │9 10 11 │10 11 12│11 12 0││├─────┼────────┼────────┼─────┤│
│├───────┼────────┼────────┼───────┤││ 5  6│ 5  6  7│ 6  7  8│ 7  8││
││0  5  6│ 5  6  7│ 6  7  8│ 7  8 0│││ 9 10│ 9 10 11│10 11 12│11 12││
││0  9 10│ 9 10 11│10 11 12│11 12 0│││13 14│13 14 15│14 15 16│15 16││
││0 13 14│13 14 15│14 15 16│15 16 0││├─────┼────────┼────────┼─────┤│
│├───────┼────────┼────────┼───────┤││ 9 10│ 9 10 11│10 11 12│11 12││
││0  9 10│ 9 10 11│10 11 12│11 12 0│││13 14│13 14 15│14 15 16│15 16││
││0 13 14│13 14 15│14 15 16│15 16 0││└─────┴────────┴────────┴─────┘│
││0  0  0│ 0  0  0│ 0  0  0│ 0  0 0││                               │
│└───────┴────────┴────────┴───────┘│                               │
└───────────────────────────────────┴───────────────────────────────┘
</span></div></div>
</div>
<p>We can also try pairing the left and right arguments to see what <code class="docutils literal notranslate"><span class="pre">⍺</span></code> looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────────────┬───────────────┬───────────────┬───────────────┐
│┌───┬─────┐   │┌───┬─────┐    │┌───┬─────┐    │┌────┬─────┐   │
││1 1│0 0 0│   ││1 0│0 0 0│    ││1 0│0 0 0│    ││1 ¯1│0 0 0│   │
││   │0 1 2│   ││   │1 2 3│    ││   │2 3 4│    ││    │3 4 0│   │
││   │0 5 6│   ││   │5 6 7│    ││   │6 7 8│    ││    │7 8 0│   │
│└───┴─────┘   │└───┴─────┘    │└───┴─────┘    │└────┴─────┘   │
├──────────────┼───────────────┼───────────────┼───────────────┤
│┌───┬──────┐  │┌───┬───────┐  │┌───┬────────┐ │┌────┬───────┐ │
││0 1│0 1  2│  ││0 0│1  2  3│  ││0 0│ 2  3  4│ ││0 ¯1│ 3  4 0│ │
││   │0 5  6│  ││   │5  6  7│  ││   │ 6  7  8│ ││    │ 7  8 0│ │
││   │0 9 10│  ││   │9 10 11│  ││   │10 11 12│ ││    │11 12 0│ │
│└───┴──────┘  │└───┴───────┘  │└───┴────────┘ │└────┴───────┘ │
├──────────────┼───────────────┼───────────────┼───────────────┤
│┌───┬───────┐ │┌───┬────────┐ │┌───┬────────┐ │┌────┬───────┐ │
││0 1│0  5  6│ ││0 0│ 5  6  7│ ││0 0│ 6  7  8│ ││0 ¯1│ 7  8 0│ │
││   │0  9 10│ ││   │ 9 10 11│ ││   │10 11 12│ ││    │11 12 0│ │
││   │0 13 14│ ││   │13 14 15│ ││   │14 15 16│ ││    │15 16 0│ │
│└───┴───────┘ │└───┴────────┘ │└───┴────────┘ │└────┴───────┘ │
├──────────────┼───────────────┼───────────────┼───────────────┤
│┌────┬───────┐│┌────┬────────┐│┌────┬────────┐│┌─────┬───────┐│
││¯1 1│0  9 10│││¯1 0│ 9 10 11│││¯1 0│10 11 12│││¯1 ¯1│11 12 0││
││    │0 13 14│││    │13 14 15│││    │14 15 16│││     │15 16 0││
││    │0  0  0│││    │ 0  0  0│││    │ 0  0  0│││     │ 0  0 0││
│└────┴───────┘│└────┴────────┘│└────┴────────┘│└─────┴───────┘│
└──────────────┴───────────────┴───────────────┴───────────────┘
</span></div></div>
</div>
<p>The definition of the left argument of the left operand also determines the maximum window size for any given array.
Recall that the left argument is:</p>
<blockquote>
<div><p>“the vector <code class="docutils literal notranslate"><span class="pre">⍺</span></code> such that <code class="docutils literal notranslate"><span class="pre">⍺↓⍵</span></code> removes all padding from <code class="docutils literal notranslate"><span class="pre">⍵</span></code>.”</p>
</div></blockquote>
<p>The primitive <em>drop</em> can drop from the beginning or end of any axis, but never from both ends at the same time.
For example, if you had the vector <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">0</span></code> you could <em>drop</em> all the zeroes in it by dropping two from the front and one from the back, but you always have to do that by using <em>drop</em> twice:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↓</span><span class="m">¯1</span><span class="o">↓</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">↓</span><span class="m">2</span><span class="o">↓</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
</span></div></div>
</div>
<p>There is no left argument you can pass to <em>drop</em> that will let you get rid of the leading and trailing zeroes at the same time.
Thus, the maximum window size, is the window size that ensures there is <em>never</em> padding on both sides of a sub-array.
This is always <code class="docutils literal notranslate"><span class="pre">1+⍴array</span></code>.</p>
<p>For example, here is a 3 by 7 matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">letters</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ABCDEFG
HIJKLMN
OPQRSTU
</span></div></div>
</div>
<p>For this matrix, the maximum window size is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">+⍴</span><span class="nv">letters</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 8
</span></div></div>
</div>
<p>Notice, however, that this maximum is per axis.
That is, a valid window size for the matrix <code class="docutils literal notranslate"><span class="pre">letters</span></code> must be less than or equal to <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">8</span></code> in each axis.
So, a window size <code class="docutils literal notranslate"><span class="pre">ws</span></code> is valid if <code class="docutils literal notranslate"><span class="pre">ws</span> <span class="pre">∧.≤</span> <span class="pre">4</span> <span class="pre">8</span></code>.
Conversely, a window size <code class="docutils literal notranslate"><span class="pre">ws</span></code> is invalid if <code class="docutils literal notranslate"><span class="pre">ws</span> <span class="pre">∨.&gt;</span> <span class="pre">4</span> <span class="pre">8</span></code>.</p>
<p>Here are some examples of invalid window sizes that raise <code class="docutils literal notranslate"><span class="pre">DOMAIN</span> <span class="pre">ERROR</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ws</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
<span class="nv">ws</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">&gt;</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="nv">ws</span><span class="o">⊢</span><span class="nv">letters</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DOMAIN ERROR
      {⊂⍵}⌺ws⊢letters
         ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ws</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
<span class="nv">ws</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">&gt;</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="nv">ws</span><span class="o">⊢</span><span class="nv">letters</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DOMAIN ERROR
      {⊂⍵}⌺ws⊢letters
         ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ws</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">12</span><span class="w"></span>
<span class="nv">ws</span><span class="w"> </span><span class="o">∨</span><span class="na">.</span><span class="o">&gt;</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="nv">ws</span><span class="o">⊢</span><span class="nv">letters</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DOMAIN ERROR
      {⊂⍵}⌺ws⊢letters
         ∧
</pre></div>
</div>
</div>
</div>
<p>Finally, here is the example that makes use of the largest possible window size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="o">⊢</span><span class="nv">letters</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬────────┬────────┬────────┬────────┬────────┐
│        │        │        │        │        │        │
│   ABCDE│  ABCDEF│ ABCDEFG│ABCDEFG │BCDEFG  │CDEFG   │
│   HIJKL│  HIJKLM│ HIJKLMN│HIJKLMN │IJKLMN  │JKLMN   │
│   OPQRS│  OPQRST│ OPQRSTU│OPQRSTU │PQRSTU  │QRSTU   │
├────────┼────────┼────────┼────────┼────────┼────────┤
│   ABCDE│  ABCDEF│ ABCDEFG│ABCDEFG │BCDEFG  │CDEFG   │
│   HIJKL│  HIJKLM│ HIJKLMN│HIJKLMN │IJKLMN  │JKLMN   │
│   OPQRS│  OPQRST│ OPQRSTU│OPQRSTU │PQRSTU  │QRSTU   │
│        │        │        │        │        │        │
└────────┴────────┴────────┴────────┴────────┴────────┘
</span></div></div>
</div>
<p>Notice how the nested matrices in columns 3 and 4 contain the whole matrix <code class="docutils literal notranslate"><span class="pre">letters</span></code>, plus a row and a column of padding.
That shows that the padding is already at a maximum.</p>
</div>
<div class="section" id="stencil-for-any-rank">
<span id="operators-stencil-for-any-rank"></span><h3><span class="section-number">11.10.4. </span>Stencil For Any Rank<a class="headerlink" href="#stencil-for-any-rank" title="Permalink to this headline">#</a></h3>
<p>The operator <em>stencil</em> can be applied to arrays of any rank.
The right operand array, which is responsible for determining the shape of the resulting sub-arrays, must contain as many elements as there are axes in the right argument.</p>
<p>In the examples above, we applied the operator <em>stencil</em> to matrices, which have rank two, which explains why the window size was always a vector with two integers.
If we want to apply <em>stencil</em> to a vector (rank 1), then the right operand must have a single element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="o">⊢⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬──────┬──────┐
│0 1 2│1 2 3│2 3 4│3 4 5│4 5 6│5 6 7│6 7 8│7 8 9│8 9 10│9 10 0│
└─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴──────┴──────┘
</span></div></div>
</div>
<p>And if we want to apply <em>stencil</em> to a cuboid (rank 3), then the right operand must have three elements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴⍳</span><span class="m">24</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┐
│0 0 0│0 0 0│
│0 0 0│0 0 0│
│0 0 0│0 0 0│
│     │     │
│0 0 0│0 0 0│
│0 1 2│1 2 0│
│0 3 4│3 4 0│
│     │     │
│0 0 0│0 0 0│
│0 5 6│5 6 0│
│0 7 8│7 8 0│
├─────┼─────┤
│0 0 0│0 0 0│
│0 0 0│0 0 0│
│0 0 0│0 0 0│
│     │     │
│0 1 2│1 2 0│
│0 3 4│3 4 0│
│0 0 0│0 0 0│
│     │     │
│0 5 6│5 6 0│
│0 7 8│7 8 0│
│0 0 0│0 0 0│
└─────┴─────┘
┌─────┬─────┐
│0 0 0│0 0 0│
│0 1 2│1 2 0│
│0 3 4│3 4 0│
│     │     │
│0 0 0│0 0 0│
│0 5 6│5 6 0│
│0 7 8│7 8 0│
│     │     │
│0 0 0│0 0 0│
│0 0 0│0 0 0│
│0 0 0│0 0 0│
├─────┼─────┤
│0 1 2│1 2 0│
│0 3 4│3 4 0│
│0 0 0│0 0 0│
│     │     │
│0 5 6│5 6 0│
│0 7 8│7 8 0│
│0 0 0│0 0 0│
│     │     │
│0 0 0│0 0 0│
│0 0 0│0 0 0│
│0 0 0│0 0 0│
└─────┴─────┘
</span></div></div>
</div>
</div>
<div class="section" id="step-size">
<span id="operators-step-size"></span><h3><span class="section-number">11.10.5. </span>Step Size<a class="headerlink" href="#step-size" title="Permalink to this headline">#</a></h3>
<p>The operator <em>stencil</em> defaults to creating all sub-matrices consecutively, but you can specify a step size that determines by how much the rectangular window moves.
The step size is also indicated in the right operand, which in its most general form is a 2-row matrix:</p>
<ul class="simple">
<li><p>the first row determines the window size along each axis; and</p></li>
<li><p>the second row determines the step size along each axis.</p></li>
</ul>
<p>The first sub-array is always centred on the first element of the argument to <em>stencil</em>, so the step size only influences the subsequent sub-arrays that are created:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">9</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
4 5 6
7 8 9
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ws</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The default step size is 1 on each axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">stepSize</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">complete</span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nv">ws</span><span class="o">,</span><span class="nv">stepSize</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│0 0 0│0 0 0│0 0 0│
│0 1 2│1 2 3│2 3 0│
│0 4 5│4 5 6│5 6 0│
├─────┼─────┼─────┤
│0 1 2│1 2 3│2 3 0│
│0 4 5│4 5 6│5 6 0│
│0 7 8│7 8 9│8 9 0│
├─────┼─────┼─────┤
│0 4 5│4 5 6│5 6 0│
│0 7 8│7 8 9│8 9 0│
│0 0 0│0 0 0│0 0 0│
└─────┴─────┴─────┘
</span></div></div>
</div>
<p>The step size is specified independently for each axis, so we can increase the step size along the first axis to 2.
This will skip every other row of sub-matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">stepSize</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nv">ws</span><span class="o">,</span><span class="nv">stepSize</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│0 0 0│0 0 0│0 0 0│
│0 1 2│1 2 3│2 3 0│
│0 4 5│4 5 6│5 6 0│
├─────┼─────┼─────┤
│0 4 5│4 5 6│5 6 0│
│0 7 8│7 8 9│8 9 0│
│0 0 0│0 0 0│0 0 0│
└─────┴─────┴─────┘
</span></div></div>
</div>
<p>Notice how the two rows of the result above are the first and third rows of the nested matrix <code class="docutils literal notranslate"><span class="pre">complete</span></code>.</p>
<p>We can increase the step size even further, to 3.
With a step size of 3 for the first axis, we only get one out of every three rows of the output.
Because the matrix <code class="docutils literal notranslate"><span class="pre">complete</span></code> only has 3 rows, this means our result will have a single row (the first one):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">stepSize</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nv">ws</span><span class="o">,</span><span class="nv">stepSize</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│0 0 0│0 0 0│0 0 0│
│0 1 2│1 2 3│2 3 0│
│0 4 5│4 5 6│5 6 0│
└─────┴─────┴─────┘
</span></div></div>
</div>
<p>The step size can be increased arbitrarily, even if further increases do not modify the output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="o">⍴</span><span class="nv">ws</span><span class="o">,</span><span class="m">123409</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬─────┬─────┐
│0 0 0│0 0 0│0 0 0│
│0 1 2│1 2 3│2 3 0│
│0 4 5│4 5 6│5 6 0│
└─────┴─────┴─────┘
</span></div></div>
</div>
<p>A step size of 123409 along the first axis means that we keep one out of every 123409 rows.
Because there are only 3 rows in the complete result, we keep the very first one, and that is it.</p>
</div>
<div class="section" id="image-processing-with-stencil">
<span id="operators-image-processing-with-stencil"></span><h3><span class="section-number">11.10.6. </span>Image Processing with Stencil<a class="headerlink" href="#image-processing-with-stencil" title="Permalink to this headline">#</a></h3>
<p>The operator <em>stencil</em> is very useful in domains like image processing or neural networks.
A simple application example is the usage of the operator <em>stencil</em> to blur images.</p>
<p><a class="reference internal" href="#fig-image"><span class="std std-numref">Fig. 11.7</span></a> is an image we will blur:</p>
<div class="figure align-default" id="image">
<span id="fig-image"></span><img alt="_images/Image.png" src="_images/Image.png" />
<p class="caption"><span class="caption-number">Fig. 11.7 </span><span class="caption-text">A screenshot of the Dyalog website in late 2022.</span><a class="headerlink" href="#image" title="Permalink to this image">#</a></p>
</div>
<p><a class="reference internal" href="#fig-image-blurred"><span class="std std-numref">Fig. 11.8</span></a> is the blurred version:</p>
<div class="figure align-default" id="image-blurred">
<span id="fig-image-blurred"></span><img alt="_images/Image_Blurred.png" src="_images/Image_Blurred.png" />
<p class="caption"><span class="caption-number">Fig. 11.8 </span><span class="caption-text">A blurred screenshot of the Dyalog website in late 2022.</span><a class="headerlink" href="#image-blurred" title="Permalink to this image">#</a></p>
</div>
<p>The main piece of code that blurs the image is this:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Blur</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">⌿</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷</span><span class="m">49</span><span class="kt">}</span><span class="na">⌺</span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
<span class="nv">newImage</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Blur</span><span class="na">⍤</span><span class="m">2</span><span class="o">⊢</span><span class="nv">image</span><span class="w"></span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">Blur</span></code> goes over sub-matrices of shape 7 by 7 and then computes the average value of each 7 by 7 sub-matrix as the new value that will go in a given position.
This is one way to achieve a simple blurring effect.
Then, the expression that computes the new image applies the function <code class="docutils literal notranslate"><span class="pre">Blur</span></code> to each 2-cell of the array <code class="docutils literal notranslate"><span class="pre">image</span></code>, because <code class="docutils literal notranslate"><span class="pre">image</span></code> is actually a cuboid with three layers, where each layer represents a colour channel in the RGB colour space.</p>
<p>(If you are not familiar with the RGB colour space, you can think of it as saying that a colour can be determined by its amount of <strong>r</strong>ed, <strong>g</strong>reen, and <strong>b</strong>lue.
Thus, in our code, we need to blur the red, green, and blue, layers, which is why we use <code class="docutils literal notranslate"><span class="pre">Blur⍤2</span></code>.)</p>
</div>
</div>
<div class="section" id="power">
<span id="operators-power"></span><h2><span class="section-number">11.11. </span>Power<a class="headerlink" href="#power" title="Permalink to this headline">#</a></h2>
<p><em>Power</em> is a dyadic operator represented by the glyph <code class="docutils literal notranslate"><span class="pre">⍣</span></code> that you can type with <kbd>APL</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>, which is easy to remember because P is the initial letter of <em>power</em> and because the glyph <code class="docutils literal notranslate"><span class="pre">⍣</span></code> is just the <code class="docutils literal notranslate"><span class="pre">*</span></code> with a diaeresis on top.
The operator <em>power</em> produces a derived function that is either monadic, dyadic, or ambivalent, depending on the function used as the left operand.
Again, depending on the left operand, the derived function may return a result or not.</p>
<p>The general syntax is <code class="docutils literal notranslate"><span class="pre">{result}</span> <span class="pre">←</span> <span class="pre">{left}</span> <span class="pre">F⍣n</span> <span class="pre">⊢</span> <span class="pre">right</span></code>, if the right operand is an integer, or <code class="docutils literal notranslate"><span class="pre">{result}</span> <span class="pre">←</span> <span class="pre">{left}</span> <span class="pre">F⍣C</span> <span class="pre">⊢</span> <span class="pre">right</span></code>, if the right operand is a function.
The two usages are explained next.</p>
<div class="section" id="power-n-times">
<span id="operators-power-n-times"></span><h3><span class="section-number">11.11.1. </span>Power <code class="docutils literal notranslate"><span class="pre">n</span></code> Times<a class="headerlink" href="#power-n-times" title="Permalink to this headline">#</a></h3>
<p>If the right operand <code class="docutils literal notranslate"><span class="pre">n</span></code> is an integer scalar, the left operand function <code class="docutils literal notranslate"><span class="pre">F</span></code> is applied <code class="docutils literal notranslate"><span class="pre">n</span></code> times to the argument <code class="docutils literal notranslate"><span class="pre">right</span></code> (if the derived function is used monadically) or to <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> (if the derived function is used dyadically).</p>
<p>Like with some other operators we have seen already, the right operand <code class="docutils literal notranslate"><span class="pre">n</span></code> must be separated from the right argument, either by parenthesising the whole derived function or by using a <em>right tack</em> between the right operand and the right argument.</p>
<p>Imagine we have a little matrix <code class="docutils literal notranslate"><span class="pre">mat</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
4 5 6
7 8 9
</span></div></div>
</div>
<p>And we write a function to spin it a quarter of a turn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Spin</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">⊖⍉</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Spin</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 6 9
2 5 8
1 4 7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9 8 7
6 5 4
3 2 1
</span></div></div>
</div>
<p>Of course, after 4 executions, the matrix would return to its original position.</p>
<p>We can spin the matrix any number of times using the operator <em>power</em> instead of writing <code class="docutils literal notranslate"><span class="pre">Spin</span></code> repeatedly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9 8 7
6 5 4
3 2 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Spin</span><span class="na">⍣</span><span class="m">2</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9 8 7
6 5 4
3 2 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">Spin</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 6 9
2 5 8
1 4 7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Spin</span><span class="na">⍣</span><span class="m">9</span><span class="o">⊢</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 6 9
2 5 8
1 4 7
</span></div></div>
</div>
<p>The example above shows that 9 spins are equivalent to a single spin.</p>
<p>The operator <em>power</em> can also give us a way of calculating a Fibonacci series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Fibo</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="o">,+</span><span class="na">/</span><span class="m">¯2</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">Fibo</span><span class="na">⍣</span><span class="m">10</span><span class="o">⊢</span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 2 3 5 8 13 21 34 55 89
</span></div></div>
</div>
</div>
<div class="section" id="conditional-execution">
<span id="operators-conditional-execution"></span><h3><span class="section-number">11.11.2. </span>Conditional Execution<a class="headerlink" href="#conditional-execution" title="Permalink to this headline">#</a></h3>
<p>As a special case, when <code class="docutils literal notranslate"><span class="pre">n</span></code> is a Boolean value, the left operand function is applied (1) or not applied (0).
It simulates the conditional execution of the function.</p>
<p>In the example below, the right operand to <em>power</em> is 1, so we round down our values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="na">⍣</span><span class="m">1</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="m">23.73</span><span class="w"> </span><span class="m">42.25</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23 42
</span></div></div>
</div>
<p>In the next example, the right operand to <em>power</em> is 0, so we do not round down:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="na">⍣</span><span class="m">0</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="m">23.73</span><span class="w"> </span><span class="m">42.25</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23.73 42.25
</span></div></div>
</div>
<p>For example, a function has been written in such a way that it works only on nested vectors, but sometimes its right argument <code class="docutils literal notranslate"><span class="pre">v</span></code> is a simple vector (not nested) or even a scalar.
So, one must <em>ravel</em> <code class="docutils literal notranslate"><span class="pre">v</span></code> (if it is a scalar), <em>enclose</em> it, then <em>ravel</em> again to produce a vector, or do absolutely nothing if <code class="docutils literal notranslate"><span class="pre">v</span></code> is already a nested vector.
The following expression will perform the necessary transformations: <code class="docutils literal notranslate"><span class="pre">({,⊂,⍵}</span> <span class="pre">⍣</span> <span class="pre">(1=≡,v))</span> <span class="pre">v</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;nested&#39;</span><span class="w"> </span><span class="s1">&#39;vector&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┐
│nested│vector│
└──────┴──────┘
</span></div></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">v</span></code> is already a nested vector, so the expression above shouldn’t do anything to <code class="docutils literal notranslate"><span class="pre">v</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kt">{</span><span class="o">,⊂,</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"> </span><span class="na">⍣</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">=≡,</span><span class="nv">v</span><span class="p">))</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┐
│nested│vector│
└──────┴──────┘
</span></div></div>
</div>
<p>In the next example, we define <code class="docutils literal notranslate"><span class="pre">v</span></code> to be a simple vector, which means the expression should nest it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;simple vector&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">simple vector
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">newV</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="kt">{</span><span class="o">,⊂,</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"> </span><span class="na">⍣</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">=≡,</span><span class="nv">v</span><span class="p">))</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────┐
│simple vector│
└─────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">newV</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Whether one prefers to use the operator <em>power</em> to write such a compact conditional expression, or to use a traditional control structure (<code class="docutils literal notranslate"><span class="pre">:If</span> <span class="pre">...</span> <span class="pre">:EndIf</span></code>) is mostly a matter of taste.
Some may find the former easier to write and read than the latter, while others may disagree.</p>
<p>The version with the operator <em>power</em> has the advantage that it works inside a <em>dfn</em>.</p>
</div>
<div class="section" id="left-argument">
<span id="operators-left-argument"></span><h3><span class="section-number">11.11.3. </span>Left Argument<a class="headerlink" href="#left-argument" title="Permalink to this headline">#</a></h3>
<p>If a left argument <code class="docutils literal notranslate"><span class="pre">left</span></code> is provided to the derived function, it is bound as the left argument to the left operand <code class="docutils literal notranslate"><span class="pre">F</span></code> in <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍣n</span> <span class="pre">⊢</span> <span class="pre">right</span></code>.
It is the same thing if, instead of an integer right operand, we have a function right operand in <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F⍣C</span> <span class="pre">right</span></code>.</p>
<p>So, the expression</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="o">×</span><span class="na">⍣</span><span class="m">4</span><span class="o">⊢</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">162
</span></div></div>
</div>
<p>is the same as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="m">3</span><span class="o">×</span><span class="w"> </span><span class="m">3</span><span class="o">×</span><span class="w"> </span><span class="m">3</span><span class="o">×</span><span class="w"> </span><span class="m">3</span><span class="o">×</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="c1">⍝ 1  2  3  4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">162
</span></div></div>
</div>
<p>and not</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="o">×</span><span class="m">2</span><span class="w"> </span><span class="o">×</span><span class="m">2</span><span class="w"> </span><span class="o">×</span><span class="m">2</span><span class="w"> </span><span class="o">×</span><span class="m">2</span><span class="w"></span>
<span class="c1">⍝ 1  2  3  4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">48
</span></div></div>
</div>
</div>
<div class="section" id="inverse-function">
<span id="operators-inverse-function"></span><h3><span class="section-number">11.11.4. </span>Inverse Function<a class="headerlink" href="#inverse-function" title="Permalink to this headline">#</a></h3>
<p>If the right operand <code class="docutils literal notranslate"><span class="pre">n</span></code> is a <strong>negative</strong> integer, the function executed by the operator <em>power</em> is not <code class="docutils literal notranslate"><span class="pre">F</span></code>, but its <em>inverse</em> function – provided such an inverse function exists and APL knows about it.
If the inverse function to <code class="docutils literal notranslate"><span class="pre">F</span></code> is not known to APL, a <code class="docutils literal notranslate"><span class="pre">DOMAIN</span> <span class="pre">ERROR</span></code> will be reported.
In particular, APL is not able to find the <em>inversion function</em> of user-defined function, and some primitive functions have no <em>inverse function</em>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">n</span></code> is negative, the <em>inverse function</em> is applied <code class="docutils literal notranslate"><span class="pre">|n</span></code> times.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">F</span></code> may be an appropriate primitive function or an expression consisting of such primitive functions combined with primitive operators among <em>each</em> <code class="docutils literal notranslate"><span class="pre">¨</span></code>, <em>outer product</em> <code class="docutils literal notranslate"><span class="pre">∘.</span></code>, <em>axis</em> <code class="docutils literal notranslate"><span class="pre">[n]</span></code>, <em>scan</em> <code class="docutils literal notranslate"><span class="pre">\</span></code>, and <em>power</em> <code class="docutils literal notranslate"><span class="pre">⍣</span></code>.
Later in <a class="reference internal" href="#operators-inverting-functions-with-the-operator-power"><span class="std std-numref">Section 11.15.6</span></a> you will see that there are some other operators that you can also use and that the operator <em>power</em> will know how to invert.</p>
<p>As an example, let us compute the inverse of <em>plus scan</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">+</span><span class="na">\</span><span class="w"> </span><span class="na">⍣</span><span class="w"> </span><span class="m">¯1</span><span class="p">)</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">19</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 1 5 6 4
</span></div></div>
</div>
<p>We can confirm this result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 4 9 15 19
</span></div></div>
</div>
<p>The <em>inverse function</em> can also accept a left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">left</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">right</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">10</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">35</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">12</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10  4 14  8
25 10 35 20
15  6 21 12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">left</span><span class="w"> </span><span class="p">(</span><span class="na">∘.</span><span class="o">×</span><span class="w"> </span><span class="na">⍣</span><span class="w"> </span><span class="m">¯1</span><span class="p">)</span><span class="w"> </span><span class="nv">right</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 2 7 4
</span></div></div>
</div>
<p>In this case, the <em>inverse function</em> computed the vector that you would need to combine with the vector <code class="docutils literal notranslate"><span class="pre">left</span></code> to produce the matrix <code class="docutils literal notranslate"><span class="pre">right</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">right</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="na">∘.</span><span class="o">×</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
</div>
<div class="section" id="fixed-point-and-user-defined-operators">
<span id="operators-fixed-point-and-user-defined-operators"></span><h3><span class="section-number">11.11.5. </span>Fixed Point and User-Defined Operators<a class="headerlink" href="#fixed-point-and-user-defined-operators" title="Permalink to this headline">#</a></h3>
<p>Here are two additional features of the operator <em>power</em>:</p>
<ol class="simple">
<li><p>in its second form, the operator <em>power</em> has two function operands: <code class="docutils literal notranslate"><span class="pre">{left}</span> <span class="pre">F⍣C</span> <span class="pre">right</span></code>; and</p></li>
<li><p>some common patterns in user-defined operators make use of <em>power</em>.</p></li>
</ol>
<p>These two types of use require an advanced knowledge of APL and of <em>user-defined operators</em>.
They will not be presented now, but <a class="reference internal" href="#operators-advanced-uses-of-the-operator-power"><span class="std std-numref">Section 11.15.9</span></a> covers <em>power</em> with two function operands and <a class="reference internal" href="#operators-under"><span class="std std-numref">Section 11.15.7</span></a> covers one such common pattern.
Have a look at it when you feel ready.</p>
</div>
</div>
<div class="section" id="spawn">
<span id="operators-spawn"></span><h2><span class="section-number">11.12. </span>Spawn<a class="headerlink" href="#spawn" title="Permalink to this headline">#</a></h2>
<div class="section" id="main-features">
<span id="operators-main-features"></span><h3><span class="section-number">11.12.1. </span>Main Features<a class="headerlink" href="#main-features" title="Permalink to this headline">#</a></h3>
<p>The monadic operator <em>spawn</em> is represented by an ampersand <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> and your regular keyboard should be able to type it already.
It executes a function asynchronously from the main flow of execution in a separate sequence of instructions known as a <em>thread</em>.</p>
<p>If the main flow of execution and the function executing in the separate thread are both using the CPU heavily, nothing is gained by starting a separate thread.
On the contrary, the two threads will be competing for the same resource – the CPU, which requires some overhead.
But if one of the threads involves waiting time in which it cannot make use of the CPU, the other thread may use the CPU, which otherwise would have been idle.
In such cases, a considerable improvement of the application’s perceived performance may be observed.</p>
<p>There are many situations in which a thread may be waiting and not be able to make good use of the CPU: it may be waiting for user input, a file operation, a response from a web client or server, or a response from a database manager, to give just a few examples.</p>
<p><em>Spawn</em> is itself monadic, but its derived function is monadic, dyadic, or ambivalent, according to the definition of its left function operand.
This function (and hence the derived function) may not be niladic.</p>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>If you are reading this book in its interactive format, we suggest you try the examples with the operator <em>spawn</em> in your local interpreter.
That is because the operator <em>spawn</em> interacts in inconvenient ways with the notebook software.</p>
</div>
<p><em>Spawn</em> returns as a <em>shy result</em> the number of the thread in which the task is executed.</p>
<p>The main execution flow is executing in thread number 0, so the first time one launches a new thread, it is executed in thread number 1.
Let us execute <code class="docutils literal notranslate"><span class="pre">⍳5</span></code> in a separate thread:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="na">&amp;</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="m">1</span><span class="w"></span>
<span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
<p>In the example above, the <em>quad</em> forces the shy result (the new thread number) to be displayed, which is 1 because this is the first thread we start.
Then, the function result is displayed.</p>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>It may happen that you run the expression <code class="docutils literal notranslate"><span class="pre">⎕←</span> <span class="pre">⍳&amp;</span> <span class="pre">5</span></code> and the output is the same as the one above, but with the two lines swapped.
If the left operand of <em>spawn</em> is a simple/small expression, it may finish executing before the <em>quad</em> gets a chance to print the thread number.</p>
</div>
<p>Once a thread number has been used, it will not be used again in this session: the thread number will be incremented every time <em>spawn</em> is used:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="o">÷</span><span class="na">&amp;</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
<span class="m">2</span><span class="w"></span>
<span class="m">0.5</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="m">0.1</span><span class="w"></span>
</pre></div>
</div>
<p>As we can see, the second time we use <em>spawn</em>, the thread number was incremented to 2.</p>
<p>In these examples, the derived function was monadic; let us now use a dyadic function operand, and try to execute <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">3</span> <span class="pre">7</span> <span class="pre">×</span> <span class="pre">4</span> <span class="pre">6</span> <span class="pre">5</span></code> in a separate thread:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">×</span><span class="na">&amp;</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="m">8</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">35</span><span class="w"></span>
</pre></div>
</div>
<p>Beware of the previous example!
You may think that <code class="docutils literal notranslate"><span class="pre">r</span></code> contains the result of the function call, but it does not.
It contains the thread number:</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="nv">r</span><span class="w"></span>
<span class="m">3</span><span class="w"></span>
</pre></div>
</div>
<p>If you think about it, it should not come as a surprise that the result of starting a new thread is not the result of the function call.
If that had been the case, the main execution thread would have had to stop and wait until the execution of the function had completed – and we would not have had any parallel execution at all!</p>
<p>So, if we cannot get hold of the result of the function call when starting it using the operator <em>spawn</em>, how can we get hold of it later, when we assume that the function has completed execution?</p>
<p>The answer is the monadic <em>system function</em> <code class="docutils literal notranslate"><span class="pre">⎕TSYNC</span></code> (<em>thread synchronization</em>).
It takes an array of thread numbers as its argument.
It then causes the thread in which it is executing to stop and wait until all the threads listed in the argument have completed execution.
Then, it returns an array of the same shape as the right argument, each item containing the result of the function call executed in the corresponding thread.</p>
<p>Let us build a simple example using the system function <code class="docutils literal notranslate"><span class="pre">⎕DL</span></code> (<em>delay</em>), which simply stops execution for approximately a specified number of seconds.
<code class="docutils literal notranslate"><span class="pre">⎕DL</span></code> returns, as a result, the exact length of the delay.</p>
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="vg">⎕</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">tn</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕DL</span><span class="na">&amp;</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
<span class="m">4</span><span class="w"></span>
<span class="w">      </span><span class="vg">⎕</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕TSYNC</span><span class="w"> </span><span class="nv">tn</span><span class="w"></span>
<span class="m">10.045</span><span class="w"></span>
</pre></div>
</div>
<p>We start a new thread that will just waste 10 seconds and its thread number is saved in the variable <code class="docutils literal notranslate"><span class="pre">tn</span></code>, which we then print and see it is 4.
The thread number is displayed immediately.
Then, we wait approximately 10 seconds, and then we print the result that is returned by <code class="docutils literal notranslate"><span class="pre">⎕DL</span></code>.</p>
<p>It will never really make sense to use primitive functions with <em>spawn</em>, as this will only slow the system down.
In practice, <em>spawn</em> is always used to start user-defined functions in situations where you don’t mind that your main thread slows down a little while a job is done in the background.
For example, you might start a function which prepares a print job and let it run in the background.
Your application will possibly run more slowly until the print job is completed, but you can avoid having to make your user wait until the print job is finished.
If the user is typing in data for the next job, the slowdown may not even be noticeable.</p>
<p>Programming using multiple threads is complex and requires great care.
In particular, you have to be careful about what happens to global or semi-global variables that can be seen by more than one thread.
Dyalog contains several mechanisms for controlling and synchronising the execution in threads.
The operator <em>spawn</em> and <code class="docutils literal notranslate"><span class="pre">⎕TSYNC</span></code> are just the two most basic ones.
We will not go into further detail about the others here; please refer to the Dyalog help file if you are interested in learning more about using multiple threads in Dyalog.</p>
</div>
<div class="section" id="special-syntax">
<span id="operators-special-syntax"></span><h3><span class="section-number">11.12.2. </span>Special Syntax<a class="headerlink" href="#special-syntax" title="Permalink to this headline">#</a></h3>
<p>Suppose we have three functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DyaFun</span></code> is dyadic;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MonaFun</span></code> is monadic; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NilFun</span></code> is niladic.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">47</span> <span class="pre">DyaFun&amp;</span> <span class="pre">60</span></code> will execute <code class="docutils literal notranslate"><span class="pre">DyaFun</span></code> in a separate thread.
The derived function is dyadic: <code class="docutils literal notranslate"><span class="pre">47</span> <span class="pre">(DyaFun&amp;)</span> <span class="pre">60</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">MonaFun&amp;</span> <span class="pre">33</span></code> will execute <code class="docutils literal notranslate"><span class="pre">MonaFun</span></code> in a separate thread.
The derived function is monadic: <code class="docutils literal notranslate"><span class="pre">(MonaFun&amp;)</span> <span class="pre">33</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">NilaFun&amp;</span></code> <strong>will not work</strong>; it will cause a <code class="docutils literal notranslate"><span class="pre">VALUE</span> <span class="pre">ERROR</span></code>!
Why?</p>
<p>The reason is that the APL syntax does not allow operators to be used with niladic functions, although there is really no specific reason why it should not be possible to run a niladic function in a separate thread.
There are workarounds, though:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⍎&amp;</span> <span class="pre">'NilaFunc'</span></code> – the operand of <em>spawn</em> is the function <em>execute</em> (<code class="docutils literal notranslate"><span class="pre">⍎</span></code>) and the argument of the <em>derived function</em> is the name of the function we would like to execute: <code class="docutils literal notranslate"><span class="pre">'NilaFunc'</span></code>. Finally, this will launch <code class="docutils literal notranslate"><span class="pre">⍎'NilaFunc'</span></code> in a new thread, and it works as expected!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{NilaFunc}&amp;</span> <span class="pre">0</span></code> – here, <code class="docutils literal notranslate"><span class="pre">NilaFunc</span></code> is embedded in a dfn, which is always ambivalent. A dummy right argument is provided, but ignored (any value will do).</p></li>
</ul>
<p><em>Spawn</em> can be used in conjunction with <em>each</em> (<code class="docutils literal notranslate"><span class="pre">¨</span></code>) to launch several parallel threads in one expression.</p>
</div>
</div>
<div class="section" id="user-defined-operators">
<span id="operators-user-defined-operators"></span><h2><span class="section-number">11.13. </span>User-Defined Operators<a class="headerlink" href="#user-defined-operators" title="Permalink to this headline">#</a></h2>
<p>As we have seen, APL offers a set of primitive <em>functions</em>, and you can write your own <em>user-defined functions</em>.
Likewise for <em>operators</em>: Dyalog APL has a large set of primitive operators, but you can write your own <em>user-defined operators</em>.</p>
<p>As for functions, there are two types of <em>user-defined operators</em>, and we will cover both of them next.</p>
<div class="section" id="dops">
<span id="operators-dops"></span><h3><span class="section-number">11.13.1. </span>Dops<a class="headerlink" href="#dops" title="Permalink to this headline">#</a></h3>
<p>Dops are just like dfns with a few extra conventions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⍺⍺</span></code> represents the left operand of the operator;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍵⍵</span></code> represents the right operand of the operator;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍺</span></code> is the left argument of the <em>derived function</em>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⍵</span></code> is the right argument of the <em>derived function</em>.</p></li>
</ul>
<p>Using these conventions, suppose that we want to simulate <em>inner product</em>.
We could write:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_InPro_</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍺⍺</span><span class="na">.</span><span class="bp">⍵⍵</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>To see if it works, we can just check that we obtain the same results as with the primitive <em>inner product</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">percent</span><span class="w"> </span><span class="o">+</span><span class="nv">_InPro_</span><span class="o">×</span><span class="w"> </span><span class="nv">invest</span><span class="p">)</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">percent</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="w"> </span><span class="nv">invest</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>In the previous example, <code class="docutils literal notranslate"><span class="pre">⍺⍺</span></code> was set to <code class="docutils literal notranslate"><span class="pre">+</span></code> and <code class="docutils literal notranslate"><span class="pre">⍵⍵</span></code> was set to <code class="docutils literal notranslate"><span class="pre">×</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">words</span><span class="w"> </span><span class="o">∧</span><span class="nv">_InPro_</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;COLONEL&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">words</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;COLONEL&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Throughout this book we will use the convention that <em>user-defined operators</em> have leading underscore if they are monadic, or a leading and trailing underscore if they are dyadic.
This will help distinguish operators from functions.
Recall that this is just a convention and you are not forced to follow it.</p>
<div class="tip admonition">
<p class="admonition-title">Remark</p>
<p>A dfn becomes a dop if it mentions either <code class="docutils literal notranslate"><span class="pre">⍺⍺</span></code> or <code class="docutils literal notranslate"><span class="pre">⍵⍵</span></code> explicitly.
For example, <code class="docutils literal notranslate"><span class="pre">{⍺⍺</span> <span class="pre">⍵}</span></code> is a dop.
The code <code class="docutils literal notranslate"><span class="pre">{{⍺⍺</span> <span class="pre">⍵}</span> <span class="pre">⍵}</span></code> <em>might</em> look like a dop, but it is not.
The outer <code class="docutils literal notranslate"><span class="pre">{...}</span></code> is a dfn because it does not mention the names <code class="docutils literal notranslate"><span class="pre">⍺⍺</span></code> or <code class="docutils literal notranslate"><span class="pre">⍵⍵</span></code>.</p>
</div>
</div>
<div class="section" id="traditional-operators">
<span id="operators-traditional-operators"></span><h3><span class="section-number">11.13.2. </span>Traditional Operators<a class="headerlink" href="#traditional-operators" title="Permalink to this headline">#</a></h3>
<p>Traditional operators, often referred to as tradops, have a syntax similar to that of tradfns.
The names of the operands must be parenthesised together with the name of the operator.
The name(s) of the argument(s) to the derived function are specified on either side of the parentheses.</p>
<p>With this in mind, here are the possible header structures for a dyadic tradop:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Syntax</p></th>
<th class="text-align:left head"><p>Valence of the derived function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>                 <code class="docutils literal notranslate"><span class="pre">(F</span> <span class="pre">_Op_</span> <span class="pre">G)</span> <span class="pre">right</span></code></p></td>
<td class="text-align:left"><p>Monadic</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>  <code class="docutils literal notranslate"><span class="pre">left</span>&#160; <span class="pre">(F</span> <span class="pre">_Op_</span> <span class="pre">G)</span> <span class="pre">right</span></code></p></td>
<td class="text-align:left"><p>Dyadic</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">{left}</span> <span class="pre">(F</span> <span class="pre">_Op_</span> <span class="pre">G)</span> <span class="pre">right</span></code></p></td>
<td class="text-align:left"><p>Ambivalent</p></td>
</tr>
</tbody>
</table>
<p>Similarly, here are the possible header structures for a <strong>monadic</strong> tradop:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Syntax</p></th>
<th class="text-align:left head"><p>Valence of the derived function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>                 <code class="docutils literal notranslate"><span class="pre">(F</span> <span class="pre">_Op)</span> <span class="pre">right</span></code></p></td>
<td class="text-align:left"><p>Monadic</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>  <code class="docutils literal notranslate"><span class="pre">left</span>&#160; <span class="pre">(F</span> <span class="pre">_Op)</span> <span class="pre">right</span></code></p></td>
<td class="text-align:left"><p>Dyadic</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">{left}</span> <span class="pre">(F</span> <span class="pre">_Op)</span> <span class="pre">right</span></code></p></td>
<td class="text-align:left"><p>Ambivalent</p></td>
</tr>
</tbody>
</table>
<p>Recall that neither an operator nor its derived function can be niladic.</p>
<p>If we wanted to simulate <em>inner product</em> again, but this time with a tradop, it would look something like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="p">(</span><span class="nv">F</span><span class="w"> </span><span class="nv">_InPro_</span><span class="w"> </span><span class="nv">G</span><span class="p">)</span><span class="w"> </span><span class="nv">right</span><span class="w"></span>
<span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">left</span><span class="w"> </span><span class="nv">F</span><span class="na">.</span><span class="nv">G</span><span class="w"> </span><span class="nv">right</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">percent</span><span class="w"> </span><span class="o">+</span><span class="nv">_InPro_</span><span class="o">×</span><span class="w"> </span><span class="nv">invest</span><span class="p">)</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="nv">percent</span><span class="w"> </span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="w"> </span><span class="nv">invest</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
</div>
<div class="section" id="some-basic-user-defined-operators">
<span id="operators-some-basic-user-defined-operators"></span><h3><span class="section-number">11.13.3. </span>Some Basic User-Defined Operators<a class="headerlink" href="#some-basic-user-defined-operators" title="Permalink to this headline">#</a></h3>
<p>Just to experiment a little, let us define a dyadic operator with a dyadic derived function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_Op_</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍺⍺</span><span class="w"> </span><span class="bp">⍺</span><span class="p">)</span><span class="w"> </span><span class="bp">⍵⍵</span><span class="w"> </span><span class="p">(</span><span class="bp">⍵</span><span class="w"> </span><span class="bp">⍺⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="o">×</span><span class="nv">_Op_</span><span class="o">+</span><span class="w"> </span><span class="m">8</span><span class="w">  </span><span class="c1">⍝ ←→ (5×5) + (8×8)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">89
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="w"> </span><span class="o">+</span><span class="nv">_Op_</span><span class="o">×</span><span class="w"> </span><span class="m">8</span><span class="w">  </span><span class="c1">⍝ ←→ (5+5) × (8+8)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">160
</span></div></div>
</div>
<p>You probably remember that we used a <em>multiply-scan</em> to calculate a vector of inflation rates, which we then used to calculate the future values of investments given as current values (see <a class="reference internal" href="#operators-inflate-values"><span class="std std-numref">Section 11.3.2.1</span></a>).
We could just as well have used the rates to calculate the current values if we knew the future values.
So, why not create an operator that can be used to transform future values into current values, or the inverse.
Let us name it <code class="docutils literal notranslate"><span class="pre">_InDef</span></code> (for Inflate / Deflate).</p>
<p>The derived function arguments will be the inflation rates (left) and the investment values (right):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">rates</span><span class="w"> </span><span class="p">(</span><span class="nv">action</span><span class="w"> </span><span class="nv">_InDef</span><span class="p">)</span><span class="w"> </span><span class="nv">values</span><span class="w"></span>
<span class="w">    </span><span class="nv">values</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">×</span><span class="na">\</span><span class="m">1</span><span class="o">+</span><span class="nv">rates</span><span class="o">÷</span><span class="m">100</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Example values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2000 5000 6000 4000 2000
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inf</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2.6 2.9 3.4 3.1 2.7
</span></div></div>
</div>
<p>We can use it to calculate the future values using multiplication:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⍕</span><span class="w"> </span><span class="nv">inf</span><span class="w"> </span><span class="o">×</span><span class="nv">_InDef</span><span class="w"> </span><span class="nv">inv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 2052.00 5278.77 6549.90 4501.96 2311.76
</span></div></div>
</div>
<p>Using division, we can do the inverse:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⍕</span><span class="w"> </span><span class="nv">inf</span><span class="w"> </span><span class="o">÷</span><span class="nv">_InDef</span><span class="w"> </span><span class="m">3200</span><span class="w"> </span><span class="m">4300</span><span class="w"> </span><span class="m">3800</span><span class="w"> </span><span class="m">2500</span><span class="w"> </span><span class="m">2500</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 3118.91 4072.92 3480.97 2221.25 2162.86
</span></div></div>
</div>
<p>We can also go forward and back:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">inf</span><span class="w"> </span><span class="o">÷</span><span class="nv">_InDef</span><span class="w"> </span><span class="nv">inf</span><span class="w"> </span><span class="o">×</span><span class="nv">_InDef</span><span class="w"> </span><span class="nv">inv</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2000 5000 6000 4000 2000
</span></div></div>
</div>
<p><a class="reference external" href="#Under">The “Specialist’s Section”</a> describes an interesting <em>user-defined operator</em>.</p>
</div>
</div>
<div class="section" id="more-exercises">
<span id="operators-more-exercises"></span><h2><span class="section-number">11.14. </span>More Exercises<a class="headerlink" href="#more-exercises" title="Permalink to this headline">#</a></h2>
<div class="exercise admonition" id="trim-long-subvectors">

<p class="admonition-title"><span class="caption-number">Exercise 11.14 </span></p>
<div class="section" id="exercise-content">
<p>Write a function that receives a vector of vectors and returns the same vector of vectors, but all the subvectors that had a length of four or more were replaced by their first three elements.
How would you have to implement this function if you wanted to use the operator <em>at</em>?</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TrimLong</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="kt">{</span><span class="m">3</span><span class="o">↑</span><span class="na">¨</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">@</span><span class="p">(</span><span class="kt">{</span><span class="m">3</span><span class="o">&lt;≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="p">))</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍳</span><span class="na">¨</span><span class="o">⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬───────┬─────────┐
│1│1 2│1 2 3│1 2 3 4│1 2 3 4 5│
└─┴───┴─────┴───────┴─────────┘
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TrimLong</span><span class="w"> </span><span class="o">⍳</span><span class="na">¨</span><span class="o">⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬─────┬─────┐
│1│1 2│1 2 3│1 2 3│1 2 3│
└─┴───┴─────┴─────┴─────┘
</span></div></div>
</div>
<div class="exercise admonition" id="rank">

<p class="admonition-title"><span class="caption-number">Exercise 11.15 </span></p>
<div class="section" id="exercise-content">
<p>The cuboid <code class="docutils literal notranslate"><span class="pre">prod</span></code>, shown below, contains production data for 5 years of production, on 2 assembly lines, across the 12 months of the year.
To each <em>major cell</em> of <code class="docutils literal notranslate"><span class="pre">prod</span></code>, add information about the total production in each assembly line (across the 12 months) and for each month (across the 2 assembly lines).
Try to solve this problem without using <em>axis</em>.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">prod</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">12</span><span class="o">⍴</span><span class="m">50</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36
34 19 32 12 37 15 46 24 49 28 36  9

29  5 45 23 27  4 23 16 39 22 22  2
46 20 47 17 18 25 13 38 42 38 45 28

37 19  5 10 30 49 16 18 46 47 47  3
39 23 41 20  6 40 21 22 40 49 20  1

13 36 12 40 12 15 24 20 21 12 19 25
 8 48 22 37 33  1 39 30 50 50  8 35

38 31 24 40 23  7 20 34 35  6 19 27
41  1 14 50 17 42  6 35 12 48 30 29
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Totalise</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">m</span><span class="o">,</span><span class="na">⍤</span><span class="m">¯1</span><span class="o">+</span><span class="na">/⍤</span><span class="m">2</span><span class="o">⊢</span><span class="nv">m</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">⍪</span><span class="na">⍤</span><span class="m">¯1</span><span class="o">+</span><span class="na">⌿⍤</span><span class="m">2</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Totalise</span><span class="w"> </span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36 297
34 19 32 12 37 15 46 24 49 28 36  9 341
43 35 74 62 39 18 57 69 66 65 65 45 638

29  5 45 23 27  4 23 16 39 22 22  2 257
46 20 47 17 18 25 13 38 42 38 45 28 377
75 25 92 40 45 29 36 54 81 60 67 30 634

37 19  5 10 30 49 16 18 46 47 47  3 327
39 23 41 20  6 40 21 22 40 49 20  1 322
76 42 46 30 36 89 37 40 86 96 67  4 649

13 36 12 40 12 15 24 20 21 12 19 25 249
 8 48 22 37 33  1 39 30 50 50  8 35 361
21 84 34 77 45 16 63 50 71 62 27 60 610

38 31 24 40 23  7 20 34 35  6 19 27 304
41  1 14 50 17 42  6 35 12 48 30 29 325
79 32 38 90 40 49 26 69 47 54 49 56 629
</span></div></div>
</div>
<div class="exercise admonition" id="cross-count-key">

<p class="admonition-title"><span class="caption-number">Exercise 11.16 </span></p>
<div class="section" id="exercise-content">
<p>Recall the vectors <code class="docutils literal notranslate"><span class="pre">status</span></code> and <code class="docutils literal notranslate"><span class="pre">graduated</span></code>:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code> – a character vector specifying a person’s marital status (Single, Married, Divorced, Widow, Unknown); and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">graduated</span></code> – a character vector specifying if the person has graduated or not (Yes/No).</p></li>
</ol>
<p>Write a function to count how many people are in each category, but make use of the operator <em>key</em>.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">CrossCountKey</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">statusOrder</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;SMDWU&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;YN&#39;</span><span class="o">,</span><span class="bp">⍺</span><span class="p">)</span><span class="w"> </span><span class="kt">{{</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">statusOrder</span><span class="o">,</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="s1">&#39;  &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">base</span><span class="w"></span>
<span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="o">⍪</span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">⌿</span><span class="nv">base</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">statusOrder</span><span class="o">,⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">⍪</span><span class="p">(</span><span class="s1">&#39;YN&#39;</span><span class="o">,⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">base</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">↑</span><span class="nv">status</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;SMDWU&#39;</span><span class="sr">[</span><span class="o">?</span><span class="m">300</span><span class="o">⍴</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">SMMMDDUSUU
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">↑</span><span class="nv">graduated</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;YN&#39;</span><span class="sr">[</span><span class="o">?</span><span class="m">300</span><span class="o">⍴</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">YNNNNNYYYY
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="nv">CrossCountKey</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬──┬──┬──┬──┬──┬─────┐
│     │S │M │D │W │U │Total│
├─────┼──┼──┼──┼──┼──┼─────┤
│Y    │31│28│31│32│36│158  │
├─────┼──┼──┼──┼──┼──┼─────┤
│N    │26│27│37│24│28│142  │
├─────┼──┼──┼──┼──┼──┼─────┤
│Total│57│55│68│56│64│300  │
└─────┴──┴──┴──┴──┴──┴─────┘
</span></div></div>
</div>
<div class="exercise admonition" id="house-market-sales">

<p class="admonition-title"><span class="caption-number">Exercise 11.17 </span></p>
<div class="section" id="exercise-content">
<p>The matrix <code class="docutils literal notranslate"><span class="pre">data</span></code> below contains house sales data for a real estate company.
The data pertains to the years 2016, 2017, and 2018, across the 4 quarters of each year, for three locations: Lisbon, Madrid, and Berlin.
Each row in the matrix contains the year, the quarter, the location (3 letter code), and the value of a sale a real estate company made, in thousands of euros.</p>
<p>Answer these questions:</p>
<ul class="simple">
<li><p>What was the most expensive house sold in each city, per year?</p></li>
<li><p>How many sales did the real estate company make per year and per quarter?</p></li>
<li><p>What was the volume of sales per year in millions of euros? What about per year and per location?</p></li>
</ul>
<p>To help you verify your answers, here are partial answers:</p>
<ul class="simple">
<li><p>In 2017, the most expensive houses in thousands of euros, were 353 in Lisbon, 396 in Berlin, and 400 in Madrid.</p></li>
<li><p>In 2017, the real estate company made 5, 8, 4, and 13, sales per quarter, respectively in quarters 1 through 4.</p></li>
<li><p>The volume of sales, in millions of euros, was 8.605 in 2016.</p></li>
<li><p>The volume of sales, in millions of euros, in Berlin was 3.838, 3.643, and 3.613, respectively in 2016, 2017, and 2018.</p></li>
</ul>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">data</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍉↑</span><span class="p">(</span><span class="m">2015</span><span class="o">+?</span><span class="m">103</span><span class="o">⍴</span><span class="m">3</span><span class="p">)(</span><span class="o">?</span><span class="m">103</span><span class="o">⍴</span><span class="m">4</span><span class="p">)((</span><span class="s1">&#39;LIS&#39;</span><span class="w"> </span><span class="s1">&#39;MAD&#39;</span><span class="w"> </span><span class="s1">&#39;BER&#39;</span><span class="p">)</span><span class="sr">[</span><span class="o">?</span><span class="m">103</span><span class="o">⍴</span><span class="m">3</span><span class="sr">]</span><span class="p">)(</span><span class="o">?</span><span class="m">100</span><span class="o">+</span><span class="m">103</span><span class="o">⍴</span><span class="m">300</span><span class="p">)</span><span class="w"></span>
<span class="nv">header</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Year&#39;</span><span class="w"> </span><span class="s1">&#39;Quarter&#39;</span><span class="w"> </span><span class="s1">&#39;Location&#39;</span><span class="w"> </span><span class="s1">&#39;Sale&#39;</span><span class="w"></span>
<span class="nv">header</span><span class="o">⍪</span><span class="m">10</span><span class="o">↑</span><span class="nv">data</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───────┬────────┬────┐
│Year│Quarter│Location│Sale│
├────┼───────┼────────┼────┤
│2016│3      │BER     │73  │
├────┼───────┼────────┼────┤
│2017│4      │MAD     │400 │
├────┼───────┼────────┼────┤
│2018│2      │BER     │170 │
├────┼───────┼────────┼────┤
│2017│1      │BER     │306 │
├────┼───────┼────────┼────┤
│2018│2      │BER     │386 │
├────┼───────┼────────┼────┤
│2016│3      │LIS     │256 │
├────┼───────┼────────┼────┤
│2018│4      │MAD     │67  │
├────┼───────┼────────┼────┤
│2018│3      │BER     │395 │
├────┼───────┼────────┼────┤
│2017│4      │MAD     │365 │
├────┼───────┼────────┼────┤
│2017│4      │BER     │293 │
└────┴───────┴────────┴────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;Most expensive house&#39;</span><span class="w"> </span><span class="m">2016</span><span class="w"> </span><span class="m">2017</span><span class="w"> </span><span class="m">2018</span><span class="o">⍪</span><span class="nv">data</span><span class="sr">[;</span><span class="m">3</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="m">2016</span><span class="o">,</span><span class="m">2017</span><span class="o">,</span><span class="m">2018</span><span class="o">,</span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="w"> </span><span class="kt">{</span><span class="o">⌈</span><span class="na">⌿</span><span class="o">,</span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">4</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="nv">data</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────────────────┬────┬────┬────┐
│Most expensive house│2016│2017│2018│
├────────────────────┼────┼────┼────┤
│BER                 │385 │396 │395 │
├────────────────────┼────┼────┼────┤
│MAD                 │365 │400 │369 │
├────────────────────┼────┼────┼────┤
│LIS                 │354 │353 │365 │
└────────────────────┴────┴────┴────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;Year&#39;</span><span class="w"> </span><span class="s1">&#39;Q1&#39;</span><span class="w"> </span><span class="s1">&#39;Q2&#39;</span><span class="w"> </span><span class="s1">&#39;Q3&#39;</span><span class="w"> </span><span class="s1">&#39;Q4&#39;</span><span class="o">⍪</span><span class="p">(</span><span class="m">2016</span><span class="o">,</span><span class="m">2017</span><span class="o">,</span><span class="m">2018</span><span class="o">,</span><span class="nv">data</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="kt">{</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="p">(</span><span class="o">⍳</span><span class="m">4</span><span class="p">)</span><span class="o">,</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="nv">data</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──┬──┬──┬──┐
│Year│Q1│Q2│Q3│Q4│
├────┼──┼──┼──┼──┤
│2016│9 │8 │9 │13│
├────┼──┼──┼──┼──┤
│2017│5 │8 │4 │13│
├────┼──┼──┼──┼──┤
│2018│11│11│7 │5 │
└────┴──┴──┴──┴──┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="w"> </span><span class="m">1000</span><span class="o">÷</span><span class="na">⍨</span><span class="o">+</span><span class="na">⌿</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">data</span><span class="sr">[;</span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2016 8.605
2017 7.455
2018 7.054
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="m">1000</span><span class="o">÷</span><span class="na">⍨</span><span class="o">+</span><span class="na">⌿</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">data</span><span class="sr">[;</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───┬─────┐
│2016│BER│3.838│
├────┼───┼─────┤
│2016│LIS│2.447│
├────┼───┼─────┤
│2016│MAD│2.32 │
└────┴───┴─────┘
┌────┬───┬─────┐
│2017│MAD│2.137│
├────┼───┼─────┤
│2017│BER│3.643│
├────┼───┼─────┤
│2017│LIS│1.675│
└────┴───┴─────┘
┌────┬───┬─────┐
│2018│BER│3.613│
├────┼───┼─────┤
│2018│MAD│1.817│
├────┼───┼─────┤
│2018│LIS│1.624│
└────┴───┴─────┘
</span></div></div>
</div>
<div class="exercise admonition" id="minesweeper">

<p class="admonition-title"><span class="caption-number">Exercise 11.18 </span></p>
<div class="section" id="exercise-content">
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Minesweeper_(video_game)">Minesweeper</a> is a logic game in which the player has to pinpoint the location of mines in a rectangular grid.
To help the player, each square that is not a mine gets a clue: an integer from 0 to 8 that identifies how many mines can be found in the 3 by 3 region centred around the clue square.</p>
<p>Write a function <code class="docutils literal notranslate"><span class="pre">MakeClues</span></code> that takes a rectangular Boolean grid indicating the positions of the mines and returns the rectangular grid with the clues superimposed on the grid with mines.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">MakeClues</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">clues</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">+</span><span class="na">⌿</span><span class="s1">&#39;*&#39;</span><span class="o">=,</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">notMines</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="s1">&#39;*&#39;</span><span class="o">≠</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">clues</span><span class="sr">[</span><span class="nv">notMines</span><span class="sr">]</span><span class="na">@</span><span class="nv">notMines</span><span class="o">⊢</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mines</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="s1">&#39;⎕*⎕⎕**⎕⎕*⎕⎕*&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">⎕*⎕⎕
**⎕⎕
*⎕⎕*
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MakeClues</span><span class="w"> </span><span class="nv">mines</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 * 2 0
* * 3 1
* 3 2 *
</span></div></div>
</div>
<div class="exercise admonition" id="stencil-n-wise-reduction">

<p class="admonition-title"><span class="caption-number">Exercise 11.19 </span></p>
<div class="section" id="exercise-content">
<p>Implement <em>n-wise reduction</em> on vectors as a user-defined operator, in terms of <em>stencil</em> and regular <em>reductions</em>.</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_NWiseReduce</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">F</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺⍺</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌊</span><span class="p">(</span><span class="bp">⍺</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="o">↓</span><span class="nv">p</span><span class="o">↓</span><span class="kt">{</span><span class="nv">F</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="bp">⍺</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="nv">_NWiseReduce</span><span class="w"> </span><span class="o">⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5 7 9 11 13 15 17 19
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="o">×</span><span class="nv">_NWiseReduce</span><span class="w"> </span><span class="o">⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">24 120
</span></div></div>
</div>
<div class="exercise admonition" id="power-if">

<p class="admonition-title"><span class="caption-number">Exercise 11.20 </span></p>
<div class="section" id="exercise-content">
<p>Implement a dyadic operator called <code class="docutils literal notranslate"><span class="pre">_If_</span></code> that defines a monadic derived function.
In other words, the signature of <code class="docutils literal notranslate"><span class="pre">_If_</span></code> is <code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">_If_</span> <span class="pre">G</span> <span class="pre">right</span></code>.
<code class="docutils literal notranslate"><span class="pre">G</span></code> must be a monadic Boolean function.
If <code class="docutils literal notranslate"><span class="pre">G</span> <span class="pre">right</span></code> gives 1, then we return <code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">right</span></code>, otherwise we return just <code class="docutils literal notranslate"><span class="pre">right</span></code>.
Try to implement <code class="docutils literal notranslate"><span class="pre">_If_</span></code> in terms of the operator <em>power</em>.</p>
</div>
</div>
<p>For an extra challenge, after solving the exercise above, try to make the derived function <code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">_If_</span> <span class="pre">G</span></code> ambivalent:</p>
<ul class="simple">
<li><p>if there is only the right argument <code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">_If_</span> <span class="pre">G</span> <span class="pre">right</span></code> then we get <code class="docutils literal notranslate"><span class="pre">F</span> <span class="pre">right</span></code> if <code class="docutils literal notranslate"><span class="pre">G</span> <span class="pre">right</span></code> is 1 otherwise we get just <code class="docutils literal notranslate"><span class="pre">right</span></code>; and</p></li>
<li><p>if there is also the left argument <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F</span> <span class="pre">_If_</span> <span class="pre">G</span> <span class="pre">right</span></code>, then we get <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">F</span> <span class="pre">right</span></code> if <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">G</span> <span class="pre">right</span></code> is 1 otherwise we get just <code class="docutils literal notranslate"><span class="pre">right</span></code>.</p></li>
</ul>
<p>Beware that this is not an easy challenge, but the solution you will be shown involves a pattern that is worth knowing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_If_</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="bp">⍺</span><span class="w"> </span><span class="p">(</span><span class="bp">⍺⍺</span><span class="na">⍣</span><span class="p">(</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵⍵</span><span class="w"> </span><span class="bp">⍵</span><span class="p">))</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TimesTen</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">10</span><span class="o">×</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">IsSmall</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="o">&lt;</span><span class="m">10</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TimesTen</span><span class="w"> </span><span class="nv">_If_</span><span class="w"> </span><span class="nv">IsSmall</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">50
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TimesTen</span><span class="w"> </span><span class="nv">_If_</span><span class="w"> </span><span class="nv">IsSmall</span><span class="w"> </span><span class="m">12</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
</span></div></div>
</div>
</div>
<div class="section" id="the-specialist-s-section">
<span id="operators-the-specialists-section"></span><h2><span class="section-number">11.15. </span>The Specialist’s Section<a class="headerlink" href="#the-specialist-s-section" title="Permalink to this headline">#</a></h2>
<br />
<center><i>Each chapter is followed by a "Specialist's Section" like this one. This section is dedicated to skilled APLers who wish to improve their knowledge.</i>
<p>You will find here rare or complex usages of the concepts presented in this chapter, or discover extended explanations which need the knowledge of some symbols that will be seen much further in the book.</p>
<p><b>If you are exploring APL for the first time, skip this section and go to the next chapter.</b></center></p>
<div class="section" id="reduction-applied-to-empty-vectors">
<span id="operators-reduction-applied-to-empty-vectors"></span><h3><span class="section-number">11.15.1. </span>Reduction Applied to Empty Vectors<a class="headerlink" href="#reduction-applied-to-empty-vectors" title="Permalink to this headline">#</a></h3>
<div class="section" id="operators-identities">
<span id="identities"></span><h4><span class="section-number">11.15.1.1. </span>Identities<a class="headerlink" href="#operators-identities" title="Permalink to this headline">#</a></h4>
<p>Suppose we have two numeric vectors <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>, for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="nv">b</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>You can see that</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">a</span><span class="o">,</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23
</span></div></div>
</div>
<p>is equal to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">a</span><span class="o">,+</span><span class="na">/</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23
</span></div></div>
</div>
<p>Similarly,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="nv">a</span><span class="o">,</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1008
</span></div></div>
</div>
<p>is equal to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="nv">a</span><span class="o">,×</span><span class="na">/</span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1008
</span></div></div>
</div>
<p>In general, for any two vectors <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and for any valid dyadic function <code class="docutils literal notranslate"><span class="pre">F</span></code>, the expressions <code class="docutils literal notranslate"><span class="pre">F/a,b</span></code> and <code class="docutils literal notranslate"><span class="pre">F/a,F/b</span></code> give the same result.
To see why this is the case, recall that the expression <code class="docutils literal notranslate"><span class="pre">F/a,b</span></code> reduces all the elements in the vector <code class="docutils literal notranslate"><span class="pre">a,b</span></code> from right to left, which means that we start by reducing the values in <code class="docutils literal notranslate"><span class="pre">b</span></code> and then we move on to the values in <code class="docutils literal notranslate"><span class="pre">a</span></code>.
So, the expression <code class="docutils literal notranslate"><span class="pre">F/a,F/b</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">F/a,b</span></code> because <code class="docutils literal notranslate"><span class="pre">F/b</span></code> represents a partial result in the computation of <code class="docutils literal notranslate"><span class="pre">F/a,b</span></code>.</p>
<p>If the vector <code class="docutils literal notranslate"><span class="pre">b</span></code> is the empty vector, then we see that <code class="docutils literal notranslate"><span class="pre">a,b</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">a</span></code>, which means that <code class="docutils literal notranslate"><span class="pre">F/a</span> <span class="pre">←→</span> <span class="pre">F/a,b</span> <span class="pre">←→</span> <span class="pre">F/a,F/b</span></code>.
We can use this equivalence to determine what <code class="docutils literal notranslate"><span class="pre">F/b</span></code> should give when <code class="docutils literal notranslate"><span class="pre">b</span></code> is the empty vector, because <code class="docutils literal notranslate"><span class="pre">F/a</span> <span class="pre">←→</span> <span class="pre">F/a,F/b</span></code> shows that <code class="docutils literal notranslate"><span class="pre">F/b</span></code> should be a value that can be appended to <code class="docutils literal notranslate"><span class="pre">a</span></code> and that will <strong>not</strong> change the result of the reduction.</p>
<p>For example, in <em>plus-reductions</em>, we see that <code class="docutils literal notranslate"><span class="pre">+/⍬</span></code> must be 0 because 0 is the <em>identity element</em> of addition.
In other words, 0 is the element that does not change the result of an addition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">a</span><span class="o">,+</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">a</span><span class="o">,</span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<p>Similarly, in <em>times-reductions</em>, we see that <code class="docutils literal notranslate"><span class="pre">×/⍬</span></code> must be 1 because 1 is the <em>identity element</em> of multiplication.
In other words, 1 is the number that does not change the result of a multiplication:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="nv">a</span><span class="o">,×</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="nv">a</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8
</span></div></div>
</div>
</div>
<div class="section" id="rule">
<span id="operators-rule"></span><h4><span class="section-number">11.15.1.2. </span>Rule<a class="headerlink" href="#rule" title="Permalink to this headline">#</a></h4>
<p>The reduction of an empty vector by any dyadic <strong>primitive</strong> function <code class="docutils literal notranslate"><span class="pre">F</span></code> returns the <em>identity element</em> of that function <code class="docutils literal notranslate"><span class="pre">F</span></code> (0 for <em>addition</em>, 1 for <em>multiplication</em>, etc…).
If <code class="docutils literal notranslate"><span class="pre">F</span></code> has no <em>identity element</em>, a <code class="docutils literal notranslate"><span class="pre">DOMAIN</span> <span class="pre">ERROR</span></code> is issued.</p>
</div>
<div class="section" id="examples">
<span id="operators-examples"></span><h4><span class="section-number">11.15.1.3. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">#</a></h4>
<p>Some <em>identity elements</em> are obvious:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Some others may need a little explanation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.79769E308
</span></div></div>
</div>
<p>The <em>identity element</em> of the function <em>minimum</em> is the largest possible value that APL can represent in your computer, because any other number compared to it will be smaller.</p>
<p>A similar reasoning explains the <em>identity element</em> of the function <em>maximum</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.79769E308
</span></div></div>
</div>
</div>
<div class="section" id="non-commutative-functions">
<span id="operators-non-commutative-functions"></span><h4><span class="section-number">11.15.1.4. </span>Non-Commutative Functions<a class="headerlink" href="#non-commutative-functions" title="Permalink to this headline">#</a></h4>
<p>The examples we have seen above involved <em>commutative</em> functions.
Things become more complicated with <em>non-commutative</em> functions because, in general, you will get different results if you swap the arguments to a non-commutative function.
Thus, a value that works as an <em>identity element</em> if used as the left argument cannot be expected to be an <em>identity element</em> when used as a right argument.</p>
<p>So, a non-commutative function may have</p>
<ul class="simple">
<li><p>an identity value that works as left argument (a left identity element);</p></li>
<li><p>an identity value that works as right argument (a right identity element); or</p></li>
<li><p>no identity at all.</p></li>
</ul>
<p>Here are some examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The right identity element of the function <em>power</em> is 1 because any number raised to the power of 1 gives the same number, but the function <em>power</em> has no left identity element.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌽</span><span class="na">/</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>The function <em>rotate</em> has the left identity element 0 because a rotation of 0 leaves any array unchanged, but the function <em>rotate</em> has no right identity element.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="na">//</span><span class="no">⍬</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The function <em>compress</em> has the left identity element 1 because an array compressed with 1 is preserved, but the function <em>compress</em> does not have a right identity element.</p>
</div>
<div class="section" id="application-to-n-wise-reduction">
<span id="operators-application-to-n-wise-reduction"></span><h4><span class="section-number">11.15.1.5. </span>Application to n-Wise Reduction<a class="headerlink" href="#application-to-n-wise-reduction" title="Permalink to this headline">#</a></h4>
<p>The properties described above explain the results returned by <em>n-wise reduction</em> when its left argument is 0.</p>
<p>Let us just explore how it processes vectors: we saw earlier that the result size of <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">F/</span> <span class="pre">vector</span></code> is <code class="docutils literal notranslate"><span class="pre">(1+≢vector)-n</span></code>.
If <code class="docutils literal notranslate"><span class="pre">n</span></code> is 0, the result size is <code class="docutils literal notranslate"><span class="pre">1+≢vector</span></code>.
And, if <code class="docutils literal notranslate"><span class="pre">n</span></code> is 0, the slices are all empty.
Hence, the result is composed of <em>identity elements</em> of the function in question (if such an <em>identity element</em> exists, of course):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="nv">vec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="o">×</span><span class="na">/</span><span class="w"> </span><span class="nv">vec</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1 1
</span></div></div>
</div>
</div>
</div>
<div class="section" id="index-origin-and-axis-operator">
<span id="operators-index-origin-and-axis-operator"></span><h3><span class="section-number">11.15.2. </span>Index Origin and Axis Operator<a class="headerlink" href="#index-origin-and-axis-operator" title="Permalink to this headline">#</a></h3>
<p>Changing <em>index origin</em> has an impact on the use of <em>axis</em>.
For example, with the default value <code class="docutils literal notranslate"><span class="pre">⎕IO</span> <span class="pre">←</span> <span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="o">,</span><span class="sr">[</span><span class="m">1.5</span><span class="sr">]</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 7
4 3
1 6
</span></div></div>
</div>
<p>If we change the <em>index origin</em>, we have to adjust the operand to <em>axis</em> accordingly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="nv">a</span><span class="w"> </span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 7
4 3
1 6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="w"> </span><span class="o">,</span><span class="sr">[</span><span class="m">¯.5</span><span class="sr">]</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 4 1
7 3 6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="nv">a</span><span class="w"> </span><span class="o">,</span><span class="sr">[</span><span class="m">.5</span><span class="sr">]</span><span class="w"> </span><span class="nv">b</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 4 1
7 3 6
</span></div></div>
</div>
<p>For this reason, when an operation applies to the first or the last dimension of an array, it is recommended to use the special symbols rather than specifying an axis, as the special symbols work independently of <code class="docutils literal notranslate"><span class="pre">⎕IO</span></code>.</p>
<p>To apply the function along the last dimension (the default), use <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">,</span></code>, <code class="docutils literal notranslate"><span class="pre">⌽</span></code>, <code class="docutils literal notranslate"><span class="pre">\</span></code>.
To apply the function along the first dimension, use <code class="docutils literal notranslate"><span class="pre">⌿</span></code>, <code class="docutils literal notranslate"><span class="pre">⍪</span></code>, <code class="docutils literal notranslate"><span class="pre">⊖</span></code>, <code class="docutils literal notranslate"><span class="pre">⍀</span></code>.</p>
<p>We had already mentioned in <a class="reference internal" href="Working-on-Data-Shape.html#working-on-data-shape-more-about-laminate"><span class="std std-numref">Section 8.8.1</span></a> that a fractional <em>axis</em> used with <em>laminate</em>, <em>ravel with axis</em>, or <em>mix</em>, sometimes has to be negative when <code class="docutils literal notranslate"><span class="pre">⎕IO</span></code> is set to zero.
Above, we saw another example of that.</p>
</div>
<div class="section" id="rank-outer-products">
<span id="operators-rank-outer-products"></span><h3><span class="section-number">11.15.3. </span>Rank Outer Products<a class="headerlink" href="#rank-outer-products" title="Permalink to this headline">#</a></h3>
<p>The operator <em>rank</em> can be used in an interesting pattern to implement an <em>outer product</em> on arbitrary cells.
The operator <em>outer product</em> combines all the 0-cells of the left and right arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="na">∘.</span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┐
│1 A│1 B│1 C│1 D│
├───┼───┼───┼───┤
│1 E│1 F│1 G│1 H│
├───┼───┼───┼───┤
│1 I│1 J│1 K│1 L│
└───┴───┴───┴───┘
┌───┬───┬───┬───┐
│2 A│2 B│2 C│2 D│
├───┼───┼───┼───┤
│2 E│2 F│2 G│2 H│
├───┼───┼───┼───┤
│2 I│2 J│2 K│2 L│
└───┴───┴───┴───┘
</span></div></div>
</div>
<p>By using the operator <em>rank</em> in the appropriate way, we can create an <em>outer product</em> that operates on the j-cells of the left argument and the k-cells of the right argument.
For example let us combine all rows of this matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="nf">⎕A</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ABCD
EFGH
</span></div></div>
</div>
<p>With all the sub-matrices of this cuboid:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="o">⍴⍳</span><span class="m">60</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 1  2  3  4  5
 6  7  8  9 10
11 12 13 14 15
16 17 18 19 20

21 22 23 24 25
26 27 28 29 30
31 32 33 34 35
36 37 38 39 40

41 42 43 44 45
46 47 48 49 50
51 52 53 54 55
56 57 58 59 60
</span></div></div>
</div>
<p>So, we want to apply <code class="docutils literal notranslate"><span class="pre">F</span></code> to all combinations of 1-cells of the array <code class="docutils literal notranslate"><span class="pre">mat</span></code> and 2-cells of the array <code class="docutils literal notranslate"><span class="pre">cuboid</span></code>.
To implement this <em>outer product</em> pattern, we use the operator <em>rank</em> once on <code class="docutils literal notranslate"><span class="pre">F</span></code> to apply <code class="docutils literal notranslate"><span class="pre">F</span></code> to all 2-cells of the right argument while leaving the left argument intact:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">99</span><span class="w"> </span><span class="m">2</span><span class="o">⊢</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──────────────┐
│ABCD│ 1  2  3  4  5│
│EFGH│ 6  7  8  9 10│
│    │11 12 13 14 15│
│    │16 17 18 19 20│
├────┼──────────────┤
│ABCD│21 22 23 24 25│
│EFGH│26 27 28 29 30│
│    │31 32 33 34 35│
│    │36 37 38 39 40│
├────┼──────────────┤
│ABCD│41 42 43 44 45│
│EFGH│46 47 48 49 50│
│    │51 52 53 54 55│
│    │56 57 58 59 60│
└────┴──────────────┘
</span></div></div>
</div>
<p>Then, we use the operator <em>rank</em> once more to apply the function <code class="docutils literal notranslate"><span class="pre">F⍤99</span> <span class="pre">2</span></code> to the 1-cells of the left argument while leaving the right argument intact:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">99</span><span class="w"> </span><span class="m">2</span><span class="na">⍤</span><span class="m">1</span><span class="w"> </span><span class="m">99</span><span class="o">⊢</span><span class="w"> </span><span class="nv">cuboid</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──────────────┐
│ABCD│ 1  2  3  4  5│
│    │ 6  7  8  9 10│
│    │11 12 13 14 15│
│    │16 17 18 19 20│
├────┼──────────────┤
│ABCD│21 22 23 24 25│
│    │26 27 28 29 30│
│    │31 32 33 34 35│
│    │36 37 38 39 40│
├────┼──────────────┤
│ABCD│41 42 43 44 45│
│    │46 47 48 49 50│
│    │51 52 53 54 55│
│    │56 57 58 59 60│
└────┴──────────────┘
┌────┬──────────────┐
│EFGH│ 1  2  3  4  5│
│    │ 6  7  8  9 10│
│    │11 12 13 14 15│
│    │16 17 18 19 20│
├────┼──────────────┤
│EFGH│21 22 23 24 25│
│    │26 27 28 29 30│
│    │31 32 33 34 35│
│    │36 37 38 39 40│
├────┼──────────────┤
│EFGH│41 42 43 44 45│
│    │46 47 48 49 50│
│    │51 52 53 54 55│
│    │56 57 58 59 60│
└────┴──────────────┘
</span></div></div>
</div>
<p>The 99 in the operand of <em>rank</em> is to ensure that we capture the whole argument, regardless of the argument we end up using.
If we know beforehand what are the ranks of the arguments, we do not need to use the value 99.</p>
<p>To conclude, if you want to apply the function <code class="docutils literal notranslate"><span class="pre">F</span></code> to all combinations of j-cells of the left argument with k-cells of the right argument, use <code class="docutils literal notranslate"><span class="pre">F⍤99</span> <span class="pre">k⍤j</span> <span class="pre">99</span></code>.</p>
<p>A useful example of this pattern is <code class="docutils literal notranslate"><span class="pre">F⍤99</span> <span class="pre">¯1⍤¯1</span> <span class="pre">99</span></code>, which is the <em>outer product</em> between <em>major cells</em> of the left and right arguments.</p>
</div>
<div class="section" id="the-full-rank-specification">
<span id="operators-the-full-rank-specification"></span><h3><span class="section-number">11.15.4. </span>The Full Rank Specification<a class="headerlink" href="#the-full-rank-specification" title="Permalink to this headline">#</a></h3>
<p>The full specification of the operator <em>rank</em> says that the right operand can be an integer vector with up to three elements.
In its most general form, we have <code class="docutils literal notranslate"><span class="pre">F⍤p</span> <span class="pre">q</span> <span class="pre">r</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">p</span></code> specifies the rank of the argument cells when <code class="docutils literal notranslate"><span class="pre">F</span></code> is applied monadically;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">q</span></code> specifies the rank of the left argument cells when <code class="docutils literal notranslate"><span class="pre">F</span></code> is applied dyadically; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r</span></code> specifies the rank of the right argument cells when <code class="docutils literal notranslate"><span class="pre">F</span></code> is applied dyadically.</p></li>
</ul>
<p>The form <code class="docutils literal notranslate"><span class="pre">F⍤r</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">F⍤r</span> <span class="pre">r</span> <span class="pre">r</span></code> and the form <code class="docutils literal notranslate"><span class="pre">F⍤q</span> <span class="pre">r</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">F⍤r</span> <span class="pre">q</span> <span class="pre">r</span></code>.</p>
</div>
<div class="section" id="optimised-left-operands-for-stencil">
<span id="operators-optimised-left-operands-for-stencil"></span><h3><span class="section-number">11.15.5. </span>Optimised Left Operands for Stencil<a class="headerlink" href="#optimised-left-operands-for-stencil" title="Permalink to this headline">#</a></h3>
<p>The operator <em>stencil</em> recognises certain left operand functions and runs specialised code in those cases, resulting in much faster execution times for those cases.</p>
<p>The simplest special left operand is <code class="docutils literal notranslate"><span class="pre">{⍵}</span></code> and we show the speed up it gets from the special code recognition.
To do this comparison, we need to “break” the special code recognition without adding code that slows down the timing comparisons.
Typically, adding the <em>identity</em> is enough, but <code class="docutils literal notranslate"><span class="pre">{⊢⍵}</span></code> is also special-cased, so we need to add two <em>right tacks</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">100</span><span class="w"> </span><span class="m">200</span><span class="o">⍴</span><span class="m">0</span><span class="w"></span>
<span class="sr">]</span><span class="nv">runtime</span><span class="w"> </span><span class="o">-</span><span class="nv">c</span><span class="w"> </span><span class="s2">&quot;{⍵}⌺3 5⊢mat&quot;</span><span class="w"> </span><span class="s2">&quot;{⊢⍵}⌺3 5⊢mat&quot;</span><span class="w"> </span><span class="s2">&quot;{⊢⊢⍵}⌺3 5⊢mat&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">                                                                            
  {⍵}⌺3 5⊢mat   → 3.4E¯4 |      0%                                          
  {⊢⍵}⌺3 5⊢mat  → 2.7E¯4 |    -21%                                          
  {⊢⊢⍵}⌺3 5⊢mat → 3.5E¯2 | +10186% ⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕ 
</span></div></div>
</div>
<p>The special left operands are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{⊢⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{,⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{⊂⍵}</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{+/,⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{∧/,⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{∨/,⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{=/,⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{≠/,⍵}</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{</span>&#160; <span class="pre">+/,A×⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{</span>&#160; <span class="pre">+/⍪A×⍤2⊢⍵}</span></code>; and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{C&lt;+/,A×⍵}</span></code>, <code class="docutils literal notranslate"><span class="pre">{C&lt;+/⍪A×⍤2⊢⍵}</span></code>.</p></li>
</ul>
<p>In the above, we have that:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">C</span></code> is a single number or a variable whose value is a single number;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">A</span></code> is a variable whose value is a rank-2 or rank-3 array;</p></li>
<li><p>the comparison can be any of <code class="docutils literal notranslate"><span class="pre">&lt;</span> <span class="pre">≤</span> <span class="pre">≥</span> <span class="pre">&gt;</span> <span class="pre">=</span> <span class="pre">≠</span></code>; and</p></li>
<li><p>the operator is assumed to be applied with odd window size, movement 1, and matrix argument.</p></li>
</ul>
</div>
<div class="section" id="inverting-functions-with-the-operator-power">
<span id="operators-inverting-functions-with-the-operator-power"></span><h3><span class="section-number">11.15.6. </span>Inverting Functions with the Operator Power<a class="headerlink" href="#inverting-functions-with-the-operator-power" title="Permalink to this headline">#</a></h3>
<p>In <a class="reference internal" href="#operators-inverse-function"><span class="std std-numref">Section 11.11.4</span></a> we learned that the operator <em>power</em> can invert functions that are primitive functions modified with primitive operators.
We must note that the operator <em>power</em> can also invert functions that contain the operators <em>beside</em> <code class="docutils literal notranslate"><span class="pre">∘</span></code>, <em>atop</em> <code class="docutils literal notranslate"><span class="pre">⍤</span></code>, <em>over</em> <code class="docutils literal notranslate"><span class="pre">⍥</span></code>, and <em>commute</em> <code class="docutils literal notranslate"><span class="pre">⍨</span></code>.</p>
<p>It is also worth noting that the operator <em>power</em> can invert some tacit functions, provided the primitives that make up the tacit function can be inverted.
This is not a sufficient condition, but it is necessary.</p>
<p>Here is an example with a short numerical tacit function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="p">(</span><span class="o">*+×</span><span class="p">)</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">42
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="p">(</span><span class="o">*+×</span><span class="p">)</span><span class="na">⍣</span><span class="m">¯1</span><span class="o">⊢</span><span class="w"> </span><span class="m">42</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
</div>
<div class="section" id="under">
<span id="operators-under"></span><h3><span class="section-number">11.15.7. </span>Under<a class="headerlink" href="#under" title="Permalink to this headline">#</a></h3>
<p>In mathematics, physics, and other domains, there are many cases in which one wants to apply a given transformation <code class="docutils literal notranslate"><span class="pre">F</span></code>, but first some pre-processing must be applied, then one can apply <code class="docutils literal notranslate"><span class="pre">F</span></code>, and then the pre-processing must be undone.</p>
<p>For example, in electricity, the effective resistance of n resistors connected in parallel is the inverse of the sum of the inverses of the individual resistors’ resistances.
By chance, the function <em>reciprocal</em> <code class="docutils literal notranslate"><span class="pre">÷</span></code> is its own inverse.</p>
<p>If the resistance of 5 resistors connected in parallel are given in Ohms in the vector below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">resistances</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Then, the effective resistance can be calculated easily as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Resistance</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">÷+</span><span class="na">/</span><span class="o">÷</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Resistance</span><span class="w"> </span><span class="nv">resistances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.987306
</span></div></div>
</div>
<p>In the example above, the pre-processing that had to be done and then undone was computing the reciprocals of the numbers that we wanted to sum.</p>
<p>An implementation of the <em>bitwise right shift</em> operation exhibits this pattern again.
To implement <em>bitwise right shift</em> we must take the integer we want to shift, convert it to binary, shift its binary representation to the right, and then convert back to decimal.</p>
<p>Here is a possible implementation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RightShift</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">2</span><span class="o">⊥</span><span class="p">(</span><span class="bp">⍺</span><span class="o">⍴</span><span class="m">0</span><span class="p">)</span><span class="o">,</span><span class="na">⍨</span><span class="m">2</span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="nv">RightShift</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">RightShift</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">8
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">RightShift</span><span class="w"> </span><span class="m">124</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">992
</span></div></div>
</div>
<p>An implementation of the <em>bitwise shift left</em> operation would be very similar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">LeftShift</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">2</span><span class="o">⊥</span><span class="p">(</span><span class="o">-</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↓</span><span class="m">2</span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="nv">LeftShift</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="nv">LeftShift</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3</span><span class="w"> </span><span class="nv">LeftShift</span><span class="w"> </span><span class="m">123</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">15
</span></div></div>
</div>
<p>The pattern of doing a pre-processing step <code class="docutils literal notranslate"><span class="pre">P</span></code>, applying a transformation <code class="docutils literal notranslate"><span class="pre">F</span></code>, and then undoing the pre-processing by applying <code class="docutils literal notranslate"><span class="pre">P⍣¯1</span></code> is commonly implemented as the operator <em>under</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_Under_</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="bp">⍵⍵</span><span class="na">⍣</span><span class="m">¯1</span><span class="o">⊢</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍺⍺</span><span class="w"> </span><span class="bp">⍵⍵</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>If we make use of the operator <em>under</em>, we can implement the functions <code class="docutils literal notranslate"><span class="pre">Resistance</span></code>, <code class="docutils literal notranslate"><span class="pre">RightShift</span></code>, and <code class="docutils literal notranslate"><span class="pre">LeftShift</span></code>, in terms of it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Resistance</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">_Under_</span><span class="o">÷</span><span class="w"></span>
<span class="nv">Resistance</span><span class="w"> </span><span class="nv">resistances</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.987306
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RightShift</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="o">,</span><span class="bp">⍺</span><span class="o">⍴</span><span class="m">0</span><span class="kt">}</span><span class="nv">_Under_</span><span class="p">(</span><span class="m">2</span><span class="na">∘</span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="p">)</span><span class="w"></span>
<span class="m">3</span><span class="w"> </span><span class="nv">RightShift</span><span class="w"> </span><span class="m">124</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">992
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">LeftShift</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="o">-</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↓</span><span class="bp">⍵</span><span class="kt">}</span><span class="nv">_Under_</span><span class="p">(</span><span class="m">2</span><span class="na">∘</span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="p">)</span><span class="w"></span>
<span class="m">3</span><span class="w"> </span><span class="nv">LeftShift</span><span class="w"> </span><span class="m">123</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">15
</span></div></div>
</div>
</div>
<div class="section" id="the-result-of-an-inverse-function">
<span id="operators-the-result-of-an-inverse-function"></span><h3><span class="section-number">11.15.8. </span>The Result of an Inverse Function<a class="headerlink" href="#the-result-of-an-inverse-function" title="Permalink to this headline">#</a></h3>
<p>As shown in <a class="reference internal" href="#operators-inverse-function"><span class="std std-numref">Section 11.11.4</span></a>, the derived function returned by the operator <em>power</em> is the <em>inverse</em> of its left operand when the right operand is negative.</p>
<p>Therefore, the following identity is usually true for a function <code class="docutils literal notranslate"><span class="pre">F</span></code> for which an inverse function exists:</p>
<center><code>right ≡ {left} F⍣¯1⊢ left F right</code></center>
<p>For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="o">÷</span><span class="na">⍣</span><span class="m">¯1</span><span class="o">⊢</span><span class="w"> </span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>However, where several possible inverses exist, the “simplest” is chosen.
For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊥</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3
</span></div></div>
</div>
<p>Notice how prepending a 0 does not change the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊥</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3
</span></div></div>
</div>
<p>However, the inverse does not add the zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="o">⊢</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1
</span></div></div>
</div>
<p>The identity we showed holds true:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="m">2</span><span class="o">⊥</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>But not if we include the extra zero, because the inverse function will return a “simpler” inverse:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">≡</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="m">2</span><span class="o">⊥</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>To conclude, notice that <code class="docutils literal notranslate"><span class="pre">2⊤</span></code> is different from <code class="docutils literal notranslate"><span class="pre">2⊥⍣¯1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊤</span><span class="m">3</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>This shows that the use of <em>inverse decode</em> rather than <em>encode</em> allows you to let the system decide how many digits are needed to do the full base conversion.</p>
</div>
<div class="section" id="advanced-uses-of-the-operator-power">
<span id="operators-advanced-uses-of-the-operator-power"></span><h3><span class="section-number">11.15.9. </span>Advanced Uses of the Operator Power<a class="headerlink" href="#advanced-uses-of-the-operator-power" title="Permalink to this headline">#</a></h3>
<p>In its second form, the operator <em>power</em> has two operands: <code class="docutils literal notranslate"><span class="pre">{left}</span> <span class="pre">F⍤C</span> <span class="pre">⊢</span> <span class="pre">right</span></code>.
The right operand <code class="docutils literal notranslate"><span class="pre">C</span></code> must be a dyadic function that returns a Boolean scalar.
The left operand <code class="docutils literal notranslate"><span class="pre">F</span></code> is applied repeatedly like this: <code class="docutils literal notranslate"><span class="pre">v_</span> <span class="pre">←</span> <span class="pre">{left}</span> <span class="pre">F</span> <span class="pre">v</span></code> until the condition <code class="docutils literal notranslate"><span class="pre">v_</span> <span class="pre">C</span> <span class="pre">v</span></code> evaluates to 1.
To start off, <code class="docutils literal notranslate"><span class="pre">v</span></code> is set to <code class="docutils literal notranslate"><span class="pre">right</span></code> and, after reach iteration, <code class="docutils literal notranslate"><span class="pre">v</span></code> is updated with <code class="docutils literal notranslate"><span class="pre">v_</span></code>.
Thus, <code class="docutils literal notranslate"><span class="pre">F⍣C</span></code> computes a series of values in which the left argument to <code class="docutils literal notranslate"><span class="pre">F</span></code> is always <code class="docutils literal notranslate"><span class="pre">left</span></code>, if present, and the right argument to <code class="docutils literal notranslate"><span class="pre">F</span></code> starts off as <code class="docutils literal notranslate"><span class="pre">right</span></code> and then gets successively updated.</p>
<p>To demonstrate this, let us use this extremely silly function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">42</span><span class="w"></span>
<span class="nv">Silly</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;⍺: &#39;</span><span class="o">,</span><span class="bp">⍺</span><span class="o">,</span><span class="s1">&#39;⍵: &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="o">⊢</span><span class="vg">⎕</span><span class="kd">←</span><span class="o">?</span><span class="bp">⍵</span><span class="o">+</span><span class="bp">⍺</span><span class="kt">}</span><span class="w"></span>
<span class="m">10</span><span class="w"> </span><span class="nv">Silly</span><span class="na">⍣</span><span class="o">&gt;</span><span class="w"> </span><span class="m">20</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">⍺:  10 ⍵:  20
11
⍺:  10 ⍵:  11
3
⍺:  10 ⍵:  3
9
9
</span></div></div>
</div>
<p>The output above shows that, in all iterations, the left argument was always 10.
Then, we see that the right argument started off as 20 and then it got successively updated as the result of the previous iteration, so it went from 20 to 11, and then to 3.
When the right argument was 3, the result was 9 and then <code class="docutils literal notranslate"><span class="pre">9</span> <span class="pre">&gt;</span> <span class="pre">3</span></code> evaluated to 1.</p>
<p>If the condition never evaluates to 1, the derived function will continue to execute until it is stopped by a <em>strong interrupt</em>.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">C</span></code> is <code class="docutils literal notranslate"><span class="pre">=</span></code> or <code class="docutils literal notranslate"><span class="pre">≡</span></code>, the result is called the <em>fixed point</em> of the function <code class="docutils literal notranslate"><span class="pre">F</span></code>.</p>
<p>For all the many mathematical iterative calculations that converge towards a final limit, this use of the operator <em>power</em> is certainly something you should consider.</p>
<p>Here is the example of the golden ratio, a mathematical number that can be approximated by the following expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="na">⍣</span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.61803
</span></div></div>
</div>
<p>The golden ration can be defined as the result of the expression that follows, assuming it could have an infinite number of terms:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="na">∘</span><span class="o">÷</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1.61798
</span></div></div>
</div>
<p>By using the <em>fixed point</em> <code class="docutils literal notranslate"><span class="pre">+∘÷⍣=</span></code>, we can approximate the value of the golden ratio by computing the expression with as many terms as the machine precision allows.</p>
</div>
</div>
<div class="section" id="solutions">
<span id="operators-solutions"></span><h2><span class="section-number">11.16. </span>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline">#</a></h2>
<p>The following solutions we propose are not necessarily the “best” ones; perhaps you will find other solutions that we have never considered. APL is a very rich language, and due to the general nature of its primitive functions and operators there are always plenty of different ways to express different solutions to a given problem. Which one is “the best” depends on many things, for example the level of experience of the programmer, the importance of system performance, the required behaviour in border cases, the requirement to meet certain programming standards and also personal preferences. This is one of the reasons why APL is so pleasant to teach and to learn!</p>
<p>We advise you to try and solve the exercises before reading the solutions!</p>
<div class="solution admonition" id="Operators-solution-20">

<p class="admonition-title">Solution to<a class="reference internal" href="#ex-complex-refunding"> Exercise 11.1</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We start by defining a numeric vector with the upper limits and a matrix with the refund rates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">limits</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">600</span><span class="w"> </span><span class="m">1100</span><span class="w"> </span><span class="m">1500</span><span class="w"> </span><span class="m">2000</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">0</span><span class="o">⍕</span><span class="w"> </span><span class="nv">rates</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="m">100</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 100 100  80  50
 100  70  30  10
  80  60  20   5
</span></div></div>
</div>
<p>The next step is rewriting the traditional refund rate table in the modified version.
For example, for category 1 students, expenses up to 2.000 are refunded in 50%, and then there is a 30% additional refund for expenses up to 1.500.
Why is that?
Because the refund rate for expenses up to 1.500 is 80%, and not 50%, meaning there is a difference of 30%.</p>
<p>By using an <em>n-wise reduction</em>, we can subtract each pair of adjacent columns and get these rates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">modifiedRates</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">-</span><span class="na">/</span><span class="w"> </span><span class="nv">rates</span><span class="o">,</span><span class="m">0</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 0 20 30 50
30 40 20 10
20 40 15  5
</span></div></div>
</div>
<p>In the expression above, we added a column of zeroes to the right of <code class="docutils literal notranslate"><span class="pre">rates</span></code>.
This can be interpreted as “all expenses above 2.000 have a refund rate of 0%”.</p>
<p>Now, we compare each student’s expenses with the upper limits of each range:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">capped</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">expenses</span><span class="w"> </span><span class="na">∘.</span><span class="o">⌊</span><span class="w"> </span><span class="nv">limits</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">↑</span><span class="nv">expenses</span><span class="o">,</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">capped</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2121   600 1100 1500 2000
1936   600 1100 1500 1936
 682   600  682  682  682
 818   600  818  818  818
1922   600 1100 1500 1922
1419   600 1100 1419 1419
1389   600 1100 1389 1389
 465   465  465  465  465
1829   600 1100 1500 1829
 221   221  221  221  221
</span></div></div>
</div>
<p>Finally, we are ready to multiply each student’s capped expenses with the appropriate rates.
We just have to be careful to take into account each student’s category to use the appropriate rates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">refunds</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">capped</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="nv">modifiedRates</span><span class="sr">[</span><span class="nv">categories</span><span class="sr">;]</span><span class="w"> </span><span class="o">÷</span><span class="w"> </span><span class="m">100</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="m">10</span><span class="o">↑</span><span class="nv">refunds</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">refunds</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1670 1113.6 657.4 610.8 1112.2 843.8 1036.7 372 1584.5 221
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">309491
</span></div></div>
</div>
<p>To wrap up, we can put everything into a function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">refunds</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">Refund</span><span class="w"> </span><span class="p">(</span><span class="nv">limits</span><span class="w"> </span><span class="nv">rates</span><span class="w"> </span><span class="nv">categories</span><span class="w"> </span><span class="nv">expenses</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="sr">;</span><span class="nv">modifiedRates</span><span class="w"> </span><span class="sr">;</span><span class="nv">capped</span><span class="w"></span>
<span class="w">    </span><span class="nv">modifiedRates</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">-</span><span class="na">/</span><span class="w"> </span><span class="nv">rates</span><span class="o">,</span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="nv">capped</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">expenses</span><span class="w"> </span><span class="na">∘.</span><span class="o">⌊</span><span class="w"> </span><span class="nv">limits</span><span class="w"></span>
<span class="w">    </span><span class="nv">refunds</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">capped</span><span class="w"> </span><span class="o">×</span><span class="w"> </span><span class="nv">modifiedRates</span><span class="sr">[</span><span class="nv">categories</span><span class="sr">;]</span><span class="w"> </span><span class="o">÷</span><span class="w"> </span><span class="m">100</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">↑</span><span class="nv">Refund</span><span class="w"> </span><span class="nv">limits</span><span class="w"> </span><span class="nv">rates</span><span class="w"> </span><span class="nv">categories</span><span class="w"> </span><span class="nv">expenses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1670 1113.6 657.4 610.8 1112.2 843.8 1036.7 372 1584.5 221
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="nv">Refund</span><span class="w"> </span><span class="nv">limits</span><span class="w"> </span><span class="nv">rates</span><span class="w"> </span><span class="nv">categories</span><span class="w"> </span><span class="nv">expenses</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">309491
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-21">

<p class="admonition-title">Solution to<a class="reference internal" href="#reductions"> Exercise 11.2</a></p>
<div class="section" id="solution-content">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌈</span><span class="na">/</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.996049 0.995464 0.997448 0.995455 0.998168 0.989837 0.998023 0.972867 0.991436 0.997907 0.983055 0.998847 0.996739 0.995
      861 0.995326 0.99808 0.999367 0.990154 0.999411 0.994254 0.999527 0.996037 0.998322 0.995728 0.993855 0.99316 0.9991
      9 0.983515 0.988839 0.999845 0.991439 0.997391 0.990559 0.998868 0.998994 0.978796 0.996159 0.999472 0.997361 0.9958
      67 0.998943 0.998081 0.99308 0.992848 0.997828 0.999646 0.997467 0.996576 0.99622 0.983581 0.98676 0.99314 0.990683 
      0.995529 0.997899 0.992508 0.994957 0.993181 0.999817 0.992939 0.994394 0.993252 0.994808 0.989973 0.996322 0.999256
       0.999784 0.999005 0.99679 0.994354 0.991575 0.996636 0.997965 0.980452 0.99877 0.993315 0.998415 0.997657 0.999999 
      0.99976 0.995448 0.996802 0.993511 0.991057 0.995665 0.976344 0.997448 0.995506 0.99362 0.997573 0.990723 0.996999 0
      .993595 0.992018 0.99738 0.999432 0.99859 0.998183 0.996201 0.999802
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌊</span><span class="na">/</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">88.8108
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="w"> </span><span class="o">⌊</span><span class="na">/</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="w"> </span><span class="o">⍴</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20000
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-22">

<p class="admonition-title">Solution to<a class="reference internal" href="#scans"> Exercise 11.3</a></p>
<div class="section" id="solution-content">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">\</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 0 1 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">\</span><span class="w"> </span><span class="o">⌽⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 1 4 2 3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">/</span><span class="w"> </span><span class="o">+</span><span class="na">\</span><span class="w"> </span><span class="m">6</span><span class="o">⍴</span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">720
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-23">

<p class="admonition-title">Solution to<a class="reference internal" href="#Boolean-scans-and-reductions"> Exercise 11.4</a></p>
<div class="section" id="solution-content">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∧</span><span class="na">/</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∧</span><span class="na">\</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">=</span><span class="na">/</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">=</span><span class="na">\</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 1 1
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-24">

<p class="admonition-title">Solution to<a class="reference internal" href="#reverse-engineer-scan"> Exercise 11.5</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The result of <code class="docutils literal notranslate"><span class="pre">×\vec</span></code> has six elements, which means the original vector <code class="docutils literal notranslate"><span class="pre">vec</span></code> also has six elements.
The first element of a <em>scan</em> is the first element of the argument vector, thus the first element of <code class="docutils literal notranslate"><span class="pre">vec</span></code> is <code class="docutils literal notranslate"><span class="pre">7</span></code>.
Finally, each subsequent element of the result is going to be the previous element of the result <em>times</em> the respective element of the original vector <code class="docutils literal notranslate"><span class="pre">vec</span></code>.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">14</span></code> is <code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">×</span> <span class="pre">vec[2]</span></code>, meaning <code class="docutils literal notranslate"><span class="pre">vec[2]</span> <span class="pre">←</span> <span class="pre">14</span> <span class="pre">÷</span> <span class="pre">7</span></code>.
Then, <code class="docutils literal notranslate"><span class="pre">70</span></code> should be <code class="docutils literal notranslate"><span class="pre">14</span> <span class="pre">×</span> <span class="pre">vec[3]</span></code>, meaning <code class="docutils literal notranslate"><span class="pre">vec[3]</span> <span class="pre">←</span> <span class="pre">70</span> <span class="pre">÷</span> <span class="pre">14</span></code>.
And we can keep going, or we can compute everything with a pairwise reduction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">vec</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">7</span><span class="o">,</span><span class="w"> </span><span class="m">¯2</span><span class="w"> </span><span class="o">÷</span><span class="na">/</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">210</span><span class="w"> </span><span class="m">840</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 2 5 3 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">×</span><span class="na">\</span><span class="w"> </span><span class="nv">vec</span><span class="w">  </span><span class="c1">⍝ verification</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 14 70 210 840
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-25">

<p class="admonition-title">Solution to<a class="reference internal" href="#broken-keyboard-iota"> Exercise 11.6</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>To create a vector with the first <code class="docutils literal notranslate"><span class="pre">n</span></code> integers we can create a vector with <code class="docutils literal notranslate"><span class="pre">n</span></code> elements <code class="docutils literal notranslate"><span class="pre">1</span></code> and then do a <em>plus scan</em> on that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Iota</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">+</span><span class="na">\</span><span class="bp">⍵</span><span class="o">⍴</span><span class="m">1</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Iota</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3 4 5 6 7 8 9 10
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-26">

<p class="admonition-title">Solution to<a class="reference internal" href="#triangle-area"> Exercise 11.7</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We can translate the formula directly to APL and add an <em>inner product</em> for good measure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Area</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">s</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0.5</span><span class="o">×+</span><span class="na">/</span><span class="bp">⍵</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="o">×</span><span class="nv">s</span><span class="o">×</span><span class="na">.</span><span class="o">-</span><span class="bp">⍵</span><span class="p">)</span><span class="o">*</span><span class="m">0.5</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Area</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Area</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">24
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-27">

<p class="admonition-title">Solution to<a class="reference internal" href="#all-different"> Exercise 11.8</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The <em>outer product</em> is commonly used when you need to try all different combinations of something, so if you have a vector <code class="docutils literal notranslate"><span class="pre">v</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">∘.=</span> <span class="pre">v</span></code> to compare all items against each other:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 0
0 1 0 0
0 0 1 0
0 0 0 1
</span></div></div>
</div>
<p>If a vector only contains unique vectors, then the resulting Boolean matrix will look like the one shown above: a matrix filled with zeroes with a main diagonal composed of ones.</p>
<p>In this context, it suffices to guarantee that each row, or each column, contains a single <code class="docutils literal notranslate"><span class="pre">1</span></code>, which we can do as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">∧</span><span class="na">.</span><span class="o">=+</span><span class="na">/</span><span class="nv">v</span><span class="na">∘.</span><span class="o">=</span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>This way, we found a solution that uses both an <em>inner product</em> and an <em>outer product</em>.</p>
<div class="solution admonition" id="Operators-solution-28">

<p class="admonition-title">Solution to<a class="reference internal" href="#pairwise-reduction"> Exercise 11.9</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The <em>pairwise equals reduction</em> will verify which adjacent characters are the same:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">=</span><span class="na">/</span><span class="w"> </span><span class="s1">&#39;MASSACHUSSETTS&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 1 0 0 0 0 0 1 0 0 1 0
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-29">

<p class="admonition-title">Solution to<a class="reference internal" href="#word-in-vector"> Exercise 11.10</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The first natural step is comparing each character of the left argument to the whole right argument vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">word</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
<span class="nv">sentence</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;CAN YOU CANCEL MY FLIGHT ON AIR CANADA?&#39;</span><span class="w"></span>
<span class="nv">sentence</span><span class="o">⍪</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">C A N   Y O U   C A N C E L   M Y   F L I G H T   O N   A I R   C A N A D A ?
1 0 0 0 0 0 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0
0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 1 0 1 0
0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0
</span></div></div>
</div>
<p>Then, we see an interesting pattern: the left argument word occurs in the positions where the matrix has a diagonal of ones.
So, what we need to do is look for those diagonals of ones in the matrix that is the result of the <em>outer product</em>.
This is not very easy to do directly, but we can <em>rotate</em> the rows of the matrix independently to try to align the diagonals:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">¯1</span><span class="o">+⍳≢</span><span class="nv">word</span><span class="p">)</span><span class="o">⌽</span><span class="nv">word</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 0 0 0 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0
1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 1 0 1 0 0
1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0
</span></div></div>
</div>
<p>Then we can use an <em>and reduction</em> to verify if the diagonals were complete or not:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸∧</span><span class="na">⌿</span><span class="p">(</span><span class="m">¯1</span><span class="o">+⍳≢</span><span class="nv">word</span><span class="p">)</span><span class="o">⌽</span><span class="nv">word</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 9 33
</span></div></div>
</div>
<p>Putting everything together, we can define our dfn <code class="docutils literal notranslate"><span class="pre">In</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">In</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">⍸∧</span><span class="na">⌿</span><span class="p">(</span><span class="m">¯1</span><span class="o">+⍳≢</span><span class="bp">⍺</span><span class="p">)</span><span class="o">⌽</span><span class="bp">⍺</span><span class="na">∘.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;CAN&#39;</span><span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="s1">&#39;CAN YOU CANCEL MY FLIGHT ON AIR CANADA?&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 9 33
</span></div></div>
</div>
<p>To solve this exercise with an <em>inner product</em>, we can do something different, but similar. But different.</p>
<p>First, we create a matrix with as many rows as the length of the left argument vector, where the sentence in each row has been rotated one character in comparison to the row above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">l</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">≢</span><span class="nv">word</span><span class="w"></span>
<span class="p">(</span><span class="m">¯1</span><span class="o">+⍳</span><span class="nv">l</span><span class="p">)</span><span class="o">⌽</span><span class="nv">l</span><span class="p">(</span><span class="o">≢</span><span class="nv">sentence</span><span class="p">)</span><span class="o">⍴</span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">CAN YOU CANCEL MY FLIGHT ON AIR CANADA?
AN YOU CANCEL MY FLIGHT ON AIR CANADA?C
N YOU CANCEL MY FLIGHT ON AIR CANADA?CA
</span></div></div>
</div>
<p>Next, we use the <em>inner product</em> <code class="docutils literal notranslate"><span class="pre">∧.=</span></code> to look for columns of that matrix that match the word:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="nv">word</span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="p">(</span><span class="m">¯1</span><span class="o">+⍳</span><span class="nv">l</span><span class="p">)</span><span class="o">⌽</span><span class="nv">l</span><span class="p">(</span><span class="o">≢</span><span class="nv">sentence</span><span class="p">)</span><span class="o">⍴</span><span class="nv">sentence</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 9 33
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-30">

<p class="admonition-title">Solution to<a class="reference internal" href="#find-row-in-matrix"> Exercise 11.11</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>One possible way of tackling this problem is by using the <em>axis</em> operator together with <em>equals</em> to compare each row with the vector given:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 1
1 1 1
0 1 1
0 0 0
</span></div></div>
</div>
<p>Then, we can use an <em>and reduction</em> to find rows that are filled with <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∧</span><span class="na">/</span><span class="w"> </span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 0 0
</span></div></div>
</div>
<p>Finally, we use an <em>or reduction</em> to determine if <em>any</em> of the rows matched:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">/</span><span class="o">∧</span><span class="na">/</span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">InMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">∨</span><span class="na">/</span><span class="o">∧</span><span class="na">/</span><span class="bp">⍺</span><span class="o">=</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>Another alternative revolves around understanding that the pattern of <em>and reduction</em> after <em>equals</em> can be written as an <em>inner product</em> that will pair the vector with each row of the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 0 0
</span></div></div>
</div>
<p>After that, we only need the final <em>or reduction</em> to produce the final Boolean result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">InMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">∨</span><span class="na">/</span><span class="bp">⍺</span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-31">

<p class="admonition-title">Solution to<a class="reference internal" href="#in-mat-find-better"> Exercise 11.12</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We can follow the same <em>inner product</em> strategy as in the previous exercise, we just have to make sure we match the dimensions of the left and right arguments of the <em>inner product</em> correctly.
First, notice that we do <em>have</em> to do something:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">9</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="nv">InMat</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
InMat[0] InMat←{∨/⍺∧.=⍵}
                    ∧
</pre></div>
</div>
</div>
</div>
<p>When we learned about the <em>inner product</em>, we learned that the last dimension of the left argument must match the first dimension of the right argument.
So, in order for this <em>inner product</em> to work, we actually need to transpose the right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">9</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="w"> </span><span class="o">⍉</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0
0 1
0 0
</span></div></div>
</div>
<p>By transposing the right argument, we fix this issue.
In a way, when the left and right arguments to an <em>inner product</em> are matrices, it is as if we were combining the rows of the left matrix with the columns of the right matrix.
In the case of the <em>inner product</em> <code class="docutils literal notranslate"><span class="pre">∧.=</span></code>, it is as if we were doing an equality comparison between the rows of the left matrix and the columns of the right matrix.</p>
<p>After transposing the right argument, we need to use <em>reduce-first</em> to determine which rows of the right argument appear in the left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">⌿</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="m">9</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=</span><span class="w"> </span><span class="o">⍉</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="o">⍴⍳</span><span class="m">6</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1
</span></div></div>
</div>
<p>What is also worth noting is that this new implementation will also work when the right argument is just a vector, because the <em>transpose</em> will do nothing in that case, and the final reduction is the same, regardless of it being a <em>first-axis</em> or <em>last-axis</em> reduction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∨</span><span class="na">⌿</span><span class="w"> </span><span class="p">(</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;BANCANDANDIG&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">∧</span><span class="na">.</span><span class="o">=⍉</span><span class="w"> </span><span class="s1">&#39;CAN&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Thus, our solution can be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">InMat2</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">∨</span><span class="na">⌿</span><span class="bp">⍺</span><span class="o">∧</span><span class="na">.</span><span class="o">=⍉</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="solution admonition" id="Operators-solution-32">

<p class="admonition-title">Solution to<a class="reference internal" href="#cross-count"> Exercise 11.13</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The first step to counting the people in each category is creating two Boolean matrices that encode the category to which each person belongs.
We start by determining which categories exist and then we use an <em>outer product</em> to create said matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∪</span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">SMDUW
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">↑</span><span class="w"> </span><span class="nv">maritalMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="o">∪</span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 0 0
0 1 0 0 0
0 1 0 0 0
0 1 0 0 0
0 0 1 0 0
0 0 1 0 0
0 0 0 1 0
1 0 0 0 0
0 0 0 1 0
0 0 0 1 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">↑</span><span class="w"> </span><span class="nv">graduateMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">graduated</span><span class="w"> </span><span class="na">∘.</span><span class="o">=</span><span class="w"> </span><span class="o">∪</span><span class="nv">graduated</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0
0 1
0 1
0 1
0 1
0 1
1 0
1 0
1 0
1 0
</span></div></div>
</div>
<p>Now, we can use an <em>inner product</em> to <em>add up</em> how many people have a specific marital status <em>and</em> a specific graduation status:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍉</span><span class="nv">graduateMat</span><span class="p">)</span><span class="o">+</span><span class="na">.</span><span class="o">∧</span><span class="nv">maritalMat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">31 28 31 36 32
26 27 37 28 24
</span></div></div>
</div>
<p>We can write this in a dfn and then add the totals row and column, as well as the labels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">CrossCount</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">binw</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">∪</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">bina</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">∪</span><span class="bp">⍺</span><span class="w"></span>
<span class="w">    </span><span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">bina</span><span class="na">∘.</span><span class="o">=</span><span class="bp">⍺</span><span class="p">)</span><span class="o">+</span><span class="na">.</span><span class="o">∧</span><span class="bp">⍵</span><span class="na">∘.</span><span class="o">=</span><span class="nv">binw</span><span class="w"></span>
<span class="w">    </span><span class="nv">mat</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
<span class="w">    </span><span class="nv">mat</span><span class="w"> </span><span class="o">⍪</span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">⌿</span><span class="w"> </span><span class="nv">mat</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">binw</span><span class="o">,⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">⍪</span><span class="p">(</span><span class="nv">bina</span><span class="o">,⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">mat</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="nv">CrossCount</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬──┬──┬──┬──┬──┬─────┐
│     │S │M │D │U │W │Total│
├─────┼──┼──┼──┼──┼──┼─────┤
│Y    │31│28│31│36│32│158  │
├─────┼──┼──┼──┼──┼──┼─────┤
│N    │26│27│37│28│24│142  │
├─────┼──┼──┼──┼──┼──┼─────┤
│Total│57│55│68│64│56│300  │
└─────┴──┴──┴──┴──┴──┴─────┘
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-33">

<p class="admonition-title">Solution to<a class="reference internal" href="#trim-long-subvectors"> Exercise 11.14</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>To use the operator <em>at</em>, we can choose one of two approaches:</p>
<ul class="simple">
<li><p>we compute the lengths of all the nested vectors and find the indices of the long ones; or</p></li>
<li><p>we use a Boolean function to determine which nested vectors are too long.</p></li>
</ul>
<p>In this particular example, both approaches are rather similar.
We can start by defining two small auxiliary functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Trim</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">3</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">IsLong</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">3</span><span class="o">&lt;≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">v</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="na">¨</span><span class="o">⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can use <code class="docutils literal notranslate"><span class="pre">IsLong</span></code> to determine the indices of all the nested vectors that are too long:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">longIndices</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="nv">IsLong</span><span class="na">¨</span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4 5
</span></div></div>
</div>
<p>Then, we can use the operator <em>at</em> to apply the function <code class="docutils literal notranslate"><span class="pre">Trim</span></code> on those indices.
We just have to remember to use <em>each</em> because, otherwise, the right argument of the function <code class="docutils literal notranslate"><span class="pre">Trim</span></code> would be a vector of all the vectors that are too long:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Trim</span><span class="na">@</span><span class="nv">longIndices</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">v</span><span class="w">  </span><span class="c1">⍝ ¨ missing</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      Trim@longIndices⊢v  ⍝ ¨ missing
      ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">Trim</span><span class="na">¨</span><span class="p">)</span><span class="na">@</span><span class="nv">longIndices</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬─────┬─────┐
│1│1 2│1 2 3│1 2 3│1 2 3│
└─┴───┴─────┴─────┴─────┘
</span></div></div>
</div>
<p>The alternative approach was to use the function <code class="docutils literal notranslate"><span class="pre">IsLong</span></code> as the Boolean selector, in which case it <em>also</em> needs the operator <em>each</em>.
The operator <em>each</em> is also needed in this case because the argument of the right operand of <em>at</em> is the whole array, and not each of its successive elements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">Trim</span><span class="na">¨</span><span class="p">)</span><span class="na">@</span><span class="nv">IsLong</span><span class="w"> </span><span class="nv">v</span><span class="w">  </span><span class="c1">⍝ ¨ missing</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR: Right operand and argument ranks differ
      (Trim¨)@IsLong v  ⍝ ¨ missing
             ∧
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">Trim</span><span class="na">¨</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="nv">IsLong</span><span class="na">¨</span><span class="p">)</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬─────┬─────┐
│1│1 2│1 2 3│1 2 3│1 2 3│
└─┴───┴─────┴─────┴─────┘
</span></div></div>
</div>
<p>Thus, our function <code class="docutils literal notranslate"><span class="pre">TrimLong</span></code> could be defined, for example, as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Trim</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">3</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">IsLong</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">3</span><span class="o">&lt;≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">TrimLong</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="nv">Trim</span><span class="na">¨</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="nv">IsLong</span><span class="na">¨</span><span class="p">)</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="solution admonition" id="Operators-solution-34">

<p class="admonition-title">Solution to<a class="reference internal" href="#rank"> Exercise 11.15</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>If we want to compute the totals for each <em>major cell</em>, one possible solution is to define an auxiliary function that computes totals for a matrix and then we can use the operator <em>rank</em> to apply it to each <em>major cell</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TotaliseMat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">m</span><span class="o">⍪+</span><span class="na">⌿</span><span class="nv">m</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">,+</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">Totalise</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">TotaliseMat</span><span class="na">⍤</span><span class="m">¯1</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">prod</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">?</span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">12</span><span class="o">⍴</span><span class="m">50</span><span class="w"></span>
<span class="nv">Totalise</span><span class="w"> </span><span class="nv">prod</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 9 16 42 50  2  3 11 45 17 37 29 36 297
34 19 32 12 37 15 46 24 49 28 36  9 341
43 35 74 62 39 18 57 69 66 65 65 45 638

29  5 45 23 27  4 23 16 39 22 22  2 257
46 20 47 17 18 25 13 38 42 38 45 28 377
75 25 92 40 45 29 36 54 81 60 67 30 634

37 19  5 10 30 49 16 18 46 47 47  3 327
39 23 41 20  6 40 21 22 40 49 20  1 322
76 42 46 30 36 89 37 40 86 96 67  4 649

13 36 12 40 12 15 24 20 21 12 19 25 249
 8 48 22 37 33  1 39 30 50 50  8 35 361
21 84 34 77 45 16 63 50 71 62 27 60 610

38 31 24 40 23  7 20 34 35  6 19 27 304
41  1 14 50 17 42  6 35 12 48 30 29 325
79 32 38 90 40 49 26 69 47 54 49 56 629
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-35">

<p class="admonition-title">Solution to<a class="reference internal" href="#cross-count-key"> Exercise 11.16</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We can use the operator <em>key</em> to group the status by the graduation value.
That way, we will have all the statuses of people who have graduated separated from the statuses of the people who have not graduated:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">status</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;SMDWU&#39;</span><span class="sr">[</span><span class="o">?</span><span class="m">300</span><span class="o">⍴</span><span class="m">5</span><span class="sr">]</span><span class="w"></span>
<span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">graduated</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;YN&#39;</span><span class="sr">[</span><span class="o">?</span><span class="m">300</span><span class="o">⍴</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="p">(</span><span class="m">10</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;...&#39;</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────┬─────────────┐
│SUSUUWMDDS...│MMMDDDMWUW...│
└─────────────┴─────────────┘
</span></div></div>
</div>
<p>In the code above, we show the first ten statuses for each group (graduated versus not graduated) but we do not know which is which.
To get that information, we must make use of the left argument of the operand:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,⊂</span><span class="p">(</span><span class="m">10</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;...&#39;</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─────────────┐
│Y│SUSUUWMDDS...│
├─┼─────────────┤
│N│MMMDDDMWUW...│
└─┴─────────────┘
</span></div></div>
</div>
<p>Now we know which group of statuses pertains to graduated people and which doesn’t.
The next step is grouping the statuses and counting each group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="kt">{</span><span class="o">≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Y 31 36 32 28 31
N 27 37 24 28 26
</span></div></div>
</div>
<p>This looks like a reasonable answer, although if you inspect the result closely, you will see that the numbers do not match what we computed in the previous version of this exercise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="nv">CrossCount</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬──┬──┬──┬──┬──┬─────┐
│     │S │M │D │U │W │Total│
├─────┼──┼──┼──┼──┼──┼─────┤
│Y    │31│28│31│36│32│158  │
├─────┼──┼──┼──┼──┼──┼─────┤
│N    │26│27│37│28│24│142  │
├─────┼──┼──┼──┼──┼──┼─────┤
│Total│57│55│68│64│56│300  │
└─────┴──┴──┴──┴──┴──┴─────┘
</span></div></div>
</div>
<p>What seems to be the issue..?
If you look even more closely, you will see that the problem is that the two rows we just computed with <code class="docutils literal notranslate"><span class="pre">{⍺,{≢⍵}⌸⍵}⌸</span></code> have the wrong order!
As we have seen in <a class="reference internal" href="#operators-order-of-the-result"><span class="std std-numref">Section 11.9.2</span></a>, the order in which <em>key</em> groups things is dependant on the order in which the key values first appear.
If we take a look at each group of statuses, separated by graduation data, we see that they do not have the same order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,⊂</span><span class="p">(</span><span class="m">10</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;...&#39;</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─────────────┐
│Y│SUSUUWMDDS...│
├─┼─────────────┤
│N│MMMDDDMWUW...│
└─┴─────────────┘
</span></div></div>
</div>
<p>For example, the first person that graduated is Single but the first person that did not graduate is Married.
To fix this, we can prepend a character vector with the desired order in the inner <em>key</em>.
Then, we need to subtract 1 from each count to make up for the fake value we added in the beginning:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="kt">{</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="s1">&#39;SMDUW&#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Y 31 28 31 36 32
N 26 27 37 28 24
</span></div></div>
</div>
<p>To make our solution even more robust, we can also force the order in which the outer <em>key</em> finds the graduated/not graduated categories.
For that, we prepend the two categories in the order we want and then we need to add two fake statuses to make sure both vectors have the same length.
Then, inside the operand, we need to start by dropping the fake status we added previously:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;YN&#39;</span><span class="o">,</span><span class="nv">graduated</span><span class="p">)</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="kt">{</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="s1">&#39;SMDUW&#39;</span><span class="o">,</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="s1">&#39;xx&#39;</span><span class="o">,</span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Y 31 28 31 36 32
N 26 27 37 28 24
</span></div></div>
</div>
<p>To conclude this exercise, we just need to add the totals and the labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">CrossCountKey</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">statusOrder</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;SMDWU&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;YN&#39;</span><span class="o">,</span><span class="bp">⍺</span><span class="p">)</span><span class="w"> </span><span class="kt">{{</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">statusOrder</span><span class="o">,</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="s1">&#39;  &#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="o">,</span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="nv">base</span><span class="w"></span>
<span class="w">    </span><span class="nv">base</span><span class="w"> </span><span class="o">⍪</span><span class="kd">←</span><span class="w"> </span><span class="o">+</span><span class="na">⌿</span><span class="nv">base</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="nv">statusOrder</span><span class="o">,⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">⍪</span><span class="p">(</span><span class="s1">&#39;YN&#39;</span><span class="o">,⊂</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">base</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">graduated</span><span class="w"> </span><span class="nv">CrossCountKey</span><span class="w"> </span><span class="nv">status</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────┬──┬──┬──┬──┬──┬─────┐
│     │S │M │D │W │U │Total│
├─────┼──┼──┼──┼──┼──┼─────┤
│Y    │31│28│31│32│36│158  │
├─────┼──┼──┼──┼──┼──┼─────┤
│N    │26│27│37│24│28│142  │
├─────┼──┼──┼──┼──┼──┼─────┤
│Total│57│55│68│56│64│300  │
└─────┴──┴──┴──┴──┴──┴─────┘
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-36">

<p class="admonition-title">Solution to<a class="reference internal" href="#house-market-sales"> Exercise 11.17</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The questions that were asked about the matrix <code class="docutils literal notranslate"><span class="pre">data</span></code> boil down to a series of applications of the operator <em>key</em>.</p>
<p>The first question asks:</p>
<ul class="simple">
<li><p>What was the most expensive house sold in each city, per year?</p></li>
</ul>
<p>To answer this, we can use the operator <em>key</em> with the columns for the year and the location given as the left argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕RL</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">73</span><span class="w"></span>
<span class="nv">data</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍉↑</span><span class="p">(</span><span class="m">2015</span><span class="o">+?</span><span class="m">103</span><span class="o">⍴</span><span class="m">3</span><span class="p">)(</span><span class="o">?</span><span class="m">103</span><span class="o">⍴</span><span class="m">4</span><span class="p">)((</span><span class="s1">&#39;LIS&#39;</span><span class="w"> </span><span class="s1">&#39;MAD&#39;</span><span class="w"> </span><span class="s1">&#39;BER&#39;</span><span class="p">)</span><span class="sr">[</span><span class="o">?</span><span class="m">103</span><span class="o">⍴</span><span class="m">3</span><span class="sr">]</span><span class="p">)(</span><span class="o">?</span><span class="m">100</span><span class="o">+</span><span class="m">103</span><span class="o">⍴</span><span class="m">300</span><span class="p">)</span><span class="w"></span>
<span class="nv">header</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;Year&#39;</span><span class="w"> </span><span class="s1">&#39;Quarter&#39;</span><span class="w"> </span><span class="s1">&#39;Location&#39;</span><span class="w"> </span><span class="s1">&#39;Sale&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="sr">[;</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,⌈</span><span class="na">⌿</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">data</span><span class="sr">[;</span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───┬───┐
│2016│BER│385│
├────┼───┼───┤
│2017│MAD│400│
├────┼───┼───┤
│2018│BER│395│
├────┼───┼───┤
│2017│BER│396│
├────┼───┼───┤
│2016│LIS│354│
├────┼───┼───┤
│2018│MAD│369│
├────┼───┼───┤
│2018│LIS│365│
├────┼───┼───┤
│2016│MAD│365│
├────┼───┼───┤
│2017│LIS│353│
└────┴───┴───┘
</span></div></div>
</div>
<p>The order of the result is a bit chaotic, but that could be fixed by sorting the result (which you will learn to do in <code class="xref std std-numref docutils literal notranslate"><span class="pre">Mathematical-Functions-Sorting-and-Searching-Data</span></code>).</p>
<p>Another alternative would be adding fake rows to the left argument to force the sorting to be like you want it to be.
This becomes a bit less cumbersome if you apply the operator <em>key</em> twice (once for the year and once for the location) instead of everything at once:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">years</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2015</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">⍳</span><span class="m">3</span><span class="w"></span>
<span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">data</span><span class="sr">[;</span><span class="m">3</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="w"> </span><span class="p">(</span><span class="nv">years</span><span class="o">,</span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="w"> </span><span class="kt">{</span><span class="o">⌈</span><span class="na">⌿</span><span class="o">,</span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">4</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="nv">data</span><span class="w"></span>
<span class="p">((</span><span class="o">⊂</span><span class="s1">&#39;Most expensive house&#39;</span><span class="p">)</span><span class="o">,</span><span class="nv">years</span><span class="p">)</span><span class="o">⍪</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────────────────┬────┬────┬────┐
│Most expensive house│2016│2017│2018│
├────────────────────┼────┼────┼────┤
│BER                 │385 │396 │395 │
├────────────────────┼────┼────┼────┤
│MAD                 │365 │400 │369 │
├────────────────────┼────┼────┼────┤
│LIS                 │354 │353 │365 │
└────────────────────┴────┴────┴────┘
</span></div></div>
</div>
<ul class="simple">
<li><p>How many sales did the real estate company make per year and per quarter?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Qs</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="m">4</span><span class="w"></span>
<span class="nv">mat</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">years</span><span class="o">,</span><span class="nv">data</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="p">)</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="kt">{</span><span class="m">¯1</span><span class="o">+≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">Qs</span><span class="o">,</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="nv">data</span><span class="w"></span>
<span class="s1">&#39;Year&#39;</span><span class="w"> </span><span class="s1">&#39;Q1&#39;</span><span class="w"> </span><span class="s1">&#39;Q2&#39;</span><span class="w"> </span><span class="s1">&#39;Q3&#39;</span><span class="w"> </span><span class="s1">&#39;Q4&#39;</span><span class="o">⍪</span><span class="nv">mat</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬──┬──┬──┬──┐
│Year│Q1│Q2│Q3│Q4│
├────┼──┼──┼──┼──┤
│2016│9 │8 │9 │13│
├────┼──┼──┼──┼──┤
│2017│5 │8 │4 │13│
├────┼──┼──┼──┼──┤
│2018│11│11│7 │5 │
└────┴──┴──┴──┴──┘
</span></div></div>
</div>
<ul class="simple">
<li><p>What was the volume of sales per year in millions of euros?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="p">(</span><span class="o">+</span><span class="na">⌿</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷</span><span class="m">1000</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">data</span><span class="sr">[;</span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2016 8.605
2017 7.455
2018 7.054
</span></div></div>
</div>
<ul class="simple">
<li><p>What about per year and per location?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="p">(</span><span class="o">+</span><span class="na">⌿</span><span class="bp">⍵</span><span class="p">)</span><span class="o">÷</span><span class="m">1000</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌸</span><span class="w"> </span><span class="nv">data</span><span class="sr">[;</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="sr">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────┬───┬─────┐
│2016│BER│3.838│
├────┼───┼─────┤
│2016│LIS│2.447│
├────┼───┼─────┤
│2016│MAD│2.32 │
└────┴───┴─────┘
┌────┬───┬─────┐
│2017│MAD│2.137│
├────┼───┼─────┤
│2017│BER│3.643│
├────┼───┼─────┤
│2017│LIS│1.675│
└────┴───┴─────┘
┌────┬───┬─────┐
│2018│BER│3.613│
├────┼───┼─────┤
│2018│MAD│1.817│
├────┼───┼─────┤
│2018│LIS│1.624│
└────┴───┴─────┘
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-37">

<p class="admonition-title">Solution to<a class="reference internal" href="#minesweeper"> Exercise 11.18</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>We will break the solution to this problem in two smaller problems.
First, we will compute a matrix with clues for all possible squares, counting how many mines are in the neighbouring region.
Then, we replace non-mine squares with the corresponding clues.</p>
<p>First, we use the operator <em>stencil</em> to count the mines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">mines</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="o">⍴</span><span class="s1">&#39;⎕*⎕⎕**⎕⎕*⎕⎕*&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">⎕*⎕⎕
**⎕⎕
*⎕⎕*
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="nv">clues</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">+</span><span class="na">⌿</span><span class="s1">&#39;*&#39;</span><span class="o">=,</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="nv">mines</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 3 2 0
4 4 3 1
3 3 2 1
</span></div></div>
</div>
<p>Now, we can use <em>index of</em> to find which indices do not pertain to mines and then we use the operator <em>at</em> to do the replacement:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">notMines</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="s1">&#39;*&#39;</span><span class="o">≠</span><span class="nv">mines</span><span class="w"></span>
<span class="nv">clues</span><span class="sr">[</span><span class="nv">notMines</span><span class="sr">]</span><span class="na">@</span><span class="nv">notMines</span><span class="o">⊢</span><span class="nv">mines</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 * 2 0
* * 3 1
* 3 2 *
</span></div></div>
</div>
<p>We can put both steps together in a small function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">MakeClues</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">clues</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">+</span><span class="na">⌿</span><span class="s1">&#39;*&#39;</span><span class="o">=,</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="o">⊢</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">notMines</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍸</span><span class="s1">&#39;*&#39;</span><span class="o">≠</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">    </span><span class="nv">clues</span><span class="sr">[</span><span class="nv">notMines</span><span class="sr">]</span><span class="na">@</span><span class="nv">notMines</span><span class="o">⊢</span><span class="bp">⍵</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MakeClues</span><span class="w"> </span><span class="nv">mines</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 * 2 0
* * 3 1
* 3 2 *
</span></div></div>
</div>
<div class="solution admonition" id="Operators-solution-38">

<p class="admonition-title">Solution to<a class="reference internal" href="#stencil-n-wise-reduction"> Exercise 11.19</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The operator <em>stencil</em> can be used to create the windows of size <code class="docutils literal notranslate"><span class="pre">n</span></code> that we need, and then we can use a regular <em>reduction</em> inside each window.</p>
<p>For example, here is a pairwise sum:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="na">/</span><span class="w"> </span><span class="o">⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5 7 9 11 13 15 17 19
</span></div></div>
</div>
<p>And the same thing with the operator <em>stencil</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">2</span><span class="o">⊢⍳</span><span class="m">10</span><span class="w"></span>
<span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">2</span><span class="o">⊢⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┬───┬───┬───┬────┐
│1 2│2 3│3 4│4 5│5 6│6 7│7 8│8 9│9 10│
└───┴───┴───┴───┴───┴───┴───┴───┴────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5 7 9 11 13 15 17 19
</span></div></div>
</div>
<p>There are two things we have to pay attention to, though.
The first one has to do with the padding that <em>stencil</em> adds, which we need to get rid of.</p>
<p>Compare this <em>n-wise multiplication</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span><span class="o">×</span><span class="na">/</span><span class="w"> </span><span class="o">⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">24 120
</span></div></div>
</div>
<p>With the similar code that uses <em>stencil</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">4</span><span class="o">⊢⍳</span><span class="m">5</span><span class="w"></span>
<span class="kt">{</span><span class="o">×</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">4</span><span class="o">⊢⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬───────┬───────┬───────┐
│0 1 2 3│1 2 3 4│2 3 4 5│3 4 5 0│
└───────┴───────┴───────┴───────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">0 24 120 0
</span></div></div>
</div>
<p>To fix this issue, we need to compute how much padding is added and we need to <em>drop</em> from the beginning and the end the results that came from windows that had padding.
Recall that in <a class="reference internal" href="#operators-padding-and-window-size"><span class="std std-numref">Section 11.10.2</span></a> we saw the formula to compute how much padding <em>stencil</em> adds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ws</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="nv">p</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌊</span><span class="p">(</span><span class="nv">ws</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="o">↓</span><span class="nv">p</span><span class="o">↓</span><span class="w"> </span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="nv">ws</span><span class="o">⊢⍳</span><span class="m">5</span><span class="w"></span>
<span class="vg">⎕</span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="o">↓</span><span class="nv">p</span><span class="o">↓</span><span class="w"> </span><span class="kt">{</span><span class="o">×</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="nv">ws</span><span class="o">⊢⍳</span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────┬───────┐
│1 2 3 4│2 3 4 5│
└───────┴───────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">24 120
</span></div></div>
</div>
<p>The second thing to bear in mind is how this is written in a <em>user-defined operator</em>.</p>
<p>We could write a tradop:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="bp">∇</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="p">(</span><span class="nv">F</span><span class="w"> </span><span class="nv">_NWiseReduce</span><span class="p">)</span><span class="w"> </span><span class="nv">vector</span><span class="w"> </span><span class="sr">;</span><span class="nv">p</span><span class="w"></span>
<span class="w">    </span><span class="nv">p</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌊</span><span class="p">(</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="o">↓</span><span class="nv">p</span><span class="o">↓</span><span class="kt">{</span><span class="nv">F</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="nv">n</span><span class="o">⊢</span><span class="nv">vector</span><span class="w"></span>
<span class="bp">∇</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="nv">_NWiseReduce</span><span class="w"> </span><span class="o">⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 5 7 9 11 13 15 17 19
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="w"> </span><span class="o">×</span><span class="nv">_NWiseReduce</span><span class="w"> </span><span class="o">⍳</span><span class="m">10</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">720 5040 20160 60480 151200
</span></div></div>
</div>
<p>We can also write a drop.
In that case, the left operand to the dop will be used inside a dfn that is the operand of <em>stencil</em>.
This apparently correct definition does not work:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_NWiseReduce</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">p</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌊</span><span class="p">(</span><span class="bp">⍺</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="o">↓</span><span class="nv">p</span><span class="o">↓</span><span class="kt">{</span><span class="bp">⍺⍺</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="bp">⍺</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The issue lies in the fact that <code class="docutils literal notranslate"><span class="pre">_NWiseReduce</span></code> isn’t really a dop because it does not reference neither <code class="docutils literal notranslate"><span class="pre">⍺⍺</span></code> nor <code class="docutils literal notranslate"><span class="pre">⍵⍵</span></code>.
The <code class="docutils literal notranslate"><span class="pre">{⍺⍺/⍵}</span></code> does <strong>not</strong> make <code class="docutils literal notranslate"><span class="pre">_NWiseReduce</span></code> a dop.
Instead, it makes it look like <code class="docutils literal notranslate"><span class="pre">{⍺⍺/⍵}</span></code> is an operator and we trying to pass it as the left operand to <em>stencil</em>.
Instead, we need to give a name to the left operand and then use that name inside the operand to <em>stencil</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_NWiseReduce</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">F</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺⍺</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌊</span><span class="p">(</span><span class="bp">⍺</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="o">↓</span><span class="nv">p</span><span class="o">↓</span><span class="kt">{</span><span class="nv">F</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="bp">⍺</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="solution admonition" id="Operators-solution-39">

<p class="admonition-title">Solution to<a class="reference internal" href="#power-if"> Exercise 11.20</a></p>
<div class="section" id="solution-content">
</div>
</div>
<p>The conditional execution of <code class="docutils literal notranslate"><span class="pre">F</span></code> can be achieved with the operator <em>power</em> if we use the Boolean <code class="docutils literal notranslate"><span class="pre">G</span> <span class="pre">right</span></code> as the right operand to <em>power</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_If_</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="p">(</span><span class="bp">⍺⍺</span><span class="na">⍣</span><span class="p">(</span><span class="bp">⍵⍵</span><span class="w"> </span><span class="bp">⍵</span><span class="p">))</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TimesTen</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">10</span><span class="o">×</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
<span class="nv">IsSmall</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="o">&lt;</span><span class="m">10</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TimesTen</span><span class="w"> </span><span class="nv">_If_</span><span class="w"> </span><span class="nv">IsSmall</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">50
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">TimesTen</span><span class="w"> </span><span class="nv">_If_</span><span class="w"> </span><span class="nv">IsSmall</span><span class="w"> </span><span class="m">12</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
</span></div></div>
</div>
<p>To make the derived function of <code class="docutils literal notranslate"><span class="pre">_If_</span></code> ambivalent, we can resort to a clever trick and the conditional assignment to <code class="docutils literal notranslate"><span class="pre">⍺</span></code> inside dfns.
We assign <code class="docutils literal notranslate"><span class="pre">⍺</span></code> to the <em>right tack</em> which is the identity function, and then we just put <code class="docutils literal notranslate"><span class="pre">⍺</span></code> on the left of <code class="docutils literal notranslate"><span class="pre">⍺⍺</span></code> and <code class="docutils literal notranslate"><span class="pre">⍵⍵</span></code>.
If the value of <code class="docutils literal notranslate"><span class="pre">⍺</span></code> was provided (if the derived function is being used dyadically), then that value is passed to the left and right operands, as intended.
If the derived function is being used monadically, then <code class="docutils literal notranslate"><span class="pre">⍺</span></code> is set to the <em>identity function</em>, and it won’t change anything:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">_If_</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍺</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊢</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="bp">⍺</span><span class="w"> </span><span class="p">(</span><span class="bp">⍺⍺</span><span class="na">⍣</span><span class="p">(</span><span class="bp">⍺</span><span class="w"> </span><span class="bp">⍵⍵</span><span class="w"> </span><span class="bp">⍵</span><span class="p">))</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="w"> </span><span class="o">+</span><span class="nv">_If_</span><span class="w"> </span><span class="nv">IsSmall</span><span class="w"> </span><span class="m">8</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">18
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="w"> </span><span class="o">+</span><span class="nv">_If_</span><span class="w"> </span><span class="nv">IsSmall</span><span class="w"> </span><span class="m">13</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">13
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Nested-Arrays-Continued.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">10. </span>Nested Arrays (Continued)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Tacit-Programming.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">12. </span>Tacit Programming</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Bernard Legrand, reworked by Rodrigo Girão Serrão.<br/>
  
    <div class="extra_footer">
      <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
</a></p>
<p>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>